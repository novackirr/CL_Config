<?xml version="1.0" encoding="windows-1251"?>
<!-- edited with XML Spy v4.3 U (http://www.xmlspy.com) by LEGO (LEGO) -->
<FORM_DESCRIPTION xmlns="http://www.cognitive.ru/XML/2001/ctform" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.cognitive.ru/XML/2001/ctform  ctform.xsd" name="LRequest223">
  <CONTENT_MODEL dfattchfiles="|Document|files" dfnumberdoc="|Document|Число_регномера" key="Key">
    <E name="Key" datatype="integer" index="false" default="&quot;1&quot;" view="invisible" displayname="Ключ" dfprotected="true" />
    <E name="ИД_последний_редактор" datatype="text" index="true" displayname="ИД последний редактор" dfhidden="true" view="invisible" />
    <E name="Имя_последний_редактор" datatype="text" index="true" displayname="Имя последний редактор" dfhidden="true" view="invisible" />
    <S name="Document" displayname="Документ" use="LRequest">
      <E displayname="Регистрационный номер" name="Регистрационный_номер" datatype="text(249)" index="true" dfprotected="true" dfhidden="true" />
      <E displayname="Префикс рег. номера" name="Префикс_регномера" datatype="dictionary(Prefix,text)" edit="combobox(Prefix)" index="true" view="invisible" dfprotected="false" />
      <E displayname="Порядковый рег. номер" name="Число_регномера" datatype="integer(+1..)" index="true" view="invisible" dfprotected="true" required="true" />
      <E displayname="Суффикс рег. номера" name="Суффикс_регномера" datatype="dictionary(Suffix,text)" edit="combobox(Suffix)" dfprotected="false" index="true" view="invisible" />
      <E displayname="Дата регистрации" name="Дата_регистрации" datatype="date" edit="" index="true" dfprotected="true" required="true" esp="false" default="nowdate()" />
      <E displayname="Вид документа" name="Вид_документа" datatype="dictionary(VidDocNames,text)" index="true" dfprotected="true" required="false" edit="combobox" value="&quot;Запрос на разъяснение&quot;" view="invisible" />
      <E displayname="Краткое содержание" name="Краткое_содержание" datatype="longtext" euflag="7" index="true" dfprotected="true" required="false" edit="multiline" awindex="true" value=" Описание_запроса " view="invisible" />
      <E displayname="Имя потока" name="Имя_потока" datatype="text" index="false" view="invisible" dfprotected="true" dfhidden="true" esp="false" />
      <E displayname="ИД потока" name="ИД_потока" datatype="integer" index="false" dfprotected="true" dfhidden="false" esp="false" view="invisible" />
      <E displayname="ИД регистратора" name="ИД_регистратора" datatype="integer" index="false" dfprotected="true" dfhidden="false" esp="false" view="invisible" />
      <E name="header" datatype="text" index="false" value="&quot;Запрос на разъяснение&quot;" view="invisible" />
      <E name="subheader" datatype="text" index="false" view="invisible" />
      <E name="Номер_извещения" datatype="text" index="true" displayname="Номер извещения" />
      <E name="Номер_запроса" datatype="text" index="true" displayname="Номер запроса" />
      <E name="Дата_публикации_запроса" datatype="datetime" index="true" displayname="Дата публикации запроса" />
      <E name="Описание_запроса" datatype="longtext" index="true" displayname="Описание запроса" awindex="true" euflag="7" />
      <A name="Участник_размещения_заказа" displayname="Участник размещения заказа" use="table">
        <S name="S1">
          <E name="Участник_размещения_ФИО" datatype="longtext" index="true" displayname="Участник размещения ФИО" />
          <E name="Участник_размещения_email" datatype="text" index="true" displayname="Участник размещения email" />
        </S>
      </A>
      <E name="Опубликован_ответ" datatype="boolean" index="true" displayname="Опубликован ответ" value=" Дата_публикации_разъяснения &lt;&gt;&quot;&quot;" default="0" />
      <E name="Дата_публикации_разъяснения" datatype="datetime" index="true" displayname="Дата публикации разъяснения" />
      <E name="Номер_разъяснения" datatype="text" index="true" displayname="Номер разъяснения" />
      <E name="Описание_разъяснения" datatype="longtext" index="true" displayname="Описание разъяснения" euflag="7" awindex="true" />
      <E name="ИД_извещения" datatype="integer" index="true" displayname="ИД извещения" view="invisible" />
      <E name="Номер_закупки_в_ЕИС" datatype="text" index="true" displayname="Номер закупки в ЕИС" view="invisible" />
      <E name="Статус" datatype="text" index="true" edit="textbox" required="false" default="&quot;Черновик&quot;" />
      <E name="Инициатор_запроса" datatype="longtext" index="true" displayname="Инициатор запроса" />
      <E name="email_Инициатора_запроса" datatype="text" index="true" displayname="email Инициатора запроса" />
      <E name="Код_типа_запроса" datatype="text" index="true" displayname="Код типа запроса" />
      <E name="ИД_процедуры" datatype="text" index="true" displayname="ИД процедуры" />
      <E name="Отклонение" datatype="boolean" index="true" displayname="Отклонение" />
      <E name="Дата_отклонения" datatype="date" index="true" displayname="Дата отклонения" />
      <E name="Причина_отклонения" datatype="longtext" index="true" displayname="Причина отклонения" />
      <E name="ИД_запроса_ЕЭТП" datatype="text" index="true" displayname="ИД_запроса_ЕЭТП" />
      <E name="Наименование_объекта_закупки" datatype="longtext" index="true" displayname="Наименование_объекта_закупки" />
      <E name="ИД_лота_на_ЭТП" datatype="text" index="true" displayname="ИД лота на ЭТП" />
      <E name="ИД_ЭТП" datatype="text" index="true" displayname="ИД ЭТП" />
      <S name="Организатор_закупки" displayname="Организатор закупки">
        <E name="Организатор_закупки_наименование" datatype="dictionary(Организации заказчики,text)@Краткое наименование" index="true" displayname="Организатор закупки наименование" required="true" dictpath="" edit="textbox" absettings="&lt;ROOT title=&quot;Организатор закупки&quot; IsMultiple=&quot;False&quot; CanSelectNobody=&quot;True&quot; SelectedUser=&quot;True&quot; SelectedGroup=&quot;True&quot; SelectedDepartments=&quot;True&quot;&gt;&lt;DateDictionary Name=&quot;Departments&quot; DisplayName=&quot;Структура предприятия&quot; /&gt;&lt;/ROOT&gt;" extype="addressbook" abdata="Name" />
        <E name="Организатор_закупки" datatype="integer" index="true" displayname="Организатор закупки" required="false" dictpath="" view="invisible" extype="addressbook" abdata="Id" />
        <E name="Организатор_закупки_ИНН" datatype="text" index="true" extype="addressbook" abdata="INN" displayname="Организатор закупки ИНН" />
        <E name="Организатор_закупки_КПП" datatype="text" index="true" extype="addressbook" abdata="KPP" displayname="Организатор закупки КПП" />
        <E name="Организатор_закупки_ОРГН" datatype="text" index="true" extype="addressbook" abdata="OGRN" displayname="Организатор закупки ОРГН" />
        <E name="Ид_организации_на_ЭТП" datatype="text" index="true" displayname="Ид организации на ЭТП" />
        <E name="Организатор_закупки_спраочный_код" datatype="text" index="true" displayname="Организатор закупки спраочный код" />
        <E name="Организатор_закупки_ЕИС" datatype="text" index="true" displayname="Организатор закупки ЕИС" />
      </S>
      <S name="Организация_заказчик" displayname="Организация заказчик">
        <E name="Организация_заказчик_наименование" datatype="longtext" index="true" dictpath="" required="true" displayname="Организация заказчик наименование" absettings="&lt;ROOT title=&quot;Организация заказчик&quot; IsMultiple=&quot;False&quot; CanSelectNobody=&quot;False&quot; SelectedUser=&quot;False&quot; SelectedGroup=&quot;False&quot; SelectedDepartments=&quot;False&quot;&gt;&lt;DateDictionary Name=&quot;Departments&quot; DisplayName=&quot;Структура предприятия&quot; /&gt;&lt;/ROOT&gt;" edit="textbox" extype="addressbook" abdata="Name" />
        <E name="Организация_заказчик" datatype="integer" index="true" displayname="Организация заказчик" required="false" dictpath="" extype="addressbook" abdata="Id" />
        <E name="Организация_заказчик_ИНН" datatype="text" index="true" displayname="Организация_заказчик_ИНН" extype="addressbook" abdata="INN" />
        <E name="Организация_заказчик_КПП" datatype="text" index="true" displayname="Организация_заказчик_КПП" extype="addressbook" abdata="KPP" />
        <E name="Организация_заказчик_Адрес" datatype="text" index="true" displayname="Организация_заказчик_Адрес" extype="addressbook" abdata="Адрес" />
        <E name="Организация_заказчик_Телефон" datatype="text" index="true" displayname="Организация_заказчик_Телефон" extype="addressbook" abdata="Телефоны" />
        <E name="Организация_заказчик_Электронная_почта" datatype="text" index="true" displayname="Организация_заказчик_Электронная_почта" extype="addressbook" abdata="E-mail" />
        <E name="Организация_заказчик_ОГРН" datatype="text" index="true" extype="addressbook" abdata="OGRN" />
        <E name="Организация_заказчик_ЕИС" datatype="text" index="true" displayname="Организация_заказчик ЕИС" extype="addressbook" abdata="EISCode223" />
        <E name="ИД_заказчика_на_ЭТП" datatype="text" index="true" displayname="ИД заказчика на ЭТП" />
      </S>
      <S name="Подразделение_инициатор" displayname="Подразделение инициатор">
        <E name="Подразделение_инициатор_наименование" datatype="text" index="true" displayname="Подразделение инициатор наименование" required="true" dictpath="" edit="tool(CallTools.AddressBookTool)" absettings="&lt;ROOT title=&quot;Организатор закупки&quot; IsMultiple=&quot;False&quot; CanSelectNobody=&quot;False&quot; SelectedUser=&quot;False&quot; SelectedGroup=&quot;False&quot; SelectedDepartments=&quot;True&quot;&gt;&lt;DateDictionary Name=&quot;Departments&quot; DisplayName=&quot;Структура предприятия&quot; /&gt;&lt;/ROOT&gt;" abdata="Name" />
        <E name="Подразделение_инициатор" datatype="integer" index="true" displayname="Подразделение инициатор" required="false" dictpath="" edit="textbox" abdata="Id" extype="addressbook" view="invisible" />
      </S>
      <E name="Текст_подписи" datatype="longtext" index="true" displayname="Текст подписи" awindex="true" euflag="7" />
      <A name="Заказчик_права_таблица" displayname="Заказчик права таблица">
        <S name="S1">
          <E name="Заказчик_код_права" datatype="integer" index="true" displayname="Заказчик код права" />
          <E name="Заказчик_наименование_права" datatype="text" index="true" displayname="Заказчик наименование права" />
        </S>
      </A>
      <S name="Ответственный_исполнитель" displayname="Ответственный исполнитель">
        <E name="Ответственный_исполнитель" datatype="integer" index="true" displayname="Ответственный исполнитель" extype="addressbook" abdata="Id" view="invisible" />
        <E name="Ответственный_исполнитель_ФИО" datatype="text" index="true" displayname="Ответственный исполнитель ФИО" dictpath="" edit="textbox,tool(CallTools.AddressBookTool)" absettings="&lt;ROOT title=&quot;Ответственный исполнитель ФИО&quot; IsMultiple=&quot;False&quot; CanSelectNobody=&quot;False&quot; SelectedUser=&quot;True&quot; SelectedGroup=&quot;False&quot; SelectedDepartments=&quot;False&quot;&gt;&lt;DateDictionary Name=&quot;Persons&quot; DisplayName=&quot;Пользователи&quot; /&gt;&lt;DateDictionary Name=&quot;Departments&quot; DisplayName=&quot;Структура предприятия&quot; /&gt;&lt;/ROOT&gt;" required="false" abdata="Name" extype="addressbook" />
      </S>
      <E name="Участник_закупки_СМП" datatype="boolean" index="true" displayname="Участник закупки СМП" />
      <S name="Инициатор" displayname="Инициатор">
        <E name="ФИО_инициатора" datatype="text" index="true" absettings="&lt;ROOT title=&quot;Выбор сотрудника&quot; IsMultiple=&quot;False&quot; CanSelectNobody=&quot;False&quot; SelectedUser=&quot;True&quot; SelectedGroup=&quot;False&quot; SelectedDepartments=&quot;False&quot;&gt;&lt;DateDictionary Name=&quot;Departments&quot; DisplayName=&quot;Структура предприятия&quot; /&gt;&lt;/ROOT&gt;" edit="textbox" displayname="ФИО инициатора" abdata="Name" extype="addressbook" />
        <E name="ИД_Инициатора" datatype="integer" index="true" extype="addressbook" displayname="ИД Инициатора" abdata="Id" view="invisible" />
        <E name="Должность_инициатора" datatype="text" index="true" displayname="Должность инициатора" abdata="Post" />
        <E name="Табельный_номер_инициатора" datatype="integer" index="true" displayname="Табельный номер инициатора" />
      </S>
      <E name="Дата_создания" datatype="datetime" index="true" displayname="Дата создания" />
      <E name="ИД_запроса" datatype="integer" index="true" displayname="ИД запроса" />
      <E name="RFI" datatype="boolean" index="true" displayname="RFI" />
      <E name="ИД_запроса_лот" datatype="integer" index="true" displayname="ИД запроса лот" />
      <E name="Создана_в_Е1" datatype="boolean" index="true" displayname="Создана в Е1" />
      <S name="Поставщик" displayname="Поставщик">
        <E name="Поставщик_наименование" datatype="longtext" index="true" displayname="Поставщик наименование" />
        <E name="Поставщик_код" datatype="text" index="true" displayname="Поставщик код" />
        <E name="Поставщик_ИНН" datatype="text" index="true" displayname="Поставщик ИНН" />
        <E name="Поставщик_КПП" datatype="text" index="true" displayname="Поставщик КПП" />
        <E name="Поставщик_телефон" datatype="text" index="true" displayname="Поставщик телефон" />
        <E name="Поставщик_email" datatype="text" index="true" displayname="Поставщик email" />
        <E name="Поставщик_номер_заявки" datatype="text" index="true" displayname="Поставщик номер заявки" />
        <E name="Поставщик_дата_подачи_заявки" datatype="datetime" index="true" displayname="Поставщик дата подачи заявки" />
        <E name="Поставщик_ИД_на_ЭТП" datatype="text" index="true" displayname="Поставщик ИД на ЭТП" />
        <E name="Поставщик_фирменное_наименование" datatype="longtext" index="true" displayname="Поставщик фирменное наименование" />
      </S>
      <E name="Срок_предоставления_ответа" datatype="datetime" index="true" displayname="Срок предоставления ответа" />
      <E name="Название_закупки" datatype="longtext" index="true" displayname="Название закупки" dictpath="" awindex="true" euflag="7" required="true" />
      <E name="Блокировать_по_истечению_срока" datatype="boolean" index="true" displayname="Блокировать_по_истечению срока" />
      <E name="Год_закупки" datatype="integer" index="true" displayname="Год закупки" view="invisible" />
      <S name="Ответсвенный_за_ответ" displayname="Ответсвенный за ответ">
        <E name="Ответсвенный_за_ответ" datatype="integer" index="true" displayname="Ответсвенный за ответ" extype="addressbook" abdata="Id" />
        <E name="Ответсвенный_за_ответ_ФИО" datatype="text" index="true" displayname="Ответсвенный за ответ ФИО" abdata="Name" />
      </S>
      <E name="Переназначен_ответственный" datatype="boolean" index="true" displayname="Переназначен ответственный" />
      <S name="ГРБС" displayname="ГРБС">
        <E name="ГРБС_наименование" datatype="longtext" index="true" dictpath="" required="false" displayname="ГРБС_наименование" extype="addressbook" abdata="Name" />
        <E name="ГРБС" datatype="integer" index="true" displayname="ГРБС" required="false" dictpath="" extype="addressbook" abdata="Id" />
      </S>
      <E name="Сгенерировать_файл_на_площадке" datatype="boolean" index="true" displayname="Сгенерировать файл на площадке" />
      <S name="Сбербанк_АСТ" displayname="Сбербанк АСТ">
        <E name="ИД_документа_на_ЭТП" datatype="integer" index="true" displayname="ИД документа на ЭТП" />
        <E name="Тема_запроса" datatype="longtext" index="true" displayname="Тема запроса" />
        <E name="Тема_разъяснения" datatype="longtext" index="true" displayname="Тема разъяснения" />
        <E name="Разместить_файл_запроса_участника" datatype="boolean" index="true" displayname="Разместить файл запроса участника" />
        <E name="ИД_черновика_запроса_на_ЭТП" datatype="text" index="true" displayname="ИД черновика запроса на ЭТП" />
        <E name="Возможность_внести_корректировки" datatype="text" index="true" displayname="Возможность внести корректировки" />
        <E name="Дополнительный_mail" datatype="longtext" index="true" displayname="Дополнительный mail" />
        <E name="Основание_внесения_изменений" datatype="longtext" index="true" displayname="Основание внесения изменений" />
        <E name="Сведения_о_предмете_запроса" datatype="longtext" index="true" displayname="Сведения о предмете запроса"/>
      </S>
      <E name="Форма_торгов_код" datatype="text" index="true" displayname="Форма торгов код" />
      <E name="Форма_торгов" datatype="text" index="true" displayname="Форма торгов" />
      <E name="ИД_извещения_на_ЭТП" datatype="text" index="true" displayname="ИД извещения на ЭТП" />
      <E name="Номер_лота_в_извещении" datatype="integer" index="true" displayname="Номер лота в извещении" />
      <E name="Предмет_договора" datatype="longtext" index="true" displayname="Предмет договора" awindex="true" />
      <E name="Разъяснение_без_запроса" datatype="boolean" index="true" displayname="Разъяснение без запроса" />
      <E name="Актуальность" datatype="boolean" index="true" displayname="Актуальность" />
      <E name="Внесение_изменений" datatype="boolean" index="true" displayname="Внесение изменений" />
      <E name="Номер_редакции" datatype="integer" index="true" displayname="Номер редакции" />
      <E name="Guid_редакции" datatype="text" index="true" displayname="Guid редакции" />
      <E name="ParentRK" datatype="text" index="true" displayname="ParentRK" />
    </S>
    <S name="FilesRequest" use="FilesProtocol" displayname="Документы запроса">
      <E name="header" datatype="text" index="false" value="&quot;Документы запроса&quot;" view="invisible" />
      <E name="subheader" datatype="text" index="false" view="invisible" />
    </S>
    <S name="FilesIntegration" use="FilesIntegration" displayname="Файлы интеграции">
      <E name="header" datatype="text" index="false" value="&quot;Файлы интеграции&quot;" view="invisible" />
      <E name="subheader" datatype="text" index="false" view="invisible" />
    </S>
    <S name="Документы_разъяснения" displayname="Документы разъяснения" use="Filesreq">
      <E name="header" datatype="text" index="false" value="&quot;Документы разъяснения&quot;" view="invisible" />
      <E name="subheader" datatype="text" index="false" view="invisible" />
    </S>
  </CONTENT_MODEL>
  <SCRIPT language="VBScript">Dim oTrace

Dim saveCheck
saveCheck=0

Sub generate_num

'oTrace.Trace " VBCRPT generate_num..."

  Dim rn
  pref = Data("|Document|Префикс_регномера").Value
  num = Data("|Document|Число_регномера").Value
  suf = Data("|Document|Суффикс_регномера").Value

 if Len(num) = 0 then
'	oTrace.Trace " VBCRPT End generate_num(Нет номера)"
	Exit Sub
 end if

  if Len(pref)&gt;0 then
	rn = CStr(rn) + pref + "-"
  end if
  rn = CStr(rn) + CStr(num)
  if Len(suf)&gt;0 then
     rn = CStr(rn) + "-" + CStr(suf)
  end if

    Data("|Document|Регистрационный_номер")=CStr(rn)
    Exit Sub

'  oTrace.Trace " VBCRPT End generate_num"
  err_exit:
  Form.MsgBox err.Description
End Sub
    

Sub clear_all_readonly
'   oTrace.Trace " VBCRPT clear_all_readonly..."
    Data("|Document|Число_регномера").Attribute("readonly")=""
'      oTrace.Trace " VBCRPT end clear_all_readonly"
End Sub

 Sub prepare_completed
'   oTrace.Trace " VBCRPT prepare_completed..."
    clear_all_readonly
    Data("|Document|Число_регномера").Attribute("readonly")="true"
'   oTrace.Trace " VBCRPT End prepare_completed"
    End Sub

    Sub prepare_wfclosed
'    oTrace.Trace " VBCRPT prepare_wfclosed..."
'    oTrace.Trace " VBCRPT End prepare_wfclosed"
    End Sub

    Sub prepare_finder
'    oTrace.Trace " VBCRPT prepare_finder..."
    clear_all_readonly
'    oTrace.Trace " VBCRPT End prepare_finder"
    End Sub

    Sub prepare_registration
'    oTrace.Trace " VBCRPT prepare_registration..."
    clear_all_readonly
    Data("|Document|Число_регномера").Attribute("readonly")="true"
'    oTrace.Trace " VBCRPT End prepare_registration"
    End Sub

    Sub Form_NamedEvent( evt )
'    oTrace.Trace " VBCRPT Form_NamedEvent..."
    if evt = "dfmakestrregnum" then
    generate_num
    End If
    if evt = "dfrgmregistration" then
    prepare_registration
    End If
    if evt = "dfrgmfinder" then
    prepare_finder
    End If
    if evt = "dfrgmcompleted" then
    prepare_completed
    End If
    if evt = "dfrgmwfclosed" then
    prepare_wfclosed
    End if


    if evt="dfpreparestrregnum" then 'началось сохранение документа
       saveCheck=1
    end if

    if evt="dfmakestrregnum" then 'закончилось сохранение документа
       saveCheck=0
    end if

'   oTrace.Trace " VBCRPT End Form_NamedEvent"
    End Sub

Set ctx = CreateObject("Form.ExecutionContext")

    Sub Form_Load
'    Set oTrace = CreateObject("TRACE.VBTracer")
'    oTrace.Trace " VBCRPT End Form_Load"



    End Sub

    Sub Form_Unload
'    oTrace.Trace " VBCRPT Form_Unload..."
'    Set oTrace = Nothing
    End Sub

    sub form_FieldDataChanged(field)
    s = field.Attribute("frm.abstoredata")
    if s &lt;&gt; "" and field.Value = "" then
    Set arr = field.Parent(s)
    if not arr is nothing then
    arr.RemoveAll
    end if
    end if

   ' Документ не сохраняется
   if saveCheck=0 then

          

    end if

end sub</SCRIPT>
  <plugins>
    <restriction displayname="Генерация номера" progid="Euphfrm.RegNumGenerator" root="" initstring="">
      <arg role="numberdoc" path="|S|Число_регномера" />
      <arg role="flow" path="|S|ИД_потока" />
      <arg role="regnum" path="|S|Регистрационный_номер" />
      <checkentry type="onevent" param="dfgenerateregnum" action="error" />
    </restriction>
    <dictionary name="Тип связки" progid="FrmTools.DictSource" inittime="once" initstring="stored:Тип связки" />
    <dictionary name="Месяцы" progid="FrmTools.DictSource" inittime="field" initstring="stored:Месяцы" />
    <dictionary name="Статусы заявки" progid="FrmTools.DictSource" inittime="once" initstring="stored:Статусы заявки" />
    <dictionary name="Валюта" progid="FrmTools.DictSource" inittime="field" initstring="stored:Валюта" />
    <dictionary name="Основание внесения изменений" progid="FrmTools.DictSource" inittime="once" initstring="stored:Основание внесения изменений" />
    <dictionary name="Статусы запроса " progid="FrmTools.DictSource" inittime="once" initstring="stored:Статусы запроса " />
  </plugins>
</FORM_DESCRIPTION>