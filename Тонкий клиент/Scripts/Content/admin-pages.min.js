var AdminPages=function(n,t,i,r,u,f,e,o,s){var h={users:[],organizations:[],isApprovePage:!0,accountPermissionInfoUrl:"",lawSwitcherEnabled:!0,actionURL:"",deleteActionURL:"",deleteEventHandler:null,organizationsInited:!1,usersInited:!1,initDeactivatedPersons:!1,orgsAndUsersInited:!1,init:function(n,t,i,r,u,f,e,o,s){this.users=n;this.organizations=t;this.isApprovePage=i;this.accountPermissionInfoUrl=r;this.lawSwitcherEnabled=u;this.actionURL=f;this.deleteActionURL=e;this.deleteEventHandler=o;this.initDeactivatedPersons=s;addParsleyValidation("form");this.addEventHandlers();this.initChosenSelects();this.resetControls()},addEventHandlers:function(){this.addUserChangeEvent();this.addFormSubmitEvent();this.addDeleteClick();this.addUserClickEvent()},initChosenSelects:function(){var t,n;$("#User").prop("disabled",!0);$(".chosen-select").chosen({search_contains:!0});t=$("#WorkGroup option[data-isfz44]").size()==0?[]:[1];this.toggleRowElem(t,$(".workGroup-ctl"));n=$("#Role option[data-isfz44]").size()==0?[]:[1];this.toggleRowElem(n,$(".role-ctl"));this.toggleRowElem(n,$(".accessGroup-ctl"))},resetControls:function(){$("#Organization").val("");$("#Organization_chosen span").html("");$("#Department").val("");$("#Department_chosen span").html("");$("#Role").val("");$(".chosen-select.custom-multiselect").val("").trigger("chosen:updated")},toggleRowElem:function(n,t){n!=null&&n.length>0&&t.find("option[data-isfz44]").size()>0?t.show():t.hide()},initOrganizationsAndUsers:function(){var n=this;return n.orgsAndUsersInited?$.Deferred():(waitingDialog.show("Загрузка пользователей..."),$.ajax({url:getRelativeUrl("Account/GetOrganizationsAndUsers?initDeactivatedPersons="+n.initDeactivatedPersons),type:"GET",cache:!1,success:function(t){var o,u,r,f,e,i;if(t.success){for(o=t.data,u=o.users,n.users=u,n.organizations=o.organizations,r="",f="",e=0;e<u.length;e++)i=u[e],i.Organization!==f&&(f!==""&&(r+="<\/optgroup>"),f=i.Organization,r+=i.OrganizationTitle!=null?'<optgroup label="'+i.OrganizationTitle.replace(/"/g,"''")+'">':'<optgroup label="'+i.OrganizationTitle+'">'),r+='<option value="'+i.Id+'">'+i.Name+"<\/option>";$("#User").append(r).prop("disabled",!1).trigger("chosen:updated");n.orgsAndUsersInited=!0}waitingDialog.hide();t.success||showCommonErrors(t.message)},error:function(n){waitingDialog.hide();showCommonErrors(n)}}))},addUserClickEvent:function(){var n=this;$("body").on("click","#User_chosen",function(){n.initOrganizationsAndUsers().then(function(){$("#User_chosen").trigger("mousedown")})})},addUserChangeEvent:function(){var n=this,t=$("#User");t.change(function(){var r=t.val();if(r){var u=$.grep(n.users,function(n){return n.Id==r})[0],e=u.Organization,f=u.Department,o=u.DepartmentTitle,i=n.getOrganization(e);n.lawSwitcherEnabled&&($("option[data-isfz44]").hide(),i.IsLaw44?($("#isFz44").prop("checked",!0),$("[data-IsHidden='False'][data-isfz44='True']").css("display","list-item")):$("#isFz44").prop("checked",!1),i.IsLaw223?($("#isFz223").prop("checked",!0),$("[data-IsHidden='False'][data-isfz223='True']").css("display","list-item")):$("#isFz223").prop("checked",!1),i.GRBS?($("#isGRBS").prop("checked",!0),$("[data-IsHidden='False'][data-isgrbs='True']").css("display","list-item")):$("#isGRBS").prop("checked",!1));n.isApprovePage?n.resetControls():(waitingDialog.showWaiting(),$.ajax({url:n.accountPermissionInfoUrl,type:"GET",cache:!1,data:{userId:r},success:function(t){t&&($("#AccessGroup").val(t.AccessGroups).trigger("chosen:updated"),$("#Role").val(t.Role),n.toggleRowElem(t.Role,$(".role-ctl")),$("#WorkGroup").val(t.WorkGroups).trigger("chosen:updated"),n.toggleRowElem(t.WorkGroups,$(".workGroup-ctl")),n.toggleRowElem(t.WorkGroups,$(".accessGroup-ctl")));waitingDialog.hide()},error:function(){waitingDialog.hide()}}));i&&($("#Organization").val(i.Name),$("#Organization_chosen span").html(i.Name));f&&($("#Department").val(f),$("#Department_chosen span").html(o))}})},getOrganization:function(n){return $.grep(this.organizations,function(t){return t.Id===n})[0]},chosenSelectValidation:function(n){n||(n=100);setTimeout(function(){var n=$(".chosen-select.parsley-error").next().next(),t=$(".chosen-select.parsley-error").parent().prev();n.addClass("custom-error");t.addClass("custom-error-label");n=$(".chosen-select:not(.parsley-error)").next().next();t=$(".chosen-select:not(.parsley-error)").parent().prev();n.removeClass("custom-error");t.removeClass("custom-error-label")},n)},addFormSubmitEvent:function(){var n=this;$(".btn-approve").click(function(){n.chosenSelectValidation();var t=$("form");t.parsley().whenValidate().done(function(){n.persmissionValidation()&&(t.attr("action",n.actionURL),t.submit(),n.disableAndShowLoading())})})},addDeleteClick:function(){var n=this;$(".btn-delete").click(function(){if(n.deleteEventHandler!=null&&n.userValidation()){n.deleteEventHandler();return}n.chosenSelectValidation();var t=$("form");t.parsley().validate();n.hidePermissionError();n.userValidation()&&(t.attr("action",n.deleteActionURL),t.submit(),n.disableAndShowLoading())})},userValidation:function(){return $("#User").val()?!0:!1},getPermissionElement:function(){return $(".permission-validation-error")},hidePermissionError:function(){var n=this.getPermissionElement();n.hasClass("hidden")||n.addClass("hidden")},showPermissionError:function(){var n=this.getPermissionElement();n.hasClass("hidden")&&n.removeClass("hidden")},persmissionValidation:function(){var n=$("#AccessGroup_chosen .chosen-choices .search-choice-close").length>0||$("#WorkGroup_chosen .chosen-choices .search-choice-close").length>0;return n?this.hidePermissionError():this.showPermissionError(),n},disableButtons:function(){$(".btn").prop("disabled",!0)},disableAndShowLoading:function(){this.disableButtons();showLoadingIndicator("#content-approve-loading-image")}};h.init(n,t,i,r,u,f,e,o,s)};