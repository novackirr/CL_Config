function gridItemSelectedHandler(){var n=$dictButton.attr("id"),e=$dictButton.closest(".table-edit"),t=e.length>0,i=e.attr("data-name"),r=$dictButton.closest(".table-edit-row").attr("data-rowkey"),u=function(u){multipleSelection?fillMultipleDictFields(u,n,t,i,r):fillSelectionFields(u[0],n,t,i,r)},f;if(typeof ExtContractorManager!="undefined")if(selectedRowsDebug.length>=1)if(f=selectedRowsDebug[0],f.data.hasOwnProperty("source")&&(n=="orgpost2"||n=="orgposttable")){var o=f.get(model.CodeKey),s=ExtContractorManager(store,treePanel,win),h=f.data["ИНН"],c=f.data["Наименование"];s.saveChoosenContractor(o,selectedRowsDebug,u,h,c,loadDictionaryDataRow,function(){closeWin()},function(){fillDictFields(!0,n,t,i,r,u);deferred.resolve(selectedRowsDebug)},function(){fillDictFields(!1,n,t,i,r,u);deferred.resolve(selectedRowsDebug)})}else fillDictFields(!0,n,t,i,r,u),closeWin(),deferred.resolve(selectedRowsDebug);else fillDictFields(!1,n,t,i,r,u),closeWin(),deferred.resolve(selectedRowsDebug);else fillDictFields(!0,n,t,i,r,u),closeWin(),deferred.resolve(selectedRowsDebug)}function addNewTableRow(n,t){var i,e,o,s,u,h,c;setPreventDefault(t);var r=$(n).closest(".table-edit > .table-content"),l=r.children(".templates").children(".table-edit-row"),f=r.children(".templates").children(".table-row-row-view");f&&f.length!==0||(f=r.parents().find(".templates").children(".table-row-row-view"));i=l.clone(!1);e=r.children(".table-edit-row").map(function(){return $(this).attr("data-rowkey")});o=e.length>0?Math.max.apply(Math,jQuery.map(e,function(n){return n})):0;i.attr("data-rowkey",o+1);s=r.parent().attr("data-name");u=o+1;i.find(".show-dict-btn").each(function(){$(this).attr("parent-id")&&$(this).attr("parent-id",s+"-"+$(this).attr("parent-id")+"-"+u)});i.find("input[name='IdSeconds']").attr("required",!0);i.find("input[name='DateFrom']").attr("required",!0);i.find("[data-dg-group]").each(function(){$(this).attr("data-dg-group",s+"-"+u+"-"+$(this).attr("data-dg-group"))});r.append(i);i.find(".form-dictionary-control").each(function(){var n=$(this);n.attr("data-dictionaryparent")==""&&setDictionaryField(n)});setEditTableRowVisibility(".table-edit-wrapper-deputy",r.closest(".table-edit-wrapper-deputy").parent());h=i.find("[data-wslist]").attr("data-wslist");i.find("[data-wslist]").attr("list",h);reinitialiseScriptShort();c={rowKey:u,innerTableContainer:i};calcTableNUM(r.children(".table-edit-row[data-rowkey]"));$(r).trigger("onTableRowAdded",c);window.adjustNewRowTextAreaHeight(i)}function removeTableRow(n,t){var f,r,e,o;t!==undefined&&setPreventDefault(t);var i=$(n).closest(".table-edit"),u=i.find("input[type=hidden][name='"+i.attr("data-deleted-rows-field")+"']"),s=u.val();$(n).attr("groupedTable")?$(n).closest(".table-edit-row").find(".table-edit-row[data-rowkey]").each(function(n,t){var i=u.val(),r=$(t).attr("data-rowkey").split("-").pop();u.val(i+r+",")}):u.val(s+$(n).closest(".table-edit-row").attr("data-rowkey").split("-").pop()+",");f=i.find("input[type=hidden][name='"+i.attr("data-deleted-attachment-keys")+"']");$(n).closest(".table-edit-row").find(".attachment").each(function(n,t){var i=$(t).attr("data-attachmentKey"),r=f.val();f.val(r+i+",")});r=$(n).closest(".table-edit-row");r.find(".delete-table-row-attachment:visible").children(":first").click();e=r.attr("data-rowkey");$(i).trigger("onTableRowRemoving",e);r.closest("form").off("submit.autoNumeric");r.remove();initAutonumeric();o=i.find(".table-content");rows=o.children(".table-edit-row[data-rowkey]");setEditTableRowVisibility(".table-edit-wrapper-deputy",i.closest(".table-edit-wrapper-deputy").parent());calcTableNUM(rows);$(i).trigger("onTableRowRemoved",e)}function CheckRights(n,t){winAddressbook=createWin(n,t);winAddressbook.show()}function reformButton(n,t,i){var r,u;t=t.replace("Role","IdSeconds");r=$(i.find("button[name='"+t+"']").first());n.length===0?r.prop("disabled",!0):(r.prop("disabled",!1),r.attr("data-url",r.attr("data-url-half")+"&findSameRights="+n[0].key),r.data("url",r.attr("data-url-half")+"&findSameRights="+n[0].key));$(i.find("input[name='"+t+"']").first()).val("");$(i.find("input[name='"+t+"DictId']").first()).val("");$(i.find("input[name='"+t+"DictName']").first()).val("");u=$(i.find("ul[name='"+t+"List']").first());u.val("");u.find("li").remove();r.val("")}function calcTableNUM(n){var t=0;n.each(function(){var n=$(this);n.find("input[additionalName]").each(function(){$(this).attr("name")&&$(this).attr("name","["+t+"]."+$(this).attr("additionalName"));$(this).attr("data-field-name")&&$(this).attr("data-field-name","["+t+"]."+$(this).attr("additionalName"))});n.find("ul[additionalName]").each(function(){$(this).attr("name")&&$(this).attr("name","["+t+"]."+$(this).attr("additionalName"))});n.find("button[additionalName]").each(function(){$(this).attr("name")&&$(this).attr("name","["+t+"]."+$(this).attr("additionalName"))});n.find("input[name='currentindex']").each(function(){$(this).val(t)});t++})}function setoldvalue(n){n.setAttribute("oldvalue",n.value)}function IndefiniteChange(n){var t=$(n).closest(".table-edit-row").find("input[additionalName='DateEnd']");n.checked?(t.prop("disabled",!0),t.val("")):t.prop("disabled",!1)}function fillMultipleDictFieldsToTable(n,t,i,r,u){var l,h,e,y,p,i,a,w,b,k,d,f;setPreventDefault(event);u.closest("div").find("span.action-container").remove();u.closest("div").find("div.multiple-editor-remove").remove();var ot=u.closest("div").find("ul.multiple-editor-list"),g=u.closest("div").find("input[name='currentindex']"),s=g.val(),nt=u.closest("div").find("input[name='filtersName']"),tt=u.closest("div").find("input[name='filtersFlow']"),it=u.closest("div").find("input[name='Filters']"),rt=u.closest("div").find("input[name='filtersNameForUser']");strfilterName=nt.val();strfilterFlow=tt.val();strfilters=it.val();strfiltersNameForUser=rt.val();var v=strfilterName.split("|"),ut=strfilterFlow.split("|"),c=strfilters.split("|"),ft=strfiltersNameForUser.split("|"),o=u.closest(".table-edit > .table-content"),et=o.children(".templatesDict").children(".table-edit-row");if(o=u.closest(".dummyFilters"),l=o.children(".templatesDict").children(".table-row-row-view"),l&&l.length!==0||(l=o.parents().find(".templatesDict").children(".table-row-row-view")),f=0,o.children(".table-edit-row").each(function(){var n=$(this),t=!1;for(var i in v)if(console.log(n.find("input[additionalAttr='DictId'][value='"+c[i]+"']")),n.find("input[additionalAttr='DictId'][value='"+c[i]+"']").length>0){console.log("WAS");t=!0;break}t===!1&&n.remove()}),strfilterName!=="")for(h in v){if(o.children(".table-edit-row").find("input[additionalAttr='DictId'][value='"+c[h]+"']").length>0){f++;continue}e=et.clone(!1);y=o.children(".table-edit-row").map(function(){return $(this).attr("data-rowkey")});p=y.length>0?Math.max.apply(Math,jQuery.map(y,function(n){return n})):0;e.attr("data-rowkey",p+1);i=o.parent().attr("data-name");a=p+1;e.find(".show-dict-btn").each(function(){$(this).attr("parent-id")&&$(this).attr("parent-id",i+"-"+$(this).attr("parent-id")+"-"+a)});e.find("[data-dg-group]").each(function(){$(this).attr("data-dg-group",i+"-"+a+"-"+$(this).attr("data-dg-group"))});o.append(e);e.find(".form-dictionary-control").each(function(){var n=$(this);n.attr("data-dictionaryparent")==""&&setDictionaryField(n)});setEditTableRowVisibility(".table-edit-wrapper-deputy",o.closest(".table-edit-wrapper-deputy").parent());w=e.find("[data-wslist]").attr("data-wslist");e.find("[data-wslist]").attr("list",w);reinitialiseScriptShort();b={rowKey:a,innerTableContainer:e};e.find("[name='Field']").val(v[h]);e.find("[name='NameForUser']").val(ft[h]);e.find("[name='Flow']").val(ut[h]);k=e.find("[name='Id']");k.val(0);d=e.find("[name='DictId']");d.val(c[h]);$(o).trigger("onTableRowAdded",b);f++;window.adjustNewRowTextAreaHeight(e)}f=0;o.children(".table-edit-row").each(function(){var n=$(this),i=n.find("[additionalName='Field']"),t,r,u,e,o;i.removeAttr("name");i.attr("name","["+s+"].DummyFilters["+f+"].Field");i.attr("additionalName","DummyFilters["+f+"].Field");t=n.find("[additionalName='NameForUser']");t.removeAttr("name");t.attr("name","["+s+"].DummyFilters["+f+"].NameForUser");t.attr("additionalName","DummyFilters["+f+"].NameForUser");r=n.find("[additionalName='Flow']");r.attr("name","["+s+"].DummyFilters["+f+"].Flow");r.attr("additionalName","DummyFilters["+f+"].Flow");u=n.find("[additionalName='Value']");u.attr("name","["+s+"].DummyFilters["+f+"].Value");u.attr("additionalName","DummyFilters["+f+"].Value");e=n.find("[additionalName='Id']");e.attr("name","["+s+"].DummyFilters["+f+"].Id");e.attr("additionalName","DummyFilters["+f+"].Value");o=n.find("[additionalName='DictId']");o.attr("name","["+s+"].DummyFilters["+f+"].DictId");o.attr("additionalName","DummyFilters["+f+"].Value");f++})}var setAssistant,createWin;$(document).ready(function(){setAssistant.init();$("#Type").on("change",function(){var n="",t;$("[name='returnUrl']").val()!=""&&(n="&returnUrl="+encodeURIComponent($("[name='returnUrl']").val()));t=$(this).attr("action")+"?type="+this.value+n;window.open(t,"_top")})});setAssistant={init:function(){addParsleyValidation("form");this.addEventHandlers()},addEventHandlers:function(){this.addFormSubmitEvent();this.addCancelEvent()},addFormSubmitEvent:function(){var n=this;$(".btn-save").click(function(){var t=$("#content-set-assistant-form");t.parsley().whenValidate().done(function(){waitingDialog.showWaiting();ajaxFormSubmit(t[0],function(){n.showSuccess();waitingDialog.hide();$(".btn-cancel").click()},function(t){n.showError(t.responseText);waitingDialog.hide()})})})},addCancelEvent:function(){$(".btn-cancel").click(function(){return $(".btn").prop("disabled",!0),showLoadingIndicator("#content-set-assistant-loading-image"),window.location.href=$("[name='returnUrl']").val(),!1})},showError:function(n){var t=$("#message");t.html("");t.removeClass("alert-success");t.hasClass("alert-danger")||t.addClass("alert-danger");t.text(n);t.show()},showSuccess:function(){var n=$("#message");n.html("");n.removeClass("alert-danger");n.hasClass("alert-success")||n.addClass("alert-success");n.text("Изменения в профиле успешно сохранены.");n.show()}};createWin=function(n,t){var r=Ext.createWidget("tabpanel",{activeTab:0,autoWidth:!0,autoHeight:!0,minWidth:350,plain:!0,layout:"fit",deferredRender:!1,defaults:{autoScroll:!1,bodyPadding:10},items:[]}),i="<div>Предупреждение<\/div>";return i=i+"<p>Недоступно назначение замещения для выбранного сотрудника ввиду несовпадения прав, для назначения замещения необходимо оформить и согласовать заявку",i=i+" на дополнительные права через Реестр Задач: ",i=i+"<p> <\/p>",i=i+"<p>Ссылка на завявку в Реестр Задач - sso.vtb.grp/RZ/Task/Index/12995<\/p>",winAddressbook=Ext.create("widget.window",{title:"",html:i,width:400,autoHeight:!0,maximizable:!1,resizable:!1,draggable:!1,closable:!1,modal:!0,bodyPadding:"10px 5px 5px 5px",bodyStyle:"background-color:white",buttons:[{text:"Направить уведомление",handler:function(){url=getAbsoluteUrl("Account/NotifyUsers");$.post(url,{Ids:n,RoleId:t},function(){});this.up("window").close()}},{text:"Закрыть",handler:function(){this.up("window").close()}}]})};