$(document).ready(function(){var n=NotificationFilteringViewer("viewnotificationfiltering");n.init()});NotificationFilteringViewer=function(n){function u(){_dataSource={load:function(n){var t=$.Deferred();return $.ajax({url:getAbsoluteUrl("Account/GetNotificationFiltering"),type:"GET",cache:!1,data:{filterText:n.searchValue},success:function(n){t.resolve(n)},error:function(n,t,i){showAlert("Ошибка полуечния групп доступа",i)}}),t.promise()}};var n;DevExpress.localization.locale("ru");n=$(r.dataGridSelector).dxDataGrid({allowColumnResizing:!0,columnResizingMode:"nextColumn",columnMinWidth:100,hoverStateEnabled:!0,selection:{mode:"single"},columns:[{width:"25%",caption:"Группа доступа",dataField:"AccessGroup.Name",allowEditing:!1},{width:"25%",caption:"Закупающие департаменты",dataField:"ExecDepartments.Name",allowEditing:!1,cellTemplate:function(n,t){t.data.PurchasingDepartments&&t.data.PurchasingDepartments.forEach(function(t){t&&n.append("<div>"+t.Name+"<\/div>")})}},{width:"25%",caption:"Исполняющие департаменты",dataField:"PurchDepartments",allowEditing:!1,cellTemplate:function(n,t){t.data.ExecutingDepartments&&t.data.ExecutingDepartments.forEach(function(t){t&&n.append("<div>"+t.Name+"<\/div>")})}},{width:"12%",caption:"МВП",dataField:"Mvps",allowEditing:!1,cellTemplate:function(n,t){t.data.IsMvpInverse&&t.data.Mvps&&t.data.Mvps.length>0&&n.append("<div>Инверсия:<\/div>");t.data.Mvps&&t.data.Mvps.forEach(function(t){t&&n.append("<div>"+t+"<\/div>")});n.children().size()===0&&n.append("<div>Не задано<\/div>")}},{width:"12%",caption:"Уведомления",dataField:"IsNoticeOff",allowEditing:!1,cellTemplate:function(n,t){var i=$("<a />");t.data.IsNoticeOff?i.append("<div>Уведомления отключены<\/div>"):i.append("<div>Уведомления включены, согласно настройке<\/div>");i.addClass("dx-link").on("dxclick",function(){f(t.data)}).appendTo(n)}}],dataSource:_dataSource,paging:{pageSize:10},pager:{showPageSizeSelector:!0,allowedPageSizes:[5,10,20],showInfo:!0},width:"100%"})}function f(n){t=n;currentGroupNoticeOffFlag=t.IsNoticeOff;var u={width:750,height:"auto",showTitle:!0,title:"Фильтр адресатов",visible:!1,dragEnabled:!1,closeOnOutsideClick:!0,contentTemplate:function(){var n=$("<div/>"),e=$("<div/>").appendTo(n),u,f;return e.dxCheckBox({value:currentGroupNoticeOffFlag>0,text:"Отключить уведомления группы для данного пользователя",onValueChanged:function(n){currentGroupNoticeOffFlag=n.value}}).dxCheckBox("instance"),$("<br><br>").appendTo(n),u=$("<div style='margin:5px;'/>").appendTo(n),u.dxButton({text:"Сохранить",onClick:function(){$.ajax({url:getAbsoluteUrl("Account/EditNotificationFiltering"),type:"POST",data:{accessGroupId:t.AccessGroup.Id,isReadOnlyExecuting:t.IsReadOnlyExecutingDepartment,isReadOnlyPurchasing:t.IsReadOnlyPurchasingDepartment,readOnlyDepartmentId:t.ReadOnlyDepartmentId,isNoticeOff:currentGroupNoticeOffFlag?1:0},traditional:!0,success:function(){t.IsNoticeOff=currentGroupNoticeOffFlag;$(r.dataGridSelector).dxDataGrid("instance").refresh()},error:function(n,t,i){showAlert("Ошибка при установке подразделений",i)}});i.hide()}}).dxButton("instance"),f=$("<div style='margin:5px;'/>").appendTo(n),f.dxButton({text:"Отмена",onClick:function(){i.hide()}}).dxButton("instance"),n}};i?i.option("contentTemplate",u.contentTemplate.bind(this)):i=$(r.popupId).dxPopup(u).dxPopup("instance");i.show()}var i,t,r={containerId:"inc-viewer-"+n+"-container",dataGridId:"inc-viewer-"+n+"-datagrid",startSelector:"#inc-viewer-"+n+"-start",endSelector:"#inc-viewer-"+n+"-end",refreshSelector:"#inc-viewer-"+n+"-refresh",containerSelector:"#inc-viewer-"+n+"-container",dataGridSelector:"#inc-viewer-"+n+"-datagrid",jsonInput:"#inc-viewer-json-"+n,popupId:"#inc-viewer-"+n+"-popup"};return{init:u}};