function ModalHelper(n){function w(){var n=t.find(".modal-title");n.text()==="Документ редактируется другим пользователем"&&t.find(".btn-submit").prop("disabled",!0)}var o;n=n||{};var t=$(n.dialog),i=t.find(".modal-errors-wrapper"),u=t.find(".modal-info-wrapper"),f=t.find(".modal-content-wrapper"),r=t.find(".modal-loading-wrapper"),s=function(){i.empty();i.hide();u.empty();u.hide();f.empty();f.hide();r.show()},h=function(){t.css("overflow-y","scroll");t.modal("show");t.data("bs.modal").options.backdrop="static"},e=function(f){t.data("bs.modal").options.backdrop=!0;i.empty();i.hide();u.empty();u.hide();setPreventDefault(f);FormHelper.submit({document:t,isTargetBlank:n.isTargetBlank,dontSubmit:n.dontSubmit,onStart:function(){r.show()},onFinish:function(){r.hide();t.find("button[data-dismiss='modal']").click()},onMessage:function(n,t){t?(i.text(n),i.show(),r.hide()):(u.text(n),u.show(),r.hide())}})},c=function(){FormHelper.close()},l=function(){var n=t.find(".btn-submit");n.prop("disabled",!1);n.click(e);t.on("hidden.bs.modal",function(){n.unbind("click",e);t.children(".modal-dialog").removeClass("modal-large");t.children(".modal-dialog").removeClass("modal-medium");c()})},a=function(){var r=$(".modal-body-wrapper").attr("data-empty-body-error-message"),n;if(r){i.text(r);n=function(n){setPreventDefault(n);t.modal("hide")};t.find(".btn-submit").click(n);t.on("hidden.bs.modal",function(){t.find(".btn-submit").unbind("click",n)});i.show();t.modal("show");return}},v=function(n,t,i){if(typeof t!="string")return n;var r,f,u=t.indexOf(" .");return u>-1&&(r=jQuery.trim(t.slice(u)),t=t.slice(0,u)),n.length>0&&jQuery.ajax({url:t,type:"GET",dataType:"html"}).done(function(t){f=arguments;n.html(r?jQuery("<div>").append(jQuery.parseHTML(t,undefined,!0)).find(r):t)}).always(i&&function(t,r){n.each(function(){i.apply(this,f||[t.responseText,r,t])})}),this},y=function(t){var i=appendUrlArgument(n.url,"rand",getTimeStamp());i=i+" .context-action-page-body";n.keepScripts?v(f,i,t):f.load(i,t)},p=function(){if(i.hide(),r.hide(),!$(this).html()){a();return}DocumentHelper.init(t);l();FormHelper.init({document:t,isTargetBlank:n.isTargetBlank,useDefaultSubmit:n.useDefaultSubmit,dontSubmit:n.dontSubmit,beforeSubmit:n.beforeSubmit,afterSubmit:n.afterSubmit,control:n.control,event:n.event,onStart:function(){t.find(".btn-submit").prop("disabled",!0);r.show()},onFinish:function(){t.find(".btn-submit").prop("disabled",!1);r.hide()},onMessage:function(n,t){t?(i.text(n),i.show(),r.hide()):(u.text(n),u.show(),r.hide())}});var e={validatedFormSelector:".action-form",innerTableContainer:f};$(document).trigger("onDocumentModalWindowLoaded",e);w();f.show()};return o=function(){s();h();y(p)},{openWindow:o}}function getDictionaryItemIdByName(n,t,i,r){$.ajax({url:getAbsoluteUrl("Dictionary/GetDataIdByName"),type:"POST",data:{dictionaryName:n,name:t},success:function(n){i(n)},error:function(n,t,i){r(i)}})}function copyDictionaryValue(n,t){var r=n.val(),u=$("#"+t.attr("name")).attr("data-dict-name"),i=$("button[parent-id="+t.attr("name")+"]");i.prop("disabled",!0);getDictionaryItemIdByName(u,r,function(n){var r=t.next();n.error!==undefined?(console.error(n.error),r.val("-1")):r.val(n.data);i.prop("disabled",!1)},function(n){console.log(n);i.prop("disabled",!1)});t.change()}function findDictionaryItemByKey(n,t,i,r,u){$.ajax({url:getAbsoluteUrl("Dictionary/FindDictionaryItemByKey"),type:"POST",data:{dictionaryName:n,name:t,level:i},success:function(n){r(n)},error:function(n,t,i){u(i)}})}function findDictionaryItemByAttribute(n,t,i,r,u,f){$.ajax({url:getAbsoluteUrl("Dictionary/FindDictionaryItemByAttribute"),type:"POST",data:{dictionaryName:n,attributeName:t,attributeValue:i,level:r},success:function(n){u(n)},error:function(n,t,i){f(i)}})}function findDictionaryItemsByAttribute(n,t,i,r,u,f){$.ajax({url:getAbsoluteUrl("Dictionary/FindDictionaryItemsByAttribute"),type:"POST",data:{dictionaryName:n,attributeName:t,attributeValue:i,level:r},success:function(n){u(n)},error:function(n,t,i){f(i)}})}function getDictionaryItems(n,t,i,r,u,f,e){var s,c,o,l;if(!n){console.info("не задано имя словаря, getDictionaryItemChildren");return}if(!Array.isArray(u)||u.length==0){console.info("не заданы поля, getDictionaryItemChildren");return}for(s=[],c=u.length,o=0;o<c;o++)l=u[o],s.push({DictColumnName:l,EditName:o});var a={DictionaryFieldInfoList:s},v=encodeURI("&dictFieldsInfo="+JSON.stringify(a)),h="Dictionary/GetJson?dictionaryName="+n+"&showCodeColumn=False&subDictionaries="+t+"&selectionLevel="+r+"&parentId="+i+"&selectionStartLevel=";h=encodeURI(h);$.ajax({url:getAbsoluteUrl(h),type:"POST",data:v,success:function(n){if(n.data){var t=JSON.parse(n.data);f&&f(t)}else n.error?(console.log(n),e&&e(n.error)):console.log(n)},error:function(n,t,i){console.log(t);console.log(i);showCommonErrors(i);e&&e(t)}})}function getDictionaryItemsChildren(n,t,i,r,u,f,e){var o,c;if(!n){console.info("не задано имя словаря, getDictionaryItemsChildren");return}if(!Array.isArray(i)||i.length==0){console.info("не задан идентификаторы элементов словаря, getDictionaryItemsChildren");return}if(!r){console.info("не задан уровень вложености, getDictionaryItemsChildren");return}if(!Array.isArray(u)||u.length==0){console.info("не заданы поля, getDictionaryItemsChildren");return}var s={},l=function(n,t,i,r,u){var f=jQuery.Deferred();return getDictionaryItems(n,t,i,r,u,function(n){s[i]=n;f.resolve()},function(){f.reject(errorThrown)}),f.promise()},h=[],a=i.length;for(o=0;o<a;o++)c=i[o],h.push(l(n,t,c,r,u));$.when.apply($,h).then(function(){f(s)},function(n){e(n)})}function getParentFor(n,t){var r=getRelativeUrl("/Dictionary/GetParentFor"),i;return r+="?dictionaryName="+encodeURIComponent(n)+"&itemId="+t,i=jQuery.Deferred(),$.ajax({url:r,type:"GET",contentType:!1,cache:!1,processData:!1}).then(function(n){var t=JSON.parse(n);t.status==="OK"?(t=JSON.parse(t.responseMessage),i.resolve(t)):(showCommonErrors([t.responseMessage]),i.reject(t.responseMessage))},function(){console.log(response)}),i.promise()}function findNestedGridBySelector(n,t,i){var r=findRowByKey(n,t);return findNestedGridInJQObjectBySelector(r,i)}function findNestedGridInJQObjectBySelector(n,t){return n.next("tr.dx-master-detail-row").find(t)}function hideExpandButton(n){n.find("td.dx-datagrid-expand>div").remove();n.find("td.dx-datagrid-expand").removeClass("dx-datagrid-expand")}function findRowByKey(n,t){return n.getRowElement(n.getRowIndexByKey(t))}function deleteAttachment(n,t,i){var s,e,h,c,l,a,w;if($("#"+n).data("dxDataGrid")){window.docChangeObserver&&window.docChangeObserver.pause();var o=decodeURIComponent(i),v=o.split("uniqueIds="),u=v[v.length-1].split("&")[0],y=$("#"+n).dxDataGrid("instance"),r,f,p=y.getDataSource().store();if(u.indexOf(",")===-1&&u.indexOf("/")===-1)r=u,f=1,p.remove(r);else for(s=u.indexOf(",")!==-1?u.split(","):[u],f=0,e=0;e<s.length;e++)r=s[e],r.indexOf("/")!==-1&&(r=r.split("/")[1]),f++,p.remove(r);setTimeout(function(){y.refresh()},100);o.indexOf("clientGuid=")!==-1&&(h=o.split("clientGuid=")[1].split("&")[0],h&&$("[data-attachment-client-guid='"+h+"']").html(""));try{c=$(".regcard-sidenav .tabs-left .active .badge");l=c.text()*1-f;l>=0&&c.text(l)}catch(b){}a=window.location.pathname.split("/");w=a[a.length-1];window.docChangeObserver&&window.docChangeObserver.doHashRefresh(w)}}function addRowAttachment(){typeof deleteTableRowAttachmentElement!="undefined"&&window.deleteTableRowAttachmentElement.is(":visible")&&_deleteTableRowAttachment(window.deleteTableRowAttachmentElement);window.files&&($("[name='"+window.attachmentName+"']").val(window.files),$("[name='"+window.attachmentKeyName+"']").val(window.fileKeys),window.files="",window.fileKeys="",window.deleteTableRowAttachmentElement.show())}function dxGridRowAttachmentCellPrepare(n){var t=this.dataField.replace(/^Fields./,"");if(n.Fields[t]){var u=window.location.pathname.split("/").pop(),i=getBaseUrl(),r=n.Fields[t+"_ИД"];return'<a target="_blank" class="search-result-cell-value" data-attachment-client-guid="'+r+'" href="'+i+"/Attachment/View?clientGuid="+r+"&amp;documentKey="+u+'"><img class="search-result-value-image vertical-middle" src="'+i+'/Images/attachmentIcons/text.png"><span>'+n.Fields[t]+"<\/span><\/a>"}return n.Fields[t]}function gridReady(n,t){var i=$.Deferred(),r,f,u;t&&(n=t+":"+n);r=n+":initialized";f="[data-api-table-name='"+n+"'] > div";try{if(u=$(f).dxDataGrid("instance"),!u)throw"грид не найден";i.resolve(u)}catch(e){$(document).on(r,function(n,t){i.resolve(t);$(document).off(r)})}return i.promise()}function findNestedGrid(n,t,i){return findNestedGridBySelector(n,t,"[data-api-table-name='"+i+"']")}function hideColumnByCaptionName(n,t){for(var r,i=0;i<n.columnCount();i++)r=n.columnOption(i),r.caption===t&&n.columnOption(i,"visible",!1)}function dxGridCustomStateReset(n){(new customStateService).GridCustomStateReset(n)}function dxGridColShooserSyncSelectedColumns(n){(new customStateService).GridColChooserSyncSelectedColumns(n)}function onDxGridCellPrepared(n){var t,f,r,e,u,i;if(n.rowType==="data"&&n.column.command!=="expand"&&n.column.command!=="select"&&n.value!==undefined){if(t=n.value,n.data.Url&&n.column.dataType!=="boolean"?(f=n.data.OpenLinksOnBlankPage?"target='_blank'":"",t=$("<div><a class='search-result-cell-value' href='"+n.data.Url+"'"+f+" >"+t+"<\/a><\/div>")):t=n.column.cssClass=="view-in-form"?$("<div style='height: 34px;' class='btn btn-default btn-sm glyphicon glyphicon-list-alt vertical-middle hidden-xs table-edit-row-button' title='Просмотр' onclick='viewTableRow(this, event)'><\/div><span class='btn btn-default btn-sm visible-xs-inline-block' onclick='viewTableRow(this, event)'>Просмотр<\/span>"):$("<div><span class='search-result-cell-value'>"+t+"<\/span><\/div>"),n.column.cell_classes)for(r=0;r<n.column.cell_classes.length;r++)t.addClass(n.column.cell_classes[r]);n.cellElement.html(t)}if(n.rowType!=="data"||n.column.command!=="expand"||n.data.Expandable||(n.cellElement.removeClass("dx-datagrid-expand"),n.cellElement.empty()),n.rowType==="group")switch(n.column.dataType){case"number":if(n.cellElement.find(".money").length>0){n.value&&n.value!==""&&(e=n.cellElement.find(".search-result-cell-value"),$.each(e,function(t,i){var r=$(i),u=r.text(),f=!isNaN(parseFloat(u));f&&r.text(formatMoney(n.value))}));break}}if(n.rowType==="data"){switch(n.column.dataType){case"number":n.cellElement.find(".double").length>0?(u=$(n.cellElement.html()),i=u.find("span").first().text(),i&&i.trim()!==""&&i.indexOf(".")===-1&&(u.find("span").first().text(i+".00"),n.cellElement.html(u))):n.cellElement.find(".money").length>0&&n.value&&n.value!==""&&n.cellElement.find(".search-result-cell-value").text(formatMoney(n.value));break;case"boolean":transformBooleanCellElement(n)}n.column.caption=="Срок исполнения"&&n.value&&n.value!==""&&n.value.indexOf("31.12.9999")!=-1&&n.cellElement.find(".search-result-cell-value").text("Бессрочно")}}function transformBooleanCellElement(n){var t=$(n.cellElement.html()),i,r;t.find("input").length===0&&(i=t.find("span").first().empty(),r=n.value==="0"?!1:!0,$("<input type='checkbox' disabled/>").attr("checked",r).appendTo(i),n.cellElement.html(t))}function onDxGridRowPrepared(n){var t,i;if(n.data!==undefined){for(t in n.data.Classes)n.rowElement.addClass(n.data.Classes[t]);i=$("[data-grid-id='"+n.element.attr("id")+"']").attr("data-table-path");n.rowElement.attr("data-row-path",i+":"+n.data.Key)}}function onDxGridInitialized(n){var i,t;(new customStateService).GridCustomStateLoad(n);checkForNestedLinkGrid(n);n.component.option("onRowClick",function(t){onDxGridRowClick(t,n.component)});n.component.option("onToolbarPreparing",function(t){onDxToolbarPreparing(t,n.component)});n.component.option("onSelectionChanged",function(t){onDxGridSelectionChanged(t,n.component)});i=n.component.option();$.each(n.component.option().columns,function(t,r){n.component.columnOption(r.dataField,{groupCellTemplate:function(n,t){groupCellTemplate(n,t)},calculateFilterExpression:function(n,t){if(typeof n=="string"&&(n=n.trim()),t==="between"&&$.isArray(n)){var i=[];return n[0]&&i.push([this.dataField,">=",n[0]]),n[1]&&i.push([this.dataField,"<=",n[1]]),i.length===2&&i.splice(1,0,"and"),i}return this.dataType==="boolean"?[this.dataField,n?"=":"<>",1]:this.defaultCalculateFilterExpression.apply(this,arguments)}});i.remoteOperations||n.component.columnOption(r.dataField,{calculateSortValue:function(n){return this.calculateCellValue(n)}});r.cell_classes!=undefined&&(r.cell_classes.indexOf("nosecdatetime")!==-1&&(r.dataType="datetime",r.format="dd.MM.yyyy HH:mm"),r.dataType==="datetime"&&n.component.columnOption(r.dataField,{serializationFormat:"yyyy/MM/dd HH:mm:ss"}),r.dataType==="date"&&n.component.columnOption(r.dataField,{serializationFormat:"yyyy/MM/dd"}))});dxGridAddTablePath(n);t=n.component.option("onContentReady");n.component.option("onContentReady",function(i){var f=n.component.option("rowsToCollapse"),r,u;f;t&&t(i);addDxGridPagerButtons(n.component,n.element);ct.utils.isLowScreenWidth()||scaleWidthVisibleColumns(n.component,n.element);updateCountBadge(i);expandRowsIfNeeded(i.component,i.element);dxGridRemoveTitles(n.element);try{r=n.element.closest("tr[data-row-path]").attr("data-row-path");u=$("[data-grid-id='"+n.element.attr("id")+"']").attr("data-api-table-name");r?(console.log(r+":"+u+":initialized"),$(document).trigger(r+":"+u+":initialized",[n.component,n.element])):$(document).trigger(u+":initialized",[n.component,n.element])}catch(e){console.log(e)}dxGridSyncMasterDetailColumns(i)});n.component.updateDimensions()}function groupCellTemplate(n,t){var f=t.column.cell_classes,i=$("<div/>"),r=function(n,t){var i=$("<span class='search-result-cell-value'/>");return i.html(n),t&&i.addClass(t),i},u;i.addClass(f.join(" "));r(t.column.caption+": ").appendTo(i);u=r(t.data.key);t.data.caption&&(u=$($.parseHTML(t.data.caption)));u.appendTo(i);t.data.count&&r(" ("+t.data.count+") ").appendTo(i);t.groupContinuedMessage&&r("("+t.groupContinuedMessage+")","secondary").appendTo(i);t.groupContinuesMessage&&r("("+t.groupContinuesMessage+")","secondary").appendTo(i);n.append(i)}function checkForNestedLinkGrid(n){var t=n.element.closest("tr[data-row-path]").attr("data-row-path");t&&n.element.attr("id").indexOf("links-table")!==-1&&n.element.attr("id","links-table-"+createGuid())}function dxGridAddTablePath(n){var t=n.element.closest("tr[data-row-path]").attr("data-row-path"),i=$("[data-grid-id='"+n.element.attr("id")+"']").attr("data-api-table-name");t?$("[data-grid-id='"+n.element.attr("id")+"']").attr("data-table-path",t+":"+i):$("[data-grid-id='"+n.element.attr("id")+"']").attr("data-table-path",i)}function expandRowsIfNeeded(n){for(var t,o,i,f=n.getVisibleRows(),r=[],e=[],s=f.length,u=0;u<s;u++)t=f[u],t.data.IsExpanded&&r.push(t.key),t.rowType==="detail"&&e.push(t.key);if(e.length===0)for(o=r.length,i=0;i<o;i++)n.expandRow(r[i])}function updateCountBadge(n){var o=n.element.closest(".tab-pane").attr("id"),i=$('[data-target="#'+o+'"]'),u=i.find(".loading-image-small"),t,r,f,e;o!="links-view-docs"?u.length>0&&(t=n.component.totalCount(),u.remove(),i.append('<span class="badge">'+t+"<\/span>"),t==0?i.parent().hide():i.parent().show()):(t=n.component.totalCount(),t>0&&(i.parent().show(),r=$(n.element[0]).closest(".column-container"),r.css("display")=="none"&&(r.show(),$(r).prev().hasClass("column-container")&&$(r).prev().show(),u.length>0?(u.remove(),i.append('<span class="badge">'+t+"<\/span>")):(f=i.find(".badge"),f.length>0&&(e=f[0].textContent,isNaN(e)||(t+=Number(e)),$(f[0]).text(t))))))}function onDxGridRowClick(n){n.rowElement.toggleClass("dx-datagrid-wrap")}function onDxToolbarPreparing(n,t){addDxGridToolbarMenuItems(n,t);GetGridElementBoolProperty(n.element,"hide-grid-sett-buttons")||(addDxGridToolbarCustomColumnChooser(n,t),addDxGridToolbarStateItems(n,t),addCreateExportButton(n,t))}function addCreateExportButton(n,t){n.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{hint:"Экспортировать данные в формате Excel",icon:"download",visible:t.option("excel_format")?t.option("excel_format"):0,disable:!0,onClick:function(){createExportHandler(n,t,t.option("excel_format"))}}});n.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{hint:"Экспортировать данные в формате ODS",icon:"download",visible:t.option("ods_format")?t.option("ods_format"):0,disable:!0,onClick:function(){createExportHandler(n,t,t.option("ods_format"))}}});n.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{hint:"Добавить узел",icon:"repeat",visible:t.option("add_roadmap")?t.option("add_roadmap"):0,disable:!1,onClick:function(){addActivityHandler(n,t)}}})}function addActivityHandler(n,t){var r=t.option("addactivity_url");$("#btn-ok_from_modal").unbind("click");console.log("handleLinkAction1");var i=undefined,u=function(n,t){return saveCurrentHash(),i?i(n,t):void 0};setPreventDefault(n);ModalHelper({dialog:"#actionDialog",url:r,isTargetBlank:!1,beforeSubmit:u,afterSubmit:undefined,control:null,event:null,useDefaultSubmit:!1,dontSubmit:!1,keepScripts:null}).openWindow()}function createExportHandler(n,t,i){var e,f;waitingDialog.showWaiting();e=JSON.stringify(t.state().columns);f=t.getDataSource().loadOptions();f.filter=t.getCombinedFilter();var o=JSON.stringify(f),u={columns:e,loadOptions:o},s=$("form").serializeArray();$.each(s,function(n,t){var i=u[t.name];u[t.name]=i===undefined||i===""?t.value:i+","+t.value});var h=urlParam("yearRequisite"),c=urlParam("selectedYear"),r=appendUrlArgument(t.option("export_url"),"format",i);r=appendUrlArgument(r,"yearRequisite",encodeURIComponent(h));r=appendUrlArgument(r,"selectedYear",c);$.ajax({url:r,type:"POST",cache:!1,data:u,success:function(n){waitingDialog.hide();window.location.href=getRelativeUrl("GridExport/DownloadFile?fileGuid="+n.FileGuid+"&fileName="+n.FileName)},error:function(n){waitingDialog.hide();showCommonErrors([n.responseText])}})}function addDxGridToolbarCustomColumnChooser(n){GetGridElementBoolProperty(n.element,"allow-column-chooser")&&n.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{hint:"Выбор столбцов",icon:"column-chooser",onClick:function(t){dxGridCustomColumnsChooser(n,t)}}})}function dxGridGetCustomChooserColumns(n){for(var t,r,u=[],f=[],e=n.columnCount(),i=0;i<e;i++)t=n.columnOption(i),r={visible:!0,index:t.index,caption:t.caption,dataField:t.dataField},t.visible&&f.push(r),u.push(r);return{columns:u,checked:f}}function dxGridSortCustomChooserColumns(n){n.beginUpdate();var t=n.option("items"),i=t.sort(function(t,i){var r=n.option("selectedItems").indexOf(t)!==-1,u=n.option("selectedItems").indexOf(i)!==-1;return r&&!u?-1:u&&!r?1:t.caption<i.caption?-1:t.caption>i.caption?1:0});n.option("items",i);n.endUpdate()}function appendTooltip(n,t){var i=$("<div data-item-tooltip><\/div>");return $(i).dxTooltip({target:t,showEvent:{name:"mouseenter",delay:800},hideEvent:"mouseleave",position:"top",contentTemplate:function(t){t.html(n)},animation:{show:{type:"pop",from:{scale:.1,opacity:0},to:{opacity:1,scale:1}},hide:{type:"pop",from:{scale:1,opacity:1},to:{opacity:0,scale:.1}}}}),t.append(i),i}function dxGridCustomColumnsChooser(n,t){var i=n.component,r=i.colChooserPopup,u;r||(r=i.colChooserPopup=$("#colChooserPopup_"+n.element[0].id).dxPopup({showCloseButton:!0,visible:!1,title:"Выбор столбцов",width:350,height:520}));var s=dxGridGetCustomChooserColumns(i),e=r.find(".dx-popup-content"),c=r.find("[data-item-tooltip]");if(e.is(":empty")&&!c.length){u=document.createElement("div");$(u).addClass("grid-columns-list");var o=$(u).dxList({items:s.columns,selectionMode:"multiple",selectedItems:s.checked,showSelectionControls:!0,itemTemplate:function(n,t,i){appendTooltip("<span>"+n.caption+"<\/span>",i);i.append("<b>"+n.caption+"<\/b>")},onSelectionChanged:function(t){var u,f,r;for(i.beginUpdate(),u=t.addedItems.length,r=0;r<u;r++)i.columnOption(t.addedItems[r].index,"visible",!0);for(f=t.removedItems.length,r=0;r<f;r++)o._getSelectedItemIndices().length>0?i.columnOption(t.removedItems[r].index,"visible",!1):o.selectItem(t.removedItems[r]);i.endUpdate();dxGridSortCustomChooserColumns(t.component);scaleWidthVisibleColumns(i,n.element);setTimeout(100);i.refresh()},onInitialized:function(n){dxGridSortCustomChooserColumns(n.component)}}).dxList("instance"),h=document.createElement("div"),f=null;$(h).dxTextBox({value:"",placeholder:"Поиск...",showClearButton:!0,valueChangeEvent:"keyup",onValueChanged:function(n){f&&(window.clearTimeout(f),f=null);f=window.setTimeout(function(){for(var r=i.colChooserList,u=r.option("items"),s=u.length,t=0;t<s;t++){var f=u[t],e=n.value.toLowerCase(),o=!0;e&&e.trim()!==""&&(o=f.caption.toLowerCase().search(n.value.toLowerCase())>=0);f.visible=o}r.repaint()},200)}});e.append(h);e.append(u);i.colChooserList=o}r.dxPopup("instance").option({showCloseButton:!0,visible:!0,position:{my:"right top",at:"left bottom",of:t.element}})}function scaleWidthVisibleColumns(n){var t;if((!n.option("masterDetail")||!n.option("masterDetail").enabled)&&(t=n.getVisibleColumns().length,!(t<2))){var i=n.getVisibleColumns()[t-1],r=n.columnOption(i.index,"width"),u=n.columnOption(i.index,"visibleWidth");r&&StringEndsWith(r,"px")&&(n.columnOption(i.index,"width",r),n.columnOption(i.index,"visibleWidth",r));u&&StringEndsWith(u,"px")&&(n.columnOption(n.getVisibleColumns()[t-1].index,"width",u),n.columnOption(n.getVisibleColumns()[t-1].index,"visibleWidth",u))}}function addDxGridPagerButtons(n,t){var i;if(n.option("paging").enabled&&t.find(".dx-pages").length!==0){if(t.find(".dx-pages .grid-pager-nums").length!==0){t.find(".dx-pages .grid-pager-nums").find(".dx-numberbox").dxNumberBox("instance").option("max",n.pageCount());return}var r=document.createElement("div"),u=document.createElement("div"),f=function(){var i=$(r).dxNumberBox("instance"),t=i.option("text")||i.option("value");t<=0&&(t=1);n.pageIndex(t-1)};$(r).dxNumberBox({min:1,max:n.pageCount(),value:n.pageIndex()+1,showSpinButtons:!0,onKeyUp:function(n){n.jQueryEvent.key==="Enter"&&f()},onKeyPress:function(n){var t=Number(n.jQueryEvent.key);typeof t=="number"&&isFinite(t)&&Math.floor(t)===t||n.jQueryEvent.preventDefault()}});$(u).dxButton({icon:"spinright",hint:"Перейти",onClick:function(){f()}});i=document.createElement("div");$(i).addClass("grid-pager-nums");$(i).append(r);$(i).append(u);t.find(".dx-pages").append(i)}}function addDxGridToolbarMenuItems(n){if(n.element.parent("div[data-allow-actions]").attr("data-allow-actions")==="True"&&n.element.parent("div[data-allow-selection]").attr("data-allow-selection")==="True"){var t=getDxGridId(n.element);n.toolbarOptions.items.unshift({location:"before",widget:"dxMenu",options:{visible:!1,onItemClick:function(n){n.event.stopPropagation();onDxGridActionClick(n,t)},items:[{text:"Действия",id:"root"}],elementAttr:{id:t+"-toolbar-menu"}}})}}function addDxGridToolbarStateItems(n){var t=getDxGridStateKey(n.element);t&&n.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{hint:"Список состояний",icon:"menu",onClick:function(t){var i=new CustomStateDialog(n,t);i.Init()}}},{location:"after",widget:"dxButton",options:{hint:"Сбросить состояние",icon:"refresh",onClick:function(){dxGridCustomStateReset(n.component)}}})}function onDxGridActionClick(n,t){n.itemData.id!=="root"&&n.itemData.text!=="нет доступных действий"&&handleUrl(n.itemData.url,n.itemData.dialog,n.itemData.afterSubmit,t)}function onDxGridSelectionChanged(n,t){var i=$("#"+getDxGridId(n.element)+"-toolbar-menu").dxMenu("instance"),e=n.selectedRowsData.filter(function(){return t.getSelectedRowKeys()}),u,f;if(i)if(i.lastAjaxRequest&&i.lastAjaxRequest.abort(),e.length>1){var o=$(n.element).attr("id").indexOf("files-table")!==-1,s=$(n.element).attr("id").indexOf("multieditable")!==-1,r=t._options._optionManager._options.isAjax;if(r&&(u=$(n.element).find("div[class*='dx-actions-menu']:first"),u.length&&($(n.element).find("div[class*='dx-actions-menu'][data-is-ajax-act*='true']").length||$(n.element).find("[class*='dx-datagrid-rowsview']").find("[class*='dx-menu-item'][aria-haspopup*='true']").length||(r=!1))),r){i.lastAjaxRequest=getContextActionsForRowsAjax(t,i,n);return}f=getContextActionsForRows(t,o,s);i.option("items",[{text:"Действия",id:"root",items:f}]);i.option("visible",!0)}else i.option("items",[]),i.option("visible",!1);onDxGridSelectionChanged_CustomAction(n,t)}function onDxGridSelectionChanged_CustomAction(){}function dxGridRowNumberCellTemplate(n,t){var i=t.row.dataIndex+1;$("<div class='search-result-cell text'><a class='search-result-cell-value static'>"+i+"<\/a><\/div>").appendTo(n)}function dxGridRowActivityStatusCellTemplate(n){if(typeof n.Fields!="undefined"){var t=this.dataField.replace(/^Fields./,""),i=getBaseUrl();if(n.Fields[t]=="running")return'<img src="'+i+'/Images/activityState/16-Yellow.png" title="выполняется" alt="выполняется"/>';if(n.Fields[t]=="finish")return'<img src="'+i+'/Images/activityState/16-Green.png" title="выполнен" alt="выполнен"/>'}return""}function dxGridDateCellPrepare(n){if(typeof n.Fields!="undefined"){var t=this.dataField.replace(/^Fields./,"");return n.Fields[t]}return""}function loadActionAjax(n,t,i,r){var u=getBaseUrl()+"/Search/GetAvailableActions?docKeys="+n+"&objType="+r+"&rnd="+Math.random()+"&searchType="+getUrlParameter("searchType")+"&searchBlock="+getUrlParameter("searchBlock");$.ajax({url:u,type:"GET",contentType:!1,cache:!1,processData:!1}).then(function(r){var f,u;$(i).empty();r&&r.length>0&&(f=r.map(function(t){return{text:t.Title,dialog:t.Options.dialog,afterSubmit:t.AfterSubmit,url:joinGridActionUrl(t.Options.url,"uniqueIds="+n+"&returnUrl="+encodeURIComponent(window.location.href)+(t.Options.tableId?"&tableId="+t.Options.tableId:""))}}),u=$("<div class='dx-actions-menu'/>").dxMenu({onItemClick:function(n){n.event.stopPropagation();onDxGridActionClick(n,t)},items:[{icon:"menu",id:"root",items:f}]}),u.find(".dx-menu-item-popout-container").remove(),u.appendTo(i),setTimeout(function(){$(u.find(".dx-menu-item")[0]).click()},100));r.length===0&&(f=[{text:"нет доступных действий",dialog:"DialogWindow",afterSubmit:null}],u=$("<div class='dx-actions-menu'/>").dxMenu({items:[{icon:"menu",id:"root",items:f}]}),console.log(f),u.find(".dx-menu-item-popout-container").remove(),u.appendTo(i),setTimeout(function(){$(u.find(".dx-menu-item")[0]).click()},100))},function(n){console.error(n)})}function dxGridRowMenuCellTemplateAjax(n,t){var r=getDxGridId(t.component.element()),i=$("<div class='dx-actions-menu' data-is-ajax-act='true'/>").dxMenu({onItemClick:function(n){n.event.stopPropagation();onDxGridActionClick(n,r)},items:[{icon:"menu",id:"root",items:[]}]});i.find(".dx-menu-item-popout-container").remove();i.appendTo(n);i.on("click",function(){var u=i.parent(),f;u.empty();f=$('<div style="visibility: visible;" class="loading-image-small"><\/div>');f.appendTo(u);loadActionAjax(t.data.Key,r,n,t.column.objType)})}function dxGridRowMenuCellTemplate(n,t){var f=t.data.Actions,r=f.map(function(n){return{text:n.Title,dialog:n.Options.dialog,afterSubmit:n.AfterSubmit,url:joinGridActionUrl(n.Options.url,"uniqueIds="+t.data.Key+"&returnUrl="+encodeURIComponent(window.location.href)+(n.Options.tableId?"&tableId="+n.Options.tableId:""))}}),u,i;r.length!==0&&(u=getDxGridId(t.component.element()),i=$("<div class='dx-actions-menu'/>").dxMenu({onItemClick:function(n){n.event.stopPropagation();onDxGridActionClick(n,u)},items:[{icon:"menu",id:"root",items:r}]}),i.find(".dx-menu-item-popout-container").remove(),i.appendTo(n))}function joinGridActionUrl(n,t){var i=n;return i&&(i+=i.indexOf("?")!==-1?"&":"?"),i+t}function getContextActionsForRowsAjax(n,t,i){var f=n.getSelectedRowsData().filter(function(){return n.getSelectedRowKeys()}),e=f.map(function(n){return n.Key}),r=e.join(","),o="&objType="+n._options._optionManager._options.objType,s=getBaseUrl()+"/Search/GetAvailableActions?docKeys="+r+o+"&rnd="+Math.random()+"&searchType="+getUrlParameter("searchType")+"&searchBlock="+getUrlParameter("searchBlock"),u=$.ajax({url:s,type:"GET",contentType:!1,cache:!1,processData:!1});return u.then(function(u){var o,f,e;if(u&&u.length>0){for(e=[],o=0;o<u.length;o++)f=u[o],e.push({text:f.Title,dialog:f.Options.dialog,afterSubmit:f.AfterSubmit,url:joinGridActionUrl(f.Options.url,"uniqueIds="+r+"&returnUrl="+encodeURIComponent(window.location.href)+(f.Options.tableId?"&tableId="+f.Options.tableId:""))});t.option("items",[{text:"Действия",id:"root",items:e}]);t.option("visible",!0)}u.length===0&&(e=[{text:"нет доступных действий",dialog:"DialogWindow",afterSubmit:null}],t.option("items",[{text:"Действия",id:"root",items:e}]),t.option("visible",!0));onDxGridSelectionChanged_CustomAction(i,n)}),u}function getUrlParameter(n){for(var u=window.location.search.substring(1),r=u.split("&"),t,i=0;i<r.length;i++)if(t=r[i].split("="),t[0]===n)return typeof t[1]===undefined?!0:decodeURIComponent(t[1]);return!1}function getContextActionsForRows(n,t,i){for(var o,l,s,a,c,y,u={},r,e=n.getSelectedRowsData().filter(function(){return n.getSelectedRowKeys()}),f=0;f<e.length;f++)for(o=0;o<e[f].Actions.length;o++)if(r=e[f].Actions[o],t){if(r.Title!=="Удалить"&&!(i&&r.Title==="Редактировать"))continue;r.Title in u?(u[r.Title].keys.push(e[f].Key),l=++u[r.Title].count):u[r.Title]={data:r,count:1,keys:[e[f].Key]}}else{if(r.Type===1||r.Title==="Отложить")continue;r.Options.key in u?(u[r.Options.key].keys.push(e[f].Key),l=++u[r.Options.key].count):u[r.Options.key]={data:r,count:1,keys:[e[f].Key]}}s=[];for(a in u)if(r=u[a],t){var v=r.data.Options.url.split("uniqueIds="),p=decodeURIComponent(v[1]).split("/")[0],h="";for(c=0;c<r.keys.length;c++)h&&(h+=","),h+=p+"/"+r.keys[c];y=v[0]+"uniqueIds="+encodeURIComponent(h);s.push({text:r.data.Title,dialog:r.data.Options.dialog,afterSubmit:r.data.AfterSubmit,url:joinGridActionUrl(y,"returnUrl="+encodeURIComponent(window.location.href)+(r.data.Options.tableId?"&tableId="+r.data.Options.tableId:""))})}else s.push({text:r.data.Title,dialog:r.data.Options.dialog,afterSubmit:r.data.AfterSubmit,url:joinGridActionUrl(r.data.Options.url,"uniqueIds="+r.keys.join()+"&returnUrl="+encodeURIComponent(window.location.href)+(r.data.Options.tableId?"&tableId="+r.data.Options.tableId:""))});return s}function getDxGridId(n){return n.parent("div[data-grid-id]").attr("data-grid-id")}function getDxGridStateKey(n){return n.parent("div[data-state-key]").attr("data-state-key")}function GetGridElementBoolProperty(n,t){var i=n.parent().data(t);return $.parseJSON(i.toLowerCase())}function StringEndsWith(n,t){return typeof n=="string"&&n.indexOf(t,n.length-t.length)!==-1}function dxGridSyncMasterDetailColumns(n){var t=n.element.dxDataGrid("instance"),i;if(t.option("masterDetail")&&t.option("masterDetail").enabled&&!t.option("detail-grid"))i=function(){dxGridSyncMasterDetails(n)},n.component.getView("columnHeadersView").resizeCompleted.remove(i),n.component.getView("columnHeadersView").resizeCompleted.add(i);else if(t.option("detail-grid")){var f=n.element,e=n.element.closest(".dx-datagrid").parent(),u=e.dxDataGrid("instance"),r=f.dxDataGrid("instance");if(u.columnCount()!==r.columnCount())return;if(!r.option("detail-grid"))return;dxGridSyncMasterDetailGridFix(u,r,1)}}function dxGridSyncMasterDetails(n){var r=n.element.dxDataGrid("instance"),i=r.element().find(".sync-detail-grid > div"),t,u;if(i.length)for(t=0;t<i.length;t++)u=$(i.get(t)).dxDataGrid("instance"),dxGridSyncMasterDetailGridFix(r,u,1)}function dxGridSyncMasterDetailGridFix(n,t,i){var r,u,f;for(t.beginUpdate(),r=0;r<n.columnCount();r++)t.columnOption(r,"visibleIndex",n.columnOption(r,"visibleIndex")),t.option("detail-grid")&&t.columnOption(r,"visible",n.columnOption(r,"visible"));t.endUpdate();u=$(n.element()).find("tr").first().children("td").slice(i);f=$(t.element()).find("colgroup").first().children("col");u.each(function(n){f.eq(n).attr("style","width: "+u.eq(n).outerWidth()+"px")})}function dxGridSyncMasterDetailGrid(n,t,i){t.beginUpdate();for(var r=0;r<n.columnCount();r++)r===0?(dxGridSyncMasterDetailLeadColumn(n,t,"width",i),dxGridSyncMasterDetailLeadColumn(n,t,"visibleWidth",i)):(t.columnOption(r,"width",n.columnOption(r,"width")),t.columnOption(r,"visibleWidth",n.columnOption(r,"visibleWidth"))),t.columnOption(r,"visibleIndex",n.columnOption(r,"visibleIndex")),t.option("detail-grid")&&t.columnOption(r,"visible",n.columnOption(r,"visible"));t.endUpdate()}function dxGridSyncMasterDetailLeadColumn(n,t,i,r){var u=n.columnOption(0,i);if(u||t.columnOption(0,i,n.columnOption(0,i)),$.isNumeric(u)){dxGridSyncMasterDetailLeadColumnWithPixelWidth(n,t,i,r);return}if(StringEndsWith(u,"%")){dxGridSyncMasterDetailLeadColumnWithPercentWidth(n,t,i,r);return}}function dxGridSyncMasterDetailLeadColumnWithPixelWidth(n,t,i,r){var u=parseFloat(n.columnOption(0,i));t.columnOption(0,i,u-r)}function dxGridSyncMasterDetailLeadColumnWithPercentWidth(n,t,i,r){var u=n.columnOption(0,i),f=parseFloat(u.substring(0,u.length-1));t.columnOption(0,i,Math.floor(f-r/(t.element().width()/100))+"%")}function dxGridReloadData(n){var t=$("#"+n).dxDataGrid("instance");t.clearSelection();t.refresh()}function dxGridTotalCount(n){var t=$("#"+n).dxDataGrid("instance");return t.totalCount()}function dxGridRemoveTitles(n){for(var i=n.find("tr.dx-row > td"),t=0;t<i.length;t++)i[t].title=""}function buildFilter(n){var t="",i,r;if(n.columnIndex)t+='["'+n[0]+'","'+n[1]+'","'+n[2]+'"]';else for(i=0;i<n.length;i++)r=n[i],r.columnIndex?(t+=buildFilter(r),i<n.length&&(t+=",")):t+='"'+r+'",';return t}function dxGridBeforeSend(n,t){var u,f,r,e,i,o,s;if(n==="load"&&(i=$("div[data-state-key='"+t.data.searchType+"']").children("div").dxDataGrid("instance"),i)){for(u=i.getVisibleColumns(),f="",r=0;r<u.length;r++)e=u[r],e.colIndexId&&(f+=e.colIndexId+"||");t.data.getColumns=f}if(n==="load"&&t.data&&t.data.filter){t.data.take==1&&(i=$("div[data-state-key='"+t.data.searchType+"']").children("div").dxDataGrid("instance"),i&&(o=i.getCombinedFilter(),o&&(s=buildFilter(o),t.data.filter="["+t.data.filter+',"and",'+s+"]")));var c=function(n){var r=document.createElement("div"),t,i;for(r.innerHTML=n,t=r.childNodes,i=t.length;i--;)if(t[i].nodeType==1)return!0;return!1},l=function(n){var i=n,t,r;return c(n)&&(t=$(n),t.attr("address-book-item-key")?(r=t.attr("address-book-item-key"),i=r):t.hasClass("activitystatus")?i=t.find("span").text():t.length===2&&t.first().hasClass("search-result-activityName-image")&&(i=t.last().text())),i&&i.split?'"'+i.split('"').join('\\"').split("'").join('\\"')+'"':i},h=function h(n){var i,u,r,t;for(typeof n=="string"&&(n=n.replaceAll("\\\\","\\")),i=Array.isArray(n)?n:eval(n),u=i.length,r=0;r<u;r++)t=i[r],t.replace&&(t=t.replace(/^\\+|\\+$/g,"")),t!==i[r]&&t===""&&(t="\\\\"),i[r]=Array.isArray(t)?h(t):l(t);return"["+i.toString()+"]"};t.data.filter=h(t.data.filter)}}function onContentReady(n){var t=n.element.find(".dx-datagrid-filter-row .dx-datebox"),i;t.length>0&&$.each(t,function(n,t){i=$(t).find("input");$.each(i,function(n,t){t.setAttribute("OnKeyDown","return checkDXKey(event.key)")})})}function checkDXKey(n){return n>="0"&&n<="9"||n=="."||n=="Delete"||n=="Backspace"||n=="F5"}function hideViewElementColumn(n){var t=n.closest(".column-container");t.addClass("hidden-column");placeElementsInTwoColumns(t.parent())}function showViewElementColumn(n){var t=n.closest(".column-container");t.removeClass("hidden-column");placeElementsInTwoColumns(t.parent())}function placeElementsInTwoColumns(n){n.find("> div:not(.hidden-column)").filter(":even").css("clear","left");n.find("> div:not(.hidden-column)").filter(":odd").css("clear","none")}function showAlert(n,t){ct.common.alert(n,t)}function showReplacingContentError(n,t){var i=$("<div class='page-body'><h2>Во время работы приложения произошла ошибка<\/h2><\/div>"),f=$("<small>При необходимости получить дополнительную информацию обратитесь к администратору<\/small>"),r=$("<div class='application-errors'><\/div>"),u=$("<div class='alert alert-danger' role='alert'><\/div>");u.text(t);r.append(u);i.append(r);i.append(f);$(n).last().empty();$(n).last().append(i)}function replaceContent(n,t,i,r,u,f,e){var s=$(t).last(),o;setPreventDefault(event);o=function(){s.load(n,function(n,t,f){var h=!1,s=$($.parseHTML(n)),c=s.find("#content-login-form"),o;c.length!==0?document.location=u:$(this).html()?(t==="error"&&(h=!0,r("Error occured: "+f.status+" "+f.statusText)),h||(i&&i(),e&&$.getScript(e))):n.includes("ERROR:")?document.location=u:(o=s.attr("data-empty-body-error-message"),o||(o=s.find("div.application-errors > div").text()),o||(o="Во время выполнения приложения произошла ошибка."),r(o))})};f?$.getScript(f,o):o()}function shiftModalScrollToAnchor(n){$("div.modal-body").animate({scrollTop:$("div.modal-body #"+n+"-accordion").offset().top-$("div.modal-body").offset().top},10)}function getUrlAnchor(){return window.location.hash.substr(1)}function getQueryStringParameterByName(n,t){t||(t=window.location.href);n=n.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function getAbsoluteUrl(n){var t=$("base").attr("href");return t&&t.lastIndexOf("/")==t.length-1&&(t=t.substr(0,t.length-1)),n&&n.indexOf("/")==0&&(n=n.substr(1)),t+"/"+n}function setPreventDefault(n){n&&(n.preventDefault?n.preventDefault():n.returnValue=!1)}function stopEvent(n){n&&n.stopPropagation?n.stopPropagation():window.event.cancelBubble=!0}function toggleVisibility(n,t){var i=jQuery(n);t?i.removeClass("js-hidden"):i.addClass("js-hidden");i.each(function(i,r){r.tagName=="OPTION"&&(t?jQuery(n).parent("span.toggleOption").length&&jQuery(n).unwrap():jQuery(n).parent("span.toggleOption").length==0&&jQuery(n).wrap('<span class="toggleOption" style="display: none;" />'))})}function getFrameDocument(n){var t=null;try{n.contentWindow&&(t=n.contentWindow.document)}catch(i){}if(t)return t;try{t=n.contentDocument?n.contentDocument:n.document}catch(i){t=n.document}return t}function getDoc(n){var t=null;try{n.contentWindow&&(t=n.contentWindow.document)}catch(i){}if(t)return t;try{t=n.contentDocument?n.contentDocument:n.document}catch(i){t=n.document}return t}function getTimeStamp(){return(new Date).getTime()}function formatDate(n){var r=new Date(n),t=""+(r.getMonth()+1),i=""+r.getDate(),u=r.getFullYear();return t.length<2&&(t="0"+t),i.length<2&&(i="0"+i),[u,t,i].join("-")}function formatMoney(n){if(!jQuery.isNumeric(n))return n;var t=2;return window.moneyPrecision&&(t=window.moneyPrecision),n.toFixed(t).replace(/\d(?=(\d{3})+\.)/g,"$& ")}function appendUrlArgument(n,t,i,r,u){var o,c,l,h,e;r=r||!0;u=u||!1;n.indexOf("#")>0?(o=n.indexOf("#"),c=n.substring(o,n.length)):(o=n.length,c="");var a=n.substring(0,o),s=a.split("?"),f="";if(s.length>1&&s[1]!="")for(l=s[1].split("&"),h=0;h<l.length;h++)e=l[h].split("="),r&&e[0]==t||(f==""?f="?":f+="&",f+=e[0]+"="+(e[1]?e[1]:""));return f==""&&(f="?"),u?f="?"+t+"="+i+(f.length>1?"&"+f.substring(1):""):(f!==""&&f!="?"&&(f+="&"),f+=t+"="+(i?i:"")),s[0]+f+c}function addNewTableRow(n,t){var a,c,i,p,w,v,f,e,k,d;setPreventDefault(t);var u=$(n).closest(".table-edit > .table-content"),y=u.children(".templates").children(".table-row-template").children(".table-edit-row"),h=y.length===0;h&&(a=$(n).closest(".table-row-row-view").data("table-name"),a=$(a.split("-")).last()[0],y=u.parents().find(".templates").children(".table-row-row-view").closest(".table-edit-wrapper").children(".table-edit").find(".nested-table-row-template").children(".table-edit-row").filter(function(){return $(this).closest(".nested-table-row-template").data("table-name")===a}));c=u.children(".templates").children(".table-row-row-view");c&&c.length!==0||(c=u.parents().find(".templates").children(".table-row-row-view"));i=y.clone(!1);p=u.children(".table-edit-row").map(function(){return $(this).attr("data-rowkey")});w=p.length>0?Math.max.apply(Math,jQuery.map(p,function(n){return n})):0;i.attr("data-rowkey",w+1);i.addClass("new-table-row");var l=u.parent().attr("data-name"),r=w+1,b=$(n).closest(".table-edit-wrapper"),o="",s="";h&&(o=b.children(".table-edit").attr("data-name")+"-",s=o.split("-"),s=s[s.length-2]+"-");i.find("input:not([type=radio]), select, checkbox, textarea, ul, button[is-addressbook=true]").each(function(){if($(this).attr("name")&&(h?$(this).attr("name",o+$(this).attr("name").replace(s,"")+"-"+r):$(this).attr("name",$(this).attr("name")+"-"+r)),$(this).attr("data-field-name")&&(h?$(this).attr("data-field-name",o+$(this).attr("data-field-name").replace(s,"")+"-"+r):$(this).attr("data-field-name",$(this).attr("data-field-name")+"-"+r)),$(this).attr("data-name")&&(h?$(this).attr("data-name",o+r):$(this).attr("data-name",o+$(this).attr("data-name")+"-"+r)),$(this).attr("data-parent-name")){var n=$(this).attr("data-parent-name");h?(n=n.replace("parent","").replace(s,""),n=o+n+"-"+r+"parent"):n=n.substring(0,n.length-6)+"-"+r+"parent";$(this).attr("data-parent-name",n)}$(this).attr("data-edit-required")==="true"&&($(this).removeAttr("data-edit-required"),$(this).attr("required",!0));$(this).attr("data-dictionarygroup")&&$(this).attr("data-dictionarygroup",l+"-"+$(this).attr("data-dictionarygroup")+"-"+r);$(this).attr("data-dictionaryParent")&&$(this).attr("data-dictionaryParent",l+"-"+$(this).attr("data-dictionaryparent")+"-"+r);$(this).attr("data-addressbook-main-field")&&$(this).attr("data-addressbook-main-field",l+"-"+$(this).attr("data-addressbook-main-field")+"-"+r)});i.find(".show-dict-btn").each(function(){$(this).attr("parent-id")&&$(this).attr("parent-id",l+"-"+$(this).attr("parent-id")+"-"+r)});i.find("[data-dg-group]").each(function(){$(this).attr("data-dg-group",l+"-"+r+"-"+$(this).attr("data-dg-group"))});u.append(i);v=c;v!=undefined&&v.length>0&&(f=i.attr("data-rowkey"),e=b.children(".table-edit").attr("data-name"),i.children(".table-row-row-view").each(function(){$(this).remove()}),v.each(function(t,r){var o=$(r),s=$(n).closest(".table-row-row-view").data("table-name"),u,h;(s=s?s.split("-").pop():e.split("-").pop(),o.find(".table-edit").attr("data-parent-name")==s)&&(u=o.clone(!0),u.find("input:not([type=radio]), select, checkbox, textarea").each(function(){$(this).attr("name",e+"-"+f+"-"+$(this).attr("name"));$(this).attr("data-field-name",e+"-"+f+"-"+$(this).attr("data-field-name"));$(this).attr("data-dictionarygroup")&&$(this).attr("data-dictionarygroup",e+"-"+$(this).attr("data-dictionarygroup")+"-"+f);$(this).attr("data-dictionaryparent")&&$(this).attr("data-dictionaryparent",e+"-"+$(this).attr("data-dictionaryparent")+"-"+f)}),u.attr("data-rowkey",f),u.attr("data-table-name",o.find(".table-edit").attr("data-name")),u.find(".table-edit").each(function(){$(this).attr("data-deleted-rows-field",e+"-"+f+"-"+o.find(".table-edit").attr("data-deleted-rows-field"));$(this).attr("data-name",e+"-"+f+"-"+o.find(".table-edit").attr("data-name"))}),u.insertAfter(i.children().last()),h=i.find(".table-row-selector-radio")[0],h!=undefined&&changeNestedEditTableVisibility(h))}));i.find(".form-dictionary-control").each(function(){var n=$(this);n.attr("data-dictionaryparent")==""&&setDictionaryField(n)});setEditTableRowVisibility(".table-edit-wrapper",u.closest(".table-edit-wrapper").parent());k=i.find("[data-wslist]").attr("data-wslist");i.find("[data-wslist]").attr("list",k);reinitialiseScriptShort();d={rowKey:r,innerTableContainer:i};calcTableNUM(u);$(u).trigger("onTableRowAdded",d);window.adjustNewRowTextAreaHeight(i)}function copyTableRow(n,t){var c,h,l,a,v,y;setPreventDefault(t);var f=$(n).closest(".table-edit > .table-content"),p=$(n).closest(".table-edit-row"),u=$(n).closest(".table-edit-row").clone(!1),w=f.children(".templates").children(".table-row-template").children(".table-edit-row"),e=w.length===0;e&&(c=$(n).closest(".table-row-row-view").data("table-name"),c=$(c.split("-")).last()[0]);h=f.children(".templates").children(".table-row-row-view");h&&h.length!==0||(h=f.parents().find(".templates").children(".table-row-row-view"));lastKey=u.attr("data-rowkey");console.log(lastKey);l=f.children(".table-edit-row").map(function(){return $(this).attr("data-rowkey")});a=l.length>0?Math.max.apply(Math,jQuery.map(l,function(n){return n})):0;u.attr("data-rowkey",a+1);var o=f.parent().attr("data-name"),i=a+1,b=$(n).closest(".table-edit-wrapper"),r="",s="";e&&(r=b.children(".table-edit").attr("data-name")+"-",s=r.split("-"),s=s[s.length-2]+"-",console.log(r),console.log(o));u.find("input:not([type=radio]), select, checkbox, textarea, ul, button[is-addressbook=true], div").each(function(){if($(this).attr("name")&&(e?$(this).attr("name",r+$(this).attr("name").replace(r,"").replace("-"+lastKey,"-"+i)):$(this).attr("name",$(this).attr("name").replace("-"+lastKey,"-"+i))),$(this).attr("data-table-name")&&(e?$(this).attr("data-table-name",r+$(this).attr("data-table-name").replace(r,"").replace("-"+lastKey,"-"+i)):$(this).attr("data-table-name",$(this).attr("data-table-name").replace("-"+lastKey,"-"+i))),$(this).attr("data-deleted-rows-field")&&(e?$(this).attr("data-deleted-rows-field",r+$(this).attr("data-deleted-rows-field").replace(r,"").replace("-"+lastKey,"-"+i)):$(this).attr("data-deleted-rows-field",$(this).attr("data-deleted-rows-field").replace("-"+lastKey,"-"+i))),$(this).attr("data-deleted-attachment-keys")&&(e?$(this).attr("data-deleted-attachment-keys",r+$(this).attr("data-deleted-attachment-keys").replace(r,"").replace("-"+lastKey,"-"+i)):$(this).attr("data-deleted-attachment-keys",$(this).attr("data-deleted-attachment-keys").replace("-"+lastKey,"-"+i))),$(this).attr("data-field-name")&&(e?$(this).attr("data-field-name",r+$(this).attr("data-field-name").replace(r,"").replace("-"+lastKey,"-"+i)):$(this).attr("data-field-name",$(this).attr("data-field-name").replace("-"+lastKey,"-"+i))),$(this).attr("data-name")&&(console.log("FDATANAME"),console.log(r+i),e?$(this).attr("data-name",r+i):$(this).attr("data-name",r+$(this).attr("data-name").replace("-"+lastKey,"-"+i))),$(this).attr("data-parent-name")){var n=$(this).attr("data-parent-name");e?(n=n.replace("parent","").replace(s,""),n=r+n+"-"+i+"parent"):n=n.substring(0,n.length-6).replace("-"+lastKey,"-"+i)+"parent";$(this).attr("data-parent-name",n)}$(this).attr("data-edit-required")==="true"&&($(this).removeAttr("data-edit-required"),$(this).attr("required",!0));$(this).attr("data-dictionarygroup")&&$(this).attr("data-dictionarygroup",o+"-"+$(this).attr("data-dictionarygroup").replace("-"+lastKey,"-"+i));$(this).attr("data-dictionaryParent")&&$(this).attr("data-dictionaryParent",o+"-"+$(this).attr("data-dictionaryparent").replace("-"+lastKey,"-"+i));$(this).attr("data-addressbook-main-field")&&$(this).attr("data-addressbook-main-field",o+"-"+$(this).attr("data-addressbook-main-field").replace("-"+lastKey,"-"+i))});u.find(".show-dict-btn").each(function(){$(this).attr("parent-id")&&$(this).attr("parent-id",o+"-"+$(this).attr("parent-id").replace("-"+lastKey,"-"+i))});u.find("span").each(function(){$(this).attr("data-related-field")&&$(this).attr("data-related-field",$(this).attr("data-related-field").replace("-"+lastKey,"-"+i))});u.find("[data-dg-group]").each(function(){$(this).attr("data-dg-group",o.replace("-"+lastKey,"-"+i)+"-"+$(this).attr("data-dg-group"))});f.append(u);u.find(".bool-sel-ctl").each(function(){var n=$(this),t=n.attr("name").substring(0,n.attr("name").lastIndexOf("-"));n.val($(p[0]).find('[name^="'+t+'"]').val())});u.find(".form-dictionary-control").each(function(){var n=$(this);n.attr("data-dictionaryparent")==""&&setDictionaryField(n)});setEditTableRowVisibility(".table-edit-wrapper",f.closest(".table-edit-wrapper").parent());v=u.find("[data-wslist]").attr("data-wslist");u.find("[data-wslist]").attr("list",v);reinitialiseScriptShort();y={rowKey:i,innerTableContainer:u};calcTableNUM(f);$(f).trigger("onTableRowAdded",y)}function calcTableNUM(n){var i=n.closest(".table-edit").children(".table-content").children(".table-edit-row[data-rowkey]").children(".table-edit-columns").find("input[type=hidden][name*='-NUM-']"),t=1;i.each(function(){var n=$(this);n.val(t);t++})}function editTableRow(n,t,i){t.preventDefault();TableEditForm(n,i)}function editTableRowByColumn(n,t,i){t.preventDefault();$(n).closest(".table-content").find(".selector-all-row").filter(function(){return $(this).is(":checked")}).length==0?alert("Необходимо выбрать хотя бы одну строку."):TableEditRowsByColumn(n,i)}function viewTableRow(n,t,i){t.preventDefault();TableViewForm(n,i)}function removeTableRow(n,t){var f,r,e;t!==undefined&&setPreventDefault(t);var i=$(n).closest(".table-edit"),u=i.find("input[type=hidden][name='"+i.attr("data-deleted-rows-field")+"']"),o=u.val();$(n).attr("groupedTable")?$(n).closest(".table-edit-row").find(".table-edit-row[data-rowkey]").each(function(n,t){var i=u.val(),r=$(t).attr("data-rowkey").split("-").pop();u.val(i+r+",")}):u.val(o+$(n).closest(".table-edit-row").attr("data-rowkey").split("-").pop()+",");f=i.find("input[type=hidden][name='"+i.attr("data-deleted-attachment-keys")+"']");$(n).closest(".table-edit-row").find(".attachment").each(function(n,t){var i=$(t).attr("data-attachmentKey"),r=f.val();f.val(r+i+",")});r=$(n).closest(".table-edit-row");r.find(".delete-table-row-attachment:visible").children(":first").click();e=r.attr("data-rowkey");$(i).trigger("onTableRowRemoving",e);r.closest("form").off("submit.autoNumeric");r.remove();initAutonumeric();setEditTableRowVisibility(".table-edit-wrapper",i.closest(".table-edit-wrapper").parent());calcTableNUM(i);$(i).trigger("onTableRowRemoved",e)}function removeAttachment(n,t){setPreventDefault(t);var r=$(n).closest(".table-edit"),u=r.find("input[type=hidden][name='"+r.attr("data-deleted-attachment-keys")+"']"),f=u.val(),i=$(n).closest(".attachment-field-wrapper"),e=i.find(".attachment").attr("data-attachmentKey");u.val(f+e+",");i.find(".select-file-control").removeClass("hidden");i.find(".view-file-control").addClass("hidden")}function urlParam(n){var t=new RegExp("[?&]"+n+"=([^&#]*)").exec(window.location.href);return t==null?null:decodeURI(t[1])||0}function createGuid(){function n(n){var t=(Math.random().toString(16)+"000000000").substr(2,8);return n?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return n()+n(!0)+n(!0)+n()}function addTableRowAttachHandler(){setTimeout(function(){var n=$('input[name="file-drop-area-hidden-attachmentFiles"]');n.length>0?$('input[name="file-drop-area-hidden-attachmentFiles"]').click(function(){return $('input[name^="file-drop-area-hidden-attachmentFiles"]:first').trigger("click"),!1}):addTableRowAttachHandler()},100)}function addTableRowAttachment(n,t){setPreventDefault(t);var f=n.closest(".table-edit-row"),i=$(f),e="[name$='-attachment-"+i.data("rowkey")+"']",o=i.find(e);window.attachmentName=o.attr("name");window.attachmentKeyName=window.attachmentName.replace("attachment","attachment_key");window.deleteTableRowAttachmentElement=i.find(".delete-table-row-attachment");window.doNotReload=!0;window.files="";window.fileKeys="";window.addTableRowAttachmentWasClicked=!0;window.filterGridColumnEnabled=!0;window.filterGridColumn="AttachmentDocType";window.filterGridColumnValue="Документация процедуры закупки";var r=urlParam("flowKey"),s=urlParam("uniqueIds"),u=r==null?getBaseUrl()+"/ContextAction/CreateAttachment?isMultiple=false&allowedCategories="+encodeURIComponent("Документация")+"&uniqueIds="+s:getBaseUrl()+"/ContextAction/CreateAttachment?isMultiple=false&allowedCategories="+encodeURIComponent("Документация")+"&flowKey="+r;ModalHelper({dialog:"#actionDialog",url:u,isTargetBlank:!1,afterSubmit:"addRowAttachment#"+u}).openWindow();window.location.pathname.toLowerCase().indexOf("/Edit".toLowerCase())===-1&&addTableRowAttachHandler()}function deleteTableRowAttachment(n,t,i){$(n).parent().hide();_deleteTableRowAttachment($(n),i)}function _deleteTableRowAttachment(n,t){var r=n.closest(".table-edit-row"),o=r.data("rowkey"),c="[name$='-attachment-"+o+"']",l=r.find(c),u,f,i,e;l.val("");var a="[name$='-attachment_key-"+o+"']",s=r.find(a),h=s.val();if(s.val(""),!t)if(window.location.pathname.toLowerCase().indexOf("/Edit".toLowerCase())!==-1)$.ajax({url:getBaseUrl()+"/ContextAction/DeleteAttachmentHandler",type:"POST",data:{clientGuid:h,uniqueIds:urlParam("uniqueIds")},cache:!1});else for(u=window.grids[0]._gridInstance,f=u.getVisibleRows(),i=0;i<f.length;i++)if(e=f[i],e.data.AttachmentClientGuid==h){u.deleteRow(e.rowIndex);break}}function disableTemplateRowValidation(){$(".table-row-template").find("input, select, checkbox, textarea").filter("[required]").each(function(){$(this).attr("data-edit-required",!0);$(this).removeAttr("required")})}function loadLinks(n,t){var r,i,u,f;setPreventDefault(t);stopEvent(t);r=$(n);i=$(r.attr("data-collapse-selector"));$.trim(i.html())===""&&(i.addClass("text-center"),i.append('<div class="loading-image"><\/div>'),u=i.children(".loading-image").get(0),showLoadingIndicator(u),f=r.attr("data-load-url"),$.ajax({url:f,success:function(n){i.empty();i.removeClass("text-center");i.append(n)},error:function(){var t=$("<div class='alert alert-danger'><\/div>"),n;t.text("Не удалось загрузить связанные документы");n=$("<div class='modal-body'><\/div>");n.append(t);i.append(n)}}))}function isAjaxFileStorageSupported(){return window.FormData!==undefined}function appendAjaxFile(n,t,i){var e=$(n),s=$("form"),r,u,o,f;return s.length>1&&window.location.pathname.toLowerCase().indexOf("/Edit".toLowerCase())===-1&&window.addTableRowAttachmentWasClicked&&(e=s.first()),u=e.attr("data-ajaxFileStorageKey"),u?r=ajaxFileStorage[u]:(u=++ajaxFileStorageCounter,e.attr("data-ajaxFileStorageKey",u),r={},r.counter=0,r.data=[],ajaxFileStorage[u]=r),o=++r.counter,f={},f.name=t,f.file=i,f.id=id,r.data[o]=f,o}function removeAjaxFile(n,t){var u=$(n),f=u.attr("data-ajaxFileStorageKey"),i,r;f&&(i=ajaxFileStorage[f],i)&&(r=i.data,r[t]&&delete r[t],u.trigger("onRemoveAjaxFile"))}function getAjaxFiles(n){var f=$(n),u=f.attr("data-ajaxFileStorageKey"),t,i,r;if(!u)return[];if(t=ajaxFileStorage[u],!t)return[];i=[];for(r in t.data)i.push({key:r,data:t.data[r]});return i}function ajaxCall(n,t,i,r){var u=n;if(t=t.toUpperCase(),t=="GET"){$.ajax({url:u,type:"GET",contentType:!1,cache:!1,processData:!1,success:i,error:r});return}var f=function(n){var r="",i,t;if(n[0]=="{")for(i=1,t=1;t<n.length;t++)if(n[t]=="{"&&i++,n[t]=="}"&&i--,i==0){r=n.substring(0,t+1);break}return r},e=function(n){var u=f(n),t;u?(t=JSON.parse(u),t.status=="ERROR"&&r({responseText:t.responseMessage,allMessages:t.allMessages}),t.status=="OK"&&i(t.responseMessage,t.afterSubmitJs)):n?r({responseText:n}):i(n)},o=function(n){r(n)};$.ajax({url:u,type:"POST",contentType:!1,cache:!1,processData:!1,success:e,error:o})}function ajaxFormSubmit(n,t,i,r){var e=$(n),y=e.attr("action"),g=e.attr("method").toUpperCase(),s,c,u,h,l,a,f,v;if(g=="GET"){$.ajax({url:y,type:"GET",data:e.serialize(),contentType:!1,cache:!1,processData:!1,success:t,error:i});return}var nt=function(n){var r="",i,t;if(n[0]=="{")for(i=1,t=1;t<n.length;t++)if(n[t]=="{"&&i++,n[t]=="}"&&i--,i==0){r=n.substring(0,t+1);break}return r},p=function(n){var u=nt(n),r;u?(r=JSON.parse(u),console.log(r),r.status=="ERROR"&&i({responseText:r.responseMessage,allMessages:r.allMessages,fileName:r.downloadFileName,messageForUser:r.messageForUser}),r.status=="OK"&&t(r.responseMessage,r.afterSubmitJs,r.allMessages,r)):n?i({responseText:n}):t(n)},tt=function(n){i(n)};if($(n).trigger("beforeSubmit"),window.FormData!==undefined){var o=new FormData(n),w=typeof UploadAttachment!="undefined"&&$(".modal-title:visible:contains('Создать версию')").length==0,b=getAjaxFiles(n),k=b.length,d={};for(s=0;s<k;s++)c=b[s],u=c.data,w?(h=c.key,l=UploadAttachment.getFileProps(h),l!==null?(d[h]=l,o.append(u.name,u.file,h)):o.append(u.name,u.file,u.file.name)):o.append(u.name,u.file,u.file.name);w&&k>0&&o.append("attachmentFilesProps",JSON.stringify(d));$.ajax({url:y,type:"POST",data:o,mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,beforeSend:r,success:p,error:tt}).then(function(){})}else a="unique"+(new Date).getTime(),f=$('<iframe src="javascript:false;" name="'+a+'" ><\/iframe>'),f.hide(),e.attr("target",a),v=function(){f.unbind("load",v);f.load(function(){var n=getFrameDocument(f[0]),t=n.body?n.body:n.documentElement,i=t.innerHTML;p(i);f.remove()});e.submit()},f.bind("load",v),f.appendTo("body")}function showLoadingIndicator(n){$(n).addClass("loading-image-shown")}function hideLoadingIndicator(n){$(n).removeClass("loading-image-shown")}function hideBlock(n){$(n).hide()}function showBlock(n){$(n).show()}function onSelectNavigate(n){document.location=n.options[n.selectedIndex].value}function getSearchResultSelectedUniqueIds(n){var t=[],i=$(n),r=i.find(".search-result-selector-checkbox:checked");return r.each(function(n,i){var f=$(i).closest(".search-result-row"),u=f.find(".search-result-column-actions li[data-itemUniqueId]"),r;u.length&&(r=u.first().attr("data-itemUniqueId"),r&&$.inArray(r,t)<0&&t.push(r))}),t}function getSearchResultSelectedUniqueIdsWithoutActionCheck(n){var t=[],i=$(n),r=i.find(".search-result-selector-checkbox:checked");return r.each(function(n,i){var u=$(i).closest(".search-result-row"),r=u.attr("data-itemUniqueId");r&&$.inArray(r,t)<0&&t.push(r)}),t}function getSearchResultSelectedActionKeys(n){var t=[],i=!1,r=$(n),u=r.find(".search-result-selector-checkbox:checked");return u.each(function(n,r){var e=$(r).closest(".search-result-row"),f=e.find(".search-result-column-actions li[data-actionKey]"),u;i?(u=[],f.each(function(n,i){var r=$(i).attr("data-actionKey");r&&$.inArray(r,t)>=0&&u.push(r)}),t=u):(f.each(function(n,i){var r=$(i).attr("data-actionKey");r&&$.inArray(r,t)<0&&t.push(r)}),i=!0)}),t}function setSearchResultTableMenuVisibility(n){var t=$(n),u=getSearchResultSelectedActionKeys(n),i=!1,r=!1;t.find(".search-result-actions li[data-actionKey]").each(function(n,t){var f=$(t).attr("data-actionKey"),r=$.inArray(f,u)>=0;i=i||r;toggleVisibility(t,r)});t.find(".search-result-actions option[data-actionKey]").each(function(n,t){var f=$(t).attr("data-actionKey"),i=$.inArray(f,u)>=0;r=r||i;toggleVisibility(t,i)});toggleVisibility(t.find(".search-result-actions-selectorMenu"),i);toggleVisibility(t.find(".search-result-actions-selectorSelect"),r);t.each(function(n,t){var i=$(t).attr("data-selectionResult"),r;i&&(r=$(i),r.val(getSearchResultSelectedUniqueIdsWithoutActionCheck(t)))})}function setSearchResultTableRowViewVisibility(n){var t=$(n+" > .search-result-table");t.find(".search-result-row").each(function(){var t=$(this).find(".nested-tables-visibility").is(":checked"),n=$(this).find(".table-row-row-view");t?n.show():n.hide()})}function changeNestedViewTableVisibility(n){var t=$(n).closest(".search-result-row").find("> .search-result-row-view");changeNestedTablesVisibility(n,t)}function changeNestedEditTableVisibility(n){var t=$(n).closest(".table-edit-row").find("> .table-row-row-view");changeNestedTablesVisibility(n,t)}function changeNestedTablesVisibility(n,t){var i=$(n).siblings(".nested-tables-visibility"),r=i.is(":checked");r?(i.prop("checked",!1),n.checked=!1,t.hide(),$(n).trigger("checked:after",!1)):(i.prop("checked",!0),n.checked=!0,t.show(),$(n).trigger("checked:after",!0))}function setEditTableRowVisibility(n,t){var i;i=t?t.find(n+" > .table-edit").not(t.find(".nested-table-row-template "+n+" > .table-edit")):$(n+" > .table-edit");i.find(".table-content > .table-edit-row").each(function(){var t=$(this).find(".nested-tables-visibility").is(":checked"),n=$(this).find(".table-row-row-view");t?n.show():n.hide()})}function initialiseSearchResultTableScripts(n){function t(n){$(document).on("change",n+" .search-result-actions-checkbox",function(){var i=$(this).prop("checked"),t=":checked";i&&(t=":not(:checked)");$(n+" .search-result-selector-checkbox"+t).click();setSearchResultTableMenuVisibility(n)});$(document).on("change",n+" .search-result-selector-checkbox",function(){var r=$(this).closest(".search-result"),u=r.find(".search-result-selected"),t=u.val().split(","),f=$(this).closest(".search-result-row").attr("data-itemuniqueid"),i="",e;if($(this).prop("checked"))t[0]!==""?t.push(f):t[0]=f;else{$(n+" .search-result-actions-checkbox").prop("checked",!1);var o=t.indexOf(f),s=t.slice(0,o),h=t.slice(o+1,t.length);t=s.concat(h)}$.each(t,function(n,r){i+=r;n!==t.length-1&&(i+=",")});u.val(i);e=r.attr("data-selectionResult");e&&$(e).val(i);setSearchResultTableMenuVisibility(n);var r=$(this).closest(".search-result"),u=r.find(".search-result-selected"),c=u.val()==="";$("#search-result-control-actions a.btn:first").attr("disabled",c)});$(document).on("change",n+" .search-result-selector-radio",function(){setSearchResultTableRowViewVisibility(n)})}t(n)}function initialiseTableEditScripts(n){function t(n){function t(){$(this).hasClass("show-nested-table-button")?($(this).removeClass("glyphicon-th-list").removeClass("show-nested-table-button"),$(this).addClass("hide-nested-table-button").addClass("glyphicon-pushpin")):($(this).removeClass("glyphicon-pushpin").removeClass("hide-nested-table-button"),$(this).addClass("glyphicon-th-list").addClass("show-nested-table-button"))}$(n).find(".show-nested-table-button").click(t);$(n).find(".hide-nested-table-button").click(t)}$(document).on("onTableRowAdded",function(n,i){i.innerTableContainer!=null&&t(i.innerTableContainer)});$(document).on("onDocumentModalWindowLoaded",function(n,i){i.innerTableContainer!=null&&t(i.innerTableContainer)});t(n)}function onSearchResultTableMenuClick(n,t,i,r){var u=$(t).attr("href"),f=getSearchResultSelectedUniqueIds(n),e=encodeURIComponent(f.join());setPreventDefault(r);openActionUrlAsModal(i,u+"&uniqueIds="+e,!1)}function onSearchResultTableMenuClick(n,t,i){var e=$(t).attr("href"),r=getSearchResultSelectedUniqueIds(n),o=encodeURIComponent(r.join());setPreventDefault(i);var s=e+"&uniqueIds="+o,u,h=$(t).text(),c=$(n).find(".search-result-table").attr("data-objecttype"),f=checkAccess(h,r,c);f.isPassed?(u=$(t).attr("data-windowtype"),handleUrl(s,u)):showUserNotification("Ошибка при проверке доступности действия для группы объектов",f.notificationMessage)}function showUserNotification(n,t){var i=$("#modalNotification"),r,u;i&&(r=i.find("#notificationWindowText"),r&&r.text(t),u=i.find("#notificationWindowTitle"),u&&u.text(n),i.modal("show"))}function handleUrl(n,t,i,r){$("#btn-ok_from_modal").unbind("click");switch(t){case"NoWindow":TryAjaxHandleUrl(n,function(n){document.location=n});break;case"NoWindowWithBlank":TryAjaxHandleUrl(n,function(n){openUrlInNewTab(n)});break;case"DialogWindowWithResultOnBlank":ModalHelper({dialog:"#actionDialog",url:n,isTargetBlank:!0,afterSubmit:i,control:r}).openWindow();break;case"InfoWindow":ModalHelper({dialog:"#modalInfo",url:n,isTargetBlank:!1,afterSubmit:i,control:r,keepScripts:!0}).openWindow();break;case"DialogWindowDeleteAttachment":case"DialogWindow":default:saveCurrentHash();ModalHelper({dialog:"#actionDialog",url:n,isTargetBlank:!1,afterSubmit:t==="DialogWindowDeleteAttachment"?"deleteAttachment#"+n:i,control:r,keepScripts:!0}).openWindow()}}function openWindowWithReturnUrl(n){var t=encodeURIComponent(document.location.pathname+document.location.search);document.location=n+"?returnUrl="+t}function openWindowWithReturnUrlAdditional(n){var t=encodeURIComponent(document.location.pathname+document.location.search);document.location=n+"&returnUrl="+t}function TryAjaxHandleUrl(n,t){$.ajax({url:n,type:"GET",contentType:!1,cache:!1,processData:!1,beforeSend:function(n){n.setRequestHeader("NeedToReturnJson",!0)}}).done(function(i){if(i){try{var r=JSON.parse(i);if(r){r.status==="ERROR"?showCommonErrors(r.responseMessage):r.status==="OK"&&t(r.responseMessage);return}}catch(u){}t(n)}}).fail(function(n){showCommonErrors(n)})}function checkAccess(n,t,i){var r=!0,u,f=getAbsoluteUrl("GroupActionAccessibility/VerifyAccess"),e={uniqueIds:t,actionName:n,objectType:i};return $.ajax({url:f,type:"POST","async":!1,data:e,success:function(n){r=n.result;u=n.errorMessage},error:function(){r=!1},traditional:!0}),{isPassed:r,notificationMessage:u}}function openUrlInNewTab(n){window.open(n,"_blank")}function onSearchResultTableMenuClickNoWindow(n,t,i){var r=$(t).attr("href"),u=getSearchResultSelectedUniqueIds(n),f=encodeURIComponent(u.join());setPreventDefault(i);document.location=u.length===0?r:r+"&uniqueIds="+f}function onSearchResultTableMenuSelect(n,t,i){var r=t.options[t.selectedIndex].value,u=getSearchResultSelectedUniqueIds(n),f=encodeURIComponent(u.join());setPreventDefault(i);document.location=r+"&uniqueIds="+f}function toggleSearchResultRowEllipsis(n){$(n).find(".search-result-ellipsis-cell").toggleClass("search-result-noellipsis-cell")}function toggleSearchResultCellEllipsis(n){$(n).toggleClass("search-result-noellipsis-cell")}function toggleSearchResultParentRowEllipsis(n,t){$(n).hasClass("search-result-row")?$(n).find(".search-result-ellipsis-cell").toggleClass("search-result-noellipsis-cell"):$(n).closest(".search-result-row").find(".search-result-ellipsis-cell").toggleClass("search-result-noellipsis-cell");stopEvent(t)}function openXmlData(n,t){if($(n).length>0){var i=$(n)[0].attributes.data.value;saveTextAs(i,"download.xml")}stopEvent(t)}function resendToEis(n,t){var u=$(n).parent(),f,i,r;u.empty();f=$('<div style="visibility: visible;" class="loading-image-small"><\/div>');f.appendTo(u);i=window.location;r=i.protocol+"//"+i.host+"/"+i.pathname.split("/")[1];r+="/ContextAction/ReSendToEISHandler?attemptsId="+t;$.ajax({url:r,type:"POST",contentType:!1,cache:!1,processData:!1,timeout:36e5}).then(function(n){var t=JSON.parse(n);t.status=="OK"?alert("Повторная отправка в ЕИС прошло успешно"):alert("Ошибка приповторной отправке в ЕИС "+t.message);window.location.reload()})}function toggleRoutesViewCollapse(n,t){setPreventDefault(t);stopEvent(t);var u=$(n),r=u.closest(".routesView-process-row"),i;if(r.hasClass("routesView-collapsed")){for(i=r.next();i.length&&i.hasClass("routesView-activity-row");)i.removeClass("routesView-collapsed"),i=i.next();r.removeClass("routesView-collapsed")}else{for(i=r.next();i.length&&i.hasClass("routesView-activity-row");)i.addClass("routesView-collapsed"),i=i.next();r.addClass("routesView-collapsed")}}function openActionUrlAsModal(n,t,i,r,u){var f=$(n),e=f.find(".modal-body-wrapper"),o=appendUrlArgument(t,"rand",getTimeStamp());e.load(o+" .context-action-page-body",function(){function v(n){var t=document.getElementById(n);t.style.display=t.style.display==="none"?"block":"none"}var e,o,s,h,c,b;if(!$(this).html()){if(e=$(this).attr("data-empty-body-error-url"),e){document.location=e;return}if(o=$(this).attr("data-empty-body-error-message"),o){s=$("<div class='alert alert-danger'><\/div>");s.text(o);h=$("<div class='modal-body'><\/div>");h.append(s);$(this).append(h);c=function(n){setPreventDefault(n);f.modal("hide")};f.find(".btn-submit").click(c);f.on("hidden.bs.modal",function(){f.find(".btn-submit").unbind("click",c)});f.modal("show");return}}resetDictionaryFields();f.find(".action-page-scripts .action-page-script").each(function(n,t){var i=$(t).attr("data-url");$.getScript(i)});reinitialiseScripts();f.find(".action-page-buttons").hide();var n=f.find(".action-form"),l,k=function(){return l==null&&(l=n.hasClass("parsley-validation")),l},w=function(t){function r(){var t,r;i?(n.attr("target","_blank"),f.find("button[data-dismiss='modal']").click(),n.find("[type='submit']").click()):$('[name="isSignEDS"]').is(":checked")?$('[name="certificateList"]').find("input:checked").val()==undefined?$('[name="signInfo"]').html("<FONT color='red'>Выберите сертификат для создания подписи<\/FONT>"):$("#signAttachments").is(":checked")?EDS.SignDocumentWithAtachments(function(){n.attr("target","_blank");f.find("button[data-dismiss='modal']").click()}):(t=$('[data-name="isSignAllAttachment"]').val(),t?EDS.SignAttachments(function(){n.attr("target","_blank");f.find("button[data-dismiss='modal']").click()}):(r=$('[name="isAttachEDS"]').is(":checked"),r?EDS.SignCreate(function(){n.attr("target","_blank");f.find("button[data-dismiss='modal']").click()}):EDS.SignCreate(function(){var t=$("[data-name='activitySignature']").val();t!==undefined?n.find("[type='submit']").click():(n.attr("target","_blank"),f.find("button[data-dismiss='modal']").click())}))):n.find("[type='submit']").click()}if(setPreventDefault(t),k()){var u=n.parsley();return u.whenValidate().done(r),!1}r()};f.find(".btn-submit").prop("disabled",!1);f.find(".btn-submit").click(w);f.on("hidden.bs.modal",function(){f.find(".btn-submit").unbind("click",w);f.find(".modal-dialog").removeClass("modal-large");f.find(".modal-dialog").removeClass("modal-medium")});var a=f.find(".modal-footer .loading-image"),d=function(){n.find("[type='submit']").prop("disabled",!0);f.find(".btn-submit").prop("disabled",!0);a.each(function(){showLoadingIndicator($(this).get(0))})},g=function(){n.find("[type='submit']").prop("disabled",!1);f.find(".btn-submit").prop("disabled",!1);a.each(function(){hideLoadingIndicator($(this).get(0))})};var nt=function(){v("div-context-submit");v("div-context-modal");v("send-to-eis-question");a.each(function(){hideLoadingIndicator($(this).get(0))})},y,t=n.get(0),p=function(){$(t).bind("submit",y)},tt=function(){$(t).unbind("submit",y)};y=function(n){u||(setPreventDefault(n),d(),tt(),typeof r!="undefined"&&r(),ajaxFormSubmit(t,function(n){var i,r;n?(i=f.find(".success-message"),i.text(n),i.removeClass("hide"),p(),nt()):(r=$(t).find("input[name='returnUrl']").val(),r?window.location=r:window.location.reload())},function(n){var t=f.find(".error-message");t.text(n.responseText);t.removeClass("hide");p();g()}))};i||p();b={validatedFormSelector:".action-form",innerTableContainer:f};$(document).trigger("onDocumentModalWindowLoaded",b);f.modal("show")})}function handleLinkActionAndDisable(n,t,i){function u(){$(n).attr("style","display:none")}$("#btn-ok_from_modal").unbind("click");var r=$(n),f=r.attr("href"),e=r.attr("target")=="_blank";setPreventDefault(i);ModalHelper({dialog:t,url:f,isTargetBlank:e,beforeSubmit:u,useDefaultSubmit:undefined}).openWindow()}function handleDynamicLinkAction(n,t,i,r,u){r&&r(n,t,i,u)}function handleLinkAction(n,t,i,r,u,f){$("#btn-ok_from_modal").unbind("click");console.log("handleLinkAction1");var e=$(n),o=e.attr("href"),s=e.attr("target")=="_blank",h=e.attr("data-useDefaultSubmit")=="true",c=e.attr("dontSubmit")=="true",l=function(n,t){return saveCurrentHash(),r?r(n,t):void 0};setPreventDefault(i);ModalHelper({dialog:t,url:o,isTargetBlank:s,beforeSubmit:l,afterSubmit:u,control:n,event:i,useDefaultSubmit:h,dontSubmit:c,keepScripts:f}).openWindow()}function saveCurrentHash(){var n=decodeURIComponent(window.location.pathname),t=window.location.hash;updateSessionStorage(n,t)}function getSavedHash(){var n=decodeURIComponent(window.location.pathname);return getFromSessionStorage(n)}function removeSavedHash(){var n=decodeURIComponent(window.location.pathname);return removeFromSessionStorage(n)}function removeFromSessionStorage(n){if(sessionStorage&&n)return sessionStorage.removeItem(n)}function updateSessionStorage(n,t){sessionStorage&&sessionStorage.setItem(n,t)}function getFromSessionStorage(n){if(sessionStorage&&n)return sessionStorage.getItem(n)}function readCookie(n){var r=n+"=",u=document.cookie.split(";"),i=0,t="";for(i;i<u.length;i+=1){for(t=u[i];t.charAt(0)===" ";)t=t.substring(1,t.length);if(t.indexOf(r)===0)return t.substring(r.length,t.length)}return null}function createCookie(n,t,i){var r,u;i?(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toGMTString()):u="";document.cookie=n+"="+t+u+"; path=/"}function createCookieMinutes(n,t,i){var r,u;i?(r=new Date,r.setTime(r.getTime()+i*6e4),u="; expires="+r.toGMTString()):u="";document.cookie=n+"="+t+u+"; path=/"}function deleteCookie(n){var t=new Date,i;t.setTime(t.getTime()+-864e5);i="; expires="+t.toGMTString();document.cookie=n+'="" ;'+i+"; path=/"}function checkCreatePlanPossible(n,t){return checkOpenFormPossible(n,t)}function checkOpenFormPossible(n,t){var i=jQuery.Deferred(),r=$(t),u=r.attr("action");return $.ajax({url:u,"async":!0,data:r.serialize(),contentType:!1,cache:!1,processData:!1}).done(function(n){var r,t;try{t=JSON.parse(n);t&&t.status==="ERROR"&&(r=t.responseMessage)}catch(u){}i.resolve(r)}),i}function appendActiveTabAnchorToLink(n,t,i){var r=$("#viewNavigationTabs").find("li.active").find("a").data("block-id");r?(i.preventDefault(),window.location.href=$(n).attr("href")+t+r):window.location.href=$(n).attr("href")}function refreshSearchResult(n){if($("#"+n).data("dxDataGrid"))dxGridReloadData(n);else{var t=$(".current.navigation-item").data("url");t&&searchResultLoad(n,t)}}function searchResultSort(n,t){var i,r;setPreventDefault(t);i=$(n).parent("div").find(".sortUrl").val();n.dataset.sorttype==="AZ"&&$(n).hasClass("search-result-header-asc")||(r=i.indexOf("?")>-1?"&":"?",i=i+r+"sortKey="+encodeURIComponent(n.dataset.fieldkey)+"&sort="+n.dataset.sorttype);searchResultLoad(n,i)}function searchResultNavigate(n,t){setPreventDefault(t);var i=$(n).attr("href");searchResultLoad(n,i)}function searchResultLoad(n,t){var i,r,e;if((t=t+"&r="+Math.random()*99999,i=$(n).closest(".search-result-navigation"),!i.hasClass("loading"))&&(r=$(n).closest(".search-result"),r.length>0)){i.addClass("loading");waitingDialog.show("Поиск");var u=$(n).closest(".search-result").find(".search-result-selected").val(),o=u?u.split(","):[],f=$("#hfSearchFormData").val()?JSON.parse($("#hfSearchFormData").val()):null;f&&(e=getQueryStringParameterByName("page",t),e&&f.push({name:"page",value:e}));r.load(t+" .search-result",f,function(){var t=r.find(".search-result-selected"),n;t.val(u);n=$(".search-result-table > div.search-result-row");$.each(n,function(n,t){var i=$(t).find(".search-result-selector-checkbox"),r=$(t).attr("data-itemuniqueid");o.indexOf(r)!==-1&&i.attr("checked",!0)});waitingDialog.hide();i.removeClass("loading");reinitialiseScripts()})}}function getSelectedSearchResultIds(n){var t=$(n).find(".search-result-selected");return t.val().split(",")}function editButtonCustomLogicPreprocessorFunction(n,t,i,r){var u=function(){$.post(r.TryToForceUnLockUrl,{documentKey:r.DocumentKey},function(u){u&&u.success&&editButtonCustomLogicPreprocessorFunction(n,t,i,r)})};(i.preventDefault(),ct.common.delayPassed(n,6))&&$.post(r.TryToLockUrl,{documentKey:r.DocumentKey},function(f){f&&f.success?appendActiveTabAnchorToLink(n,"#regcard-",i):r.CanOverrideEditLock?ModalHelper({dialog:t,url:r.FailToLockWithOverrideUrl,isTargetBlank:!1,beforeSubmit:u,control:n,event:i,useDefaultSubmit:!1,dontSubmit:!0}).openWindow():ModalHelper({dialog:"#modalInfo",url:r.FailToLockUrl,isTargetBlank:!1,beforeSubmit:null,control:n,event:i,useDefaultSubmit:!1,dontSubmit:!0}).openWindow()})}function bootstrapForceCollapse(n){var i=$(n),r=i.find(".panel-heading a[data-toggle=collapse]"),t=i.find(".panel-collapse");r.length&&r.addClass("collapsed");t.length&&(t.removeClass("in"),t.css("height","0px"))}function setMobileDefaults(){var t=$(window).width(),n;t<=767&&(bootstrapForceCollapse("#documentView-controlCard-accordion"),bootstrapForceCollapse("#documentView-documentLinks-accordion"),bootstrapForceCollapse("#documentView-attachments-accordion"),n=getUrlAnchor(),n.indexOf("activity-")!=0&&bootstrapForceCollapse("#documentView-routes-accordion"),bootstrapForceCollapse("#registerView-controlCard-accordion"),bootstrapForceCollapse("#registerView-documentLinks-accordion"),bootstrapForceCollapse("#registerView-attachments-accordion"))}function reinitialiseMobileSettings(){var n=$(window).width();n<=991&&$('input[type="file"][multiple]').prop("multiple",!1)}function setReadOnlyWithCheckbox(){$("input[type='checkbox'][readonly]").readonly();$("select.bool-sel-ctl[readonly]").readonly();$("select.bool-sel-ctl[readonly]").addClass("readonly-field")}function onSelectBoolChange(){var n=$(this),t=n.is(":checked");t?n.next().val("1"):n.next().val("0")}function onSelectTableChange(){var n=$(this),t=n.is(":checked");t?n.closest(".table-content").find(".selector-all-row").prop("checked",!0):n.closest(".table-content").find(".selector-all-row").prop("checked",!1)}function setEnabledWithRadios(){$(".enabled-with-radio").each(function(){var n=$(this),u=n.attr("data-radio"),f=$("#"+u),t=!f.is(":checked"),i,r;n.prop("disabled",t);i=n.attr("data-required");r=i&&(i.toLowerCase()=="true"||i.toLowerCase()=="required");r&&n.prop("required",!t);$(this).find("input, select, textarea").each(function(){var n=$(this);n.prop("disabled",t);r&&n.prop("required",!t)})})}function setEnabledWithSelect(){$(".enabled-with-select").each(function(){for(var i,u,n=$(this),e=n.attr("data-select"),f=n.attr("data-select-value").split(","),o=$("#"+e),s=o.val(),t=!0,r=0;r<f.length;r++)if($.trim(f[r])==s){t=!1;break}n.prop("disabled",t);i=n.attr("data-required");u=i&&(i.toLowerCase()=="true"||i.toLowerCase()=="required");u&&n.prop("required",!t);$(this).find("input, select, textarea").each(function(){var n=$(this);n.prop("disabled",t);u&&n.prop("required",!t)})})}function setVisibleWithSelect(){function t(t){for(var u=t.attr("data-select"),r=t.attr("data-select-value").split(","),f=$("#"+u),e=f.val(),i=0;i<r.length;i++){if($.trim(r[i])==e){n=!1;break}n=!0}}var n=!0;$(".visible-with-select").each(function(){var i=$(this),r;i.attr("data-select-value")?t(i):(r=i.find("[data-select-value]").first(),t(r));n?i.addClass("js-hidden"):i.removeClass("js-hidden")})}function setRequiredWithRadios(){$(".required-with-radio").each(function(){var n=$(this),i=n.attr("data-radio-selector"),t=!1;$(i).each(function(){$(this).is(":checked")&&(t=!0)});n.prop("required",t);n.removeClass("user-error");$(this).find("input, select, textarea").each(function(){var n=$(this);n.prop("required",t);n.removeClass("user-error")})})}function cloneJObject(n){var t=n.clone(!1),i=n.find("input, select, textarea"),r=t.find("input, select, textarea");return r.each(function(n){var t=$(i.get(n)),r=t.attr("type");(t.get(0).tagName!="INPUT"||r!="file")&&$(this).val(t.val())}),t}function activateMultipleEditors(){$(".multiple-editor:not(.inited)").each(function(){var n=$(this),r=$('<div class="multiple-editor-append btn btn-default btn-sm glyphicon glyphicon-plus"><\/div>'),i,t;r.insertAfter(n);i=r.parent();i.hasClass("clearfix")||i.addClass("clearfix");t=n.find("input, select, textarea");t.attr("data-required",t.prop("required"));n.toggleClass("empty",!t.val());n.addClass("inited")})}function multipleEditorAppend(){var o=$(this),s=o.prev(),n=s.find("input, select, textarea"),r=$.trim(n.val()),e,t,i,u,f,h;r&&((e=[],t=null,t=s.nextAll(".multiple-editor-list"),t.length===0&&(t=$("<ul class='multiple-editor-list'><\/ul>").insertAfter(o)),t.children().each(function(){$(this).children('input[type="hidden"]').each(function(){e.push($(this).val())})}),e.indexOf(r)>=0)||(i=$("<li><\/li>"),u=$("<input type='hidden'>"),u.attr("name",n.attr("name")),u.val(r),u.appendTo(i),f=$("<span><\/span>"),n.get(0).tagName=="SELECT"?f.text(n.children(":selected").text()):f.text(r),f.appendTo(i),h=$('<div class="multiple-editor-remove glyphicon glyphicon-remove-circle"><\/div>'),h.appendTo(i),i.appendTo(t),n.prop("required",!1),n.closest(".multiple-editor").toggleClass("empty",!1),n.val("")))}function multipleEditorRemove(){var n=$(this),u=n.closest(".multiple-editor-list li"),f=n.closest(".multiple-editor-list"),t=f.parent(),i,r;u.remove();i=t.find(".mult-dict-display");r=t.find('input[data-name="name"]').map(function(){return $(this).val()}).get().join(", ");i.val(r)}function activateCollapseButtons(){$(".collapse-button").each(function(){var n=$(this);if(!n.hasClass("collapse-button-inited")){n.hasClass("glyphicon")||n.addClass("glyphicon");n.on("click",function(t){setPreventDefault(t);stopEvent(t);n.toggleClass("collapse-button-collapsed");setCollapseButton(this)});setCollapseButton(this);n.addClass("collapse-button-inited")}})}function onFileEditorAppendFiles(n,t){var i=$(n),g=i.attr("data-maxFileSize"),o=i.attr("data-errorSelector"),rt=i.attr("data-errorMessage"),r,a,s,v,y,f,h,c,e,b,l,d;if(window.FileReader){for($(o).hasClass("hide")||$(o).addClass("hide"),r=[],a=!1,s=0;s<t.length;s++)v=t[s],g>0&&v.size>g?a=!0:r.push(v);if(y=function(){a&&($(o).html(rt),$(o).removeClass("hide"))},!r.length){i.val("");y();return}if(isAjaxFileStorageSupported()){var u=i.closest("form").get(0),p=i.attr("data-name"),w=i.parent().find(".file-drop-area-list"),nt=window.location.pathname.toLowerCase().indexOf("/BasedOn".toLowerCase())!==-1,tt=nt&&!$("#"+p).is(":visible")||!nt&&window.addTableRowAttachmentWasClicked;for(f=0;f<r.length;f++){if(tt&&f>0)break;if(!i.prop("multiple"))for(h=[],w.find(".file-drop-area-remove-icon").each(function(){h.push($(this).attr("data-ajaxFileKey"))}),w.empty(),c=0;c<h.length;c++)removeAjaxFile(u,h[c]);if(e=r[f],typeof UploadAttachment!="undefined"&&$(".modal-title:visible:contains('Создать версию')").length==0)b=appendAjaxFile(u,p,e),tt&&typeof window.files!="undefined"&&(window.files=t[0].name),UploadAttachment.addFile(i,b,e.name);else{var b=appendAjaxFile(u,p,e),k=$("<li><\/li>"),it=$("<span class='file-drop-area-file-name'><\/span>");it.text(e.name);k.append(it);l=$('<div class="glyphicon glyphicon-remove-circle file-drop-area-remove-icon"><\/div>');l.attr("data-ajaxFileKey",b);l.click(function(n){var f,t,r,u;setPreventDefault(n);stopEvent(n);f=$(this).attr("data-ajaxFileKey");t=i.closest("form").get(0);removeAjaxFile(t,f);$(this).closest("li").remove();r=$(t).find("input[type='file']");u=!getAjaxFiles(t).length;r.prop("required",r.attr("data-required").toLowerCase()=="true"&&u);r.closest(".file-drop-area").toggleClass("empty",u)});k.append(l);w.append(k)}}$(u).trigger("onAppendAjaxFiles");d=!getAjaxFiles(u).length;i.prop("required",i.attr("data-required").toLowerCase()=="true"&&d);i.closest(".file-drop-area").toggleClass("empty",d);i.val("");y()}}}function onFileEditorChange(n){onFileEditorAppendFiles(this,n.target.files)}function onFileDropAreaDrop(n,t){setPreventDefault(t);stopEvent(t);var i=$(n).find("input[type='file']").get(0);onFileEditorAppendFiles(i,t.dataTransfer.files)}function activateAjaxFileEditors(){if(isAjaxFileStorageSupported()){$("body").off("change",'input[type="file"]');$("body").on("change",'input[type="file"]',onFileEditorChange);var n=function(){var n=$(this).closest(".file-drop-area"),t=n.find("input[type='file']");t.click()};$(".file-drop-area:not(.inited)").each(function(){var i=$(this),t,u,r;i.closest(".table-row-template").length>0||(t=i.find("input[type='file']"),u=t.attr("id"),t.attr("id",""),i.attr("id",u),t.attr("data-name",t.attr("name")),t.attr("name","file-drop-area-hidden-"+t.attr("name")),t.attr("data-required",t.prop("required")),t.click(stopEvent),i.find(".file-drop-area-title").click(n),window.FileReader&&(r=i.get(0),r.ondragover=function(){return $(this).toggleClass("hover",!0),!1},r.ondragleave=function(){return $(this).toggleClass("hover",!1),!1},r.ondrop=function(n){$(this).toggleClass("hover",!1);onFileDropAreaDrop(this,n)}),i.toggleClass("empty",!0),i.addClass("inited"))})}}function activateDataListIcons(){$("[list], [data-wslist]").each(function(){var i=$(this),n=i.parent(),t;n.hasClass("ui-wrapper")||(i.wrap("<div><\/div>"),n=i.parent(),n.addClass("ui-wrapper"),t=$("<div><\/div>"),t.addClass("ui-tool-button"),t.addClass("ui-tool-dropdown"),t.prependTo(n))})}function setCollapseButton(n){var t=$(n),i=t.attr("data-collapse-selector");t.hasClass("collapse-button-collapsed")?(t.addClass("glyphicon-plus"),t.removeClass("glyphicon-minus"),$(i).addClass("js-hidden")):(t.removeClass("glyphicon-plus"),t.addClass("glyphicon-minus"),$(i).removeClass("js-hidden"))}function resetDictionaryFields(){var n=$(".form-dictionary-control");n.each(function(){var n=$(this);n.attr("data-dictionaryparent")==""&&setDictionaryField(n)})}function setDictionaryField(n){var r,e=$(".form-dictionary-control[data-dictionaryparent='"+n.attr("name")+"']"),o,t,i,f,u;if(e.length>0&&(n.is("select")?r=n.find(":selected")[0]:n.is("input")&&(o=$("datalist[id='"+n.attr("list")+"']"),r=o.find("option[value='"+n.val()+"']")[0]),e.each(function(){var n=$(this),t;n.is("select")?(t=$(r).attr("data-entryid"),n.find("option").each(function(){var n=$(this),i=n.attr("data-entryparent");i==null||i==!1?n.toggleOption(!0):i==t?n.toggleOption(!0):n.toggleOption(!1)})):n.is("input")&&(n.removeAttr("list"),n.attr("list",$(r).attr("data-entryid")));n.change()}),reinitialiseScripts()),n.parents(".modal").length>0&&(t=n.val(),i=n.attr("list"),i&&(f=$("#"+i),u=!1,$.each(f.children(),function(n,i){return u=t===$(i).val(),u?!1:void 0}),!u))){var s=Math.floor(Math.random()*9999999+1e6),h=i+"-"+s,c="<option data-entrykey='"+t+"' data-entryid='"+h+"' data-entryparent='"+i+"' value='"+t+"'>"+t+"<\/option>",l=$(c);f.append(l)}}function onFormDictionaryControlChange(){var n=$(this),t,i,u,r,f;(setDictionaryField(n),t=n.attr("data-dictionaryGroup"),t)&&(n.hasClass("form-dictionary-control-changing")||(n.addClass("form-dictionary-control-changing"),n.is("select")?i=n.children('option[value="'+n.val()+'"]'):(u=n.attr("list"),i=$("#"+u).find('option[value="'+n.val()+'"]')),r=i.attr("data-entryKey"),f=$('.form-dictionary-control[data-dictionaryGroup="'+t+'"]'),f.each(function(){var n=$(this),t,i,u;n.hasClass("form-dictionary-control-changing")||(n.is("select")?t=n.children('option[data-entryKey="'+r+'"]'):(i=n.attr("list"),t=$("#"+i).find('option[data-entryKey="'+r+'"]')),u=t.attr("value"),n.val(u))}),n.removeClass("form-dictionary-control-changing")))}function wrapUrls(){var n=/((http(s)?:\/\/)(www\.)?([-a-zA-Z0-9@:%._\+~#=]{2,256}(\.[a-z]{2,6})?)\b([-a-zA-Z0-9@:%_\+.~#?&//=]*))/g,t=/((<a href.+)(http(s)?:\/\/)(www\.)?([-a-zA-Z0-9@:%._\+~#=]{2,256}(\.[a-z]{2,6})?)\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)<\/a>)/g;$(".documentView").find(".documentView-field-value, .search-result-cell-value").html(function(i,r){return t.test(r)?r:r.replace(n,'<a href="$1" title="$1" target="_blank">$1<\/a>')})}function updateDatepickers(){var n=function(){if($.fn.datetimepicker){function t(n){var t=n;return t&&t.css("position")==="static"&&(t=t.parents().filter(function(){return $(this).css("position")!=="static"}).first()),t.length!==0}function n(n){var i=n.closest(".table-edit-wrapper, .modal-content-wrapper");return i&&t(i)?i:null}$("div.input-group.date[data-type='date']").each(function(){$(this).datetimepicker({format:"DD.MM.YYYY",locale:"ru",widgetPositioning:{horizontal:"right"},disabledTimeIntervals:[[moment({h:0,m:0,s:1}),moment({h:23,m:59,s:59})]],widgetParent:n($(this))})});$("div.input-group.date[data-type='datetime']").each(function(){$(this).datetimepicker({format:"DD.MM.YYYY HH:mm:ss",locale:"ru",widgetPositioning:{horizontal:"right"},widgetParent:n($(this))})});$("div.input-group.date[data-type='nosecdatetime']").each(function(){$(this).datetimepicker({format:"DD.MM.YYYY HH:mm",locale:"ru",widgetPositioning:{horizontal:"right"},widgetParent:n($(this))})});$("div.input-group.date[data-type='time']").each(function(){$(this).datetimepicker({format:"hh:mm:ss",locale:"ru",widgetPositioning:{horizontal:"right"},widgetParent:n($(this))})});$("div.input-group.year[data-type='year']").each(function(){$(this).datetimepicker({format:"YYYY",locale:"ru",widgetPositioning:{horizontal:"right"},widgetParent:n($(this))})})}try{typeof ChronoGroups!="undefined"&&ChronoGroups.Init()}catch(i){console.log(i)}};$(document).on("shown.bs.modal",function(){n()});$(document).on("onTableRowAdded",function(){n()});$(document).on("onDocumentAjaxLoaded",function(){n()});$(document).on("change","input[type='checkbox'][hidden-ctl='true']",onSelectBoolChange);$(document).on("change","input[type='checkbox'].selector-all-rows",onSelectTableChange);$(document).on("change","select",function(){$(this).hasClass("bool-sel-ctl")&&($(this).val()=="1"?$(this).prev().prop("checked",!0):$(this).prev().prop("checked",!1));$(!0)&&n()});n()}function startReplaceScripts(){$("[data-replace-url]").each(function(){var n=$(this),t=n.attr("data-replace-url");n.removeAttr("data-replace-url");dynamicLoading.push(n.get(0),t)});$("[data-badge-url]").each(function(){var n=$(this),t=n.attr("data-badge-url");n.removeAttr("data-badge-url");t=dynamicLoading.getUniqueSelector(t);setTimeout(function(){delayedLoadBadgeCount(t,n)},1e3)})}function delayedLoadBadgeCount(n,t){if($(".dx-loadpanel.dx-state-invisible").length==0&&$(".dx-loadpanel").length==1){setTimeout(function(){delayedLoadBadgeCount(n,t)},1e3);return}$.get(n,function(n){if(n&&n>0){var i=$("<span class='badge'><\/span>");i.html(n);t.after(i);t.after("<span> <\/span>");t.remove()}else t.remove()})}function reinitialiseScripts(){function n(){reinitialiseMobileSettings();setReadOnlyWithCheckbox();setEnabledWithRadios();setRequiredWithRadios();setEnabledWithSelect();setVisibleWithSelect();setSearchResultTableMenuVisibility(".search-result");setSearchResultTableRowViewVisibility(".search-result");setEditTableRowVisibility(".table-edit-wrapper");activateMultipleEditors();activateCollapseButtons();activateAjaxFileEditors();activateDataListIcons();ct.common.dictionary.fillDisplayFields();startReplaceScripts();wrapUrls();disableTemplateRowValidation();$.fn.modal.Constructor.prototype.enforceFocus=function(){var n=this;$(document).on("focusin.modal",function(t){!n.$element.has(t.target).length})};initAutonumeric();$(document).updatePolyfill()}$(document).on("onDocumentAjaxLoaded",function(){n()});n()}function reinitialiseScriptShort(){reinitialiseMobileSettings();setEnabledWithRadios();setRequiredWithRadios();setReadOnlyWithCheckbox();setEnabledWithSelect();setVisibleWithSelect();setSearchResultTableMenuVisibility(".search-result");setSearchResultTableRowViewVisibility(".search-result");setEditTableRowVisibility(".table-edit-wrapper");activateMultipleEditors();activateCollapseButtons();activateAjaxFileEditors();activateDataListIcons();ct.common.dictionary.fillDisplayFields();startReplaceScripts();disableTemplateRowValidation();enableToolTips();$.fn.modal.Constructor.prototype.enforceFocus=function(){var n=this;$(document).on("focusin.modal",function(t){!n.$element.has(t.target).length})};initAutonumeric();$(document).updatePolyfill()}function initAutonumeric(){$(".form-control.money:not([data-edit-required])").autoNumeric("init",{aSep:" ",aDec:".",vMin:"0.00",vMax:"99999999999999999999999999999999999999999.99",wEmpty:"",mRound:"B",mDec:window.moneyPrecision});$(".form-control[data-number-type='integer']:not([data-edit-required])").autoNumeric("init",{aSep:"",aDec:".",vMin:"0",vMax:"99999999999999999999999999999999999999999",wEmpty:"zero",lZero:"keep",mRound:"B"});$(".form-control[data-number-type='double']:not([data-edit-required])").each(function(n,t){var i=$(t);i.autoNumeric("init",{aSep:"",aDec:".",vMin:"0.00",vMax:"99999999999999999999999999999999999999999.99",mDec:i.attr("data-accuracy")?i.attr("data-accuracy"):"2",wEmpty:"",mRound:"B"})})}function addParsleyValidation(n){function t(n){var t=$(n).first(),i=t.parsley({inputs:"[required]",excluded:"input[type=button], input[type=submit], input[type=reset], input[type=hidden], [disabled], [data-parsley-disabled], [data-parsley-disabled] *",triggerAfterFailure:"input change",validationThreshold:3,focus:"none",uiEnabled:!0,errorsWrapper:'<ul class="parsley-errors-list help-block tooltip-text"><\/ul>'}).on("form:error",function(){var n=this;openTabAndFocusField(getFirstErrorField(n))}).on("field:validated",function(){var n=this;displayError(n)}).on("form:validated",function(){var n=this;highlightTabsWithErrorFields(n)});addRequiredForLabels(i.fields);turnOffBrowserValidation(n)}t(n);$(document).on("onDocumentAjaxLoaded",function(n,i){i&&i.validatedFormSelector&&t(i.validatedFormSelector)})}function checkDateField(){$('[data-type="date"]').attr("data-parsley-date","")}function turnOffBrowserValidation(n){var t=$(n).first();t.hasClass("parsley-validation")||(t.addClass("parsley-validation"),t.attr("novalidate","novalidate"))}function addRequiredForLabels(n){n!=undefined&&$.each(n,function(n,t){if(t.constraintsByName.required!=null){var i=getLabelContainer(t.$element);i.addClass("label-required")}})}function displayError(n){var i=n.$element.closest(".documentView-field-value"),r=getLabelContainer(n.$element),t,u;n.$element.is("input[type='file']")&&(t=n.$element.parent(),u=t.find(".file-drop-area-title"),n.isValid()?t.removeClass("has-error"):t.addClass("has-error"));n.isValid()?(i.removeClass("has-error"),r.removeClass("has-error")):(i.addClass("has-error"),r.addClass("has-error"))}function getLabelContainer(n){return $("#rel-"+n.attr("data-field-name")).first()}function getFirstErrorField(n){for(var i=null,t=0;t<n.fields.length;t++)if(n.fields[t].isValid()!==!0){i=n.fields[t].$element;break}return i}function openTabAndFocusField(n){if(n!=null){var t=n.closest(".tab-pane"),i=t.attr("id");$("a[href*="+i+"]").first().tab("show");setTimeout(function(){n.focus()},100)}}function highlightTabsWithErrorFields(n){n.$element.find(".tab-pane").each(function(n,t){var u=t.id,r=$(t),i=$("a[href*="+u+"]");r.find(".parsley-error").length>0&&!i.hasClass("tab-has-error")?i.addClass("tab-has-error"):!r.has(".parsley-error").length>0&&i.hasClass("tab-has-error")&&i.removeClass("tab-has-error")})}function addRegEditValidations(){scopes.onRegister(function(){addParsleyValidation(".register-form")});scopes.onEdit(function(){addParsleyValidation("form.edit-form")});addViewDecodeHtml()}function addViewDecodeHtml(){scopes.onView(function(){var n=$(".documentView-field-value");$.each(n,function(n,t){var i=$(t);i.find("input").length===0&&t.className.indexOf("field-type-url")===-1&&i.text(ct.common.decodeHTML(i.text()))})})}function fillDictDisplayValues(){$(".dict-modal-control").each(function(n,t){fillDipslayValueForDict($(t))})}function fillDipslayValueForDict(n){var u=n.attr("data-edit-name"),e=n.closest(".table-edit").length>0,f=e?".table-edit-row":".column-container",t=n.closest(f).find(".display-field-part[dictionary-edit-name="+u+"]"),i,r;t.length==0&&(t=n.closest(f).parent().find(".display-field-part[dictionary-edit-name="+u+"]"));i=t.map(function(){return this.value}).get().filter(function(n){return n==null||$.trim(n).length===0?!1:!0}).join(", ");r=n.find(".dict-display-field");r.val()!==i&&r.val(i).change()}function fillDisplayVlaueForMultipleDict(n){var r=n.find("ul.multiple-editor-list li"),t=[],i;r.each(function(n,i){var r=$(i).find("input.display-field-part").map(function(){return this.value}).get().filter(function(n){return!(n==null||$.trim(n).length===0)}),u=r.length>1?"("+r.join(",")+")":r[0];t.push(u)});i=t.filter(function(n){return n!=null&&$.trim(n).length!==0}).join(", ");n.find(".mult-dict-display").val(i).change()}function removeFromMultipleDict(n){var f=$(n).closest(".dict-modal-control"),i=$(n).siblings("input").first().attr("name").split("-"),e=parseInt(i[i.length-1]),r=i[0]+"_deleted",t,u;$("[name='"+r+"']").length>0?t=$("[name='"+r+"']"):(u=$("<div data-name='deletedTableElements'><\/div>"),t=$("<input type='hidden' name='"+r+"' value='' />"),u.append(t),$(n).closest("ul").parent().append(u));t.val(t.val()+e+",");$(n).closest("li").remove();fillDisplayVlaueForMultipleDict(f)}function verticalTabs(){var n=function(n,t){var r=n.find("a:first"),i;(r.click(),t!==!1)&&(t===undefined||t===!0)&&(i=r.attr("data-target"),i&&(window.location.hash=i))},t=function(){var i=$("#registerView .nav-tabs, #documentView .nav-tabs, #editView .nav-tabs"),t,r;if(i.length!=0){$(i).on("click","a[data-toggle]",function(){var t=$(this).attr("href"),n;t&&(n=t.split("#")[1],n)&&(location.hash=n)});if(t=location.hash,t||(t=getSavedHash(),t&&removeSavedHash()),!t){n(i);return}r=i.find("a[data-target='"+t+"']");r.length>0?r.click():n(i)}};t()}function toTopButton(){var n=$("#back-to-top");$(window).scroll(function(){$(this).scrollTop()>50?n.fadeIn():n.fadeOut()});n.click(function(){return n.tooltip("hide"),$("body,html").animate({scrollTop:0},800),!1});n.tooltip("show")}function bindDictionaryButtons(){$(document).on("click","button.show-dict-btn",function(n){n.preventDefault();HierarDictionary(n.target)})}function bindDictionaryDisplayField(){$(document).on("change",".display-field-part",function(n){var t=$(n.target),r=t.attr("dictionary-edit-name"),f=t.closest(".table-edit").length>0,u=f?".table-edit-row":".column-container",i=t.closest(u).find(".dict-modal-control[data-edit-name="+r+"]");i.length==0&&(i=t.closest(u).parent().find(".dict-modal-control[data-edit-name="+r+"]"));fillDipslayValueForDict(i)});$(document).on("change",".dict-display-field",function(n){var t=$(n.target),r=t.closest(".table-edit").length>0,u=r?".form-group":".column-container",f=t.closest(u),i=f.find(".display-field-part");i.legth===0&&i.val(t.val())})}function enableToolTips(){$("body").tooltip({selector:'[data-toggle="tooltip"]',container:"body"})}function initReportSections(){$(".report-element").on("show.bs.collapse",function(){$(this).prev(".report-section").addClass("active")});$(".report-element").on("hide.bs.collapse",function(){$(this).prev(".report-section").removeClass("active")})}function filterDictionaryItems(n,t,i,r){if(!n){console.warn("не задано имя массива. FilterDictionaryItems");return}if(!t||!Array.isArray(t)){console.warn("не задан массив разрешенных значений. FilterDictionaryItems");return}typeof i=="undefined"&&(i=!1);var u=n+"_allowed_items",e={codes:t,isShow:i,columnName:r},f=$("#"+u);f.length===0&&(f=$("<input>").attr({type:"hidden",id:u,name:u,disabled:!0}).appendTo($(document.body)));f.val(JSON.stringify(e))}function showCommonErrors(n,t){ct.common.showCommonErrors(n,t)}function showNotification(n,t){var i=$("#notificationDialog"),r=i.find(".modal-body"),u,f,e;i.modal("show");n&&i.find(".modal-title").text(n);t instanceof jQuery?r.append(t):(Array.isArray(t)||(t=[t]),t.length===1?(u=$("<p class='form-control-static'><\/p>"),u.text(t[0]),r.append(u)):(f=[],$.each(t,function(n,t){f.push('<li><p class="form-control-static">'+t+"<\/p><\/li>")}),e=$("<ul>"),e.html(f),r.empty().append(e)))}function showConfirmEx(n,t,i,r,u){var a=this,o=$.Deferred(),e=$("#notificationDialog"),s=$(u).closest(".dx-overlay-wrapper"),h,f,l,c;return setContainerStyles(s),e?(h=e.find(".modal-body"),f=e.find(".modal-footer"),f&&(l=r!=""?$("<button type='button' class='btn btn-primary' data-dismiss='modal' id='btnYes'>"+i+"<\/button><button type='button' class='btn btn-default' data-dismiss='modal' id='btnNo'>"+r+"<\/button>"):$("<button type='button' class='btn btn-primary' data-dismiss='modal' id='btnYes'>"+i+"<\/button>"),f.empty(),f.append(l)),e.modal("show"),f.find("#btnYes").click(function(){resetContainerStyles(s);o.resolve()}),r!=""&&f.find("#btnNo").click(function(){resetContainerStyles(s);o.reject()}),n&&e.find(".modal-title").text(n).addClass("dialog-modal-title"),h&&(h.empty(),c=$("<p class='form-control-static dialog-text'><\/p>"),c.text(t),h.append(c))):(resetContainerStyles(s),o.fail("Элемент с id = notificationDialog не найден!")),o.promise()}function setContainerStyles(n){n&&n.length?n.removeStyle("z-index").removeClass("dialog-modal-reset").addClass("dialog-modal-backdrop"):console.log("Container (set) not found!")}function resetContainerStyles(n){n&&n.length?n.removeClass("dialog-modal-backdrop").addClass("dialog-modal-reset"):console.log("Container (reset) not found!")}function showAlertEx(n,t,i){var c=this,r=$("#notificationDialog"),f=$(document).find(".dx-overlay-wrapper"),e,u,s,o,h;setContainerStyles(f);r?(e=r.find(".modal-body"),u=r.find(".modal-footer"),u&&(s=$("<button type='button' class='btn btn-primary' data-dismiss='modal' id='btnOk'>"+i+"<\/button>"),u.empty(),u.append(s)),r.modal("show"),u.find("#btnOk").click(function(){resetContainerStyles(f);r.modal("hide");clearTimeout(h)}),n&&r.find(".modal-title").text(n).addClass("dialog-modal-title"),e&&(e.empty(),o=$("<p class='form-control-static dialog-text'><\/p>"),o.text(t),e.append(o)),h=setTimeout(function(){resetContainerStyles(f);r.modal("hide")},3e3)):resetContainerStyles(f);return}function getBaseUrl(){var n=$("base").attr("href");return n?n.substr(n.length-1)==="/"?n.substr(0,n.length-1):n:n}function getRelativeUrl(n){var t=getBaseUrl();return n&&t!==undefined&&t!==null&&(t==="/"&&(t=""),t=n[0]==="/"?t+n:t+"/"+n),t}function getDepartmentKey(n,t){if(n){var i="/AddressBook/GetAddressBookDepartmentJson?department="+encodeURIComponent(n);$.getJSON(getRelativeUrl(i),function(n){if(n){var i=n.children[0].key;t(i)}})}}function getWorkGroupKey(n,t){if(n){var i="/AddressBook/GetAddressBookWorkGroupJson?workGroup="+encodeURIComponent(n);$.getJSON(getRelativeUrl(i),function(n){if(n){var i=n.children[0].key;t(i)}})}}function getUserWorkGroups(n){$.getJSON(getRelativeUrl("/AddressBook/GetAddressBookUserWorkGroupsJson"),function(t){t&&n(t.children)})}function getAccessGroupKey(n,t){if(n){var i="/AddressBook/GetAddressBookAccessGroupJson?accessGroup="+encodeURIComponent(n);$.getJSON(getRelativeUrl(i),function(n){if(n){var i=n.children[0].key;t(i)}})}}function getUserAccessGroups(n){$.getJSON(getRelativeUrl("/AddressBook/GetAddressBookUserAccessGroupsJson"),function(t){t&&n(t.children)})}function getInputName(n){var t;if(n.indexOf(":")!==-1){var i=n.split("-"),u=i[0].split(":"),r="";for(t=1;t<u.length;t++)r=r+u[t]+"-";return r+i[1]+"-"+i[2]}return n.split("-")[1]}function Scopes(){var u=[],f=[],e=[],o=[],n=[],t=[],i=[],r=[];this.onRegisterTemp=function(n){t.push(n)};this.onEditTemp=function(n){i.push(n)};this.onViewTemp=function(n){r.push(n)};this.onSearchTemp=function(t){n.push(t)};this.onRegister=function(n){u.push(n)};this.onEdit=function(n){f.push(n)};this.onView=function(n){e.push(n)};this.onSearch=function(n){o.push(n)};this.onAll=function(n){onRegister(n);onEdit(n);onView(n);onSearch(n)};this.run=function(){var s=[],h=[];$("#editView").length>0&&(s=f,h=i);$("#registerView").length>0&&(s=u,h=t);$("#documentView").length>0&&(s=e,h=r);$("#replaced-search-content").length>0&&($.each(o,function(n,t){s.push(t)}),$.each(n,function(n,t){h.push(t)}));s!=undefined&&h!=undefined&&($.each(s,function(n,t){t()}),$.each(h,function(n,t){t()}))};this.clearTempFuncs=function(){t=[];i=[];r=[];n=[]}}function stickyBlock(){var n=$("div[fixed]");n.each(function(n,t){var i=getOffsetRect(t);t.classList.contains("fixed-block")?window.pageYOffset<=t.offsetTop&&(t.classList.remove("fixed-block"),t.style.width=null):window.pageYOffset>i&&(t.classList.add("fixed-block"),$(t).width($(t).parent().parent().width()))})}function getOffsetRect(n){var r=n.getBoundingClientRect(),t=document.body,i=document.documentElement,u=window.pageYOffset||i.scrollTop||t.scrollTop,f=i.clientTop||t.clientTop||0,e=r.top+u-f;return Math.round(e)}function resetActionsCache(){var n=$(".basic-actions .dymanic-actions"),t;n.length==0&&(t=$("#documentView.panel.panel-default").length>0,t&&window.location.reload());n.empty();n.append('<div class="item-ajax-loading"><div class= "loading-image" id = "content-change-pasword-loading-image">&nbsp;<\/div><\/div>')}function dropDownHandle(n){$(".basic-actions").on("show.bs.dropdown",function(){$(".basic-actions .loading-image").length!==0&&($(".basic-actions .loading-image").css({visibility:"visible"}),$.ajax({url:getAbsoluteUrl("Document/GetDocLazyActions"),cache:!1,type:"GET",data:{docId:n},beforeSend:function(n){n.setRequestHeader("OriginalReturnUrl",window.location.href)},success:function(n){var t=$(".basic-actions .dymanic-actions");t.empty();$.each(n,function(n,i){var r='<a title="'+i.DisplayName+'" href="'+i.Href+'" class="item-ajax-action" onclick="'+i.OnClick+'" target="'+i.Target+'">'+i.DisplayName+"<\/a>";t.append(r)});n.length===0&&t.append('<div class="item-ajax-action">нет доступных действий<\/div>');typeof customDropDownHandle=="function"&&customDropDownHandle()},error:function(n,t,i){showAlert("Ошибка загрузки действий",i)},traditional:!0}))});$(".basic-route-actions").on("show.bs.dropdown",function(){$(".basic-route-actions .loading-image").length!==0&&($(".basic-route-actions .loading-image").css({visibility:"visible"}),$.ajax({url:getAbsoluteUrl("Document/GetRouteLazyActions"),cache:!1,type:"GET",data:{docId:n},beforeSend:function(n){n.setRequestHeader("OriginalReturnUrl",window.location.href)},success:function(n){var t=$(".basic-route-actions .dymanic-actions");t.empty();$.each(n,function(n,i){var r='<a title="'+i.DisplayName+'" href="'+i.Href+'" class="item-ajax-action" onclick="'+i.OnClick+'" target="'+i.Target+'">'+i.DisplayName+"<\/a>";t.append(r)});n.length===0&&t.append('<div class="item-ajax-action">нет доступных действий<\/div>')},error:function(n,t,i){showAlert("Ошибка загрузки действий",i)},traditional:!0}))})}function switchYear(n){var t=window.location.toString(),i;renewSavedYearSettingsCookie(t,n);n?(t=t.replace(/(selectedYear=)[^\&]+/,"$1"+n),t.indexOf("selectedYear")===-1&&(t=t+"&selectedYear="+n),window.location=t):(i=new URL(t),i.searchParams.delete("selectedYear"),window.location=i)}function renewSavedYearSettingsCookie(n,t){var n=new URL(n),i=t?t:"0";document.cookie="savedYearSettings="+i+";expires=Sat, 07 Feb 2122 14:30:46 GMT"}function updateQueryStringParameter(n,t,i){var r=new RegExp("([?&])"+t+"=.*?(&|$)","i"),u=n.indexOf("?")!==-1?"&":"?";return n.match(r)?n.replace(r,"$1"+t+"="+i+"$2"):n+u+t+"="+i}function replaceUrlToNavigate(n){return n.replaceAll("&amp;","&")}function startDisplayHandlingProgress(n){$("#loadingProgressBlock").removeClass("hide");$("#loadingProgressImage").css("visibility","visible");var i=n.uniqueIds,t=$("#loadingProgressText");t.show();t.text("Обновление статуса загрузки...");UpdateEisAsyncProcStatus(i)}function UpdateEisAsyncProcStatus(n){$.ajax({url:getBaseUrl()+"/ContextAction/GetAsyncProcessUploadStatus",type:"GET",data:{docKey:n},cache:!1,success:function(t){var i,r;t&&t.statusCode&&(i="",t.statusCode=="0"&&(i="Обработка"),t.statusCode=="1"&&(i="Ошибка"),t.statusCode=="2"&&(i="Успешно"),t.statusCode=="3"&&(i="В очереди"),r="Статус: "+i+".<br/>Детали: "+t.statusText,$("#loadingProgressText").html(r),t.statusCode=="2"||t.statusCode=="1"?($("#loadingProgressImageSpan").hide(),t.statusCode=="2"&&($("#loadingProgressBlock").addClass("hide"),$("#success-message").text("Асинхронная выгрузка успешно завершена!"))):setTimeout(function(){UpdateEisAsyncProcStatus(n)},5e3))}})}function isNullOrWhiteSpace(n){return!n||n.length===0||/^\s*$/.test(n)}function changeDocStatus(n){var t=$("*.documentView-field-value[data-name='Статус'], input[name='regstatus']");t.val(n)}function afterSubmit_UpdateNotification(){(new NotificationHub).NotifyCurrentUserGroup()}var FormHelper=function(){var t=function(n){var t=document.getElementById(n);t!=null&&(t.style.display=t.style.display==="none"?"block":"none")},i=function(n){function a(n){for(var i=new ArrayBuffer(n.length),r=new Uint8Array(i),t=0;t!=n.length;++t)r[t]=n.charCodeAt(t)&255;return i}function v(n,t){var i=document.createElement("a"),u=new Blob([a(atob(t,"utf8"))],{type:""}),r;console.log(window.navigator.appName);window.navigator.msSaveBlob?window.navigator.msSaveOrOpenBlob(u,n):(i.setAttribute("href",URL.createObjectURL(u)),i.setAttribute("download",n));document.createEvent?(r=document.createEvent("MouseEvents"),r.initEvent("click",!0,!0),i.dispatchEvent(r)):i.click()}var f;window.docChangeObserver&&window.docChangeObserver.disable();var r=n.document,i=r.find(".action-form").get(0),e=function(){$(i).bind("submit",f)},h=function(){$(i).unbind("submit",f)},c=function(n,t,i){var r,u;n!=undefined&&(r="",n.indexOf&&n.indexOf("#")!==-1&&(u=n.split("#"),n=u[0],r=u[1]),typeof n=="function"&&n(t,i,r),typeof n=="string"&&window[n](t,i,r))},l=function(){$(i).find("[type='submit']").prop("disabled",!0);n.onStart!==undefined&&n.onStart()},u=function(){$(i).find("[type='submit']").prop("disabled",!1);n.onFinish!==undefined&&n.onFinish();c(n.afterSubmit,n.control,n.event)},o=function(){t("div-context-submit");t("div-context-modal");t("send-to-eis-question");t("action-form");n.onFinish!==undefined&&n.onFinish()},s=function(){if(n.useDefaultSubmit){i.submit();return}if(n.dontSubmit){o();u();n.document&&n.document.modal("toggle");return}h();ajaxFormSubmit(i,function(t,f,s,h){var v,y,a,l,c;t&&!WorkflowNotificationManager.isNotificationData(t)?(v=r.find(".success-message"),v.text(t),v.removeClass("hide"),y=r.find(".error-message"),y.addClass("hide"),a=r.find(".info-message"),s!==undefined&&(Array.isArray(s)||(s=[s]),a.text(""),l="",$.each(s,function(n,t){l=l+t;l=l+" "}),l=l.trim(),l!==""&&(a.text(l),a.removeClass("hide"))),e(),o(),h&&f&&window[f](h)):n.afterSubmit?(o(),u(),n.document&&n.document.modal("toggle")):(WorkflowNotificationManager.isNotificationData(t)&&WorkflowNotificationManager.saveNotificationData(t),c=$(i).find("input[name='returnUrl']").val(),f&&typeof f!="undefined"?(c&&window.location.href!==c&&window.location.pathname+window.location.search!==c&&$("#actionDialog").click(),window.ct.custom[f](function(){c&&window.location.href!==c&&window.location.pathname+window.location.search!==c?window.location.href=c:window.location.reload()})):c&&window.location.href!==c&&window.location.pathname+window.location.search!==c?($("#actionDialog").click(),window.location.href=c,c.toLowerCase().indexOf(window.location.pathname.toLowerCase())!==-1&&window.ct.common.routesGrid.refresh()):window.location.reload())},function(n){var t=r.find(".error-message:last"),i,s,h,f;if(n.allMessages&&Array.isArray(n.allMessages)&&n.allMessages.length>0){var c=n.responseText.replace(".",":"),l=$("<span/>").text(c),o=$("<ul/>"),a=n.allMessages.length;for(i=0;i<a;i++)s=n.allMessages[i],h=$("<li/>").text(s),h.appendTo(o);f=$("<div/>");l.appendTo(f);o.appendTo(f);t.html(f)}else n.fileName!==null?(v(n.fileName,n.responseText),t.text(n.messageForUser)):t.text(n.responseText);t.removeClass("hide");$(".modal-body").scrollTop(0);e();u()})};f=function(t){if(l(),setPreventDefault(t),n.beforeSubmit!==undefined){var f=r.find(".action-form"),i=n.beforeSubmit(t,f);if(i){if(i.then){i.then(function(t){if(t){n.onMessage(t,!0);u()}else s()});return}n.onMessage(i,!0);return}}s()};n.isTargetBlank||e()},r=function(n){return n.hasClass("parsley-validation")},u=function(n){return n.find('[name="isSignEDS"]').is(":checked")},n=function(n){n.find("[type='submit']").click()},f=function(n,t){n.attr("target","_blank");t.onFinish!==undefined&&t.onFinish();n.find("[type='submit']").click()},e=function(t,i){var f=function(){i.onStart!==undefined&&i.onStart()},u=function(){t.attr("target","_blank");i.onFinish!==undefined&&i.onFinish()},r=function(n,t){if(i.onMessage!==undefined)i.onMessage(n,t)},e=t.find('[name="certificateList"]').find("input:checked").val()!=undefined;if(!e){r("Выберите сертификат для создания подписи",!0);return}f();$("#signAttachments").is(":checked")?EDS.SignDocumentWithAtachments(function(){var i=$('[name="isEisExport"]').is(":checked");i?n(t):u()},r):$('[data-name="isSignAllAttachment"]').val()?EDS.SignAttachments(u,r):$('[name="isAttachEDS"]').is(":checked")?EDS.SignCreate(u,r):$('[name="isEDSAuthentication"]').is(":checked")?EDS.SignAuthentication(u,r):$('[name="isActivitySign"]').is(":checked")?EDS.SignCreate(function(){var i=$("[data-name='activitySignature']").val();i!==undefined?n(t):u()},r):$('[name="isEisExport"]').is(":checked")?EDS.SignForEis(function(){n(t)},r):EDS.SignCreate(function(){var i=$("[data-name='activitySignature']").val();i!==undefined?n(t):u()},r)},o=function(t){var h=t.document,i=h.find(".action-form"),o=function(){t.isTargetBlank?f(i,{onStart:t.onStart,onFinish:t.onFinish,onMessage:t.onMessage}):u(i)?e(i,{onStart:t.onStart,onFinish:t.onFinish,onMessage:t.onMessage}):n(i,{onStart:t.onStart,onFinish:t.onFinish,onMessage:t.onMessage})},s;return r(i)?(s=i.parsley(),s.whenValidate().done(o),!1):(o(),!0)},s=function(){window.docChangeObserver&&window.docChangeObserver.restart()};return{init:i,submit:o,close:s}}($),DocumentHelper=function(){var n=function(n){resetDictionaryFields();var i=n.find(".action-page-scripts .action-page-script"),t=$.when();$.each(i,function(n,i){t=t.then(function(){return $.getScript($(i).attr("data-url"))}).then(function(){console.info("Добавлен скрипт '"+$(i).attr("data-url")+"'.")},function(n){console.log(n)})});t.always(function(){reinitialiseScripts()})},t=function(t){n(t);t.find(".action-page-buttons").hide();t.find("#div-context-modal").show()};return{init:t}}($),FormDictionaryHelperModule=function(){function n(n,t,i,r,u){var f=parseInt(window.location.pathname.split("/").pop()),e=isNaN(f)?"":f;$.ajax({url:getAbsoluteUrl("FormdataDict/GetJson"),type:"POST",data:{formdataDictKey:n,formValues:i,dictFieldsInfo:t,documentKey:e},success:function(n){r(n)},error:function(n,t,i){u(i)}})}function t(t,i,r,u,f,e){n(t,r,u,function(n){var r,u,t;try{for(r=JSON.parse(n.data).children,u=[],t=0;t<r.length;t++)u.push(r[t][i]);f(u)}catch(o){e(o)}},e)}return{getFormDictionaryItemsIds:n,getIdArrayFromFormDictionary:t}}(),ajaxFileStorage,ajaxFileStorageCounter,dynamicLoading,waitingDialog,scopes,dsc,WorkflowNotificationManager,saveAs,saveTextAs,NotificationService;(function(){})(window.ct=window.ct||{}),function(n){n.fitColumnsWidth=function(n){var i,t;for(n=n.jquery?n.dxDataGrid("instance"):n,i=n.getVisibleColumns(),t=0;t<i.length;t++)n.columnOption(i[t].index,"width","auto");n.option("columnAutoWidth",!0)}}((window.ct=window.ct||{},window.ct.dataGrid=window.ct.dataGrid||{}));var customState=function(){function n(n,t){this.Name=n;this.State=t;this.Selected=!1;this.Default=!1}return n}(),customStateService=function(n){"use strict";function i(){var n=this;n.Base=$("base").attr("href");n.Base==="/"&&(n.Base="")}i.prototype.ReceiveDxGridCustomState=function(t,i,r){var f=this,u=$.Deferred();return $.ajax({type:"get",dataType:"json",url:f.Base+"/TableSettings/Load",cache:!1,data:{key:t},error:function(n){console.log("state_key="+t+": load error: "+n);u.reject(n)},success:function(t){var i,r;if(t===""){u.resolve([]);return}i=JSON.parse(t);Array.isArray(i)||(r=new n("По умолчанию",i),r.Selected=!0,i=[r]);u.resolve(i)},complete:function(){r&&r()},beforeSend:function(){i&&i()}}),u.promise()};i.prototype.GetStateKeyFromGrid=function(n){return n.parent("div[data-state-key]").attr("data-state-key")};i.prototype.ApplyStateToGrid=function(n,t){var i=this;n.state({});n.refresh().then(function(){n.state(t);t.columns.forEach(function(t){n.columnOption(t.dataField,"visible",t.visible)});i.GridColChooserSyncSelectedColumns(n)})};i.prototype.GridColChooserSyncSelectedColumns=function(n){var t=n.colChooserList,i;t&&(i=t.option("items").filter(function(t){return n.columnOption(t.dataField,"visible")}),t.beginUpdate(),t.option("selectedItems",i),t.endUpdate())};var t={data:{},remove:function(n){delete t.data[n]},exist:function(n){return t.data.hasOwnProperty(n)&&t.data[n]!==null},get:function(n){return t.data[n]},set:function(n,i){t.remove(n);t.data[n]=i}};return i.prototype.GridCustomStateLoad=function(n){var u=this,i=u.GetStateKeyFromGrid(n.element),r;i&&(t.exist(i)?r=t.get(i):(r=u.ReceiveDxGridCustomState(i,n.component.beginCustomLoading,n.component.endCustomLoading),t.set(i,r)),r.then(function(t){var r=$.when(),i=t.filter(function(n){return n.Selected})[0];return i?$.each(t,function(n,t){t.Selected=t.Default}):i=t.filter(function(n){return n.Default})[0],i&&(r=r.then(function(){u.ApplyStateToGrid(n.component,i.State)})),r}))},i.prototype.GridCustomStateReset=function(n){var t=this;n.state({});t.GridColChooserSyncSelectedColumns(n)},i.prototype.SaveChanges=function(n,t,i,r){var f=this,u=$.Deferred();return $.ajax({type:"post",dataType:"json",url:f.Base+"/TableSettings/Save",cache:!1,data:{key:n,state:JSON.stringify(t)},error:function(t){console.log("state_key="+n+": save error");console.log(t);u.reject(t)},success:function(t){console.log("state_key="+n+": saved successfully");u.resolve(t)},complete:function(){r&&r()},beforeSend:function(){i&&i()}}),u.promise()},i}(customState),CustomStateDialog=function(n,t,i){"use strict";function r(n,i){var r=this,u;r.GridId=n.element[0].id;u=$("#stateSavePopup_"+r.GridId);r.Service=new t;r.State=[];r.Button=i;r.Grid=n.component;r.Element=n.element;r.StateKey=r.Service.GetStateKeyFromGrid(n.element);r.Popup=null;r.Popup=u.dxPopup({showCloseButton:!0,visible:!1,title:"Список состояний",width:450,height:520,onHiding:function(){r.List.remove()}});r.PopupContent=this.Popup.find(".dx-popup-content");r.SaveButtonComponent=null;r.NameTextBoxComponent=null;r.List=null}function u(n){return $("<div><div data-selection-checkbox class='col-sm-1 dx-states-list-checkbox'><\/div><label class='col-sm-7 dx-states-list-label'>"+n+"<\/label><div class='col-sm-4'><div data-delete-item-button><\/div><div data-save-changes-button><\/div><div data-set-default-item-button><\/div><\/div><\/div>")}return r.prototype.BuildCreateNewPanel=function(){var n=this,t=$("<div class='row dx-add-new-state-form'><div class='col-sm-9'><div id='stateNameTextBox'><\/div><\/div><div class='col-sm-3'><div id='addStateButton'><\/div><\/div><\/div>"),i,r;n.PopupContent.append(t);i=$("#addStateButton").dxButton({icon:"save",hint:"Добавить элемент",disabled:!0});r=$("#stateNameTextBox").dxTextBox({value:"",placeholder:"Имя текущего состояния...",showClearButton:!0,valueChangeEvent:"keyup"}).dxValidator({validationRules:[{type:"stringLength",min:3,message:"Имя должно содержать не менее 3 символов"}]});n.SaveButtonComponent=i.dxButton("instance");n.NameTextBoxComponent=r.dxTextBox("instance");n.NameTextBoxComponent.option("onValueChanged",function(t){var i=t.value;n.SaveButtonComponent.option("disabled",i.length<3)});n.PopupContent.append(t)},r.prototype.Confirm=function(n){var t=this,i=$.Deferred();$("#confirmLabel_"+t.GridId).text(n);$("#confirm_"+t.GridId).modal("show");$("#confirm_modal-yes_"+t.GridId).on("click",function(){$("#confirm_"+t.GridId).modal("hide");i.resolve()});$("#confirm_modal-no_"+t.GridId).on("click",function(){$("#confirm_"+t.GridId).modal("hide");i.reject()});return i.promise()},r.prototype.Alert=function(n){var t=this,i;$("#alertLabel_"+t.GridId).text(n);$("#alert_"+t.GridId).modal("show");i=setTimeout(function(){$("#alert_"+t.GridId).modal("hide")},3e3);$("#alert_modal-yes_"+t.GridId).on("click",function(){$("#alert_"+t.GridId).modal("hide");clearTimeout(i)})},r.prototype.BuildRowTemplate=function(n,t,r){var f=this,e=u(n.Name);i("<span>"+n.Name+"<\/span>",r);r.append(e);e.data("state",t);e.find("[data-selection-checkbox]").dxCheckBox({value:n.Selected,onOptionChanged:function(t){$.each(f.State,function(n,t){t.Selected=!1});var r=e.data("state"),i=f.State[r];i.Selected=t.value;i.Selected?f.ApplyStatesChanges().then(function(){f.Service.ApplyStateToGrid(f.Grid,n.State)}):dxGridCustomStateReset(f.Grid)}});e.find("[data-delete-item-button]").dxButton({icon:"remove",hint:"Удалить элемент",onClick:function(){showConfirmEx("Удаление состояния","Вы уверены, что хотите удалить состояние '"+n.Name+"'?","OK","Закрыть",r).then(function(){var t=f.State.indexOf(n);t>-1&&(f.State.splice(t,1),e.remove(),f.ApplyStatesChanges())})}});e.find("[data-save-changes-button]").dxButton({icon:"save",hint:"Сохранить изменения",disabled:!n.Selected,onClick:function(){n.State=f.Grid.state();f.ApplyStatesChanges().then(function(){showAlertEx("Сохранение состояния","Элемент '"+n.Name+"' успешно сохранен","OK",r)})}});e.find("[data-set-default-item-button]").dxButton({icon:"check",hint:"Сделать элементом по умолчанию",disabled:n.Default,onClick:function(){$.each(f.State,function(t,i){i.Default=i===n});f.ApplyStatesChanges().then(function(){showAlertEx("Изменение состояния","Элемент '"+n.Name+"' установлен как элемент по умолчанию","OK",r)})}})},r.prototype.BuildStatesList=function(){var t=this;return t.Service.ReceiveDxGridCustomState(t.StateKey,t.Grid.beginCustomLoading,t.Grid.endCustomLoading).then(function(i){return t.State=i,t.List&&t.List.remove(),t.List=$("<div data-grid-states-list><\/div>").dxList({items:t.State,searchEnabled:!0,selectionMode:"none",itemTemplate:function(n,i,r){t.BuildRowTemplate(n,i,r)}}),t.PopupContent.append(t.List),t.SaveButtonComponent.option("onClick",function(){var i=new n(t.NameTextBoxComponent.option("value"),t.Grid.state());$.each(t.State,function(n,t){t.Selected=!1});i.Selected=!0;i.Default=!1;t.State.push(i);t.ApplyStatesChanges().then(function(){t.NameTextBoxComponent.option("value","")})}),t.State})},r.prototype.ApplyStatesChanges=function(){var n=this;return n.Service.SaveChanges(n.StateKey,n.State,n.Grid.beginCustomLoading,n.Grid.endCustomLoading).then(function(){return n.BuildStatesList()})},r.prototype.Init=function(){var n=this;n.BuildCreateNewPanel();n.BuildStatesList().then(function(){n.Popup.dxPopup("instance").option({showCloseButton:!0,visible:!0,position:{my:"right top",at:"left bottom",of:n.Button.element}})})},r}(customState,customStateService,appendTooltip);$(document).on("shown.bs.tab",'a[data-toggle="tab"]',function(n){var i=$(n.target).attr("data-target"),u,r,t;if(!ct.utils.isLowScreenWidth()||!i.startsWith("#routes-view")||(u=$(i).find("div[id ^='routes-detail-table-']"),!(u.length>0)))for(r=$(i).find("div.dx-widget:has(div.dx-datagrid)"),t=0;t<r.length;t++)$(r[t]).dxDataGrid("instance").updateDimensions()});(function(n){String.prototype.replaceAll=function(n,t){return this.split(n).join(t)};n.fn.removeStyle=function(t){var i=new RegExp(t+"[^;]+;?","g");return this.each(function(){n(this).attr("style",function(n,t){return t&&t.replace(i,"")})})}})(jQuery),function(){}(window.ct=window.ct||{}),function(n){webshim.setOptions("basePath",getRelativeUrl("Scripts/External/js-webshim/minified/shims/"));webshim.polyfill("es6");webshim.setOptions("forms",{customDatalist:"auto",list:{popover:{appendTo:"body"}}});n.calc={getMinClientWidth:function(){return Math.min(window.innerWidth,document.documentElement.clientWidth,document.body.clientWidth)},getMinClientHeight:function(){return Math.min(window.innerHeight,document.documentElement.clientHeight,document.body.clientHeight)}};n.delayPassed=function(n,t){var i=$(n),r;return i.data("last-click-time")&&(r=(Date.now()-i.data("last-click-time"))/1e3,r<=t)?!1:(i.data("last-click-time",Date.now()),!0)};n.ajaxFormSubmit=function(n,t,i,r){var e=$(n),y=e.attr("action"),g=e.attr("method").toUpperCase(),s,c,u,h,l,a,f,v;if(g=="GET"){$.ajax({url:y,type:"GET",data:e.serialize(),contentType:!1,cache:!1,processData:!1,success:t,error:i});return}var nt=function(n){var r="",i,t;if(n[0]=="{")for(i=1,t=1;t<n.length;t++)if(n[t]=="{"&&i++,n[t]=="}"&&i--,i==0){r=n.substring(0,t+1);break}return r},p=function(n){var u=nt(n),r;u?(r=JSON.parse(u),r.status=="ERROR"&&i({responseText:r.responseMessage,allMessages:r.allMessages}),r.status=="OK"&&t(r.responseMessage,r.afterSubmitJs,r.allMessages,r)):n?i({responseText:n}):t(n)},tt=function(n){i(n)};if($(n).trigger("beforeSubmit"),window.FormData!==undefined){var o=new FormData(n),w=typeof UploadAttachment!="undefined"&&$(".modal-title:visible:contains('Создать версию')").length==0,b=getAjaxFiles(n),k=b.length,d={};for(s=0;s<k;s++)c=b[s],u=c.data,w?(h=c.key,l=UploadAttachment.getFileProps(h),l!==null?(d[h]=l,o.append(u.name,u.file,h)):o.append(u.name,u.file,u.file.name)):o.append(u.name,u.file,u.file.name);w&&k>0&&o.append("attachmentFilesProps",JSON.stringify(d));$.ajax({url:y,type:"POST",data:o,mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,beforeSend:r,success:p,error:tt})}else a="unique"+(new Date).getTime(),f=$('<iframe src="javascript:false;" name="'+a+'" ><\/iframe>'),f.hide(),e.attr("target",a),v=function(){f.unbind("load",v);f.load(function(){var n=getFrameDocument(f[0]),t=n.body?n.body:n.documentElement,i=t.innerHTML;p(i);f.remove()});e.submit()},f.bind("load",v),f.appendTo("body")};n.preventDefault=function(n){n.preventDefault?n.preventDefault():n.returnValue=!1};n.dictionary={DATA_SEPARATOR:"|",VIEW_DATA_SEPARATOR:", ",fillDisplayFields:function(){var t=[];$(".dict-modal-control").each(function(i,r){var u=n.dictionary.fillSingleDisplayField($(r));u&&t.push(u)});setTimeout(function(){for(var n=0;n<t.length;n++)t[n].change()},100)},fillSingleDisplayField:function(n){var u=n.attr("data-edit-name"),e=n.closest(".table-edit").length>0,f=e?".table-edit-row":".column-container",i=n.closest(f).find(".display-field-part[dictionary-edit-name="+u+"]"),r,t;return i.length||(i=n.closest(f).parent().find(".display-field-part[dictionary-edit-name="+u+"]")),r=i.map(function(){return this.value}).get().filter(function(n){return n&&$.trim(n).length}).join(", "),t=n.find(".dict-display-field"),t.val()!==r?(t.val(r),t):void 0},fillMultipleDisplayFields:function(n){var r=n.find("ul li"),t=[],i;r.each(function(n,i){var r=$(i).find("input.display-field-part").map(function(){return this.value}).get().filter(function(n){return!(n==null||$.trim(n).length===0)}),u=r.length>1?"("+r.join(",")+")":r[0];t.push(u)});i=t.filter(function(n){return n!=null&&$.trim(n).length!==0}).join(", ");n.find(".mult-dict-display").val(i).change()},fillMultipleDisplayFieldsEx:function(n){var r=n.find("ul.multiple-editor-list li"),t=[],i;r.each(function(n,i){var r=$(i).find("input.display-field-part").map(function(){return this.value}).get().filter(function(n){return!(n==null||$.trim(n).length===0)}),u=r.length>1?"("+r.join(this.DATA_SEPARATOR)+")":r[0];t.push(u)});i=t.filter(function(n){return n!=null&&$.trim(n).length!==0}).join(this.VIEW_DATA_SEPARATOR);n.find(".mult-dict-display").val(i).change()},fillMultipleDictFieldsByList:function(n,t){var e=this,s=n.find("ul.multiple-editor-list li"),i=[],u,f;for(s.each(function(n,t){$(t).find("input").each(function(n,t){var s=$(t),f=s.attr("value"),u,h,o,r;for(f==undefined&&(f=""),u={name:getInputName(s.attr("name")),value:f,isDisplay:s.hasClass("display-field-part"),displayValue:f},h=!1,o=0;o<i.length;o++)if(r=i[o],r.name==u.name){r.value=r.value+e.DATA_SEPARATOR+u.value;r.isDisplay&&(r.displayValue=r.displayValue+e.VIEW_DATA_SEPARATOR+u.displayValue);h=!0;break}h||i.push(u)})}),i.length==0&&t&&n.find("input[dictionary-edit-name='"+t+"']").each(function(n,t){var r=$(t),u={name:r.attr("name"),value:"",isDisplay:r.hasClass("display-field-part"),displayValue:""};i.push(u)}),u="",f=0;f<i.length;f++){var r=i[f],h=r.name.replace(/:/gi,"-"),o=n.find("input[name='"+h+"']");o?(o.val(r.value),r.isDisplay&&(u+=u!=""?e.VIEW_DATA_SEPARATOR+r.displayValue:r.displayValue)):console.log("Элемент с id: "+r.name+" не найден! (значение: "+r.displayValue+")")}n.find(".mult-dict-display").val(u).change()},removeFromMultipleDisplayFields:function(n){var f=$(n).closest(".dict-modal-control"),i=$(n).siblings("input").first().attr("name").split("-"),e=parseInt(i[i.length-1]),r=i[0]+"_deleted",t,u;$("[name='"+r+"']").length>0?t=$("[name='"+r+"']"):(u=$("<div data-name='deletedTableElements'><\/div>"),t=$("<input type='hidden' name='"+r+"' value='' />"),u.append(t),$(n).closest("ul").parent().append(u));t.val(t.val()+e+",");$(n).closest("li").remove();this.fillMultipleDisplayFields(f)},removeFromMultipleDisplayFieldsEx:function(n){var f=$(n).closest(".dict-modal-control"),e=f.find("ul.multiple-editor-list li"),u;if($(e).length===1)this.removeAllEx(n);else{var i=$(n).siblings("input").first().attr("name").split("-"),o=parseInt(i[i.length-1]),r=i[0]+"_deleted",t;$("[name='"+r+"']").length>0?t=$("[name='"+r+"']"):(u=$("<div data-name='deletedTableElements'><\/div>"),t=$("<input type='hidden' name='"+r+"' value='' />"),u.append(t),$(n).closest("ul").parent().append(u));t.val(t.val()+o+this.DATA_SEPARATOR);$(n).closest("li").remove();this.fillMultipleDictFieldsByList(f,i[0])}},removeAllEx:function(n){var t=$(n).closest(".dict-modal-control"),r=t.find("ul.multiple-editor-list li"),u=t.find("ul.multiple-editor-list div"),i="";r.each(function(n,t){$(t).find("input").each(function(n,t){var r=$(t);i=r.attr("name").split("-")[0];r.closest("li").remove();r.remove()})});$(u).remove();this.fillMultipleDictFieldsByList(t,i)}};n.showCommonErrors=function(n,t,i){var f=!1,u,r,e;if(typeof n!="undefined"&&(typeof n=="string"&&n.indexOf("application-errors")!==-1?(n=$(n).find(".application-errors .alert.alert-danger"),f=!0):typeof n=="string"||Array.isArray(n)||(n="Необходимо выполнить вход в систему.")),Array.isArray(n)||(n=[n]),u=$("#commonErrorsDialog"),i&&$(".error-dlg-header").text("Предупреждение:"),u.modal("show"),r=[],$.each(n,function(n,t){f?r.push(t):r.push('<li><p class="form-control-static">'+t+"<\/p><\/li>")}),e=u.find("ul"),f?e.parent().html(r):e.html(r),t!=null)u.on("hidden.bs.modal",t)};n.safeAscii=function(n){return n.replace(/[\u007F-\uFFFF]/g,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).substr(-4)})};n.decodeHTML=function(n){var t=document.createElement("textarea");return t.innerHTML=n,t.value};n.createId=function(n,t){var i,r,u;for(n=n||8,t=t||"",i=t,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",u=0;u<n;u++)i+=r.charAt(Math.floor(Math.random()*r.length));return i};n.routesGrid={refresh:function(){var n=$('div[id^="routes-table"]');n.length===1&&n.dxDataGrid("instance").refresh()}}}((window.ct=window.ct||{},window.ct.common=window.ct.common||{}));String.prototype.startsWith||(String.prototype.startsWith=function(n,t){return t=t||0,this.indexOf(n,t)===t});String.prototype.indexOfInsensitive||(String.prototype.indexOfInsensitive=function(n,t){return this.toLowerCase().indexOf(n.toLowerCase(),t)});String.prototype.containsInsensitive||(String.prototype.containsInsensitive=function(n){return this.indexOfInsensitive(n)!==-1});ajaxFileStorage={};ajaxFileStorageCounter=0;setMobileDefaults();jQuery.fn.toggleOption=function(n){jQuery(this).toggle(n);n?jQuery(this).parent("span.toggleOption").length&&jQuery(this).unwrap():jQuery(this).parent("span.toggleOption").length==0&&jQuery(this).wrap('<span class="toggleOption" style="display: none;" />')};$("body").on("change",'input[type="radio"]',setEnabledWithRadios);$("body").on("change",'input[type="radio"]',setRequiredWithRadios);$(document).on("change","select",setEnabledWithSelect);$(document).on("change","select",setVisibleWithSelect);$("body").on("click",".multiple-editor-append",multipleEditorAppend);$("body").on("click",".multiple-editor-remove",multipleEditorRemove);$("body").on("change",'input[type="file"]',onFileEditorChange);$(".multiple-editor-append").on("change","click",multipleEditorRemove);$("body").on("change",".form-dictionary-control",onFormDictionaryControlChange);dynamicLoading={elements:[],isRunning:!1,getUniqueSelector:function(n){var t=n.indexOf(" "),i,r;t<0?(i=n,r=""):(i=n.substr(0,t),r=n.substr(t+1));var f=i.indexOf("?")>=0?"&":"?",e="rand="+(new Date).getTime(),u=i+f+e;return t>=0&&(u+=" "+r),u},loadOne:function(n){var t;if(this.elements.length<1)return!1;t=this.elements[0];this.elements.shift();var i=$(t.node),r=$("<div>"),u=this.getUniqueSelector(t.url);return r.load(u,function(){i.after(r.html());i.remove();n()}),!0},loadNext:function(){var n=this;n.isRunning||(n.isRunning=n.loadOne(function(){n.isRunning=!1;n.loadNext()}))},push:function(n,t){this.elements.push({node:n,url:t});this.loadNext()}};waitingDialog=waitingDialog||function(n){"use strict";var t=n('<div class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true" style="padding-top:15%; overflow-y:visible;"><div class="modal-dialog modal-sm"><div class="modal-content"><div class="modal-body" style="text-align:center;"><div><h3 class="loading-message"><\/h3><\/div><div class="loading-image loading-image-shown"><\/div><\/div><\/div><\/div>');return{dlg:t,show:function(i,r){var u=this;n(".modal-backdrop:visible").length===0?(t.find("h3").text(i),t.find(".modal-content").css("visibility","visible"),t.find(".loading-image.loading-image-shown").removeAttr("style"),t.modal()):setTimeout(function(){u.show(i,r)},350)},showCtrlShiftSkip:function(n,t,i){var r=this;n.ctrlKey||n.shiftKey||r.show(t,i)},showWaiting:function(i){var r=this;i||n(".modal-backdrop:visible").length===0?(t.find("h3").text(""),t.find(".modal-content").css("visibility","hidden"),t.find(".loading-image.loading-image-shown").css("opacity",.15),t.modal()):setTimeout(function(){r.showWaiting()},350)},hide:function(){t.modal("hide")},hideWithCheck:function(){var n=this;n.isVisible()&&(n.hide(),setTimeout(function(){n.hideWithCheck()},350))},isVisible:function(){return n(".modal-backdrop:visible").length>0}}}(jQuery);$(document).ready(function(){resetDictionaryFields();reinitialiseScripts();$.fn.modal.Constructor.prototype.enforceFocus=function(){var n=this;$(document).on("focusin.modal",function(t){!n.$element.has(t.target).length})};enableToolTips();updateDatepickers();verticalTabs();toTopButton();bindDictionaryButtons();bindDictionaryDisplayField();initialiseSearchResultTableScripts(".search-result");initialiseTableEditScripts($(document));initReportSections();WorkflowNotificationManager.showNotifications();typeof scopes!="undefined"&&(addRegEditValidations(),scopes.run());$(document).on("onDocumentAjaxLoaded",function(n,t){t&&t.documentType&&scopes.run(t.documentType)});$(document).on("onDocumentModalWindowLoaded",function(n,t){addParsleyValidation(t.validatedFormSelector)})});scopes=new Scopes;dsc=function(){var i={extended_title:"Нажмите чтобы скрыть",retracted_title:"Нажмите чтобы скрыть",slider_opened_em:42,slider_closed_em:0},n={px_per_em:0,slider_hidden_px:0,slider_closed_px:0,slider_opened_px:0},t,r,u,f,e;return f=function(r){var f,e;f=u(t.first());e=i.slider_opened_em;r!=undefined&&(e=e/3*r);n.px_per_em=f;n.slider_closed_px=i.slider_closed_em*f;n.slider_opened_px=e*f},u=function(n){return Number(getComputedStyle(n[0],"").fontSize.match(/\d*\.?\d*/)[0])},r=function(){var r=t.height();return r<=n.slider_closed_px?(t.animate({height:n.slider_opened_px}).attr("title",i.extended_title),!0):r>=n.slider_opened_px?(t.animate({height:n.slider_closed_px}).attr("title",i.retracted_title),!0):!1},e=function(n,i){return t=n,f(i),r(i),!0},{initModule:e}}(jQuery);$(document).ready(function(){var n=function(){var n=$("[data-target='"+location.hash+"']");n.length&&n.tab("show")};window.onpopstate=n;window.onhashchange=n});WorkflowNotificationManager=function(){function t(){var t=getFromSessionStorage(n),i;return t?(removeFromSessionStorage(n),JSON.parse(t)):(t=readCookie(n),t)?(deleteCookie(n),i=decodeURIComponent(t).split("+").join(" "),JSON.parse(i)):null}function i(){var n=t(),i,o,u,r,e,c;if(n&&(i=n.msgs,i)){for(o=i.length,u=$("<div/>"),r=0;r<o;r++){var s=i[r],f=$("<div class='panel panel-default'/>"),h=$("<div class='panel-heading'><\/div>");h.html(s.wfname);e=$("<div class='panel-body'/>");e.html(s.text);f.append(h);f.append(e);u.append(f)}c=n.title?n.title:" ";showNotification(c,u)}}function r(n){return n.indexOf("wfname")!==-1&&n.indexOf("msgs")!==-1}function u(t){var r=getFromSessionStorage(n),i,u;r&&(i=JSON.parse(r),u=typeof t=="string"?JSON.parse(t):t,i.msgs=i.msgs.concat(u.msgs),t=JSON.stringify(i));updateSessionStorage("WorkflowNextSteps",t)}var n="WorkflowNextSteps";return{showNotifications:i,isNotificationData:r,saveNotificationData:u}}();window.onscroll=function(){stickyBlock()};
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
saveAs=saveAs||typeof navigator!="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(n){"use strict";if(typeof navigator=="undefined"||!/MSIE [1-9]\./.test(navigator.userAgent)){var s=n.document,h=function(){return n.URL||n.webkitURL||n},r=s.createElementNS("http://www.w3.org/1999/xhtml","a"),y=!n.externalHost&&"download"in r,p=function(t){var i=s.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,n,0,0,0,0,0,!1,!1,!1,!1,0,null);t.dispatchEvent(i)},u=n.webkitRequestFileSystem,c=n.requestFileSystem||u||n.mozRequestFileSystem,w=function(t){(n.setImmediate||n.setTimeout)(function(){throw t;},0)},f="application/octet-stream",l=0,i=[],e=function(){for(var t=i.length,n;t--;)n=i[t],typeof n=="string"?h().revokeObjectURL(n):n.remove();i.length=0},o=function(n,t,i){var r,u;for(t=[].concat(t),r=t.length;r--;)if(u=n["on"+t[r]],typeof u=="function")try{u.call(n,i||n)}catch(f){w(f)}},a=function(t,e){var s=this,k=t.type,d=!1,v,b,g=function(){var n=h().createObjectURL(t);return i.push(n),n},nt=function(){o(s,"writestart progress write writeend".split(" "))},a=function(){(d||!v)&&(v=g(t));b?b.location.href=v:window.open(v,"_blank");s.readyState=s.DONE;nt()},w=function(n){return function(){if(s.readyState!==s.DONE)return n.apply(this,arguments)}},tt={create:!0,exclusive:!1},it;if(s.readyState=s.INIT,e||(e="download"),y){v=g(t);r.href=v;r.download=e;p(r);s.readyState=s.DONE;nt();return}if(n.chrome&&k&&k!==f&&(it=t.slice||t.webkitSlice,t=it.call(t,0,t.size,f),d=!0),u&&e!=="download"&&(e+=".download"),(k===f||u)&&(b=n),!c){a();return}l+=t.size;c(n.TEMPORARY,l,w(function(n){n.root.getDirectory("saved",tt,w(function(n){var r=function(){n.getFile(e,tt,w(function(n){n.createWriter(w(function(r){r.onwriteend=function(t){b.location.href=n.toURL();i.push(n);s.readyState=s.DONE;o(s,"writeend",t)};r.onerror=function(){var n=r.error;n.code!==n.ABORT_ERR&&a()};"writestart progress write abort".split(" ").forEach(function(n){r["on"+n]=s["on"+n]});r.write(t);s.abort=function(){r.abort();s.readyState=s.DONE};s.readyState=s.WRITING}),a)}),a)};n.getFile(e,{create:!1},w(function(n){n.remove();r()}),w(function(n){n.code===n.NOT_FOUND_ERR?r():a()}))}),a)}),a)},t=a.prototype,v=function(n,t){return new a(n,t)};return t.abort=function(){var n=this;n.readyState=n.DONE;o(n,"abort")},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,n.addEventListener("unload",e,!1),v.unload=function(){e();n.removeEventListener("unload",e,!1)},v}}(typeof self!="undefined"&&self||typeof window!="undefined"&&window||this.content);typeof module!="undefined"&&module!==null?module.exports=saveAs:typeof define!="undefined"&&define!==null&&define.amd!=null&&define([],function(){return saveAs});String.prototype.endsWithAny=function(){for(var t=Array.prototype.slice.call(arguments),i=this.toLowerCase().toString(),n=0;n<t.length;n++)if(i.indexOf(t[n],i.length-t[n].length)!==-1)return!0;return!1};saveTextAs=saveTextAs||function(n,t,i){var f,r,u,e;return t=t||"download.txt",i=i||"utf-8",n=(n||"").replace(/\r?\n/g,"\r\n"),saveAs&&Blob?(f=new Blob([n],{type:"text/plain;charset="+i}),saveAs(f,t),!0):(r=window.frames.saveTxtWindow,!r&&(r=document.createElement("iframe"),r.id="saveTxtWindow",r.style.display="none",document.body.insertBefore(r,null),r=window.frames.saveTxtWindow,!r&&(r=window.open("","_temp","width=100,height=100"),!r)))?(window.alert("Sorry, download file could not be created."),!1):(u=r.document,u.open("text/html","replace"),u.charset=i,t.endsWithAny(".htm",".html")?(u.close(),u.body.innerHTML="\r\n"+n+"\r\n"):(t.endsWithAny(".txt")||(t+=".txt"),u.write(n),u.close()),e=u.execCommand("SaveAs",null,t),r.close(),e)},function(){}(window.ct=window.ct||{}),function(n){n.showSupportDialog=function(){ct.ui.alert("Техническая поддержка",'1. <a href="http://cspp.vtb24.ru/ess/ess.do?ctx=docEngine&file=hpctplincidents&query=tpl.id%3D%2263839297913%22&action=&title=&queryHash=66446abb" target="_blank">Портал службы поддержки пользователей<\/a> <br />2. <a href="mailto:SPP3@vtb.ru?subject=Письмо в Техническую поддержку (iProc)">Письмо в Техническую поддержку (iProc)<\/a> <br />3. ЦСПП - тел.: <a href="tel:555555">55-55-55<\/a>')};n.wait5Sec=function(n){setTimeout(function(){waitingDialog.showWaiting()},500);setTimeout(function(){n&&typeof n=="function"?n():window.location.reload()},3500)};n.wait10Sec=function(n){setTimeout(function(){waitingDialog.showWaiting()},500);setTimeout(function(){n&&typeof n=="function"?n():window.location.reload()},8500)};n.wait15Sec=function(n){setTimeout(function(){waitingDialog.showWaiting()},500);setTimeout(function(){n&&typeof n=="function"?n():window.location.reload()},14500)};n.wait20Sec=function(n){setTimeout(function(){waitingDialog.showWaiting()},500);setTimeout(function(){n&&typeof n=="function"?n():window.location.reload()},20500)}}((window.ct=window.ct||{},window.ct.custom=window.ct.custom||{}));var ExtContractorManager=function(n,t,i){var r=function(){var u=$("#itemFormPanel-suppliers-body"),f=window.location,e=f.protocol+"//"+f.host,r;if(e+="/ExtContractor/GetFilteredContractor",r={orgName:u.find('[data-field-name="fullOrgName"]').val(),orgType:u.find('[dictionary-edit-name="TipUrLico"]').val(),isNoResident:u.find('[data-field-name="nerez"]:checked').length>0,isIndividEnterp:u.find('[data-field-name="ip"]:checked').length>0,code:u.find('[data-field-name="idNonres"]').val(),inn:u.find('[data-field-name="inn"]').val(),kpp:u.find('[data-field-name="kpp"]').val(),lastName:u.find('[data-field-name="lastName"]').val(),firstName:u.find('[data-field-name="firstName"]').val(),middleName:u.find('[data-field-name="middleName"]').val()},!r.orgType){Ext.Msg.alert("Ошибка","Выберите тип контрагента");return}if(r.orgType==="U"&&(!r.inn||!r.kpp)){Ext.Msg.alert("Ошибка","Необходимо указать ИНН и КПП");return}if(r.orgType==="U"&&(!r.inn||!r.kpp)||(r.orgType==="UF"||r.orgType==="PF")&&!r.orgName&&!r.code||r.orgType==="IP"&&!r.orgName&&!r.inn||r.orgType==="P"&&!r.inn&&!r.firstName&&!r.lastName&&!r.middleName){Ext.Msg.alert("Ошибка","Невозможно отправить пустой запрос");return}i.mask("Поиск в смежных системах");$.ajax({type:"POST",dataType:"json",url:e,data:r}).done(function(i){var f,o,e,u;$('.x-component.x-border-box.x-mask.x-component-default[id^="loadmask-"]').hide();n.clearData();t.view.refresh();i.data?(f=[],i.data.forEach(function(n){var t={id:n.Id,code:n.Id,"Наименование":n.Name,"ИНН":n.Inn,"КПП":n.Kpp,leaf:!0,enabled:!0,parentid:null,children:null,expanded:!1,source:n.Source};f.push(t)}),o=Ext.create("Ext.data.Store",{model:"Dictionary",data:f}),t.reconfigure(o),t.view.refresh()):(e="Произошла ошибка",u=i.error||i.responseMessage,u==="Внешние контрагенты не найдены"&&(e="Внешние контрагенты не найдены",u=r.orgType==="U"||r.orgType==="UF"||r.isIndividEnterp?"По указанным реквизитам в ПКБ контрагента не найдено":"Необходимо проверить параметры поискового запроса либо инициировать заведение нового контрагента через группу НСИ"),Ext.Msg.alert(e,u))}).always(function(){i.unmask()})},u=function(n,t,i,r,u,f,e,o,s){var l=t[0],a=window.location,p=a.protocol+"//"+a.host+"/ExtContractor/SaveContractor";var v=l.get("source"),h="",y=$("#itemFormPanel-suppliers-body"),c={orgType:y.find('[dictionary-edit-name="TipUrLico"]').val(),isIndividEnterp:y.find('[data-field-name="ip"]:checked').length>0};c.orgType==="P"||c.orgType==="PF"?h="1":(c.orgType==="U"||c.orgType==="UF"||c.isIndividEnterp)&&(h="2");v=="sap"?(h=h=="1"?"ФЛ":"ЮЛ",n=n.replace("SAP","")):c.isIndividEnterp&&(h="3");e();setTimeout(function(){waitingDialog.show("Добавление контрагента...");$.ajax({type:"POST",dataType:"json",url:p,data:{contractorId:n,contractorType:v,orgType:h,inn:r,name:u}}).done(function(n){if(n.data)if(i){var r=n.data;l.set("code",r);o();f(r).done(function(n){var u=JSON.parse(n.data),r=u.children[0];r["Код клиента в SAP"]==""&&Ext.Msg.show({title:"Внимание",msg:'Контрагент отсутствует в SAP УВХД.<br/>1. Оформите запрос на группу НСИ на добавление контрагента. Шаблон письма и печатной формы запроса доступны на карточке контрагента по кнопке "Запрос в НСИ".<br/>2. После добавления контрагента в SAP УВХД, убедитесь, что на карточке контрагента заполнено поле "Код SAP", после чего перевыберите контрагента на карточке документа.',width:700,closable:!1,buttons:Ext.Msg.YESCANCEL,buttonText:{yes:"Запрос в НСИ",cancel:"Вернуться к заполнению"},multiline:!1,fn:function(n){if(n=="yes"){var t=l.data.ИД_контрагента,i=window.location,r=i.protocol+"//"+i.host,u=r+"/ContextAction/HandleDocumentAction?uniqueIds="+t+"&actionName=%D0%97%D0%B0%D0%BF%D1%80%D0%BE%D1%81%20%D0%B2%20%D0%9D%D0%A1%D0%98&location=DocumentView&viewSourceType=SearchView&returnUrl="+encodeURIComponent(r)+"%2FSearch%2FDocumentView%2F"+t+"%3FsearchTemplateName%3DOrganizationsMenu%23regcard-view-tlcInfo";window.open(u,"_blank")}}});l.data=r;l.raw=r;i(t);waitingDialog.hide()}).fail(function(n){waitingDialog.hide();Ext.Msg.alert("Произошла ошибка при сохранении выбранного контрагента",n)})}else s();else s(),waitingDialog.hide(),Ext.Msg.alert("Произошла ошибка при сохранении выбранного контрагента",n.error||n.responseMessage)}).fail(function(n){s();waitingDialog.hide();Ext.Msg.alert("Произошла ошибка при сохранении выбранного контрагента",n)})},50)};return{findExternalContractor:r,saveChoosenContractor:u}},ExpertsManager=function(n,t){var i=function(n,t,i){var r=window.location,u=r.protocol+"//"+r.host;u+="/Expert/IsExpertForDoc";$.ajax({type:"GET",dataType:"json",url:u,data:{docId:n,userLogin:t}}).done(function(n){i(n)})},r=function(){var f=$("#itemFormPanel-expert-body"),r=f.find('[name="typedSearchField"]').val().trim(),u=window.location,i=u.protocol+"//"+u.host;if(!r){Ext.Msg.alert("Ошибка","Введите данные эксперта");return}n.storeId.indexOf("adrList")>-1?(i+="/Expert/GetFilteredExpertsLazy",i=i+"?filter="+encodeURIComponent(r),n.proxy.url=i,n.load()):(i+="/Expert/GetFilteredExperts",$.ajax({type:"POST",dataType:"json",url:i,data:{filter:r}}).done(function(i){if(n.clearData(),t.view.refresh(),i.data){var r=n.getRootNode(),u=r.childNodes;for(cs in u)r.removeChild(u[cs]);i.data.forEach(function(n){var t={id:n.VtbPersonNumber,key:n.VtbPersonNumber,name:n.FullName+" ("+n.DepartmentName+")",leaf:!0,enabled:!0,parentid:null,children:null,expanded:!1,selectable:"true"};r.appendChild(t)})}else Ext.Msg.alert("Произошла ошибка",i.error||i.responseMessage)}))},u=function(n,t,i){var r=$(".modal-title:visible").text(),e=t==="expert"||t==="performerName"&&(r==="Создать этап"||r==="Делегировать")||t==="performerNames"&&r==="Запрос дополнительного согласования"||t==="performerNames"&&r==="Создать этап",u,f;if(e){if(n.length!==1){Ext.Msg.alert("Произошла ошибка","Должен быть выбран только один эксперт");return}u=window.location;f=u.protocol+"//"+u.host;f+="/Expert/SaveExpert";waitingDialog.showWaiting(!0);$.ajax({type:"POST",dataType:"json",url:f,data:{vtbPersonNumber:n[0].key,curUserLogin:$(".header-menu-user-name").data("user-sid")}}).done(function(t){waitingDialog.hide();t.data?i&&(n[0].key=t.data,i()):Ext.Msg.alert("Произошла ошибка при сохранении выбранного контрагента",t.error||t.responseMessage)})}};return{findExpert:r,saveChoosenExpert:u,isExpert:i}},utils=function(){function t(){i()}function n(n){return n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function i(){RegExp.escape=n}return t(),{escapeRegExp:n}}();LawSwitcher=function(){function t(){return $("#lawSwitcher")}function i(){var n=t();return n.prop("checked")?n.attr("data-on"):n.attr("data-off")}function r(){return n()?!0:!1}function n(){var n=i();return typeof n!="undefined"&&n!=null?n.split("-")[1]:""}function u(){return n()==="44"}function f(){return n()==="223"}function e(){function u(){var r=window.location.protocol+"//"+window.location.host,u=window.location.pathname.split("/"),n,t,i;if(u.length>1){n="/";t=u[1];switch(t){case"Administration":case"Reports":case"Performer":case"Control":n+=t;break;case"Search":n+="Search/Search";i=getQueryStringParameterByName("searchTemplateName",window.location.search);i&&(n+="?searchTemplateName="+i)}return r+n}return r+window.location.pathname}waitingDialog.showWaiting();var i=t().attr("data-action"),r=n();$.ajax({url:i,type:"POST",dataType:"json",cache:!1,"async":!0,data:{law:r},success:function(n){var t=n.data;t&&t.Success&&(window.location=u())},error:function(){waitingDialog.hide()}})}return{Enabled:r,GetLaw:n,Is44Law:u,Is223Law:f,Toggle:e}}();NotificationService=function(n){"use strict";function t(){var t=this;t.base=n("base").attr("href");t.Base==="/"&&(t.base="")}return t.prototype.GetCount=function(t,i){var u=this,r=n.Deferred();return n.ajax({type:"get",url:getRelativeUrl("Notification/Count"),cache:!1,data:{readed:t,useMaxCount:i},error:function(n){r.reject(n)},success:function(n){r.resolve(n)}}),r.promise()},t.prototype.CountToText=function(n){return n<1?"":n>99?"99+":n},t.prototype.CountToClass=function(n){return n<1?"empty":n<10?"small":n<100?"middle":"large"},t.prototype.AllClasses=function(){return"empty small middle large"},t.prototype.ShowCount=function(){var n=this;n.GetCount(!1,!0).then(function(t){n.ShowEnvelopeCount(t)})},t.prototype.ShowEnvelopeCount=function(t){var i=this,r=parseInt(t),u=i.CountToClass(r),f=n("#notifications-item"),e=f.attr("class");e.indexOf(u)===-1&&f.removeClass(i.AllClasses()).addClass(u);n("#notifications-badge").text(i.CountToText(r))},t}($);