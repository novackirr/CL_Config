<?xml version="1.0" encoding="utf-8" ?>
<Hooks>
	<Flow name="Бюджеты">
		<FieldsModify>
		</FieldsModify>

		<OnDocumentCreated transaction="single">
			<Aggregation>
				<Select>
					<Select searchString="document[
                doc_RegCard/rc_FlowName = 'Бюджеты' and
                doc_RegCard/rc_Index/text_Организация_заказчик_наименование = '{currentDocField=|Document|Организация_заказчик|Организация_заказчик_наименование}'
                ]" tag="Бюджеты" />
				</Select>
				<Actions>
					<DocsCountCheck sourceTag="Бюджеты" operation="notEmpty" message="Для данной организации Бюджеты уже зарегистрированы" />
				</Actions>
			</Aggregation>
		</OnDocumentCreated>
		<OnRegcardEdited transaction="single"> 
			<Aggregation>
				<Select>

					<Select searchString="document[
					 doc_Id  != {current_Id} and
                doc_RegCard/rc_FlowName = 'Бюджеты' and
                doc_RegCard/rc_Index/text_Организация_заказчик_наименование = '{currentDocField=|Document|Организация_заказчик|Организация_заказчик_наименование}'
                ]" tag="Бюджеты" />
				
				<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and doc_RegCard/rc_Index/text_Организация_заказчик_наименование='{currentDocField=|Document|Организация_заказчик|Организация_заказчик_наименование}']" tag="ППЗОстатка" /> 
				
				</Select>
				<Actions>
					<DocsCountCheck sourceTag="Бюджеты" operation="notEmpty" message="Для данной организации Бюджеты уже зарегистрированы" />
					<TableFieldOperations sourceTag="{current}" targetTag="ППЗОстатка" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_бюджетные_средства}" >

						<SourceTable tableName="|Document|Бюджеты">
							<Column name="Остаток_бюджета"  />
							<Column name="Год_финансирования_бюджета"  />
							<Column name="КБК_бюджетные_средства"  />
							<Column name="Сумма_лимита_бюджета"  />
						</SourceTable>
						<Action column="Остаток_бюджета" formula="$NullToZero({sourceTableColumn=Остаток_бюджета})"/>
						<Action column="Сумма_лимита_бюджета" formula="$NullToZero({sourceTableColumn=Сумма_лимита_бюджета})"/>
						<Action column="Остаток_для_карточки" formula="$NullToZero({sourceTableColumn=Остаток_бюджета}) + $NullToZero({Финансирование})"/>
					</TableFieldOperations>  	
				</Actions>
			</Aggregation>
		</OnRegcardEdited>
	</Flow>
	<Flow name="Заявки на закупку">
		<LinksModify>
			<LinkCurrentDoc />
		</LinksModify>
		<OnRegcardEdited transaction="single"> 
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции" /> 
				</Select>
				<Actions>  
					<Sum sourceFlow="Позиции" targetFlow="{current}" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|Сумма_выплат_всего" />  
					<CopyField sourceFlow="{current}" targetFlow="Позиции" sourceField="%key%" targetField="|Document|ИД_заявки" />      
				</Actions>
			</Aggregation>
		</OnRegcardEdited>
		<OnLinkAdded>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Заявки на закупку" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Заявки на закупку}/doc_Id]]" tag="Позиции" />
				</Select>
				<Actions>
					<Sum sourceFlow="Позиции" targetFlow="{current}" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|Сумма_выплат_всего" />
				</Actions>
			</Aggregation>
		</OnLinkAdded>
		<OnLinkDeleted>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Заявки на закупку" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Заявки на закупку}/doc_Id]]" tag="Позиции" />
				</Select>
				<Actions>
					<Sum sourceFlow="Позиции" targetFlow="Заявки на закупку" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|Сумма_выплат_всего" />
				</Actions>
			</Aggregation>
		</OnLinkDeleted>
	</Flow>
	<Flow name="Позиции">
		<LinksModify>
			<LinkCurrentDoc />
		</LinksModify>
		<FieldsModify>  
			<CopyField src="|Document|Остаток_в_ППЗ"   /> 
			<CopyField src="|Document|КВР" /> 
			<CopyField src="|Document|Значение_КВР_неопределено"  />
			<CopyField src="|Document|КВР_наименование"  />
			<CopyField src="%key%" dst="|Document|ИД_позиции_ПГ" />
			<CopyField src="|Document|Используется_КТРУ"   /> 
			<CopyField src="|Document|КТРУ"   /> 
			<CopyField src="|Document|КТРУ_наименование"   /> 
			<CopyField src="|Document|ОКПД2"   /> 
			<CopyField src="|Document|ОКПД2_наименование"   /> 
			<CopyField src="|Document|Содержит_несколько_позиций_ОКПДКТРУ"   /> 
			<CopyField src="|Document|КТРУ_наименование" dst="|Document|Наименование_позиции" /> 
			<CopyField src="|Document|Планируемый_год_размещения" dst="|Document|Год_финансирования" /> 
			<CopyField src="|Document|Остаток_для_позиций" dst="|Document|Остаток_в_ППГ" /> 
			<CopyField src="|Document|Остаток_для_позиций" dst="|Document|Остаток_для_Позиции" /> 
			<CopyField src="|Document|Лекарственный_препарат" />
		</FieldsModify>  
	<!-- 	<OnDocumentCreated transaction="split">
		
			<ConditionalActions>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' and xn-in(doc_Id, {currentDocLinkList})]" tag="Контракты" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Контракты}/doc_Id]]" tag="Позиции" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана-графика" /> 
				</Select>
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldsNotEquals tag="Контракты" path="|Document|Позиции_не_учитывать" value="0"/> 
								<WhenFieldsNotEquals tag="Позиции плана-графика" path="|Document|ИД_позиции_ПГ" value=""/>  
							</And>
						</Conditions>
						<Actions>
							<SetField targetFlow="{current}" targetField="|Document|Статус" value="Позиция контракта" /> 
							<CopyField sourceFlow="Контракты" targetFlow="{current}" sourceField ="%key%" targetField="|Document|ИД_контракта"/> 
							<Sum sourceFlow="Позиции" targetFlow="Контракты" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|Цена_контракта" /> 
						</Actions>
					</ConditionalAction>
				</Actions>
			</ConditionalActions>    
		</OnDocumentCreated > -->
		<OnDocumentCreated transaction="single">
		<ConditionalActions>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' and xn-in(doc_Id, {currentDocLinkList})]" tag="Контракты" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Контракты}/doc_Id]]" tag="Позиции" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана-графика" /> 
				</Select>
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldsNotEquals tag="Контракты" path="|Document|Позиции_не_учитывать" value="0"/> 
								<WhenFieldsNotEquals tag="Позиции плана-графика" path="|Document|ИД_позиции_ПГ" value=""/>  
							</And>
						</Conditions>
						<Actions>
							<SetField targetFlow="{current}" targetField="|Document|Статус" value="Позиция контракта" /> 
							<CopyField sourceFlow="Контракты" targetFlow="{current}" sourceField ="%key%" targetField="|Document|ИД_контракта"/> 
							<Sum sourceFlow="Позиции" targetFlow="Контракты" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|Цена_контракта" /> 
						</Actions>
					</ConditionalAction>
				</Actions>
			</ConditionalActions>    

			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана-графика" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' and xn-in(doc_Id, {currentDocLinkList})]" tag="Контракты" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки на закупку' and xn-in(doc_Id, {currentDocLinkList})]" tag="Заявки на закупку" /> 
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана-графика}/doc_Id]]" tag="Позиции" />
					<Select tag="Все позиции" joinTags="Позиции,{current}" />  
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана-графика}/doc_Id]]" tag="Позиции плана закупок2" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана закупок2}/doc_Id]]" tag="Позиции плана-графика1" /> 

					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана-графика1}/doc_Id]]" tag="Позиции всех ППГ" />
					<Select tag="Все позиции ППЗ" joinTags="Позиции всех ППГ,{current}" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок" /> 
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Нормирование цен' and doc_RegCard/rc_Index/text_КТРУ = '{currentDocField=|Document|КТРУ}' and doc_RegCard/rc_Index/text_ОКЕИ = '{currentDocField=|Document|ОКЕИ}']" tag="нормирование" />  
				</Select>

				<Actions>  
					<CopyField sourceFlow="Контракты" targetFlow="{current}" sourceField ="%key%" targetField="|Document|ИД_контракта"/>
					<Sum sourceFlow="Все позиции" targetFlow="Контракты" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|Цена_контракта" />
					<CopyField sourceFlow="Позиции плана-графика" targetFlow="{current}" sourceField="%key%" targetField="|Document|ИД_позиции_ПГ" />    
					<Sum sourceFlow="Все позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|НМЦК" /> 
					<!--  <Sum sourceFlow="Все позиции" targetFlow="Позиции плана закупок2" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|Сумма_строк_ПГ" />  --> 

					 <!-- confluence - https://cgnjira.cognitive.ru:8444/pages/viewpage.action?pageId=44532561-->

					<RationingCheck rationingDocsTag="нормирование" condition="LessOrEqual" message="Средняя цена за единицу должна быть меньше {rationing} руб.">
						<CurrentDocument field="|Document|Средняя_цена_за_единицу" orgKey="|Document|Организация_заказчик|Организация_заказчик"/>
						<RationingDocument field="|Document|Средняя_цена_за_единицу" orgKey="|Document|Организация_заказчик|Организация_заказчик"/>
						<RationingTable name="|Document|Нормирование_для_подведомственных"  orgKeyColumn="|Организация_нормирования|Организация_нормирования"  valueColumn="|Средняя_цена_нормирования"/>
						<RootOrganization name="КОНТРАКТНОЕ АГЕНТСТВО АРХАНГЕЛЬСКОЙ ОБЛАСТИ"/>
					</RationingCheck> 
					 
					<!--проверка на непревышения суммы Позиций в рамках суммы всего ППГ--> 
					<VerifyExpression>
						<Variables>
							<Variable name="СуммаППГ" source="Позиции плана-графика" path="|Document|Сумма_всего"  />
							<Variable name="НМЦКППГ" source="Позиции плана-графика" path="|Document|НМЦК"  />
						</Variables>
						<Expression value="$NullToZero({НМЦКППГ})  &lt;= $NullToZero({СуммаППГ})"/>
						
						<FailtureText value="НМЦК превышает допустимую сумму в рамках ППГ"/>
					</VerifyExpression>
					
					
					
					<!-- обновление остатка ППЗ -->
					<CalculateExpression targetFlow="Позиции плана-графика1" targetField="|Document|Остаток_в_ППЗ"> 
						<Variables>
							<Variable name="СуммаППЗ" source="Позиции плана закупок2" path="|Document|Сумма_всего"  />
							<Variable name="Сумма_всего" source="Позиции плана-графика1" path="|Document|Сумма_всего" aggregation="sum" />
						
						</Variables>
						<Expression value="$NullToZero({СуммаППЗ}) - $NullToZero({Сумма_всего})"/>
					</CalculateExpression>
					
					<!-- обновление остатка ППГ -->	
					<CalculateExpression targetFlow="Все позиции" targetField="|Document|Остаток_в_ППГ"> 
						<Variables>
							<Variable name="СуммаППГ" source="Позиции плана-графика" path="|Document|Сумма_всего"  />
							<Variable name="СуммаПозиции" source="Все позиции" path="|Document|Сумма_выплат_всего" aggregation="sum" />
						</Variables>
						<Expression value="$NullToZero({СуммаППГ}) - $NullToZero({СуммаПозиции}) "/>
					</CalculateExpression>
					<SetField targetFlow="Все позиции" targetField="|Document|Остаток_для_Позиции" value="{{|Document|Остаток_в_ППГ}+{|Document|Сумма_выплат_всего}}" />	
					
					<CopyField sourceFlow="Все позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Остаток_в_ППГ" targetField="|Document|Остаток_для_позиций" />
					<Sum sourceFlow="Все позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_текущего_года" targetField="|Document|Количество_текущий_год" />
					<Sum sourceFlow="Все позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_первого_планового_года" targetField="|Document|Количество_первый_плановый_год" />
					<Sum sourceFlow="Все позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_второго_планового_года" targetField="|Document|Количество_второй_плановый_год" />
					<Sum sourceFlow="Все позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_последующих_годов" targetField="|Document|Количество_последующие_годы" />
					<Sum sourceFlow="Все позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_всего" targetField="|Document|Количество" />																			  				
					<CopyField sourceFlow="Позиции плана-графика1" targetFlow="Все позиции ППЗ" sourceField="|Document|Остаток_в_ППЗ" targetField="|Document|Остаток_в_ППЗ" />
					<Sum sourceFlow="Позиции плана-графика1" targetFlow="Позиции плана закупок2" sourceField="|Document|Сумма_всего" targetField="|Document|Сумма_строк_ПГ" /> 
				</Actions>
			</Aggregation>
		</OnDocumentCreated>   

		<OnRegcardEdited transaction="single">
			<ConditionalActions>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' and xn-in(doc_Id, {currentDocLinkList})]" tag="Контракты" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Контракты}/doc_Id]]" tag="Позиции" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки на закупку' and xn-in(doc_Id, {currentDocLinkList})]" tag="Заявки на закупку" /> 
					<Select tag="Все позиции" joinTags="Позиции,{current}" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' and doc_Links/doc_Link/link_Document='{current_Id}']" tag="Итог" />

				</Select>
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldsNotEquals tag="Контракты" path="|Document|Позиции_не_учитывать" value="0"/> 
								<WhenFieldsNotEquals tag="Заявки на закупку" path="|Document|ИД_заявки" value=""/>  
							</And>
						</Conditions>
						<Actions>

							<Sum sourceFlow="Позиции" targetFlow="Итог" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|Цена_контракта" /> 
						</Actions>
					</ConditionalAction>
						<!-- <ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldsNotEquals tag="Позиции" path="|Document|Статус" value="Позиция контракта"/> 
							</And>
						</Conditions>
						<Actions>

					<VerifyExpression>
						<Variables>
							<Variable name="СуммаППГ" source="Позиции плана-графика" path="|Document|Сумма_всего"  />
							<Variable name="НМЦКППГ" source="Позиции плана-графика" path="|Document|НМЦК"  />
							<Variable name="СуммаПозицииТек" source="{current}" path="|Document|Сумма_выплат_всего"  />
							<Variable name="СуммаПозицииСтарый" source="{oldCurrent}" path="|Document|Сумма_выплат_всего"  /> 
							
						</Variables>
						<Expression value="($NullToZero({НМЦКППГ}) - $NullToZero({СуммаПозицииСтарый}) + $NullToZero({СуммаПозицииТек}) &lt;= $NullToZero({СуммаППГ}))"/>
						<FailtureText value="НМЦК превышает допустимую сумму в рамках ППГ"/>
					</VerifyExpression> 
					
						</Actions>
					</ConditionalAction> -->
				</Actions>
			</ConditionalActions>   
			<Aggregation>

				<Select>

					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки на закупку' and doc_Links/doc_Link/link_Document='{current_Id}']" tag="Заявки на закупку"/>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана-графика" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана-графика}/doc_Id]]" tag="Позиции" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты'  and doc_Links/doc_Link/link_Document='{current_Id}']"  tag="Контракты" />

					<Select tag="Все позиции" joinTags="Позиции,{current}" />

					<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' and doc_Links/doc_Link/link_Document='{current_Id}']" tag="Итог" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана-графика}/doc_Id]]" tag="Позиции плана закупок2" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана закупок2}/doc_Id]]" tag="Позиции плана-графика1" />

					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана-графика1}/doc_Id]]" tag="Позиции всех ППГ" />
					<Select tag="Все позиции ППЗ" joinTags="Позиции всех ППГ,{current}" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Нормирование цен' and doc_RegCard/rc_Index/text_КТРУ = '{currentDocField=|Document|КТРУ}']" tag="нормирование" /> 
					
 			

				</Select>
				<Actions>
					<Sum sourceFlow="Все позиции" targetFlow="Итог" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|Цена_контракта" />
					
					
					 <!-- confluence - https://cgnjira.cognitive.ru:8444/pages/viewpage.action?pageId=44532561-->
					<RationingCheck rationingDocsTag="нормирование" condition="LessOrEqual" message="Средняя цена за единицу должна быть меньше {rationing} руб.">
						<CurrentDocument field="|Document|Средняя_цена_за_единицу" orgKey="|Document|Организация_заказчик|Организация_заказчик"/>
						<RationingDocument field="|Document|Средняя_цена_за_единицу" orgKey="|Document|Организация_заказчик|Организация_заказчик"/>
						<RationingTable name="|Document|Нормирование_для_подведомственных"  orgKeyColumn="|Организация_нормирования|Организация_нормирования"  valueColumn="|Средняя_цена_нормирования"/>
						<RootOrganization name="КОНТРАКТНОЕ АГЕНТСТВО АРХАНГЕЛЬСКОЙ ОБЛАСТИ"/>
					</RationingCheck> 
				<!--проверка на непревышения суммы Позиций в рамках суммы всего ППГ--> 	
					<VerifyExpression>
						<Variables>
							<Variable name="СуммаППГ" source="Позиции плана-графика" path="|Document|Сумма_всего"  />
							<Variable name="НМЦКППГ" source="Позиции плана-графика" path="|Document|НМЦК"  />
							<Variable name="СуммаПозицииТек" source="{current}" path="|Document|Сумма_выплат_всего"  />
							<Variable name="СуммаПозицииСтарый" source="{oldCurrent}" path="|Document|Сумма_выплат_всего"  /> 
						</Variables>
						<Expression value="$NullToZero({НМЦКППГ}) - $NullToZero({СуммаПозицииСтарый}) + $NullToZero({СуммаПозицииТек}) &lt;= $NullToZero({СуммаППГ})"/>
						<FailtureText value="НМЦК превышает допустимую сумму в рамках ППГ"/>
					</VerifyExpression>  
				
					<!-- обновление остатка ППЗ 
					<CalculateExpression targetFlow="Позиции плана-графика1" targetField="|Document|Остаток_в_ППЗ"> 
						<Variables>
							<Variable name="СуммаППЗ" source="Позиции плана закупок2" path="|Document|Сумма_всего"  />
							<Variable name="Сумма_всего" source="Позиции плана-графика1" path="|Document|Сумма_всего" aggregation="sum" />
							<Variable name="СуммаПозицийППГтек" source="{current}" path="|Document|Сумма_выплат_всего"  />
							<Variable name="СуммаПозицийППГстарый" source="{oldCurrent}" path="|Document|Сумма_выплат_всего"  /> 
						</Variables>
						<Expression value="$NullToZero({СуммаППЗ})-($NullToZero({Сумма_всего}) -$NullToZero({СуммаПозицийППГстарый}) + $NullToZero({СуммаПозицийППГтек}))"/>
					</CalculateExpression>-->
					
						<CalculateExpression targetFlow="Все позиции" targetField="|Document|Остаток_в_ППГ"> 
						<Variables>
							<Variable name="СуммаППГ" source="Позиции плана-графика" path="|Document|Сумма_всего"  />
						  	<Variable name="СуммаПозиции" source="Все позиции" path="|Document|Сумма_выплат_всего" aggregation="sum"  />  
							<Variable name="СуммаПозицийППГтек" source="{current}" path="|Document|Сумма_выплат_всего"  />
						</Variables>
						<Expression value="$NullToZero({СуммаППГ}) - $NullToZero({СуммаПозиции})  + $NullToZero({СуммаПозицийППГтек})"/>
					</CalculateExpression>
						<SetField targetFlow="Все позиции" targetField="|Document|Остаток_для_Позиции" value="{{|Document|Остаток_в_ППГ}+{|Document|Сумма_выплат_всего}}" />	
					
					<!-- Пересчет НМЦК при редактировании суммы в позициях -->
					<CalculateExpression targetFlow="Позиции плана-графика" targetField="|Document|НМЦК"> 
						<Variables>
							<Variable name="НМЦКППГ" source="Позиции" path="|Document|Сумма_выплат_всего" aggregation="sum"   />
							<Variable name="СуммаПозицийППГстарый" source="{oldCurrent}" path="|Document|Сумма_выплат_всего"  /> 
							</Variables>
						<Expression value="$NullToZero({НМЦКППГ}) - $NullToZero({СуммаПозицийППГстарый}) + $NullToZero({СуммаПозицийППГстарый})"/>
					</CalculateExpression>
					
					<CopyField sourceFlow="Все позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Остаток_в_ППГ" targetField="|Document|Остаток_для_позиций" />
				 	<CopyField sourceFlow="Позиции плана-графика1" targetFlow="Все позиции ППЗ" sourceField="|Document|Остаток_в_ППЗ" targetField="|Document|Остаток_в_ППЗ" /> 
				<Sum sourceFlow="Позиции плана-графика1" targetFlow="Позиции плана закупок2" sourceField="|Document|Сумма_всего" targetField="|Document|Сумма_строк_ПГ" /> 
				</Actions>
			</Aggregation>
		</OnRegcardEdited>   
	<OnLinkDeleted>
			<Aggregation>
				<Select>
					
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки на закупку' and doc_Links/doc_Link/link_Document='{current_Id}']" tag="Заявки на закупку"/>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана-графика" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана-графика}/doc_Id]]" tag="Позиции" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты'  and doc_Links/doc_Link/link_Document='{current_Id}']"  tag="Контракты" />

					<Select tag="Все позиции" joinTags="Позиции,{current}" />

					<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' and doc_Links/doc_Link/link_Document='{current_Id}']" tag="Итог" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана-графика}/doc_Id]]" tag="Позиции плана закупок2" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана закупок2}/doc_Id]]" tag="Позиции плана-графика1" />

					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана-графика1}/doc_Id]]" tag="Позиции всех ППГ" />
					<Select tag="Все позиции ППЗ" joinTags="Позиции всех ППГ,{current}" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Нормирование цен' and doc_RegCard/rc_Index/text_КТРУ = '{currentDocField=|Document|КТРУ}']" tag="нормирование" /> 
				</Select>
				<Actions>
					<!-- обновление остатка ППЗ 
					<CalculateExpression targetFlow="Позиции плана-графика1" targetField="|Document|Остаток_в_ППЗ"> 
						<Variables>
							<Variable name="СуммаППЗ" source="Позиции плана закупок2" path="|Document|Сумма_всего"  />
							<Variable name="НМЦКППГ" source="Позиции плана-графика1" path="|Document|НМЦК" aggregation="sum" />
							<Variable name="СуммаПозицийППГтек" source="{current}" path="|Document|Сумма_выплат_всего"  />
							<Variable name="СуммаПозицийППГстарый" source="{oldCurrent}" path="|Document|Сумма_выплат_всего"  /> 
						</Variables>
						<Expression value="$NullToZero({СуммаППЗ})-($NullToZero({НМЦКППГ}) -$NullToZero({СуммаПозицийППГстарый}) + $NullToZero({СуммаПозицийППГтек}))"/>
					</CalculateExpression>-->
					
					
					<CalculateExpression targetFlow="Все позиции" targetField="|Document|Остаток_в_ППГ"> 
						<Variables>
							<Variable name="СуммаППГ" source="Позиции плана-графика" path="|Document|Сумма_всего"  />
							<Variable name="СуммаПозиции" source="Все позиции" path="|Document|Сумма_выплат_всего" aggregation="sum" />
						</Variables>
						<Expression value="$NullToZero({СуммаППГ})-$NullToZero({СуммаПозиции})"/>
					</CalculateExpression>
					
					<CopyField sourceFlow="Все позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Остаток_в_ППГ" targetField="|Document|Остаток_для_позиций" />
				</Actions>
			</Aggregation>
		</OnLinkDeleted> 
</Flow>
	<Flow name="Позиции плана закупок">
		<LinksModify>
			<LinkCurrentDoc />
			<LinkAllLinksWhereFlow name="Позиции плана-графика" />
			<LinkAllLinksWhereFlow name="Позиции плана закупок" />
		</LinksModify>
		<FieldsModify> 
			 <SetField  src="|Document|Статус" value="Согласована" />
		</FieldsModify>
		 <FieldsModify source="Позиции плана закупок"> 
		 	<CopyField src="|Document|Наименование_объекта_закупки"   /> 
			<CopyField src="|Document|Планируемый_год_размещения"  /> 
			<CopyField src="|Document|Периодичность_закупки"   />
			<CopyField src="|Document|Периодичность_закупки_код"   />
			<CopyField src="|Document|Дата_начала_закупки"  />
			<CopyField src="|Document|Дата_окончания_закупки"  />
			<CopyField src="|Document|Периодичность_закупки_описание"   />
			<CopyField src="|Document|КВР"  /> 
			<CopyField src="|Document|Значение_КВР_неопределено"  />
			<CopyField src="|Document|КВР_наименование"  />
			<CopyField src="|Document|ОКПД2"  />
			<CopyField src="|Document|ОКПД2_наименование"  />
			<CopyField src="|Document|Содержит_несколько_ОКПД2" />
			<CopyField src="|Document|Используется_КТРУ"   /> 
			<CopyField src="|Document|КТРУ"   /> 
			<CopyField src="|Document|КТРУ_наименование"   /> 
			<CopyField src="|Document|Содержит_несколько_позиций_ОКПДКТРУ"   /> 
			<CopyTable src="|Document|Позиции_КТРУ" />
			<CopyField src="|Document|Техническая_сложность"  />
			<CopyField src="|Document|Дополнительные_сведения"  />
			<CopyField src="|Document|Тип_особой_закупки_код"  />
			<CopyField src="|Document|Тип_особой_закупки"  />
			<CopyField src="|Document|Общественное_обсуждение"   /> 
			<CopyField src="|Document|Без_разбивки_по_КБК"  />
			<CopyField src="|Document|Валюта"  />
			<CopyField src="|Document|Код_валюты"  />
			<CopyField src="|Document|Программа_планирования_код"  /> 
			<CopyField src="|Document|Программа_планирования"  /> 
			<CopyField src="|Document|Мероприятие_планирования_код"  /> 
			<CopyField src="|Document|Мероприятие_планирования"  /> 
			<CopyField src="|Document|Ожидаемый_результат"  />
			<CopyField src="|Document|Привлечение_сторонней_организации"  />
			<CopyField src="|Document|Обоснование_привлечения"  />
			<CopyField src="|Document|Обоснование_соответствия_объекта"  />
			<CopyField src="|Document|Нормативные_правовые_акты_отсутствуют"  />
			<CopyField src="|Document|Присутствует_в_РПНЗ"  />
			<CopyTable src="|Document|НПА" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование"   />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ИНН" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_КПП"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Адрес"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Телефон"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Электронная_почта"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Код_в_ЕИС"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СПЗ"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СР"   />
			<CopyField src="|Document|Организация_заказчик|ОКТМО"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКОПФ"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКТМОППО"   />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Дата_постановки_на_учет"  />
			

		</FieldsModify> 

	

		<OnDocumentCreated transaction="single">
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции" />
						<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок10" />
					<Select searchString="document[
					doc_Id != {current_Id} and
				doc_RegCard/rc_FlowName = 'Позиции плана закупок' and
                doc_RegCard/rc_Index/text_Тип_особой_закупки_код = '{currentDocField=|Document|Тип_особой_закупки_код}' and
                doc_RegCard/rc_Index/text_КВР = '{currentDocField=|Document|КВР}' and
                doc_RegCard/rc_Index/integer_Планируемый_год_размещения = {currentDocField=|Document|Планируемый_год_размещения} and doc_RegCard/rc_Index/text_Организация_заказчик_наименование='{currentDocField=|Document|Организация_заказчик|Организация_заказчик_наименование}'
                ]" tag="ППЗ" />
				<Select searchString="document[doc_RegCard/rc_FlowName = 'Бюджеты' and doc_RegCard/rc_Index/text_Организация_заказчик_наименование='{currentDocField=|Document|Организация_заказчик|Организация_заказчик_наименование}']" tag="Бюджеты" /> 
				<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and doc_RegCard/rc_Index/text_Организация_заказчик_наименование='{currentDocField=|Document|Организация_заказчик|Организация_заказчик_наименование}']" tag="ППЗОстатка" /> 
					
				<Select tag="Все позиции ППЗ" joinTags="ППЗОстатка,{current}" />
				</Select>
				<Actions>  
					<DocsCountCheck sourceTag="ППЗ" operation="notEmpty" message="Тип особой закупки: {|Document|Тип_особой_закупки}  для {|Document|Планируемый_год_размещения} года размещения с указанным КВР: {|Document|КВР} уже существует" />


					<TableFieldOperations sourceTag="{current}" targetTag="Бюджеты" targetTable="|Document|Бюджеты" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_бюджетные_средства}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Запланировано" formula="$NullToZero({Запланировано})+$NullToZero({sourceTableColumn=Финансирование})"/>
						<Action column="Остаток_бюджета" formula="$NullToZero({Сумма_лимита_бюджета})- $NullToZero({Запланировано})"/> 
					</TableFieldOperations>
					
						<TableRowsCountCheck sourceTag="{current}" tableName="|Document|Позиции_КТРУ" operation="less" value="2" 
						ifCheckedAttrs="|Document|Содержит_несколько_позиций_ОКПДКТРУ"
						message="В таблице ОКПД2/КТРУ необходимо ввести минимум две строки." />
						
					<TableFieldOperations sourceTag="Бюджеты" targetTag="Все позиции ППЗ" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_бюджетные_средства}" >

						<SourceTable tableName="|Document|Бюджеты">
							<Column name="Остаток_бюджета"  />
							<Column name="Год_финансирования_бюджета"  />
							<Column name="КБК_бюджетные_средства"  />
							<Column name="Сумма_лимита_бюджета"  />
						</SourceTable>
						<Action column="Остаток_бюджета" formula="{sourceTableColumn=Остаток_бюджета}"/>
						
					</TableFieldOperations>  	
								
					<TableFieldOperations sourceTag="Бюджеты" targetTag="Все позиции ППЗ" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_бюджетные_средства}" >
						<SourceTable tableName="|Document|Бюджеты">
							<Column name="Остаток_бюджета"  />
							<Column name="Год_финансирования_бюджета"  />
							<Column name="КБК_бюджетные_средства"  />
										
						</SourceTable>
						<Action column="Остаток_для_карточки" formula="$NullToZero({sourceTableColumn=Остаток_бюджета})+ $NullToZero({Финансирование})"/>
					</TableFieldOperations>  


					
<!-- сравнивем суммы всего и сумму по финансированию-->					
				<!-- 	<VerifyExpression>
						<Variables>
							<Variable name="Суммавсего" source="{current}" path="|Document|Сумма_всего"  />
							<Variable name="Суммавсегофинансирования" source="{current}" path="|Document|Сумма_всего_финансирование" />
						</Variables>
						<Expression value="iif({Суммавсего}=null,Decimal?(0),{Суммавсего})  == iif({Суммавсегофинансирования}=null,Decimal?(0),{Суммавсегофинансирования})"/>
						<FailtureText value= "Сумма выплат не совпадает с суммой финансирования"/>
					</VerifyExpression>
 -->
				<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Источники_финансирования" checkFormula="{Финансирование}=0" checkMessage="Укажите Сумму финансирования" > </TableFieldOperations>
				</Actions>
			</Aggregation>
			<NamedConstants>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Номер_закупки_в_ПЗ_порядковый"/>
					<Setting key="CounterNameFormat" value="({|Document|Планируемый_год_размещения}/{|Document|Организация_заказчик|Организация_заказчик})"/>
				</Constant>
			</NamedConstants>
			<ConditionalActions>
				<Select>

					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции" />
				</Select>
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldsEquals tag="{current}" path="|Document|ИКЗ" />
							</And>
						</Conditions>
						<Actions>
							<SetIKZPPZ targetFlow="{current}" targetField="|Document|ИКЗ" />
							<CopyField sourceFlow="{current}" targetFlow="Позиции" sourceField="|Document|ИКЗ" targetField="|Document|ИКЗ" />  
						</Actions>
					</ConditionalAction>
				</Actions>
			</ConditionalActions>

		</OnDocumentCreated> 
		<OnRegcardEdited transaction="single"> 
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции" />
					<Select searchString="document[
					doc_Id != {current_Id} and
				doc_RegCard/rc_FlowName = 'Позиции плана закупок' and
                doc_RegCard/rc_Index/text_Тип_особой_закупки_код = '{currentDocField=|Document|Тип_особой_закупки_код}' and
                doc_RegCard/rc_Index/text_КВР = '{currentDocField=|Document|КВР}' and
                doc_RegCard/rc_Index/integer_Планируемый_год_размещения = {currentDocField=|Document|Планируемый_год_размещения} and doc_RegCard/rc_Index/text_Организация_заказчик_наименование='{currentDocField=|Document|Организация_заказчик|Организация_заказчик_наименование}'
                ]" tag="ППЗ" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Бюджеты' and doc_RegCard/rc_Index/text_Организация_заказчик_наименование='{currentDocField=|Document|Организация_заказчик|Организация_заказчик_наименование}']" tag="Бюджеты" /> 
					
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and doc_RegCard/rc_Index/text_Организация_заказчик_наименование='{currentDocField=|Document|Организация_заказчик|Организация_заказчик_наименование}']" tag="ППЗОстатка" /> 
					
						<Select tag="Все позиции ППЗ" joinTags="ППЗОстатка,{current}" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана-графика" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'План закупок' and
                (doc_RegCard/rc_Index/text_Статус != 'Отправлено в ЕИС' or doc_RegCard/rc_Index/text_Статус != 'Неактуален') and xn-in(doc_Id, {currentDocLinkList})]" tag="ПЗ"/>
				</Select>
				<Actions>
					<DocsCountCheck sourceTag="ППЗ" operation="notEmpty" message="Тип особой закупки: {|Document|Тип_особой_закупки}  для {|Document|Планируемый_год_размещения} года размещения с указанным КВР: {|Document|КВР} уже существует" />				
					<CopyField sourceFlow="{current}" targetFlow="Позиции" sourceField="|Document|Тип_особой_закупки" targetField="|Document|Тип_особой_закупки" /> 
					<CopyField sourceFlow="{current}" targetFlow="Позиции" sourceField="|Document|Тип_особой_закупки_код" targetField="|Document|Тип_особой_закупки_код" /> 
					<SetIKZPPZ targetFlow="{current}" targetField="|Document|ИКЗ" />
					<CopyField sourceFlow="{current}" targetFlow="Позиции" sourceField="|Document|ИКЗ" targetField="|Document|ИКЗ" />  
					<CopyField sourceFlow="{current}" targetFlow="Позиции" sourceField="|Document|Периодичность_закупки" targetField="|Document|Периодичность_закупки" /> 
					<CopyField sourceFlow="{current}" targetFlow="Позиции" sourceField="|Document|Периодичность_закупки_код" targetField="|Document|Периодичность_закупки_код" /> 

					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="Бюджеты" targetTable="|Document|Бюджеты" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_бюджетные_средства}={sourceTableColumn=КБК_по_статье_расхода}">

						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Запланировано" formula="$NullToZero({Запланировано})-$NullToZero({sourceTableColumn=Финансирование})"/>
						<Action column="Остаток_бюджета" formula="$NullToZero({Сумма_лимита_бюджета})-$NullToZero({Запланировано})"/>  
					</TableFieldOperations>
					<TableRowsCountCheck sourceTag="{current}" tableName="|Document|Позиции_КТРУ" operation="less" value="2" 
						ifCheckedAttrs="|Document|Содержит_несколько_позиций_ОКПДКТРУ"
						message="В таблице ОКПД2/КТРУ необходимо ввести минимум две строки" />
					<TableFieldOperations sourceTag="{current}" targetTag="Бюджеты" targetTable="|Document|Бюджеты" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_бюджетные_средства}={sourceTableColumn=КБК_по_статье_расхода}" >

						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Запланировано" formula="$NullToZero({Запланировано})+$NullToZero({sourceTableColumn=Финансирование})"/>
						<Action column="Остаток_бюджета" formula="$NullToZero({Сумма_лимита_бюджета})-$NullToZero({Запланировано})"/>  
					</TableFieldOperations>  	
					
					<TableFieldOperations sourceTag="Бюджеты" targetTag="Все позиции ППЗ" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_бюджетные_средства}" >
						<SourceTable tableName="|Document|Бюджеты">
							<Column name="Остаток_бюджета"  />
							<Column name="Год_финансирования_бюджета"  />
							<Column name="КБК_бюджетные_средства"  />
							<Column name="Сумма_лимита_бюджета"  />
						</SourceTable>
						<Action column="Остаток_бюджета" formula="{sourceTableColumn=Остаток_бюджета}"/>
					</TableFieldOperations>  	
					
					<TableFieldOperations sourceTag="Бюджеты" targetTag="Все позиции ППЗ" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_бюджетные_средства}" >

						<SourceTable tableName="|Document|Бюджеты">
							<Column name="Остаток_бюджета"  />
							<Column name="Год_финансирования_бюджета"  />
							<Column name="КБК_бюджетные_средства"  />
						</SourceTable>
						<Action column="Остаток_для_карточки" formula="$NullToZero({sourceTableColumn=Остаток_бюджета})+ $NullToZero({Финансирование})"/>
					</TableFieldOperations>  	
					
					
					<TableFieldOperations sourceTag="{current}" targetTag="Позиции плана-графика" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >

						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Нераспределенный_остаток_ППЗ"  />
							<Column name="Год_финансирования_бюджета"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Финансирование"  />
						</SourceTable>
						<Action column="Нераспределенный_остаток_ППЗ" formula="$NullToZero({sourceTableColumn=Нераспределенный_остаток_ППЗ})"/>
						<Action column="Финансирование" formula="$NullToZero({sourceTableColumn=Финансирование})"/>
						<Action column="Нераспределенный_остаток_для_карточки" formula="$NullToZero({sourceTableColumn=Нераспределенный_остаток_ППЗ}) + $NullToZero({Корректируемая_сумма})"/>
					</TableFieldOperations>  	
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="ПЗ" targetTable="|Document|Детализация_КБК" targetRowFilter="{Год_финансирования_бюджета}={field=ПЗ:|Document|Текущий_финансовый_год} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_текущий_год" formula="$NullToZero({Сумма_текущий_год})-$NullToZero({sourceTableColumn=Финансирование})"/>  
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{current}" targetTag="ПЗ" targetTable="|Document|Детализация_КБК" targetRowFilter="{Год_финансирования_бюджета}={field=ПЗ:|Document|Текущий_финансовый_год} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_текущий_год" formula="$NullToZero({Сумма_текущий_год})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="ПЗ" targetTable="|Document|Детализация_КБК" targetRowFilter="{Год_финансирования_бюджета}={field=ПЗ:|Document|Первый_плановый_год} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_первого_года" formula="$NullToZero({Сумма_первого_года})-$NullToZero({sourceTableColumn=Финансирование})"/>  
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{current}" targetTag="ПЗ" targetTable="|Document|Детализация_КБК" targetRowFilter="{Год_финансирования_бюджета}={field=ПЗ:|Document|Первый_плановый_год} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_первого_года" formula="$NullToZero({Сумма_первого_года})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="ПЗ" targetTable="|Document|Детализация_КБК" targetRowFilter="{Год_финансирования_бюджета}={field=ПЗ:|Document|Второй_плановый_год} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_второго_года" formula="$NullToZero({Сумма_второго_года})-$NullToZero({sourceTableColumn=Финансирование})"/>  
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{current}" targetTag="ПЗ" targetTable="|Document|Детализация_КБК" targetRowFilter="{Год_финансирования_бюджета}={field=ПЗ:|Document|Второй_плановый_год} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_второго_года" formula="$NullToZero({Сумма_второго_года})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="ПЗ" targetTable="|Document|Детализация_КБК" targetRowFilter="{Год_финансирования_бюджета}&lt;{field=ПЗ:|Document|Второй_плановый_год} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_последующих_годов" formula="$NullToZero({Сумма_последующих_годов})-$NullToZero({sourceTableColumn=Финансирование})"/>  
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{current}" targetTag="ПЗ" targetTable="|Document|Детализация_КБК" targetRowFilter="{Год_финансирования_бюджета}&lt;{field=ПЗ:|Document|Второй_плановый_год} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_последующих_годов" formula="$NullToZero({Сумма_последующих_годов})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="ПЗ" targetTable="|Document|Детализация_КБК" targetRowFilter="{КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_всего" formula="$NullToZero({Сумма_всего})-$NullToZero({sourceTableColumn=Финансирование})"/>  
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{current}" targetTag="ПЗ" targetTable="|Document|Детализация_КБК" targetRowFilter="{КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_всего" formula="$NullToZero({Сумма_всего})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="ПЗ" targetTable="|Document|Детализация_КБК" targetRowFilter="{КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Нераспределенный_остаток_ППЗ"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Нераспределенный_остаток" formula="$NullToZero({Нераспределенный_остаток})-$NullToZero({sourceTableColumn=Нераспределенный_остаток_ППЗ})"/>  
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{current}" targetTag="ПЗ" targetTable="|Document|Детализация_КБК" targetRowFilter="{КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Нераспределенный_остаток_ППЗ"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Нераспределенный_остаток" formula="$NullToZero({Нераспределенный_остаток})+$NullToZero({sourceTableColumn=Нераспределенный_остаток_ППЗ})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Источники_финансирования" checkFormula="{Финансирование}=0" checkMessage="Укажите Сумму финансирования" > </TableFieldOperations>
				
				<CalculateExpression targetFlow="Позиции плана-графика" targetField="|Document|Остаток_в_ППЗ"> 
						<Variables>
							<Variable name="СуммаППЗ" source="{current}" path="|Document|Сумма_всего"  />
							<Variable name="Сумма_всего" source="{current}" path="|Document|Сумма_строк_ПГ"  />
						</Variables>
						<Expression value="$NullToZero({СуммаППЗ})-$NullToZero({Сумма_всего})"/>
					</CalculateExpression>
					<SetField targetFlow="Позиции плана-графика" targetField="|Document|Остаток_в_ППЗ" value="{{|Document|Остаток_в_ППЗ}+{|Document|Сумма_всего}}" />
</Actions>
			</Aggregation>
			<ConditionalActions>
				<Select>
				<Select searchString="document[doc_Id = '{current_Id}']" tag="ППЗ" />
				</Select>
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldsEquals tag="ППЗ" path="|Document|Статус" value="Включена в опубликованный план закупок"/> 
						</And>
						</Conditions>
						<Actions>
					<!-- сравнивем суммы всего и сумму по финансированию-->		
					<!-- <VerifyExpression>
						<Variables>
							<Variable name="Суммавсего" source="{current}" path="|Document|Сумма_всего"  />
							<Variable name="СуммавсехППГ" source="{current}" path="|Document|Сумма_строк_ПГ" />
						</Variables>
						<Expression value="$NullToZero({Суммавсего}) &gt;= $NullToZero({СуммавсехППГ})"/>
						<FailtureText value= "Сумма всего не может быть меньше Суммы всех ППГ"/>
					</VerifyExpression>  -->

						</Actions>
					</ConditionalAction>
				</Actions>
			</ConditionalActions>   
		</OnRegcardEdited>
		<OnDocumentDeleted transaction="single"> 
			<Aggregation>
				<Select>
				<Select searchString="document[doc_Id = '{current_Id}']" tag="Позиции плана закупок" />
				<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={current_Id}]]" tag="Позиции" />
				<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and doc_Id = document[doc_Links/doc_Link/link_Document={current_Id}]]" tag="Позиции плана закупок10" />
				<Select searchString="document[doc_RegCard/rc_FlowName = 'Бюджеты' and doc_RegCard/rc_Index/text_Организация_заказчик_наименование='{currentDocField=|Document|Организация_заказчик|Организация_заказчик_наименование}']" tag="Бюджеты" /> 
				<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and doc_RegCard/rc_Index/text_Организация_заказчик_наименование='{currentDocField=|Document|Организация_заказчик|Организация_заказчик_наименование}']" tag="ППЗОстатка" /> 
					
				<Select tag="Все позиции ППЗ" joinTags="ППЗОстатка,{current}" />
				</Select>
				<Actions>  
					<TableFieldOperations sourceTag="Позиции плана закупок" targetTag="Бюджеты" targetTable="|Document|Бюджеты" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_бюджетные_средства}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Запланировано" formula="$NullToZero({Запланировано})-$NullToZero({sourceTableColumn=Финансирование})"/>
						<Action column="Остаток_бюджета" formula="$NullToZero({Сумма_лимита_бюджета})- $NullToZero({Запланировано})"/> 
					</TableFieldOperations>
						
					<TableFieldOperations sourceTag="Бюджеты" targetTag="Все позиции ППЗ" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_бюджетные_средства}" >

						<SourceTable tableName="|Document|Бюджеты">
							<Column name="Остаток_бюджета"  />
							<Column name="Год_финансирования_бюджета"  />
							<Column name="КБК_бюджетные_средства"  />
							<Column name="Сумма_лимита_бюджета"  />
						</SourceTable>
						<Action column="Остаток_бюджета" formula="{sourceTableColumn=Остаток_бюджета}"/>
					</TableFieldOperations>  	
								
					<TableFieldOperations sourceTag="Бюджеты" targetTag="Все позиции ППЗ" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_бюджетные_средства}" >
						<SourceTable tableName="|Document|Бюджеты">
							<Column name="Остаток_бюджета"  />
							<Column name="Год_финансирования_бюджета"  />
							<Column name="КБК_бюджетные_средства"  />
						</SourceTable>
						<Action column="Остаток_для_карточки" formula="$NullToZero({sourceTableColumn=Остаток_бюджета})+ $NullToZero({Финансирование})"/>
					</TableFieldOperations>  
				
				</Actions>
			</Aggregation>
		</OnDocumentDeleted>
		<OnLinkAdded>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Позиции плана закупок" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана закупок}/doc_Id]]" tag="Позиции" />

				</Select>
				<Actions>
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана закупок" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|Сумма_всего" />
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана закупок" sourceField="|Document|Сумма_выплат_текущего_года"  targetField="|Document|Сумма_текущий_год" />
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана закупок" sourceField="|Document|Сумма_выплат_первого_года"  targetField="|Document|Сумма_первый_плановый_год" />
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана закупок" sourceField="|Document|Сумма_выплат_второго_года"  targetField="|Document|Сумма_второй_плановый_год" />
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана закупок" sourceField="|Document|Сумма_выплат_последующих_годов"  targetField="|Document|Сумма_последующие_годы" />	
					<CopyField sourceFlow="Позиции плана закупок" targetFlow="Позиции" sourceField="|Document|Тип_особой_закупки" targetField="|Document|Тип_особой_закупки" /> 
					<CopyField sourceFlow="Позиции плана закупок" targetFlow="Позиции" sourceField="|Document|Тип_особой_закупки_код" targetField="|Document|Тип_особой_закупки_код" /> 
					<CopyField sourceFlow="Позиции плана закупок" targetFlow="Позиции" sourceField="|Document|Периодичность_закупки" targetField="|Document|Периодичность_закупки" /> 
					<CopyField sourceFlow="Позиции плана закупок" targetFlow="Позиции" sourceField="|Document|Периодичность_закупки_код" targetField="|Document|Периодичность_закупки_код" /> 
					<SetIKZPPZ targetFlow="Позиции плана закупок" targetField="|Document|ИКЗ" />
					<CopyField sourceFlow="Позиции плана закупок" targetFlow="Позиции" sourceField="|Document|ИКЗ" targetField="|Document|ИКЗ" /> 		
					<CopyField sourceFlow="Позиции плана закупок" targetFlow="Позиции" sourceField="%key%" targetField="|Document|ИД_позиции_ПЗ" />		
					<SetField targetFlow="Позиции" targetField="|Document|Статус" value="Включена в позицию плана закупок" />					
				</Actions>
			</Aggregation>
		</OnLinkAdded>
		<OnLinkDeleted>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Позиции плана закупок" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана закупок}/doc_Id]]" tag="Позиции" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана-графика" />
				</Select>
				<Actions>
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана закупок" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|Сумма_всего" />
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана закупок" sourceField="|Document|Сумма_выплат_текущего_года"  targetField="|Document|Сумма_текущий_год" />
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана закупок" sourceField="|Document|Сумма_выплат_первого_года"  targetField="|Document|Сумма_первый_плановый_год" />
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана закупок" sourceField="|Document|Сумма_выплат_второго_года"  targetField="|Document|Сумма_второй_плановый_год" />
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана закупок" sourceField="|Document|Сумма_выплат_последующих_годов"  targetField="|Document|Сумма_последующие_годы" />	<CalculateExpression targetFlow="Позиции плана-графика" targetField="|Document|Остаток_в_ППЗ"> 
						<Variables>
							<Variable name="СуммаППЗ" source="{current}" path="|Document|Сумма_всего"  />
							<Variable name="Сумма_всего" source="{current}" path="|Document|Сумма_строк_ПГ"  />
						</Variables>
						<Expression value="$NullToZero({СуммаППЗ})-$NullToZero({Сумма_всего})"/>
					</CalculateExpression>
					<SetField targetFlow="Позиции плана-графика" targetField="|Document|Остаток_в_ППЗ" value="{{|Document|Остаток_в_ППЗ}+{|Document|Сумма_всего}}" />				
				</Actions>
			</Aggregation>
		</OnLinkDeleted> 
	</Flow>
	<Flow name="Позиции плана-графика">
		<LinksModify>
			<LinkCurrentDoc />
			<LinkAllLinksWhereFlow name="Позиции плана закупок" />
		</LinksModify>
		<FieldsModify>  
			<CopyField src="|Document|Наименование_объекта_закупки"   /> 
			<CopyField src="|Document|Планируемый_год_размещения"  /> 
			<CopyField src="|Document|Месяц_финансирования"  dst="|Document|Планируемый_месяц_размещения" />
			<CopyField src="|Document|Дата_начала_закупки"  dst="|Document|Планируемый_срок_размещения" />
			<CopyField src="|Document|Дата_окончания_закупки"  dst="|Document|Планируемый_срок_исполнения" />
			<CopyField src="|Document|КВР"  dst="|Document|КВР" /> 
			<CopyField src="|Document|Значение_КВР_неопределено"  />
			<CopyField src="|Document|Содержит_несколько_ОКПД2" />
			<CopyField src="|Document|ИКЗ"  dst="|Document|ИКЗ_позиции_ПЗ" /> 
			<CopyField src="|Document|КВР_наименование"  />
			<CopyField src="|Document|ОКПД2"  />
			<CopyField src="|Document|ОКПД2_наименование"  />
			<CopyField src="|Document|Тип_особой_закупки_код"  />
			<CopyField src="|Document|Тип_особой_закупки"  />
			<CopyField src="|Document|Валюта"  />
			<CopyField src="|Document|Код_валюты"  />
			<CopyField src="|Document|ОКЕИ"   />
			<CopyField src="|Document|Периодичность_закупки"   />
			<CopyField src="|Document|Периодичность_закупки_код"   />
			<CopyField src="|Document|Периодичность_закупки_описание"   />
			<CopyField src="|Document|Единица_измерения"  />
			<CopyField src="|Document|Невозможно_определить_количество"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование"   />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ИНН" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_КПП"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Адрес"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Телефон"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Электронная_почта"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Код_в_ЕИС"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СПЗ"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СР"   />
			<CopyField src="|Document|Организация_заказчик|ОКТМО"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКОПФ"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКТМОППО"   />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Дата_постановки_на_учет"  />
			<SumField src="|Document|Цена_запасных_частей"   /> 
			<CopyField src="|Document|Используется_КТРУ"   /> 
			<CopyField src="|Document|КТРУ"   /> 
			<CopyField src="|Document|КТРУ_наименование"   /> 
			<CopyField src="|Document|Содержит_несколько_позиций_ОКПДКТРУ"   /> 
			<CopyField src="%key%" dst="|Document|ИД_позиции_ПЗ" />
			<CopyField src="|Document|Общественное_обсуждение"   /> 
			<CopyField src="|Document|Лекарственный_препарат"  />

		
		</FieldsModify>
		
		<FieldsModify source="Позиции плана-графика"> 
			<CopyField src="|Document|Позиции_не_учитывать" /> 
			<CopyField src="|Document|Наименование_объекта_закупки"   /> 
			<CopyField src="|Document|Описание_объекта_закупки"   /> 
			<CopyField src="|Document|КВР" /> 	
			<CopyField src="|Document|КВР_наименование"  />
			<CopyField src="|Document|Значение_КВР_неопределено"  />
			<CopyField src="|Document|ОКПД2"  />
			<CopyField src="|Document|ОКПД2_наименование"  />
			<CopyField src="|Document|Содержит_несколько_ОКПД2" />
			<CopyField src="|Document|Используется_КТРУ"   /> 
			<CopyField src="|Document|КТРУ"   /> 
			<CopyField src="|Document|КТРУ_наименование"   /> 
			<CopyField src="|Document|Содержит_несколько_позиций_ОКПДКТРУ"   /> 
			<CopyField src="|Document|Способ_определения_поставщика_код"   /> 
			<CopyField src="|Document|Способ_определения_поставщика"   /> 
			<CopyField src="|Document|НМЦК"   /> 
			<CopyField src="|Document|Валюта"  />
			<CopyField src="|Document|Код_валюты"  />
			<CopyField src="|Document|Обоснование_способа_определения_поставщика"   /> 
			<CopyField src="|Document|Размер_аванса"   /> 
			<CopyField src="|Document|Размер_аванса_процент"   /> 
			<CopyField src="|Document|Невозможно_применить_метод_определения_НМЦК"   /> 
			<CopyField src="|Document|Цена_запасных_частей"   /> 
			<CopyField src="|Document|Документы_основание_ед_поставщик_код"   /> 
			<CopyField src="|Document|Документы_основание_ед_поставщик_пункт"   /> 
			<CopyField src="|Document|Документы_основание_ед_поставщик_наименование"   /> 
			<CopyField src="|Document|Тип_особой_закупки_код"  />
			<CopyField src="|Document|Тип_особой_закупки"  />
			<CopyField src="|Document|Основание_для_проведения_запроса_предложений"  />
			<CopyTable src="|Document|Метод_определения_НМЦК"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование"   />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СПЗ"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СР"   />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКОПФ"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Код_в_ЕИС"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ИНН" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_КПП"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Адрес"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Телефон"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Электронная_почта"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_справочный_код"/>
			<CopyField src="|Document|Организация_заказчик|ОКТМО"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКТМОППО"   />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Дата_постановки_на_учет"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СПЗ"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СР"  />
			<CopyField src="|Document|Организатор_закупки|Код_в_ЕИС"  />
			<CopyField src="|Document|Организатор_совместных_торгов|Организатор_совместных_торгов_наименование"  />
			<CopyField src="|Document|Организатор_совместных_торгов|Организатор_совместных_торгов_код_по_СПЗ"  />
			<CopyField src="|Document|Организатор_совместных_торгов|Организатор_совместных_торгов_код_по_СР"  />
			<CopyField src="|Document|Организатор_совместных_торгов|Организатор_совместных_торгов_Код_ЕИС"  />
			<CopyField src="|Document|Роль_организатора_закупки_код"  />
			<CopyField src="|Document|Роль_организатора_закупки"  />
			<CopyField src="|Document|Совместные_торги"  />
			<CopyField src="|Document|Централизованная_закупка"  />
			<CopyField src="|Document|Требуется_согласование_ГРБС"  />
			<CopyField src="|Document|Информация_об_одностороннем_отказе_от_исполнения"  />
			<CopyField src="|Document|Информация_о_контрактной_службе"  />
			<CopyField src="|Document|Банковское_сопровождение_контракта"  />
			<CopyField src="|Document|Максимальный_размер_оплаты"  />
			<CopyField src="|Document|Дополнительные_сведения"  />
			<CopyField src="|Document|Сведения_об_общественном_обсуждении"  />
			<CopyField src="|Document|Электронная_закупка"  />
			<CopyField src="|Document|Общественное_обсуждение"  />
			<CopyField src="|Document|СМП"  />
			<CopyField src="|Document|Лекарственный_препарат"  />
			<CopyField src="|Document|Контракт_жизненного_цикла"  />
			<CopyTable src="|Document|Случаи_заключения_контракта_ЖЦ"/>
			<CopyTable src="|Document|Преимущества_к_участникам_закупки"/>
			<CopyTable src="|Document|Требования_к_участникам"/>
			<CopyTable src="|Document|Ограничения"/>
			<CopyField src="|Document|Требуется_обеспечение_заявки"  />
			<CopyField src="|Document|Требование_об_обеспечении_исполнения_контракта"  />
			<CopyField src="|Document|Размер_обеспечения_заявки"  />
			<CopyField src="|Document|Размер_обеспечения_контракта"  />
			<CopyField src="|Document|Процент_обеспечения_заявки"  />
			<CopyField src="|Document|Процент_обеспечения_контракта"  />
			<CopyField src="|Document|Организация_заказчик|Банк_заказчика"  />
			<CopyField src="|Document|Организация_заказчик|БИК_обеспечение_заявки_заказчика"  />
			<CopyField src="|Document|Организация_заказчик|Банк_обеспечения_заявки"  />
			<CopyField src="|Document|Организация_заказчик|БИК_обеспечение_контракта_заказчика"  />
			<CopyField src="|Document|Организация_заказчик|РС_обеспечение_заявки_заказчика"  />
			<CopyField src="|Document|Организация_заказчик|РС_обеспечение_контракта_заказчика"  />
			<CopyField src="|Document|Организация_заказчик|ЛС_обеспечение_заявки_заказчика"  />
			<CopyField src="|Document|Организация_заказчик|ЛС_обеспечение_контракта_заказчика"  />
			<CopyField src="|Document|Условия_обеспечения_заявки"  />
			<CopyField src="|Document|Условия_обеспечения_контракта"  />
			<CopyField src="|Document|Порядок_внесения_денежных_средств_обеспечение_заявки"  />
			<CopyField src="|Document|Порядок_внесения_денежных_средств_обеспечение_контракта"  />
			<CopyField src="|Document|Планируемый_год_размещения"  /> 
			<CopyField src="|Document|Планируемый_месяц_размещения" />
			<CopyField src="|Document|Планируемый_срок_размещения" />
			<CopyField src="|Document|Планируемый_срок_исполнения" />
			<CopyField src="|Document|Периодичность_закупки"   />
			<CopyField src="|Document|Периодичность_закупки_код"   />
			<CopyField src="|Document|Периодичность_закупки_описание"   />
			<CopyField src="|Document|Сроки_исполнения_этапов_контракта"   /> 
			<CopyTable src="|Document|Место_доставки"/>
			<CopyField src="|Document|ОКЕИ"   />
			<CopyField src="|Document|Единица_измерения"  />
			<CopyField src="|Document|Невозможно_определить_количество"  />
			<CopyField src="|Document|ИКЗ_позиции_ПЗ" /> 
			<CopyField src="|Document|ИД_позиции_ПЗ" />
			<CopyTable src="|Document|Позиции_КТРУ"/>
			<CopyField src="|Document|Общественное_обсуждение"   /> 
		
		</FieldsModify> 

	
		<OnDocumentCreated  transaction="single">
			<Aggregation>
				<Select>
					<!-- 	<Select searchString="document[doc_Id = '{current_Id}']" tag="Позиции плана-графика" /> -->
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции}/doc_Id]]" tag="Позиции плана закупок" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок2" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана закупок2}/doc_Id]]" tag="Позиции плана-графика1" />

					<SelectLink  flow="Позиции" tag="Позиции">
						<SelectLink flow="Позиции плана закупок" tag="Позиции плана закупок"/>
					</SelectLink>   

					<Select tag="Все позиции ППГ" joinTags="Позиции плана-графика1,{current}" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок10" />
				</Select>
				<Actions>  
					<SetField targetFlow="Позиции" targetField="|Document|Статус" value="Включена в позицию план-графика" />
					<CopyField sourceFlow="{current}" targetFlow="Позиции" sourceField="%key%" targetField="|Document|ИД_позиции_ПГ" />     
					<CopyField sourceFlow="{current}" targetFlow="Позиции" sourceField="|Document|Способ_определения_поставщика_код" targetField="|Document|Способ_определения_поставщика_код" /> 			
					<AddLink target="{current}" link="Позиции плана закупок" /> 
					<CopyField sourceFlow="Позиции плана закупок10" targetFlow="{current}" sourceField="%key%" targetField="|Document|ИД_позиции_ПЗ" />
					
					
					
					<!--контроль сумм-->
					<VerifyExpression>
						<Variables>
							<Variable name="СуммаППЗ" source="Позиции плана закупок2" path="|Document|Сумма_всего"  />
							<Variable name="СуммаППГТекущий" source="{current}" path="|Document|НМЦК"  />
							<Variable name="НМЦКППГ" source="Позиции плана-графика1" path="|Document|НМЦК" aggregation="sum" />

						</Variables>
						<Expression value="$NullToZero({НМЦКППГ}) +$NullToZero({СуммаППГТекущий}) &lt;= $NullToZero({СуммаППЗ})"/>
						<FailtureText value="НМЦК превышает допустимую сумму в рамках ППЗ"/>
					</VerifyExpression>
					<Sum sourceFlow="Все позиции ППГ" targetFlow="Позиции плана закупок2" sourceField="|Document|Сумма_всего" targetField="|Document|Сумма_строк_ПГ" />
					<CalculateExpression targetFlow="Все позиции ППГ" targetField="|Document|Остаток_в_ППЗ"> 
						<Variables>
							<Variable name="СуммаППЗ" source="Позиции плана закупок2" path="|Document|Сумма_всего"  />
							<Variable name="Сумма_всего" source="Все позиции ППГ" path="|Document|Сумма_всего" aggregation="sum" />
						</Variables>
						<Expression value="$NullToZero({СуммаППЗ}) - $NullToZero({Сумма_всего}) "/>
					</CalculateExpression>
					
					<SetField targetFlow="Позиции плана-графика1" targetField="|Document|Остаток_в_ППЗ" value="{{|Document|Остаток_в_ППЗ}+{|Document|Сумма_всего}}" /> 
					
					<TableConsolidation>
						<SourceTable flow="Позиции плана закупок10" tableName="|Document|Позиции_КТРУ">
							<Column name="КТРУ_позиции" />
							<Column name="КТРУ_наименование_позиции" />
							<Column name="ОКПД2_позиции_КТРУ"  />
							<Column name="ОКПД2_наименование_позиции_КТРУ" />
							<Column name="ОКПД2_позиции_таблицы"  />
							<Column name="ОКПД2_наименование_позиции_таблицы" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Позиции_КТРУ">
							<Column name="КТРУ_позиции" />
							<Column name="КТРУ_наименование_позиции" />
							<Column name="ОКПД2_позиции_КТРУ"   />
							<Column name="ОКПД2_наименование_позиции_КТРУ" />
							<Column name="ОКПД2_позиции_таблицы"  />
							<Column name="ОКПД2_наименование_позиции_таблицы" />
						</TargetTable>
					</TableConsolidation> 
					
				<!-- вычисление остатка в ППЗ после корретирования суммы в ППГ-->	
				 	<TableFieldOperations sourceTag="{current}" targetTag="Позиции плана закупок10" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Запланированно_на_ППГ" formula="$NullToZero({Запланированно_на_ППГ})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
						<Action column="Нераспределенный_остаток_ППЗ" formula="$NullToZero({Финансирование})- $NullToZero({Запланированно_на_ППГ})"/> 
					</TableFieldOperations>
					
					
						 <TableFieldOperations sourceTag="Позиции плана закупок10" targetTag="Все позиции ППГ" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >

						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Нераспределенный_остаток_ППЗ"  />
							<Column name="Год_финансирования_бюджета"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Сумма_лимита_бюджета"  />
						</SourceTable>
						<Action column="Нераспределенный_остаток_ППЗ" formula="{sourceTableColumn=Нераспределенный_остаток_ППЗ}"/>
						
					</TableFieldOperations>  	
					
					<TableFieldOperations sourceTag="Позиции плана закупок10" targetTag="Все позиции ППГ" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Остаток_бюджета"  />
							<Column name="Год_финансирования_бюджета"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Нераспределенный_остаток_ППЗ"  />
						</SourceTable>
						<Action column="Нераспределенный_остаток_для_карточки" formula="$NullToZero({sourceTableColumn=Нераспределенный_остаток_ППЗ})+ $NullToZero({Корректируемая_сумма})"/>
					</TableFieldOperations>  	
					<SetField targetFlow="{current}" targetField="|Document|Остаток_в_ППЗ" value="{{|Document|Остаток_в_ППЗ}+{|Document|Сумма_всего}}" />
					
			</Actions>
			</Aggregation>
			<NamedConstants>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Номер_закупки_в_ПГ_порядковый"/>
					<Setting key="CounterNameFormat" value="({|Document|Планируемый_год_размещения}/{|Document|ИКЗ_позиции_ПЗ})"/>
				</Constant>
			</NamedConstants> 
			<ConditionalActions>
				<Select>
					<!-- <Select searchString="document[doc_Id = '{current_Id}']" tag="Позиции плана-графика" /> -->
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок" />
				</Select> 
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldsEquals tag="{current}" path="|Document|ИКЗ" />
							</And>
						</Conditions>
						<Actions>
							<SetIKZPPG targetFlow="{current}" targetField="|Document|ИКЗ" />
						</Actions>
					</ConditionalAction>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldsEquals tag="{current}" path="|Document|Остаток_в_ППЗ" value="0"/>
							</And>
						</Conditions>
						<Actions>
							<SetField targetFlow="Позиции плана закупок" targetField="|Document|Сумма_израсходована" value="1" />  
						</Actions>
					</ConditionalAction>
				</Actions> 
			</ConditionalActions> 
		</OnDocumentCreated>  
		<OnRegcardEdited transaction="single"> 
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Позиции плана-графика" />
					
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок2" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана закупок2}/doc_Id]]" tag="Позиции плана-графика1" />
					<Select tag="Все позиции ППГ" joinTags="Позиции плана-графика1,{current}" />
						<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок10" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Планы-графики' and
                (doc_RegCard/rc_Index/text_Статус != 'Отправлено в ЕИС' or doc_RegCard/rc_Index/text_Статус != 'Неактуален') and xn-in(doc_Id, {currentDocLinkList})]" tag="ПГ"/>

				</Select>
				<Actions>
					<Sum sourceFlow="Позиции" targetFlow="{current}" sourceField="|Document|Количество_всего" targetField="|Document|Количество" />  
					<Sum sourceFlow="Позиции" targetFlow="{current}" sourceField="|Document|Количество_первого_планового_года" targetField="|Document|Количество_первый_плановый_год" /> 
					<Sum sourceFlow="Позиции" targetFlow="{current}" sourceField="|Document|Количество_второго_планового_года" targetField="|Document|Количество_второй_плановый_год" /> 
					<Sum sourceFlow="Позиции" targetFlow="{current}" sourceField="|Document|Количество_последующих_годов" targetField="|Document|Количество_последующие_годы" /> 
					<Sum sourceFlow="Позиции" targetFlow="{current}" sourceField="|Document|Количество_текущего_года" targetField="|Document|Количество_текущий_год" /> 
					<CopyField sourceFlow="{current}" targetFlow="Позиции" sourceField="Способ_определения_поставщика_код" targetField="|Document|Способ_определения_поставщика_код" /> 
				
					<!--контроль сумм-->
					<VerifyExpression>
						<Variables>	
						    <Variable name="ПроцентАванса1" source="{current}" path="|Document|Размер_аванса_процент"  />
							<Variable name="ТребованиеКонтракт1" source="{current}" path="|Document|Требование_об_обеспечении_исполнения_контракта" />
						</Variables>
						<Expression value="(($NullToZero({ПроцентАванса1})!=0) And ({ТребованиеКонтракт1}!=0)) Or ({ТребованиеКонтракт1}!=1)"/>
						<FailtureText value="Процент аванса должен быть заполнен"/>
					</VerifyExpression>
					<VerifyExpression>
						<Variables>	
						    <Variable name="ПроцентАванса" source="{current}" path="|Document|Размер_аванса_процент"  />
							<Variable name="ТребованиеКонтракт" source="{current}" path="|Document|Процент_обеспечения_контракта" />
							<Variable name="НМЦК" source="{current}" path="|Document|НМЦК" />
						</Variables>
						<Expression value="($NullToZero({НМЦК})&gt;0 And $NullToZero({ПроцентАванса})&lt;=30 And $NullToZero({ТребованиеКонтракт})&gt;=5 And $NullToZero({ТребованиеКонтракт})&lt;=30) Or ($NullToZero({НМЦК})==0) Or ($NullToZero({ПроцентАванса})==0) Or ($NullToZero({ПроцентАванса})&gt;30)"/>
						<FailtureText value="Доля обеспечения исполнения контракта должна быть в пределах 5-30% от НМЦК"/>
					</VerifyExpression>
					<VerifyExpression>
						<Variables>	
							<Variable name="ТребованиеЗаявка" source="{current}" path="|Document|Процент_обеспечения_заявки" />
							<Variable name="НМЦК" source="{current}" path="|Document|НМЦК" />
							<Variable name="Способ" source="{current}" path="|Document|Способ_определения_поставщика_код" />
						</Variables>
						<Expression value="(({Способ}==&quot;OK44&quot; Or {Способ}==&quot;OKU44&quot; Or {Способ}==&quot;OKD44&quot; Or {Способ}==&quot;EA44&quot;) And $NullToZero({НМЦК})&gt;3000000 And ($NullToZero({ТребованиеЗаявка})&gt;=0.5 And $NullToZero({ТребованиеЗаявка})&lt;=5)) Or ({Способ}!=&quot;OK44&quot; And {Способ}!=&quot;OKU44&quot; And {Способ}!=&quot;OKD44&quot; And {Способ}!=&quot;EA44&quot;) Or ($NullToZero({НМЦК})&lt;3000000)"/>
						<FailtureText value="Доля обеспечения заявки должна быть в пределах 0.5-5% от НМЦК"/>
					</VerifyExpression>
					<VerifyExpression>
						<Variables>
							<Variable name="СуммаППЗ" source="Позиции плана закупок2" path="|Document|Сумма_всего"  />
							<Variable name="СуммаППГТекущий" source="{current}" path="|Document|НМЦК"  />
							<Variable name="СуммаППГСтарый" source="{oldCurrent}" path="|Document|НМЦК"  />
							<Variable name="НМЦКППГ" source="Позиции плана-графика1" path="|Document|НМЦК" aggregation="sum" />
						</Variables>
						<Expression value="$NullToZero({НМЦКППГ})- $NullToZero({СуммаППГСтарый}) + $NullToZero({СуммаППГТекущий}) &lt;= $NullToZero({СуммаППЗ})"/>
						<FailtureText value="НМЦК превышает допустимую сумму в рамках ППЗ"/>
					</VerifyExpression>
				
					
				
						<!-- вычисление остатка в ППЗ после корретирования суммы в ППГ-->	
						
						<TableFieldOperations sourceTag="{oldCurrent}" targetTag="Позиции плана закупок10" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Запланированно_на_ППГ" formula="$NullToZero({Запланированно_на_ППГ})-$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
						<Action column="Нераспределенный_остаток_ППЗ" formula="$NullToZero({Финансирование})- $NullToZero({Запланированно_на_ППГ})"/> 
					</TableFieldOperations>
						
						
				 	<TableFieldOperations sourceTag="{current}" targetTag="Позиции плана закупок10" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Запланированно_на_ППГ" formula="$NullToZero({Запланированно_на_ППГ})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
						<Action column="Нераспределенный_остаток_ППЗ" formula="$NullToZero({Финансирование})- $NullToZero({Запланированно_на_ППГ})"/> 
					</TableFieldOperations>
					
				<!--20180221-->
				<TableFieldOperations sourceTag="Позиции плана закупок10" targetTag="Все позиции ППГ" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Год_финансирования_бюджета"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Нераспределенный_остаток_ППЗ"  />
						</SourceTable>
						<Action column="Нераспределенный_остаток_ППЗ" formula="{sourceTableColumn=Нераспределенный_остаток_ППЗ}"/>
					</TableFieldOperations>  	
				
				
				<TableFieldOperations sourceTag="Позиции плана закупок10" targetTag="Все позиции ППГ" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >

						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Нераспределенный_остаток_ППЗ"  />
							<Column name="Год_финансирования_бюджета"  />
							<Column name="КБК_по_статье_расхода"  />
						</SourceTable>
						<Action column="Нераспределенный_остаток_для_карточки" formula="$NullToZero({sourceTableColumn=Нераспределенный_остаток_ППЗ})+ $NullToZero({Корректируемая_сумма})"/>
					</TableFieldOperations>  	
				
				
					<Sum sourceFlow="Позиции плана-графика1" targetFlow="Позиции плана закупок2" sourceField="|Document|Сумма_всего" targetField="|Document|Сумма_строк_ПГ" />
						<CalculateExpression targetFlow="Позиции плана-графика1" targetField="|Document|Остаток_в_ППЗ"> 
						<Variables>
							<Variable name="СуммаППЗ" source="Позиции плана закупок2" path="|Document|Сумма_всего"  />
							<Variable name="Сумма_всего" source="Позиции плана-графика1" path="|Document|Сумма_всего" aggregation="sum" />
						</Variables>
						<Expression value="$NullToZero({СуммаППЗ}) - $NullToZero({Сумма_всего}) "/>
					</CalculateExpression>
	
					<SetField targetFlow="Позиции плана-графика1" targetField="|Document|Остаток_в_ППЗ" value="{{|Document|Остаток_в_ППЗ}+{|Document|Сумма_всего}}" /> 
				 
					
				<TableFieldOperations sourceTag="{oldCurrent}" targetTag="ПГ" targetTable="|Document|Детализация_КБК" targetRowFilter="{sourceTableColumn=Год_финансирования_бюджета}={field=ПГ:|Document|Год} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_текущий_год" formula="$NullToZero({Сумма_текущий_год})-$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>  
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{current}" targetTag="ПГ" targetTable="|Document|Детализация_КБК" targetRowFilter="{sourceTableColumn=Год_финансирования_бюджета}={field=ПГ:|Document|Год} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_текущий_год" formula="$NullToZero({Сумма_текущий_год})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="ПГ" targetTable="|Document|Детализация_КБК" targetRowFilter="{sourceTableColumn=Год_финансирования_бюджета}=({field=ПГ:|Document|Год}+1) And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_первого_года" formula="$NullToZero({Сумма_первого_года})-$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>  
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{current}" targetTag="ПГ" targetTable="|Document|Детализация_КБК" targetRowFilter="{sourceTableColumn=Год_финансирования_бюджета}=({field=ПГ:|Document|Год}+1) And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_первого_года" formula="$NullToZero({Сумма_первого_года})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="ПГ" targetTable="|Document|Детализация_КБК" targetRowFilter="{sourceTableColumn=Год_финансирования_бюджета}=({field=ПГ:|Document|Год}+2) And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_второго_года" formula="$NullToZero({Сумма_второго_года})-$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>  
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{current}" targetTag="ПГ" targetTable="|Document|Детализация_КБК" targetRowFilter="{sourceTableColumn=Год_финансирования_бюджета}=({field=ПГ:|Document|Год}+2) And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_второго_года" formula="$NullToZero({Сумма_второго_года})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="ПГ" targetTable="|Document|Детализация_КБК" targetRowFilter="{sourceTableColumn=Год_финансирования_бюджета}&lt;({field=ПГ:|Document|Год}+2) And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_последующих_годов" formula="$NullToZero({Сумма_последующих_годов})-$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>  
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{current}" targetTag="ПГ" targetTable="|Document|Детализация_КБК" targetRowFilter="{sourceTableColumn=Год_финансирования_бюджета}&lt;({field=ПГ:|Document|Год}+2) And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_последующих_годов" formula="$NullToZero({Сумма_последующих_годов})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="ПГ" targetTable="|Document|Детализация_КБК" targetRowFilter="{КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_всего" formula="$NullToZero({Сумма_всего})-$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>  
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{current}" targetTag="ПГ" targetTable="|Document|Детализация_КБК" targetRowFilter="{КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_всего" formula="$NullToZero({Сумма_всего})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="ПГ" targetTable="|Document|Детализация_КБК" targetRowFilter="{КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Нераспределенный_остаток_для_карточки"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Нераспределенный_остаток" formula="$NullToZero({Нераспределенный_остаток})-$NullToZero({sourceTableColumn=Нераспределенный_остаток_для_карточки})"/>  
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{current}" targetTag="ПГ" targetTable="|Document|Детализация_КБК" targetRowFilter="{КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Нераспределенный_остаток_для_карточки"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Нераспределенный_остаток" formula="$NullToZero({Нераспределенный_остаток})+$NullToZero({sourceTableColumn=Нераспределенный_остаток_для_карточки})"/>
					</TableFieldOperations>
					
				</Actions>
			</Aggregation>
			<ConditionalActions>
				<Select>
					<!-- <Select searchString="document[doc_Id = '{current_Id}']" tag="Позиции плана-графика" /> -->
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок" />
				</Select> 
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldsEquals tag="{current}" path="|Document|Остаток_в_ППЗ" value="0"/>
							</And>
						</Conditions>
						<Actions>
							<SetField targetFlow="Позиции плана закупок" targetField="|Document|Сумма_израсходована" value="1" />  
						</Actions>
					</ConditionalAction>
				</Actions> 
			</ConditionalActions> 
		</OnRegcardEdited>
		<OnDocumentDeleted transaction="single"> 
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Позиции плана-графика" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={current_Id}]]" tag="Позиции" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and doc_Id = document[doc_Links/doc_Link/link_Document={current_Id}]]" tag="Позиции плана закупок2" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and  doc_Id = document[doc_Links/doc_Link/link_Document={current_Id}]]" tag="Позиции плана закупок10" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана закупок2}/doc_Id]]" tag="Позиции плана-графика1" />
					<Select tag="Все позиции ППГ" joinTags="Позиции плана-графика1,{current}" />

				</Select>
				<Actions>
									
					<!-- вычисление остатка в ППЗ после корретирования суммы в ППГ-->	
				 	<TableFieldOperations sourceTag="Позиции плана-графика" targetTag="Позиции плана закупок10" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Запланированно_на_ППГ" formula="$NullToZero({Запланированно_на_ППГ})-$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
						<Action column="Нераспределенный_остаток_ППЗ" formula="$NullToZero({Финансирование})- $NullToZero({Запланированно_на_ППГ})"/> 
					</TableFieldOperations>
					
					
						 <TableFieldOperations sourceTag="Позиции плана закупок10" targetTag="Все позиции ППГ" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >

						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Нераспределенный_остаток_ППЗ"  />
							<Column name="Год_финансирования_бюджета"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Сумма_лимита_бюджета"  />
						</SourceTable>
						<Action column="Нераспределенный_остаток_ППЗ" formula="{sourceTableColumn=Нераспределенный_остаток_ППЗ}"/>
						
					</TableFieldOperations>  	
					
					<TableFieldOperations sourceTag="Позиции плана закупок10" targetTag="Все позиции ППГ" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Остаток_бюджета"  />
							<Column name="Год_финансирования_бюджета"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Нераспределенный_остаток_ППЗ"  />
						</SourceTable>
						<Action column="Нераспределенный_остаток_для_карточки" formula="$NullToZero({sourceTableColumn=Нераспределенный_остаток_ППЗ})+ $NullToZero({Корректируемая_сумма})"/>
					</TableFieldOperations>  	
				
				</Actions>
			</Aggregation>
	
		</OnDocumentDeleted>
		<OnLinkAdded>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Позиции плана-графика" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана-графика}/doc_Id]]" tag="Позиции" />
				</Select>
				<Actions>
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_всего" targetField="|Document|Количество" />
					<CopyField sourceFlow="Позиции плана-графика" targetFlow="Позиции" sourceField="%key%" targetField="|Document|ИД_позиции_ПГ" />		
					<SetField targetFlow="Позиции" targetField="|Document|Статус" value="Включена в позицию план-графика" />
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_всего" targetField="|Document|Количество" />  
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_первого_планового_года" targetField="|Document|Количество_первый_плановый_год" /> 
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_второго_планового_года" targetField="|Document|Количество_второй_плановый_год" /> 
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_последующих_годов" targetField="|Document|Количество_последующие_годы" /> 
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_текущего_года" targetField="|Document|Количество_текущий_год" /> 
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|Сумма_всего" />
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Сумма_выплат_текущего_года"  targetField="|Document|Сумма_текущий_год" />
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Сумма_выплат_первого_года"  targetField="|Document|Сумма_первый_плановый_год" />
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Сумма_выплат_второго_года"  targetField="|Document|Сумма_второй_плановый_год" />
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Сумма_выплат_последующих_годов"  targetField="|Document|Сумма_последующие_годы" />	
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|НМЦК" />
					
				</Actions>
			</Aggregation>
		</OnLinkAdded>
		<OnLinkDeleted transaction="split">
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Позиции плана-графика" /> 
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана-графика}/doc_Id]]" tag="Позиции" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок2" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана закупок2}/doc_Id]]" tag="Позиции плана-графика1" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана-графика1}/doc_Id]]" tag="Все позиции" />
					<Select tag="Все позиции ППГ" joinTags="Позиции плана-графика1,{current}" />
				</Select>
				<Actions>
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_всего" targetField="|Document|Количество" />
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_первого_планового_года" targetField="|Document|Количество_первый_плановый_год" /> 
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_второго_планового_года" targetField="|Document|Количество_второй_плановый_год" /> 
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_последующих_годов" targetField="|Document|Количество_последующие_годы" /> 
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Количество_текущего_года" targetField="|Document|Количество_текущий_год" /> 
					<!--<Sum sourceFlow="Позиции" targetFlow="{current}" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|Сумма_всего" />
					<Sum sourceFlow="Позиции" targetFlow="{current}" sourceField="|Document|Сумма_выплат_текущего_года"  targetField="|Document|Сумма_текущий_год" />
					<Sum sourceFlow="Позиции" targetFlow="{current}" sourceField="|Document|Сумма_выплат_первого_года"  targetField="|Document|Сумма_первый_плановый_год" />
					<Sum sourceFlow="Позиции" targetFlow="{current}" sourceField="|Document|Сумма_выплат_второго_года"  targetField="|Document|Сумма_второй_плановый_год" />
					<Sum sourceFlow="Позиции" targetFlow="{current}" sourceField="|Document|Сумма_выплат_последующих_годов"  targetField="|Document|Сумма_последующие_годы" />	
					-->
					
					<Sum sourceFlow="Позиции" targetFlow="Позиции плана-графика" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|НМЦК" />
					

					<!-- обновление остатка ППЗ -->
					<CalculateExpression targetFlow="Позиции плана-графика1" targetField="|Document|Остаток_в_ППЗ"> 
						<Variables>
							<Variable name="СуммаППЗ" source="Позиции плана закупок2" path="|Document|Сумма_всего"  />
							<Variable name="Сумма_всего" source="Позиции плана-графика1" path="|Document|Сумма_всего" aggregation="sum" />
						</Variables>
						<Expression value="$NullToZero({СуммаППЗ})-$NullToZero({Сумма_всего})"/>
					</CalculateExpression>
					
					
					
					<!--проверка на непревышения суммы Позиций в рамках суммы всего ППГ--> 	
					<VerifyExpression>
						<Variables>
							<Variable name="СуммаППГ" source="{current}" path="|Document|Сумма_всего"  />
							<Variable name="НМЦКППГ" source="{current}" path="|Document|НМЦК"  />
							<Variable name="СуммаПозицииТек" source="Все позиции" path="|Document|Сумма_выплат_всего"  />
							<Variable name="СуммаПозицииСтарый" source="Все позиции" path="|Document|Сумма_выплат_всего"  /> 
						</Variables>
						<Expression value="$NullToZero({НМЦКППГ}) - $NullToZero({СуммаПозицииСтарый}) + $NullToZero({СуммаПозицииТек}) &lt;= $NullToZero({СуммаППГ})"/>
						<FailtureText value="НМЦК превышает допустимую сумму в рамках ППЗ"/>
					</VerifyExpression> 
					

					<CopyField sourceFlow="Позиции плана-графика" targetFlow="Все позиции" sourceField="|Document|Остаток_в_ППЗ" targetField="|Document|Остаток_в_ППЗ" />
					<Sum sourceFlow="Позиции плана-графика1" targetFlow="Позиции плана закупок2" sourceField="|Document|Сумма_всего" targetField="|Document|Сумма_строк_ПГ" />
				
				</Actions>
			</Aggregation>
		</OnLinkDeleted> 
	</Flow>
	<Flow name="Заявки на размещение закупки">
		<LinksModify>
			<LinkCurrentDoc />
			<!-- <LinkAllLinksWhereFlow name="Позиции плана-графика" />	 -->			
		</LinksModify>
		<FieldsModify>  
			<CopyField src="|Document|Способ_определения_поставщика_код" />
			<CopyField src="|Document|Способ_определения_поставщика" />
			<CopyField src="|Document|Наименование_объекта_закупки" />
			<CopyField src="|Document|Описание_объекта_закупки" />
			<CopyField src="|Document|НМЦК" />
			<CopyField src="|Document|Код_валюты" />
			<CopyField src="|Document|Валюта" />
			<CopyField src="|Document|Планируемый_месяц_размещения" />
			<CopyField src="|Document|Планируемый_год_размещения" />
			<CopyField src="|Document|Планируемый_срок_размещения" />
			<CopyField src="|Document|Планируемый_срок_исполнения" dst="|Document|Сроки_доставки_товара" /> 
			<CopyField src="|Document|Роль_организатора_закупки" />
			<CopyField src="|Document|Роль_организатора_закупки_код" /> 
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СПЗ"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СР"   />
			<CopyField src="|Document|Организация_заказчик|ОКТМО"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКОПФ"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКТМОППО"   />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Дата_постановки_на_учет"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СПЗ" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СР" />
			<CopyField src="|Document|Организатор_закупки|Код_в_ЕИС" />
			<CopyField src="|Document|Централизованная_закупка" />
			<CopyField src="|Document|Совместные_торги" />
			<CopyField src="|Document|Организатор_совместных_торгов|Организатор_совместных_торгов"/>
			<CopyField src="|Document|Организатор_совместных_торгов|Организатор_совместных_торгов_наименование"/>
			<CopyField src="|Document|Организатор_совместных_торгов|Организатор_совместных_торгов_код_по_СПЗ"/>
			<CopyField src="|Document|Организатор_совместных_торгов|Организатор_совместных_торгов_код_по_СР"/>
			<CopyField src="|Document|ГРБС|ГРБС"/>
			<CopyField src="|Document|ГРБС|ГРБС_наименование"/>
			<CopyField src="|Document|Лекарственный_препарат" />
			<CopyField src="|Document|Общественное_обсуждение" />
			<CopyField src="|Document|Требуется_согласование_ГРБС" />
			<CopyField src="|Document|СМП" />
			<CopyTable src="|Document|Преимущества_к_участникам_закупки" />
			<CopyTable src="|Document|Требования_к_участникам" />
			<CopyTable src="|Document|Ограничения" />
		</FieldsModify>
		<OnDocumentCreated transaction="single">
			<NamedConstants>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Номер_регистрации"/>
					<Setting key="CounterNameFormat" value="({|Document|Имя_потока}/{|Document|Организация_счетчика})"/>
				</Constant>	
			</NamedConstants>			
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана-графика" />
				</Select>
				<Actions>  
					<!-- <Sum sourceFlow="Позиции плана-графика" targetFlow="{current}" sourceField="|Document|НМЦК" targetField="|Document|НМЦК" />
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана-графика" sourceField="%key%" targetField="|Document|ИД_заявки" />    
					<SetField targetFlow="Позиции плана-графика" targetField="|Document|Статус" value="Включена в заявку на размещение закупки" /> -->
				   <Sum sourceFlow="Позиции плана-графика" targetFlow="{current}" sourceField="|Document|НМЦК" targetField="|Document|НМЦК" />  
				   <CopyAttachments sourceFlow="Позиции плана-графика" targetFlow="{current}" sourceCategory="Документация" targetCategory="Документация"/>
                   <SetField targetFlow="Позиции плана-графика" targetField="|Document|Статус" value="Включена в заявку на размещение закупки" />  
                   <CopyField sourceFlow="{current}" targetFlow="Позиции плана-графика" sourceField="%key%" targetField="|Document|ИД_заявки" />  				   
					<!-- <TableConsolidation>
						<SourceTable flow="Позиции плана-графика" tableName="|Document|Преимущества_к_участникам_закупки">
							<Column name="Код_преимущества" findExisting="true"/> 
							<Column name="Наименование_преимущества" />
							<Column name="Величина_преимущества" />
							<Column name="Идентификатор_преимущества" />
							<Column name="Величина" />
							<Column name="Бизнес_код_преимущества" />
							<Column name="Код_способа_приемущества" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Преимущества_к_участникам_закупки">
							<Column name="Код_преимущества" findExisting="true"/>  
							<Column name="Наименование_преимущества" />
							<Column name="Величина_преимущества" />
							<Column name="Идентификатор_преимущества" />							
							<Column name="Величина" />
							<Column name="Бизнес_код_преимущества" />
							<Column name="Код_способа_приемущества" />
						</TargetTable>
					</TableConsolidation> 

					<TableConsolidation>
						<SourceTable flow="Позиции плана-графика" tableName="|Document|Требования_к_участникам">
							<Column name="Код_требования"  findExisting="true" />
							<Column name="Наименование_требования" />
							<Column name="Содержание_требования" />
							<Column name="Идентификатор_требования" />
							<Column name="Бизнес_код_требования" />
							<Column name="Группа" />
							<Column name="Обоснование_требования" />
							<Column name="Код_способа_требования" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Требования_к_участникам">
							<Column name="Код_требования"  findExisting="true" />
							<Column name="Наименование_требования" />
							<Column name="Содержание_требования" />
							<Column name="Идентификатор_требования" />
							<Column name="Бизнес_код_требования" />
							<Column name="Группа" />
							<Column name="Обоснование_требования" />
							<Column name="Код_способа_требования" />
						</TargetTable>
					</TableConsolidation> 

					<TableConsolidation>
						<SourceTable flow="Позиции плана-графика" tableName="|Document|Ограничения">
							<Column name="Код_ограничения"  findExisting="true" />
							<Column name="Наименование_ограничения" />
							<Column name="Содержание_ограничения" />
							<Column name="Идентификатор_ограничения" />
							<Column name="Бизнес_код_ограничения" />
							<Column name="Код_способа_ограничения" />							
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Ограничения">
							<Column name="Код_ограничения"  findExisting="true" />
							<Column name="Наименование_ограничения" />
							<Column name="Содержание_ограничения" />
							<Column name="Идентификатор_ограничения" />
							<Column name="Бизнес_код_ограничения" />
							<Column name="Код_способа_ограничения" />
						</TargetTable>
					</TableConsolidation>  -->

				</Actions>
			</Aggregation>			
			<ConditionalActions>   
				<Select>
				 <Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Links/doc_Link/link_Document, {currentDocLinkList})]" tag="Позиции плана-графика" />
				 <Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки на размещение закупки' and xn-in(doc_Id, {currentDocLinkList})]" tag="Заявки на размещение закупки" />
				</Select>
				<Actions>      
				 <ConditionalAction>      
				  <Conditions>
				   <And>
					<WhenFieldsEquals tag="{current}" path="|Document|Совместные_торги" value="1"/>       
					<WhenFormula param-someParam1="{current}|Document|Организация_заказчик|Организация_заказчик" param-someParam2="{current}|Document|ГРБС|ГРБС" formula="{someParam1}!={someParam2}"/>
					<WhenFieldsNotEquals tag="Заявки на размещение закупки" path="|Document|Статус" value=""/>
				   </And>
				  </Conditions>
				  <Actions>       
				   <CopyField sourceFlow="{current}" targetFlow="Позиции плана-графика" sourceField="%key%" targetField="|Document|ИД_заявки_совместной" />  
				   <SetField targetFlow="Позиции плана-графика" targetField="|Document|ИД_заявки" value="" />	
				   <Sum sourceFlow="Позиции плана-графика" targetFlow="{current}" sourceField="|Document|НМЦК" targetField="|Document|НМЦК" />
                   <AddLink target="{current}" link="Позиции плана-графика"/>					   
				  </Actions>      
				 </ConditionalAction>
				 <ConditionalAction>      
				  <Conditions>
				   <And>
					<WhenFieldsEquals tag="{current}" path="|Document|Совместные_торги" value="0"/> 					
				   </And>
				  </Conditions>
				  <Actions> 				 	
                    <AddLink target="{current}" link="Позиции плана-графика"/>						
				  </Actions>      
				 </ConditionalAction>
				</Actions>
			</ConditionalActions>
		</OnDocumentCreated>  
		<OnRegcardEdited transaction="single"> 
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана-графика" />
				</Select>
				<Actions>  
					<Sum sourceFlow="Позиции плана-графика" targetFlow="{current}" sourceField="|Document|НМЦК" targetField="|Document|НМЦК" />  
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана-графика" sourceField="%key%" targetField="|Document|ИД_заявки" />  

	 				<TableConsolidation>
						<SourceTable flow="Позиции плана-графика" tableName="|Document|Преимущества_к_участникам_закупки">
							<Column name="Код_преимущества" findExisting="true"/> 
							<Column name="Наименование_преимущества" />
							<Column name="Величина_преимущества" />
							<Column name="Идентификатор_преимущества" />
							<Column name="Величина" />
							<Column name="Бизнес_код_преимущества" />
							<Column name="Код_способа_приемущества" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Преимущества_к_участникам_закупки">
							<Column name="Код_преимущества" findExisting="true"/>  
							<Column name="Наименование_преимущества" />
							<Column name="Величина_преимущества" />
							<Column name="Идентификатор_преимущества" />
							<Column name="Величина" />
							<Column name="Бизнес_код_преимущества" />
							<Column name="Код_способа_приемущества" />
						</TargetTable>
					</TableConsolidation> 

					<TableConsolidation>
						<SourceTable flow="Позиции плана-графика" tableName="|Document|Требования_к_участникам">
							<Column name="Код_требования"  findExisting="true" />
							<Column name="Наименование_требования" />
							<Column name="Содержание_требования" />
							<Column name="Идентификатор_требования" />
							<Column name="Бизнес_код_требования" />
							<Column name="Группа" />
							<Column name="Обоснование_требования" />
							<Column name="Код_способа_требования" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Требования_к_участникам">
							<Column name="Код_требования"  findExisting="true" />
							<Column name="Наименование_требования" />
							<Column name="Содержание_требования" />
							<Column name="Идентификатор_требования" />
							<Column name="Бизнес_код_требования" />
							<Column name="Группа" />
							<Column name="Обоснование_требования" />
							<Column name="Код_способа_требования" />
						</TargetTable>
					</TableConsolidation> 

					<TableConsolidation>
						<SourceTable flow="Позиции плана-графика" tableName="|Document|Ограничения">
							<Column name="Код_ограничения"  findExisting="true" />
							<Column name="Наименование_ограничения" />
							<Column name="Содержание_ограничения" />
							<Column name="Идентификатор_ограничения" />
							<Column name="Бизнес_код_ограничения" />
							<Column name="Код_способа_ограничения" />							
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Ограничения">
							<Column name="Код_ограничения"  findExisting="true" />
							<Column name="Наименование_ограничения" />
							<Column name="Содержание_ограничения" />
							<Column name="Идентификатор_ограничения" />
							<Column name="Бизнес_код_ограничения" />
							<Column name="Код_способа_ограничения" />
						</TargetTable>
					</TableConsolidation>  

				</Actions>
			</Aggregation>
		</OnRegcardEdited>
		<OnLinkAdded transaction="single">
			<Aggregation>
				<Select>
					<!-- <Select searchString="document[doc_Id = '{current_Id}']" tag="Заявки на размещение закупки" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_Id = document[doc_Links/doc_Link/link_Document={Заявки на размещение закупки}/doc_Id]]" tag="Позиции плана-графика" /> -->
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Links/doc_Link/link_Document, {currentDocLinkList})]" tag="ППГ_связь" />
				</Select>
				<Actions>
					<Sum sourceFlow="ППГ_связь" targetFlow="{current}" sourceField="|Document|НМЦК" targetField="|Document|НМЦК" />
					<CopyField sourceFlow="{current}" targetFlow="ППГ_связь" sourceField="%key%" targetField="|Document|ИД_заявки" />      
					<SetField targetFlow="ППГ_связь" targetField="|Document|Статус" value="Включена в заявку на размещение закупки" />
					<AddLink target="{current}" link="ППГ_связь"/>
				</Actions>
			</Aggregation>
		</OnLinkAdded>
		<OnLinkDeleted transaction="split">
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Заявки на размещение закупки" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_Id = document[doc_Links/doc_Link/link_Document={Заявки на размещение закупки}/doc_Id]]" tag="Позиции плана-графика" />
				</Select>
				<Actions>
					<Sum sourceFlow="Позиции плана-графика" targetFlow="Заявки на размещение закупки" sourceField="|Document|НМЦК" targetField="|Document|НМЦК" />
				</Actions>
			</Aggregation>
		</OnLinkDeleted> 
	</Flow>
	<Flow name="Извещения о закупочной процедуре">
		<LinksModify>
			<LinkCurrentDoc />
			<LinkAllLinksWhereFlow name="Позиции плана-графика" />
		</LinksModify>
		<FieldsModify>
			<CopyField src="|Document|Способ_определения_поставщика_код" />
			<CopyField src="|Document|Способ_определения_поставщика" />
			<CopyField src="|Document|Наименование_объекта_закупки" />
			<CopyField src="|Document|НМЦК" />
			<CopyField src="|Document|Код_валюты" />
			<CopyField src="|Document|Валюта" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СПЗ" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СР" /> 
			<CopyField src="|Document|Организатор_закупки|Код_в_ЕИС" />
			<CopyField src="|Document|Роль_организатора_закупки" />
			<CopyField src="|Document|Роль_организатора_закупки_код" /> 
			<CopyField src="|Document|Планируемый_месяц_размещения" />
			<CopyField src="|Document|Планируемый_год_размещения" />	
			<CopyField src="|Document|Планируемый_срок_размещения" />
			<CopyField src="|Document|Инициатор_заявки|Инициатор_заявки"/>
			<CopyField src="|Document|Инициатор_заявки|Инициатор_заявки_ФИО"/>
			<CopyField src="|Document|Ответственный_руководитель|Ответственный_руководитель"/>
			<CopyField src="|Document|Ответственный_руководитель|Ответственный_руководитель_ФИО"/>
			<CopyField src="|Document|Централизованная_закупка" />
			<CopyField src="|Document|Совместные_торги" />
			<CopyField src="|Document|Требуется_согласование_юриста" />
			<CopyTable src="|Document|Номер_регистрации" />			
		</FieldsModify>
		<OnDocumentCreated transaction="single">
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки на размещение закупки' and xn-in(doc_Id, {currentDocLinkList})]" tag="Заявки на размещение закупки" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_Id = document[doc_Links/doc_Link/link_Document={Заявки на размещение закупки}/doc_Id]]" tag="Позиции плана-графика" />
					<SelectLink source="{current}" flow="Заявки на размещение закупки" tag="Заявки на размещение закупки"/>
					<SelectLink source="{current}" flow="Позиции плана-графика" tag="Позиции плана-графика"/>
				</Select>		
				<Actions>
					<SetField targetFlow="Позиции плана-графика" targetField="|Document|Статус" value="Подготовка извещения" />
					<CopyField targetFlow="Позиции плана-графика" targetField="|Document|ИД_извещения" sourceFlow="{current}" sourceField ="%key%" />
					<CopyField targetFlow="Заявки на размещение закупки" targetField="|Document|ИД_извещения" sourceFlow="{current}" sourceField ="%key%" />
					<CopyField targetFlow="Заявки на размещение закупки" targetField="|Document|Дата_окончания_подачи_заявок" sourceFlow="{current}" sourceField ="|Document|Порядок_проведения_процедуры|Дата_окончания_подачи_заявок" />
					<Sum sourceFlow="Заявки на размещение закупки" targetFlow="{current}" sourceField="|Document|НМЦК" targetField="|Document|НМЦК" />
					<SetField targetFlow="Заявки на размещение закупки" targetField="|Document|Статус" value="Подготовка извещения" />
					<CopyField targetFlow="Заявки на размещение закупки" targetField="|Document|Срок_отмены_закупки" sourceFlow="{current}" sourceField ="|Document|Срок_отмены_закупки" />
					<CopyField targetFlow="Заявки на размещение закупки" targetField="|Document|Срок_внесения_изменений" sourceFlow="{current}" sourceField ="|Document|Срок_внесения_изменений" />
					<CopyField targetFlow="Заявки на размещение закупки" targetField="|Document|Срок_подачи_заявки_на_разъяснение" sourceFlow="{current}" sourceField ="|Document|Срок_подачи_заявки_на_разъяснение" />
					<CopyAttachments sourceFlow="Заявки на размещение закупки" targetFlow="{current}" sourceCategory="Документация" targetCategory="Документация"/>
				</Actions>
			</Aggregation>
		</OnDocumentCreated>

		<OnRegcardEdited transaction="single"> 
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки на размещение закупки' and xn-in(doc_Id, {currentDocLinkList})]" tag="Заявки на размещение закупки" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_Id = document[doc_Links/doc_Link/link_Document={Заявки на размещение закупки}/doc_Id]]" tag="Позиции плана-графика" />
					<SelectLink source="{current}" flow="Заявки на размещение закупки" tag="Заявки на размещение закупки"/>
					<SelectLink source="{current}" flow="Позиции плана-графика" tag="Позиции плана-графика"/>
				</Select>
				<Actions>  
					<CopyField targetFlow="Позиции плана-графика" targetField="|Document|ИД_извещения" sourceFlow="{current}" sourceField ="%key%" />
					<CopyField targetFlow="Заявки на размещение закупки" targetField="|Document|Дата_окончания_подачи_заявок" sourceFlow="{current}" sourceField ="|Document|Порядок_проведения_процедуры|Дата_окончания_подачи_заявок" />
					<CopyField targetFlow="Заявки на размещение закупки" targetField="|Document|Срок_отмены_закупки" sourceFlow="{current}" sourceField ="|Document|Срок_отмены_закупки" />
					<CopyField targetFlow="Заявки на размещение закупки" targetField="|Document|Срок_внесения_изменений" sourceFlow="{current}" sourceField ="|Document|Срок_внесения_изменений" />
					<CopyField targetFlow="Заявки на размещение закупки" targetField="|Document|Срок_подачи_заявки_на_разъяснение" sourceFlow="{current}" sourceField ="|Document|Срок_подачи_заявки_на_разъяснение" />
					<CopyField targetFlow="Заявки на размещение закупки" targetField="|Document|Номер_лота_в_извещении" sourceFlow="{current}" sourceField ="|Document|Номер_лота_в_извещении" />
					<Sum sourceFlow="Заявки на размещение закупки" targetFlow="{current}" sourceField="|Document|НМЦК" targetField="|Document|НМЦК" />					
				</Actions>
			</Aggregation>
		</OnRegcardEdited>

		<OnLinkAdded>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Извещения о закупочной процедуре" />
					<SelectLink flow="Заявки на размещение закупки" tag="Связанная заявка на размещение">
						<SelectLink flow="Позиции плана-графика" tag="Позиции плана-графика"/>
					</SelectLink>
				</Select>
				<Actions>
					<AddLink target="Извещения о закупочной процедуре" link="Позиции плана-графика" />
					<SetField targetFlow="Позиции плана-графика" targetField="|Document|Статус" value="Подготовка извещения" />
					<CopyField targetFlow="Позиции плана-графика" targetField="|Document|ИД_извещения" sourceFlow="Извещения о закупочной процедуре" sourceField ="%key%" />
					<Sum sourceFlow="Связанная заявка на размещение" targetFlow="Извещения о закупочной процедуре" sourceField="|Document|НМЦК" targetField="|Document|НМЦК" />
					<SetField targetFlow="Связанная заявка на размещение" targetField="|Document|Статус" value="Подготовка извещения" />
				</Actions>
			</Aggregation>
		</OnLinkAdded>

		<OnLinkDeleted>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Извещения о закупочной процедуре" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки на размещение закупки' and doc_Id = document[doc_Links/doc_Link/link_Document={Извещения о закупочной процедуре}/doc_Id]]" tag="Заявки на размещение закупки" />
				</Select>
				<Actions>
					<Sum sourceFlow="Заявки на размещение закупки" targetFlow="Извещения о закупочной процедуре" sourceField="|Document|НМЦК" targetField="|Document|НМЦК" />
				</Actions>
			</Aggregation>
		</OnLinkDeleted>
	</Flow> 
	<Flow name="Соглашения">
		<FieldsModify>
			<CopyField src="%key%"  dst="|Document|ИД_позиции_ПГ" />
			<CopyField src="|Document|Наименование_объекта_закупки"  dst="|Document|Предмет_контракта" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование"   />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СПЗ"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СР"   />
			<CopyField src="|Document|Организация_заказчик|ОКТМО"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКОПФ"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКТМОППО"   />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Дата_постановки_на_учет"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование"   />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки"   />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СПЗ"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СР" />
			<CopyField src="|Document|Организатор_совместных_торгов|Организатор_совместных_торгов" />
			<CopyField src="|Document|Организатор_совместных_торгов|Организатор_совместных_торгов_наименование" />
			<CopyField src="|Document|ИКЗ" /> 
		</FieldsModify>

		<LinksModify>
			<LinkCurrentDoc />
		</LinksModify> 

		<!--  <OnDocumentCreated>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="Соглашения" />
				</Select>
				<Actions>
					<CopyField sourceFlow="Позиции плана-графика" targetFlow="Соглашения" sourceField="%key%" targetField="|Document|ИД_позиции_ПГ" />
				</Actions>
			</Aggregation>
		</OnDocumentCreated>  -->
	</Flow>	
	<Flow name="Протоколы">
		<LinksModify>
			<LinkCurrentDoc />
			<LinkAllLinksWhereFlow name="Заявки на размещение закупки" />
			<LinkAllLinksWhereFlow name="Извещения о закупочной процедуре" />
		</LinksModify>
		
		<FieldsModify>
			<CopyField src="|Document|Номер_закупки_в_ЕИС" />
			<CopyField src="|Document|Способ_определения_поставщика_код" />
			<CopyField src="|Document|Способ_определения_поставщика" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СПЗ" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СР" /> 
			 <CopyField src="|Document|Роль_организатора_закупки" />
			<CopyField src="|Document|Роль_организатора_закупки_код" />
			<CopyField src="|Document|ИД_извещения" />
			<CopyField src="|Document|Номер_лота_в_извещении" />
			<CopyField src="|Document|Название_комиссии" />
			<CopyField src="|Document|Дополнительная_информация" />
			 <CopyField src="|Document|Номер_заявки" /> 
			<CopyField src="|Document|Номер_протокола"  dst="|Document|Номер_предыдущего_протокола" />
			<CopyField src="|Document|Вид_протокола"  dst="|Document|Наименование_предыдущего_протокола" />
			<CopyField src="|Document|Дата_составления"  dst="|Document|Дата_предыдущего_протокола" />
			<CopyField src="|Document|Место_рассмотрения_заявок"  dst="|Document|Место_предыдущего_протокола" />
			<CopyField src="|Document|НМЦК" /> 
			<CopyField src="|Document|Значимость" />  
			<CopyTable src="|Document|Список_документов" />
			<CopyTable src="|Document|Участники_комиссии" />
			<CopyTable src="|Document|Критерии_оценки_заявки_участников" />
			<!-- ===== START [РАБОТА КОМИССИИ] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolOK2">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="PRO">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол рассмотрения и оценки заявок на участие в открытом конкурсе">
					<And>
						<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
					</And>
				</SetField>
				<!-- ===== END [РАБОТА КОМИССИИ] ===== -->
				
				<!-- ===== START [РАБОТА КОМИССИИ] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolZPFinal">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="IP">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Итоговый протокол">
					<And>
						<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
					</And>
				</SetField>
				<!-- ===== END [РАБОТА КОМИССИИ] ===== -->
				
				<!-- ===== START [РАБОТА КОМИССИИ] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolOKOU2">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="PPO">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол предквалификационного отбора">
					<And>
						<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
					</And>
				</SetField>
				<!-- ===== END [РАБОТА КОМИССИИ] ===== -->
				
				<!-- ===== START [РАБОТА КОМИССИИ] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolOKD2">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="PPO">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол предквалификационного отбора">
					<And>
						<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
					</And>
				</SetField>
				<!-- ===== END [РАБОТА КОМИССИИ] ===== -->
				
				<!-- ===== START [РАБОТА КОМИССИИ] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolZKAfterProlong">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="PP">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол рассмотрения и оценки котировочных заявок по результатам продления срока подачи заявок">
					<And>
						<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
					</And>
				</SetField>
				<!-- ===== END [РАБОТА КОМИССИИ] ===== -->
				
				<!-- ===== START [ЗАКУПКА ЗАВЕРШЕНА] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolEvasion">
						<And>
							<Or>
								<WhenParentFieldEquals path="|Document|Статус" value="Закупка завершена" />
								<WhenParentFieldEquals path="|Document|Статус" value="Закупка завершена (одна заявка)" />
							</Or>
							<Or>
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
							</Or>
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="POK">
						<And>
							<Or>
								<WhenParentFieldEquals path="|Document|Статус" value="Закупка завершена" />
								<WhenParentFieldEquals path="|Document|Статус" value="Закупка завершена (одна заявка)" />
							</Or>
							<Or>
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
							</Or>
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол отказа от заключения контракта">
					<And>
						<Or>
							<WhenParentFieldEquals path="|Document|Статус" value="Закупка завершена" />
							<WhenParentFieldEquals path="|Document|Статус" value="Закупка завершена (одна заявка)" />
						</Or>
						<Or>
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
						</Or>
					</And>
				</SetField>
				<!-- ===== END [ЗАКУПКА ЗАВЕРШЕНА] ===== -->
		</FieldsModify>
		
		<FieldsModify source="Извещения о закупочной процедуре">  
		  <CopyField src="|Document|Номер_закупки_в_ЕИС" /> 
			 <CopyField src="|Document|Способ_определения_поставщика_код" />
			<CopyField src="|Document|Способ_определения_поставщика" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СПЗ" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СР" /> 
			<CopyField src="|Document|Роль_организатора_закупки" />
			<CopyField src="|Document|Роль_организатора_закупки_код" />
			<CopyField src="|Document|ИД_извещения" />
			<CopyField src="|Document|Номер_лота_в_извещении" />
			<CopyField src="|Document|Номер_заявки" />  
			 <CopyField src="|Document|Номер_протокола"  dst="|Document|Номер_предыдущего_протокола" />
			<CopyField src="|Document|Дата_составления"  dst="|Document|Дата_предыдущего_протокола" />
			<CopyField src="|Document|Место_рассмотрения_заявок"  dst="|Document|Место_предыдущего_протокола" /> 
			<CopyField src="|Document|НМЦК" /> 
			
			<!-- ===== START [ОТКРЫТЫЙ КОНКУРС] ===== -->
		
				<!-- ===== START [ПОДАЧА ЗАЯВОК] ===== -->
					 <SetField dst="|Document|Объект_протокола" value="fcsProtocolOK1">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="PVK">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол вскрытия конвертов с заявками на участие в открытом конкурсе и открытия доступа к поданным в форме электронных документов заявкам на участие в открытом конкурсе">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
						</And>
					</SetField>
					
					<SetField dst="|Document|Признан_несостоявшимся" value="1">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="0" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Код_признания_несост" value="NR">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="0" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Наименование_признания_несост" value="По окончании срока подачи заявок не подано ни одной заявки.">
					<And>
						<WhenParentLinksCount flow="Заявки участников" value="0" />
						<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
					</And>
				</SetField> 
				<!-- ===== END [ПОДАЧА ЗАЯВОК] ===== -->
				
				<!-- ===== START [РАБОТА КОМИССИИ] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolOK2">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="PRO">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол рассмотрения и оценки заявок на участие в открытом конкурсе">
					<And>
						<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
					</And>
				</SetField>
				<!-- ===== END [РАБОТА КОМИССИИ] ===== -->
			
			<!-- ===== END [ОТКРЫТЫЙ КОНКУРС] ===== -->
		
			<!-- ===== START [ЗАПРОС ПРЕДЛОЖЕНИЯ] ===== -->
		
				<!-- ===== START [ПОДАЧА ЗАЯВОК] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolZP">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="PP">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол проведения запроса предложений">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
						</And>
					</SetField>
					
					<SetField dst="|Document|Признан_несостоявшимся" value="1">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="0" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
						</And>
					</SetField>
					<SetField dst="|Document|Код_признания_несост" value="NR">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="0" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
						</And>
					</SetField>
					<SetField dst="|Document|Наименование_признания_несост" value="По окончании срока подачи заявок не подано ни одной заявки.">
					<And>
						<WhenParentLinksCount flow="Заявки участников" value="0" />
						<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
					</And>
				</SetField>
				<!-- ===== END [ПОДАЧА ЗАЯВОК] ===== -->
				
				<!-- ===== START [РАБОТА КОМИССИИ] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolZPFinal">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="IP">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Итоговый протокол">
					<And>
						<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
					</And>
				</SetField>
				<!-- ===== END [РАБОТА КОМИССИИ] ===== -->
				
			<!-- ===== END [ЗАПРОС ПРЕДЛОЖЕНИЯ] ===== -->
			
			<!-- ===== START [КОНКУРС С ОГРАНИЧЕННЫМ УЧАСТИЕМ] ===== -->
		
				<!-- ===== START [ПОДАЧА ЗАЯВОК] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolOKOU1">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="PVK">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол вскрытия конвертов с заявками на участие в конкурсе с ограниченным участием и открытия доступа к поданным в форме электронных документов заявкам на участие в конкурсе с ограниченным участием">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
						</And>
					</SetField>
					
					<SetField dst="|Document|Признан_несостоявшимся" value="1">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="0" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
						</And>
					</SetField>
					<SetField dst="|Document|Код_признания_несост" value="NR">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="0" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
						</And>
					</SetField>
					<SetField dst="|Document|Наименование_признания_несост" value="По окончании срока подачи заявок не подано ни одной заявки.">
					<And>
						<WhenParentLinksCount flow="Заявки участников" value="0" />
						<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
					</And>
				</SetField>
				<!-- ===== END [ПОДАЧА ЗАЯВОК] ===== -->
				
				<!-- ===== START [РАБОТА КОМИССИИ] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolOKOU2">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="PPO">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол предквалификационного отбора">
					<And>
						<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
					</And>
				</SetField>
				<!-- ===== END [РАБОТА КОМИССИИ] ===== -->
				
			<!-- ===== END [КОНКУРС С ОГРАНИЧЕННЫМ УЧАСТИЕМ] ===== -->
			
			<!-- ===== START [ДВУХЭТАПНЫЙ КОНКУРС] ===== -->
		
				<!-- ===== START [ПОДАЧА ЗАЯВОК] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolOKD1">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="PVKI">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол вскрытия конвертов с заявками на участие в первом этапе двухэтапного конкурса и открытия доступа к поданным в форме электронных документов заявкам на участие в первом этапе двухэтапного конкурса">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
						</And>
					</SetField>
					
					<SetField dst="|Document|Признан_несостоявшимся" value="1">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="0" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
						</And>
					</SetField>
					<SetField dst="|Document|Код_признания_несост" value="NR">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="0" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
						</And>
					</SetField>
					<SetField dst="|Document|Наименование_признания_несост" value="По окончании срока подачи заявок не подано ни одной заявки.">
					<And>
						<WhenParentLinksCount flow="Заявки участников" value="0" />
						<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
					</And>
				</SetField>
				<!-- ===== END [ПОДАЧА ЗАЯВОК] ===== -->
				
				<!-- ===== START [РАБОТА КОМИССИИ] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolOKD2">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="PPO">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол предквалификационного отбора">
					<And>
						<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
					</And>
				</SetField>
				<!-- ===== END [РАБОТА КОМИССИИ] ===== -->
				
			<!-- ===== END [ДВУХЭТАПНЫЙ КОНКУРС] ===== -->
			
			<!-- ===== START [ЗАПРОС КОТИРОВОК] ===== -->
		
				<!-- ===== START [ПОДАЧА ЗАЯВОК] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolZK">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="P">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол рассмотрения и оценки заявок на участие в запросе котировок">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="any" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
						</And>
					</SetField>
					
					<SetField dst="|Document|Признан_несостоявшимся" value="1">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="0" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Код_признания_несост" value="NR">
						<And>
							<WhenParentLinksCount flow="Заявки участников" value="0" />
							<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Наименование_признания_несост" value="По окончании срока подачи заявок не подано ни одной заявки.">
					<And>
						<WhenParentLinksCount flow="Заявки участников" value="0" />
						<WhenParentFieldEquals path="|Document|Статус" value="Подача заявок" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
					</And>
				</SetField>
				<!-- ===== END [ПОДАЧА ЗАЯВОК] ===== -->
				
				<!-- ===== START [РАБОТА КОМИССИИ] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolZKAfterProlong">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="PP">
						<And>
							<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол рассмотрения и оценки котировочных заявок по результатам продления срока подачи заявок">
					<And>
						<WhenParentFieldEquals path="|Document|Статус" value="Работа комиссии" />
						<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
					</And>
				</SetField>
				<!-- ===== END [РАБОТА КОМИССИИ] ===== -->
				
			<!-- ===== END [ЗАПРОС КОТИРОВОК] ===== -->
			
			<!-- ===== START [ЗАКУПКА ЗАВЕРШЕНА] ===== -->
					<SetField dst="|Document|Объект_протокола" value="fcsProtocolEvasion">
						<And>
							<Or>
								<WhenParentFieldEquals path="|Document|Статус" value="Закупка завершена" />
								<WhenParentFieldEquals path="|Document|Статус" value="Закупка завершена (одна заявка)" />
							</Or>
							<Or>
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
							</Or>
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола_код" value="POK">
						<And>
							<Or>
								<WhenParentFieldEquals path="|Document|Статус" value="Закупка завершена" />
								<WhenParentFieldEquals path="|Document|Статус" value="Закупка завершена (одна заявка)" />
							</Or>
							<Or>
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
								<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
							</Or>
						</And>
					</SetField>
					<SetField dst="|Document|Вид_протокола" value="Протокол отказа от заключения контракта">
					<And>
						<Or>
							<WhenParentFieldEquals path="|Document|Статус" value="Закупка завершена" />
							<WhenParentFieldEquals path="|Document|Статус" value="Закупка завершена (одна заявка)" />
						</Or>
						<Or>
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OK44" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZP44" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKU44" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="OKD44" />
							<WhenParentFieldEquals path="|Document|Способ_определения_поставщика_код" value="ZK44" />
						</Or>
					</And>
				</SetField>
				<!-- ===== END [ЗАКУПКА ЗАВЕРШЕНА] ===== -->
			
			<!-- <CopyField src="|Document|Номер_закупки_в_ЕИС" />
			<CopyField src="|Document|Способ_определения_поставщика_код" />
			<CopyField src="|Document|Способ_определения_поставщика" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СПЗ" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СР" /> 
			<CopyField src="|Document|Роль_организатора_закупки" />
			<CopyField src="|Document|Роль_организатора_закупки_код" />
			<CopyField src="|Document|ИД_извещения" />
			<CopyField src="|Document|Номер_лота_в_извещении" />
			<CopyField src="|Document|Номер_заявки" /> -->
			<!-- <CopyField src="|Document|Номер_протокола"  dst="|Document|Номер_предыдущего_протокола" />
			<CopyField src="|Document|Дата_составления"  dst="|Document|Дата_предыдущего_протокола" />
			<CopyField src="|Document|Место_рассмотрения_заявок"  dst="|Document|Место_предыдущего_протокола" /> -->
			<!-- <CopyField src="|Document|НМЦК" /> -->
		  </FieldsModify>  
		 
		
	<!-- 	<FieldsModify source="Протоколы">
			 <CopyField src="|Document|Номер_закупки_в_ЕИС" />
			<CopyField src="|Document|Способ_определения_поставщика_код" />
			<CopyField src="|Document|Способ_определения_поставщика" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СПЗ" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СР" /> 
			 <CopyField src="|Document|Роль_организатора_закупки" />
			<CopyField src="|Document|Роль_организатора_закупки_код" />
			<CopyField src="|Document|ИД_извещения" />
			<CopyField src="|Document|Номер_лота_в_извещении" />
			<CopyField src="|Document|Название_комиссии" />
			<CopyField src="|Document|Дополнительная_информация" />
			 <CopyField src="|Document|Номер_заявки" /> 
			<CopyField src="|Document|Номер_протокола"  dst="|Document|Номер_предыдущего_протокола" />
			<CopyField src="|Document|Вид_протокола"  dst="|Document|Наименование_предыдущего_протокола" />
			<CopyField src="|Document|Дата_составления"  dst="|Document|Дата_предыдущего_протокола" />
			<CopyField src="|Document|Место_рассмотрения_заявок"  dst="|Document|Место_предыдущего_протокола" />
			<CopyField src="|Document|НМЦК" /> 
			<CopyTable src="|Document|Список_документов" />
			<CopyTable src="|Document|Участники_комиссии" />
			<CopyTable src="|Document|Критерии_оценки_заявки_участников" />
		</FieldsModify> -->
		
		<OnDocumentCreated transaction="single">
			<ConditionalActions>
				<Select>					
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Извещения о закупочной процедуре' and xn-in(doc_Id, {currentDocLinkList})]" tag="parent" /> 
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки участников' and doc_Id = document[doc_Links/doc_Link/link_Document={parent}/doc_Id]]" tag="Заявки участников" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки участников' and doc_Id = document[doc_Links/doc_Link/link_Document={parent}/doc_Id]  and doc_RegCard/rc_Index/boolean_Победитель = '1']" tag="Заявки участников Победитель" />
				</Select>					 
   <Actions>
						
						<!-- ===== START  ===== -->
						<ConditionalAction>
							<Conditions>
								<And>
								<Or>
									<WhenFieldsEquals tag="parent" path="|Document|Способ_определения_поставщика_код" value="OK44"/>
									<WhenFieldsEquals tag="parent" path="|Document|Способ_определения_поставщика_код" value="ZP44"/>
									<WhenFieldsEquals tag="parent" path="|Document|Способ_определения_поставщика_код" value="OKU44"/>
									<WhenFieldsEquals tag="parent" path="|Document|Способ_определения_поставщика_код" value="OKD44"/>
									<WhenFieldsEquals tag="parent" path="|Document|Способ_определения_поставщика_код" value="ZK44"/>
								</Or>
								<Or>
									<WhenFieldsEquals tag="parent" path="|Document|Статус" value="Подача заявок"/>
									<WhenFieldsEquals tag="parent" path="|Document|Статус" value="Работа комиссии"/>
								</Or>
								</And>
							</Conditions>
							<Actions>
								<AddLink target="{current}" link="Заявки участников"/>
							</Actions>
						</ConditionalAction>
						<!-- ===== END  ===== -->
					
					
						<!-- ===== START [ЗАКУПКА ЗАВЕРШЕНА] ===== -->
						<ConditionalAction>
							<Conditions>
								<And>
									<Or>
										<WhenFieldsEquals tag="parent" path="|Document|Способ_определения_поставщика_код" value="OK44"/>
										<WhenFieldsEquals tag="parent" path="|Document|Способ_определения_поставщика_код" value="ZP44"/>
										<WhenFieldsEquals tag="parent" path="|Document|Способ_определения_поставщика_код" value="OKU44"/>
									    <WhenFieldsEquals tag="parent" path="|Document|Способ_определения_поставщика_код" value="OKD44"/>
									    <WhenFieldsEquals tag="parent" path="|Document|Способ_определения_поставщика_код" value="ZK44"/>
									</Or>
									<Or>
										<WhenFieldsEquals tag="parent" path="|Document|Статус" value="Закупка завершена"/>
										<WhenFieldsEquals tag="parent" path="|Document|Статус" value="Закупка завершена (одна заявка)"/>
									</Or>
								</And>
							</Conditions>
							<Actions>
								<AddLink target="{current}" link="Заявки участников Победитель"/> 
							</Actions>
					   </ConditionalAction>	
						<!-- ===== END [ЗАКУПКА ЗАВЕРШЕНА ===== -->
		   </Actions>
			</ConditionalActions>
			<Aggregation>
				<Select>				
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Извещения о закупочной процедуре' and xn-in(doc_Id, {currentDocLinkList})]" tag="Извещения о закупочной процедуре" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки на размещение закупки' and doc_Id = document[doc_Links/doc_Link/link_Document={Извещения о закупочной процедуре}/doc_Id]]" tag="Заявки на размещение закупки" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки участников' and xn-in(doc_Links/doc_Link/link_Document, {currentDocLinkList})]" tag="Заявки участников" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Протоколы' and xn-in(doc_Id, {currentDocLinkList})]" tag="Протоколы" />
				</Select>
				<Actions>
				<VerifyExpression>
						<Variables>
							<Variable name="Значимость" source="{current}" path="|Document|Значимость"  />
							<Variable name="Объект_протокола" source="{current}" path="|Document|Объект_протокола"  />
						</Variables>
						<Expression value="(($NullToZero({Значимость})= 100) And ({Объект_протокола}=&quot;fcsProtocolOK1&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD4&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOU1&quot;)) Or {Объект_протокола}=&quot;fcsProtocolCancel&quot; Or {Объект_протокола}=&quot;fcsProtocolDeviation&quot; Or {Объект_протокола}=&quot;fcsProtocolEvasion&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD1&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD2&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD3&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD5&quot; Or {Объект_протокола}=&quot;fcsProtocolOK2&quot; Or {Объект_протокола}=&quot;fcsProtocolOKSingleApp&quot; Or {Объект_протокола}=&quot;fcsProtocolOKDSingleApp&quot;  Or {Объект_протокола}=&quot;fcsProtocolOKOUSingleApp&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOU2&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOU3&quot; Or {Объект_протокола}=&quot;fcsProtocolPO&quot; Or {Объект_протокола}=&quot;fcsProtocolZK&quot; Or {Объект_протокола}=&quot;fcsProtocolZKAfterProlong&quot; Or {Объект_протокола}=&quot;fcsProtocolZP&quot; Or {Объект_протокола}=&quot;fcsProtocolZPExtract&quot; Or {Объект_протокола}=&quot;fcsProtocolZPFinal&quot;"/>
						<FailtureText value="Сумма значимостей всех критериев должна быть равна 100"/>
					</VerifyExpression>
					<CopyField sourceFlow="Извещения о закупочной процедуре" targetFlow="{current}" sourceField="%key%" targetField="|Document|ИД_извещения" />					
					<CopyField targetFlow="Заявки на размещение закупки" targetField="|Document|ИД_протокола" sourceFlow="{current}" sourceField ="%key%" />	
					<CopyField targetFlow="Извещения о закупочной процедуре" targetField="|Document|Номер_протокола" sourceFlow="{current}" sourceField ="|Document|Номер_протокола" />	
					<CopyField targetFlow="Заявки участников" targetField="|Document|Номер_протокола" sourceFlow="{current}" sourceField ="%key%" />	
					<CopyField targetFlow="Заявки участников" targetField="|Document|Объект_протокола" sourceFlow="{current}" sourceField ="|Document|Объект_протокола" />	
					<CopyField targetFlow="Заявки участников" targetField="|Document|Вид_протокола_код" sourceFlow="{current}" sourceField ="|Document|Вид_протокола_код" />
					<TableConsolidation>
						<SourceTable flow="{current}" tableName="|Document|Список_документов">
							<Column name="Порядковый_номер" />
							<Column name="Наименование_документа" />
							<Column name="Обязательность_предоставления" />
						</SourceTable>
						<TargetTable flow="Заявки участников" tableName="|Document|Список_документов">
							<Column name="Порядковый_номер"  findExisting="true"/>  
							<Column name="Наименование_документа" /> 
							<Column name="Обязательность_предоставления" />
						</TargetTable>
					</TableConsolidation> 
					<TableConsolidation>
						<SourceTable flow="{current}" tableName="|Document|Критерии_оценки_заявки_участников">
							<Column name="Код_критерия" />
							<Column name="Критерий" />
							<Column name="Значимость_критерия" />
							<Column name="Дополнение_критерия" />
							<Column name="Лимит_критерия" />
							<Column name="Порядок_оценки_критерия" />
							<Column name="Порядок_оценки_критерия_код" />
							<Column name="Наличие_показателя" />
							<Column name="Код_показателя_оценки" />
							<Column name="Наименование_показателя" />
							<Column name="Порядок_оценки_по_показателю" />
							<Column name="доп_информация_по_показателю" />
							<Column name="Код_порядка" />
						</SourceTable>
						<TargetTable flow="Заявки участников" tableName="|Document|Критерии_оценки_заявки_участников">
							<Column name="Код_критерия"  findExisting="true"/>  
							<Column name="Критерий" />
							<Column name="Значимость_критерия" />
							<Column name="Дополнение_критерия" />
							<Column name="Лимит_критерия" />
							<Column name="Порядок_оценки_критерия" />
							<Column name="Порядок_оценки_критерия_код" />
							<Column name="Наличие_показателя" />
							<Column name="Код_показателя" />
							<Column name="Наименование_показателя" />
							<Column name="Порядок_оценки_по_показателю" />
							<Column name="Доп_информация_по_показателю" />
							<Column name="Код_порядка" />
						</TargetTable>
					</TableConsolidation>	
					<TableConsolidation>
						<SourceTable flow="{current}" tableName="|Document|Участники_комиссии">
							<Column name="Номер" />
							<Column name="ФИО_комиссии|Фамилия_комиссии" />
							<Column name="ФИО_комиссии|Имя_комиссии" />
							<Column name="ФИО_комиссии|Отчество_комиссии" />
						</SourceTable>
						<TargetTable flow="Заявки участников" tableName="|Document|Выбор_комиссии">
							<Column name="Номер_комиссии"  findExisting="true"/>  
							<Column name="Фамилия" />
							<Column name="Имя" />
							<Column name="Отчество" />
						</TargetTable>
					</TableConsolidation>	
					<TableRowsCountCheck sourceTag="{current}" tableName="|Document|Участники_комиссии" operation="less" value="1" message="В документе должно быть не менее 1 участников комисии" />			
				</Actions>
			</Aggregation>
		</OnDocumentCreated>
		
		<OnRegcardEdited transaction="single">
			<Aggregation>
				<Select>
				<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки участников' and xn-in(doc_Links/doc_Link/link_Document, {currentDocLinkList})]" tag="Заявки участников" />
				</Select>
				<Actions>
				<VerifyExpression>
						<Variables>
							<Variable name="Значимость" source="{current}" path="|Document|Значимость"  />
							<Variable name="Объект_протокола" source="{current}" path="|Document|Объект_протокола"  />
						</Variables>
						<Expression value="(($NullToZero({Значимость})= 100) And ({Объект_протокола}=&quot;fcsProtocolOK1&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD4&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOU1&quot;)) Or {Объект_протокола}=&quot;fcsProtocolCancel&quot; Or {Объект_протокола}=&quot;fcsProtocolDeviation&quot; Or {Объект_протокола}=&quot;fcsProtocolEvasion&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD1&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD2&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD3&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD5&quot; Or {Объект_протокола}=&quot;fcsProtocolOK2&quot; Or {Объект_протокола}=&quot;fcsProtocolOKSingleApp&quot; Or {Объект_протокола}=&quot;fcsProtocolOKDSingleApp&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOUSingleApp&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOU2&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOU3&quot; Or {Объект_протокола}=&quot;fcsProtocolPO&quot; Or {Объект_протокола}=&quot;fcsProtocolZK&quot; Or {Объект_протокола}=&quot;fcsProtocolZKAfterProlong&quot; Or {Объект_протокола}=&quot;fcsProtocolZP&quot; Or {Объект_протокола}=&quot;fcsProtocolZPExtract&quot; Or {Объект_протокола}=&quot;fcsProtocolZPFinal&quot;"/>
						<FailtureText value="Сумма значимостей всех критериев должна быть равна 100"/>
					</VerifyExpression>
					<TableConsolidation>
						<SourceTable flow="{current}" tableName="|Document|Список_документов">
							<Column name="Порядковый_номер" />
							<Column name="Наименование_документа" />
							<Column name="Обязательность_предоставления" />
						</SourceTable>
						<TargetTable flow="Заявки участников" tableName="|Document|Список_документов">
							<Column name="Порядковый_номер"  findExisting="true"/>  
							<Column name="Наименование_документа" /> 
							<Column name="Обязательность_предоставления" />
						</TargetTable>
					</TableConsolidation> 
					<TableConsolidation>
						<SourceTable flow="{current}" tableName="|Document|Критерии_оценки_заявки_участников">
							<Column name="Код_критерия" />
							<Column name="Критерий" />
							<Column name="Значимость_критерия" />
							<Column name="Дополнение_критерия" />
							<Column name="Лимит_критерия" />
							<Column name="Порядок_оценки_критерия" />
							<Column name="Порядок_оценки_критерия_код" />
							<Column name="Наличие_показателя" />
							<Column name="Код_показателя_оценки" />
							<Column name="Наименование_показателя" />
							<Column name="Порядок_оценки_по_показателю" />
							<Column name="доп_информация_по_показателю" />
							<Column name="Код_порядка" />
						</SourceTable>
						<TargetTable flow="Заявки участников" tableName="|Document|Критерии_оценки_заявки_участников">
							<Column name="Код_критерия"  findExisting="true"/>  
							<Column name="Критерий" />
							<Column name="Значимость_критерия" />
							<Column name="Дополнение_критерия" />
							<Column name="Лимит_критерия" />
							<Column name="Порядок_оценки_критерия" />
							<Column name="Порядок_оценки_критерия_код" />
							<Column name="Наличие_показателя" />
							<Column name="Код_показателя" />
							<Column name="Наименование_показателя" />
							<Column name="Порядок_оценки_по_показателю" />
							<Column name="Доп_информация_по_показателю" />
							<Column name="Код_порядка" />
						</TargetTable>
					</TableConsolidation>	
					<TableConsolidation>
						<SourceTable flow="{current}" tableName="|Document|Участники_комиссии">
							<Column name="Номер" />
							<Column name="ФИО_комиссии|Фамилия_комиссии" />
							<Column name="ФИО_комиссии|Имя_комиссии" />
							<Column name="ФИО_комиссии|Отчество_комиссии" />
						</SourceTable>
						<TargetTable flow="Заявки участников" tableName="|Document|Выбор_комиссии">
							<Column name="Номер_комиссии"  findExisting="true"/>  
							<Column name="Фамилия" />
							<Column name="Имя" />
							<Column name="Отчество" />
						</TargetTable>
					</TableConsolidation>	
					<TableRowsCountCheck sourceTag="{current}" tableName="|Document|Участники_комиссии" operation="less" value="1" message="В документе должно быть не менее 1 участников комисии" />			
				</Actions>
			</Aggregation>
		</OnRegcardEdited>


		
	</Flow>	
	<Flow name="Заявки участников">
		<LinksModify>
			<LinkCurrentDoc />
			<LinkAllLinksWhereFlow name="Протоколы" />
			<LinkAllLinksWhereFlow name="Извещения о закупочной процедуре" />
			<LinkAllLinksWhereFlow name="Заявки на размещение закупки" />
		</LinksModify>	
		<FieldsModify>			
			<CopyField src="|Document|ИД_извещения" />
			<CopyField src="|Document|Способ_определения_поставщика_код" />
			<CopyField src="|Document|Способ_определения_поставщика" />
			<CopyField src="|Document|Номер_лота_в_извещении" />
			<CopyField src="|Document|НМЦК" />			
		</FieldsModify>		
		<FieldsModify source="Протоколы">			
			<CopyField src="|Document|ИД_извещения" />
			<!-- <CopyField src="%key%" dst="|Document|Номер_протокола" />  -->
			<CopyField src="|Document|Способ_определения_поставщика_код" />
			<CopyField src="|Document|Способ_определения_поставщика" />
			<CopyField src="|Document|Номер_лота_в_извещении" />
			<CopyField src="|Document|Объект_протокола" />
			<CopyField src="|Document|Вид_протокола_код" />
			<CopyField src="|Document|НМЦК" />
			<CopyTable src="|Document|Список_документов" />
			<!-- <CopyTable src="|Document|Критерии_оценки_заявки_участников" /> -->
			<CopyTable dst="|Document|Участники_комиссии" src="|Document|Выбор_комиссии"/>
		</FieldsModify>
		<OnDocumentCreated transaction="single">
			<Aggregation>			
				<Select>							
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки на размещение закупки' and xn-in(doc_Id, {currentDocLinkList})]" tag="Заявки на размещение закупки2"/>
					<!-- <Select searchString="document[doc_RegCard/rc_FlowName = 'Протоколы' and doc_Id = {currentDocField=|Document|Номер_протокола}]" tag="Протоколы" /> -->
					<!-- <Select searchString="document[doc_RegCard/rc_FlowName = 'Извещения о закупочной процедуре' and doc_Id = document[doc_Links/doc_Link/link_Document={Протоколы}/doc_Id]]" tag="Извещения о закупочной процедуре" /> -->
					<!-- <Select searchString="document[(doc_RegCard/rc_FlowName = 'Позиции плана-графика') and doc_Id = document[doc_Links/doc_Link/link_Document={Извещения о закупочной процедуре}/doc_Id]]" tag="Позиции плана-графика" />    -->
				</Select>
				 <Actions>
					 <VerifyExpression>
						<Variables>
							<Variable name="Код_результата_рассмотрения" source="{current}" path="|Document|Код_результата_рассмотрения"  />
							<Variable name="Объект_протокола" source="{current}" path="|Document|Объект_протокола"  />
						</Variables>
						<Expression value="((($NullToEmpty({Код_результата_рассмотрения})!=&quot;&quot;) And ({Объект_протокола}=&quot;fcsProtocolOK2&quot; Or {Объект_протокола}=&quot;fcsProtocolOKSingleApp&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOU3&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOUSingleApp&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD5&quot; Or {Объект_протокола}=&quot;fcsProtocolOKDSingleApp&quot; Or {Объект_протокола}=&quot;fcsProtocolZK&quot; Or {Объект_протокола}=&quot;fcsProtocolZKAfterProlong&quot; Or {Объект_протокола}=&quot;fcsProtocolZP&quot; Or {Объект_протокола}=&quot;fcsProtocolZPExtract&quot; Or {Объект_протокола}=&quot;fcsProtocolZPFinal&quot;)) Or ({Объект_протокола}=&quot;fcsProtocolOK1&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOU1&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOU2&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD1&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD2&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD3&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD4&quot; Or {Объект_протокола}=&quot;fcsProtocolCancel&quot; Or {Объект_протокола}=&quot;fcsProtocolDeviation&quot; Or {Объект_протокола}=&quot;fcsProtocolEvasion&quot; Or {Объект_протокола}=&quot;fcsProtocolPO&quot; Or $NullToEmpty({Объект_протокола})=&quot;&quot;))"/>
						<FailtureText value="Выберите результат рассмотрения заявки"/>
					</VerifyExpression>
					<TableConsolidation>
						<SourceTable flow="Заявки на размещение закупки2" tableName="|Document|Преимущества_к_участникам_закупки">
							<Column name="Код_преимущества"/>
							<Column name="Наименование_преимущества" />
							<Column name="Величина_преимущества" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Соответствие_преимуществу">
							<Column name="Код_преимущества"  findExisting="true"/>  
							<Column name="Наименование_преимущества" /> 
							<Column name="Величина_преимущества" />
						</TargetTable>
					</TableConsolidation>
					<TableConsolidation>
						<SourceTable flow="Заявки на размещение закупки2" tableName="|Document|Ограничения">
							<Column name="Код_ограничения" />
							<Column name="Наименование_ограничения" />
							<Column name="Содержание_ограничения" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Соответствие_ограничению">
							<Column name="Код_ограничения"  findExisting="true"/>  
							<Column name="Наименование_ограничения" /> 
							<Column name="Содержание_ограничения" />
						</TargetTable>
					</TableConsolidation>
					<TableConsolidation>
						<SourceTable flow="Заявки на размещение закупки2" tableName="|Document|Требования_к_участникам">
							<Column name="Код_требования" />
							<Column name="Наименование_требования" />
							<Column name="Содержание_требования" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Соответствие_требованиям">
							<Column name="Код_требования"  findExisting="true"/>  
							<Column name="Наименование_требования" /> 
							<Column name="Содержание_требования" />
						</TargetTable>
					</TableConsolidation> 
					<VerifyExpression>
						<Variables>
							<Variable name="НМЦК" source="{current}" path="|Document|НМЦК" />
							<Variable name="Ценаучастника" source="{current}" path="|Document|Цена_участника" />
						</Variables>
						<Expression value="$NullToZero({НМЦК}) &lt;= $NullToZero({Ценаучастника})"/>
						<FailtureText value="Цена участника не может быть выше НМЦК"/>
			</VerifyExpression>
			<VerifyExpression>
						<Variables>
							<Variable name="НМЦК" source="{current}" path="|Document|НМЦК" />
							<Variable name="Ценаучастникаокончательная" source="{current}" path="|Document|Цена_участника_окончательная" />
						</Variables>
						<Expression value="$NullToZero({НМЦК}) &lt;= $NullToZero({Ценаучастникаокончательная})"/>
						<FailtureText value="Цена участника не может быть выше НМЦК"/>
			</VerifyExpression>			
					<!-- <TableConsolidation>
						<SourceTable flow="Позиции плана-графика" tableName="|Document|Преимущества_к_участникам_закупки">
							<Column name="Код_преимущества" />
							<Column name="Наименование_преимущества" />
							<Column name="Величина_преимущества" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Соответствие_преимуществу">
							<Column name="Код_преимущества"  findExisting="true"/>  
							<Column name="Наименование_преимущества" /> 
							<Column name="Величина_преимущества" />
						</TargetTable>
					</TableConsolidation>
					<TableConsolidation>
						<SourceTable flow="Позиции плана-графика" tableName="|Document|Ограничения">
							<Column name="Код_ограничения" />
							<Column name="Наименование_ограничения" />
							<Column name="Содержание_ограничения" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Соответствие_ограничению">
							<Column name="Код_ограничения"  findExisting="true"/>  
							<Column name="Наименование_ограничения" /> 
							<Column name="Содержание_ограничения" />
						</TargetTable>
					</TableConsolidation>
					<TableConsolidation>
						<SourceTable flow="Позиции плана-графика" tableName="|Document|Требования_к_участникам">
							<Column name="Код_требования" />
							<Column name="Наименование_требования" />
							<Column name="Содержание_требования" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Соответствие_требованиям">
							<Column name="Код_требования"  findExisting="true"/>  
							<Column name="Наименование_требования" /> 
							<Column name="Содержание_требования" />
						</TargetTable>
					</TableConsolidation> 	 -->								
				</Actions> 
			</Aggregation>
		<ConditionalActions>
		  <Select>					
		      <Select searchString="document[doc_RegCard/rc_FlowName = 'Протоколы' and xn-in(doc_Id, {currentDocLinkList})]" tag="Протоколы" /> 
		      <Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Links/doc_Link/link_Document, {currentDocLinkList})]" tag="Позиции плана-графика" />
			  <Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки участников' and xn-in(doc_Links/doc_Link/link_Document, {currentDocLinkList}) and doc_RegCard/rc_Index/boolean_Победитель = '1']" tag="Заявки участников Победитель" />	
		  </Select>
		<Actions>
	    	<ConditionalAction>
				<Conditions>
					<And>
				    	<WhenFieldsEquals tag="{current}" path="|Document|Номер_протокола" value=""/>
					</And>
				</Conditions>
		<Actions>
	        	<CopyField sourceFlow="Протоколы" targetFlow="{current}" sourceField="|Document|Номер_протокола" targetField="|Document|Номер_протокола" /> 
	         	<CopyField sourceFlow="Протоколы" targetFlow="{current}" sourceField="|Document|ИД_извещения" targetField="|Document|ИД_извещения" />
	        	<CopyField sourceFlow="{current}" targetFlow="Протоколы" sourceField="|Document|Номер_заявки" targetField="|Document|Номер_заявки" />
	         	<TableConsolidation>
						<SourceTable flow="Протоколы" tableName="|Document|Список_документов">
							<Column name="Порядковый_номер" />
							<Column name="Наименование_документа" />
							<Column name="Обязательность_предоставления" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Список_документов">
							<Column name="Порядковый_номер"  findExisting="true"/>  
							<Column name="Наименование_документа" /> 
							<Column name="Обязательность_предоставления" />
						</TargetTable>
	        	</TableConsolidation> 
	        	<TableConsolidation>
						<SourceTable flow="Протоколы" tableName="|Document|Участники_комиссии">
							<Column name="Номер" />
							<Column name="ФИО_комиссии|Фамилия_комиссии" />
							<Column name="ФИО_комиссии|Имя_комиссии" />
							<Column name="ФИО_комиссии|Отчество_комиссии" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Выбор_комиссии">
							<Column name="Номер_комиссии"  findExisting="true"/>  
							<Column name="Фамилия" /> 
							<Column name="Имя" />
							<Column name="Отчество" />
						</TargetTable>
		</TableConsolidation> 
		<TableConsolidation>
						<SourceTable flow="Протоколы" tableName="|Document|Критерии_оценки_заявки_участников">
							<Column name="Код_критерия" />
							<Column name="Критерий" />
							<Column name="Значимость_критерия" />
							<Column name="Дополнение_критерия" />
							<Column name="Лимит_критерия" />
							<Column name="Порядок_оценки_критерия" />
							<Column name="Порядок_оценки_критерия_код" />
							<Column name="Наличие_показателя" />
							<Column name="Код_показателя" />
							<Column name="Наименование_показателя" />
							<Column name="Порядок_оценки_по_показателю" />
							<Column name="доп_информация_по_показателю" />
							<Column name="Код_порядка" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Критерии_оценки_заявки_участников">
							<Column name="Код_критерия"  findExisting="true"/>  
							<Column name="Критерий" />
							<Column name="Значимость_критерия" />
							<Column name="Дополнение_критерия" />
							<Column name="Лимит_критерия" />
							<Column name="Порядок_оценки_критерия" />
							<Column name="Порядок_оценки_критерия_код" />
							<Column name="Наличие_показателя" />
							<Column name="Код_показателя" />
							<Column name="Наименование_показателя" />
							<Column name="Порядок_оценки_по_показателю" />
							<Column name="Доп_информация_по_показателю" />
							<Column name="Код_порядка" />
						</TargetTable>
		</TableConsolidation>		
		</Actions>
		</ConditionalAction>
		    <ConditionalAction>
		    	<Conditions>
			    	<And>
			        	<WhenFieldsEquals tag="{current}" path="|Document|Победитель" value="1"/>
				    </And>
			</Conditions>
			<Actions>
		           <CopyField sourceFlow="{current}" targetFlow="Позиции плана-графика" sourceField="|Document|Цена_участника_окончательная" targetField="|Document|Цена_победителя" /> 
		          <TableConsolidation>
					    <SourceTable flow="{current}" tableName="|Document|Поставщики">
						    	<Column name="Поставщики_наименование" />
								<Column name="Поставщики_фирменное_наименование" />
						    	<Column name="Поставщики_тип" />
						    	<Column name="Поставщики_тип_наименование" />
							    <Column name="Поставщики_ИНН" />
						    	<Column name="Поставщики_КПП" />
						        <Column name="Поставщики_ОКПО" />
						    	<Column name="Поставщики_ОКТМО" />
						    	<Column name="Дата_постановки_на_учет" />
						    	<Column name="Поставщики_страна" />
						     	<Column name="Цифровой_код_страны" />
                                <Column name="Поставщики_почтовый_адрес" />
                                <Column name="Поставщики_адрес" />	
                                <Column name="Поставщики_ОГРН" />
                                <Column name="Статус_поставщика_код" /> 								
                                <Column name="Статус_поставщика" />								
						    	<Column name="Поставщики_ОКОПФ" />
						    	<Column name="Поставщики_ОКОПФ_наименование" />
						    	<Column name="Поставщики_контактное_лицо_фамилия" />
						    	<Column name="Поставщики_контактное_лицо_имя" />
						    	<Column name="Поставщики_контактное_лицо_отчество" />
						    	<Column name="Поставщики_контактное_лицо_email" />
						    	<Column name="Поставщики_контактное_лицо_телефон" /> 
                                <Column name="Поставщики_дополнительная_информация" />								    	
						</SourceTable>
						<TargetTable flow="Позиции_плана_графика" tableName="|Document|Поставщики">							
							<Column name="Поставщики_наименование" />
								<Column name="Поставщики_фирменное_наименование" />
						    	<Column name="Поставщики_тип" />
						    	<Column name="Поставщики_тип_наименование" />
							    <Column name="Поставщики_ИНН" />
						    	<Column name="Поставщики_КПП" />
						        <Column name="Поставщики_ОКПО" />
						    	<Column name="Поставщики_ОКТМО" />
						    	<Column name="Дата_постановки_на_учет" />
						    	<Column name="Поставщики_страна" />
						     	<Column name="Цифровой_код_страны" />
                                <Column name="Поставщики_почтовый_адрес" />
                                <Column name="Поставщики_адрес" />	
                                <Column name="Поставщики_ОГРН" />
                                <Column name="Статус_поставщика_код" /> 								
                                <Column name="Статус_поставщика" />								
						    	<Column name="Поставщики_ОКОПФ" />
						    	<Column name="Поставщики_ОКОПФ_наименование" />
						    	<Column name="Поставщики_контактное_лицо_фамилия" />
						    	<Column name="Поставщики_контактное_лицо_имя" />
						    	<Column name="Поставщики_контактное_лицо_отчество" />
						    	<Column name="Поставщики_контактное_лицо_email" />
						    	<Column name="Поставщики_контактное_лицо_телефон" /> 
                                <Column name="Поставщики_дополнительная_информация" />							
						</TargetTable>
		           </TableConsolidation> 
		     </Actions>
		    </ConditionalAction>
		    <ConditionalAction>
		    	<Conditions>
			    	<And>
			        	<WhenFieldsEquals tag="{current}" path="|Document|Победитель" value="1"/>
				    </And>
			</Conditions>
			<Actions>
			 <DocsCountCheck sourceTag="Заявки участников Победитель" operation="notEmpty" message="Победитель по закупке определен, внесите корректировки в заявку" /> 
		     </Actions>
		    </ConditionalAction>
		   </Actions>	
		</ConditionalActions>
		</OnDocumentCreated>					
		<OnRegcardEdited transaction="single">
		<Aggregation>
				<Select>				
				</Select>
				<Actions>
					 <VerifyExpression>
						<Variables>
							<Variable name="Код_результата_рассмотрения" source="{current}" path="|Document|Код_результата_рассмотрения"  />
							<Variable name="Объект_протокола" source="{current}" path="|Document|Объект_протокола"  />
						</Variables>
						<Expression value="((($NullToEmpty({Код_результата_рассмотрения})!=&quot;&quot;) And ({Объект_протокола}=&quot;fcsProtocolOK2&quot; Or {Объект_протокола}=&quot;fcsProtocolOKSingleApp&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOU3&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOUSingleApp&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD5&quot; Or {Объект_протокола}=&quot;fcsProtocolOKDSingleApp&quot; Or {Объект_протокола}=&quot;fcsProtocolZK&quot; Or {Объект_протокола}=&quot;fcsProtocolZKAfterProlong&quot; Or {Объект_протокола}=&quot;fcsProtocolZP&quot; Or {Объект_протокола}=&quot;fcsProtocolZPExtract&quot; Or {Объект_протокола}=&quot;fcsProtocolZPFinal&quot;)) Or ({Объект_протокола}=&quot;fcsProtocolOK1&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOU1&quot; Or {Объект_протокола}=&quot;fcsProtocolOKOU2&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD1&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD2&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD3&quot; Or {Объект_протокола}=&quot;fcsProtocolOKD4&quot; Or {Объект_протокола}=&quot;fcsProtocolCancel&quot; Or {Объект_протокола}=&quot;fcsProtocolDeviation&quot; Or {Объект_протокола}=&quot;fcsProtocolEvasion&quot; Or {Объект_протокола}=&quot;fcsProtocolPO&quot; Or $NullToEmpty({Объект_протокола})=&quot;&quot;))"/>
						<FailtureText value="Выберите результат рассмотрения заявки"/>
					</VerifyExpression>
					<VerifyExpression>
						<Variables>
							<Variable name="НМЦК" source="{current}" path="|Document|НМЦК" />
							<Variable name="Ценаучастника" source="{current}" path="|Document|Цена_участника" />
						</Variables>
						<Expression value="$NullToZero({НМЦК}) &lt;= $NullToZero({Ценаучастника})"/>
						<FailtureText value="Цена участника не может быть выше НМЦК"/>
					</VerifyExpression>
					<VerifyExpression>
						<Variables>
							<Variable name="НМЦК" source="{current}" path="|Document|НМЦК" />
							<Variable name="Ценаучастникаокончательная" source="{current}" path="|Document|Цена_участника_окончательная" />
						</Variables>
						<Expression value="$NullToZero({НМЦК}) &lt;= $NullToZero({Ценаучастникаокончательная})"/>
						<FailtureText value="Цена участника не может быть выше НМЦК"/>
					</VerifyExpression>					
				</Actions>
			</Aggregation>		
		<ConditionalActions>
		    <Select>					
		       <Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Links/doc_Link/link_Document, {currentDocLinkList})]" tag="Позиции_плана_графика" />
			    <Select searchString="document[doc_RegCard/rc_FlowName = 'Протоколы' and xn-in(doc_Id, {currentDocLinkList})]" tag="Протоколы" />
				 <Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки участников' and doc_Id != {current_Id} and xn-in(doc_Links/doc_Link/link_Document, {currentDocLinkList}) and doc_RegCard/rc_Index/boolean_Победитель = '1']" tag="Заявки участников Победитель" />	
	    	</Select>
	    	<Actions>
	        	<ConditionalAction>
		        	<Conditions>
						<And>
						  <WhenFieldsEquals tag="{current}" path="|Document|Победитель" value="1"/>
						</And>
					</Conditions>
			        <Actions>
		              <TableConsolidation>
					    <SourceTable flow="{current}" tableName="|Document|Поставщики">
						    	<Column name="Поставщики"/>
						    	<Column name="Поставщики_наименование" />
								<Column name="Поставщики_фирменное_наименование" />
						    	<Column name="Поставщики_тип" />
						    	<Column name="Поставщики_тип_наименование" />
							    <Column name="Поставщики_ИНН" />
						    	<Column name="Поставщики_КПП" />
						        <Column name="Поставщики_ОКПО" />
						    	<Column name="Поставщики_ОКТМО" />
						    	<Column name="Дата_постановки_на_учет" />
						    	<Column name="Поставщики_страна" />
						     	<Column name="Цифровой_код_страны" />
                                <Column name="Поставщики_почтовый_адрес" />
                                <Column name="Поставщики_адрес" />	
                                <Column name="Поставщики_ОГРН" />
                                <Column name="Статус_поставщика_код" /> 								
                                <Column name="Статус_поставщика" />								
						    	<Column name="Поставщики_ОКОПФ" />
						    	<Column name="Поставщики_ОКОПФ_наименование" />
						    	<Column name="Поставщики_контактное_лицо_фамилия" />
						    	<Column name="Поставщики_контактное_лицо_имя" />
						    	<Column name="Поставщики_контактное_лицо_отчество" />
						    	<Column name="Поставщики_контактное_лицо_email" />
						    	<Column name="Поставщики_контактное_лицо_телефон" /> 
                                <Column name="Поставщики_дополнительная_информация" />								
						</SourceTable>
						<TargetTable flow="Позиции_плана_графика" tableName="|Document|Поставщики">							
							<Column name="Поставщики" findExisting="true"/>
						    	<Column name="Поставщики_наименование" />
								<Column name="Поставщики_фирменное_наименование" />
						    	<Column name="Поставщики_тип" />
						    	<Column name="Поставщики_тип_наименование" />
							    <Column name="Поставщики_ИНН" />
						    	<Column name="Поставщики_КПП" />
						        <Column name="Поставщики_ОКПО" />
						    	<Column name="Поставщики_ОКТМО" />
						    	<Column name="Дата_постановки_на_учет" />
						    	<Column name="Поставщики_страна" />
						     	<Column name="Цифровой_код_страны" />
                                <Column name="Поставщики_почтовый_адрес" />
                                <Column name="Поставщики_адрес" />	
                                <Column name="Поставщики_ОГРН" />
                                <Column name="Статус_поставщика_код" /> 								
                                <Column name="Статус_поставщика" />								
						    	<Column name="Поставщики_ОКОПФ" />
						    	<Column name="Поставщики_ОКОПФ_наименование" />
						    	<Column name="Поставщики_контактное_лицо_фамилия" />
						    	<Column name="Поставщики_контактное_лицо_имя" />
						    	<Column name="Поставщики_контактное_лицо_отчество" />
						    	<Column name="Поставщики_контактное_лицо_email" />
						    	<Column name="Поставщики_контактное_лицо_телефон" /> 
                                <Column name="Поставщики_дополнительная_информация" />									
						</TargetTable>
		           </TableConsolidation> 
                   <CopyField sourceFlow="{current}" targetFlow="Позиции_плана_графика" sourceField="|Document|Цена_участника_окончательная" targetField="|Document|Цена_победителя" /> 				   
		         </Actions>
		      </ConditionalAction>
		    <ConditionalAction>
				<Conditions>
					<And>
				    	<WhenFieldsEquals tag="{current}" path="|Document|Номер_протокола" value=""/>
					</And>
				</Conditions>
		<Actions>
	        	<CopyField sourceFlow="Протоколы" targetFlow="{current}" sourceField="|Document|Номер_протокола" targetField="|Document|Номер_протокола" /> 
	         	<CopyField sourceFlow="Протоколы" targetFlow="{current}" sourceField="|Document|ИД_извещения" targetField="|Document|ИД_извещения" />
	        	<CopyField sourceFlow="{current}" targetFlow="Протоколы" sourceField="|Document|Номер_заявки" targetField="|Document|Номер_заявки" />
	        	<!-- <TableConsolidation>
						<SourceTable flow="Протоколы" tableName="|Document|Список_документов">
							<Column name="Порядковый_номер" />
							<Column name="Наименование_документа" />
							<Column name="Обязательность_предоставления" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Список_документов">
							<Column name="Порядковый_номер"  findExisting="true"/>  
							<Column name="Наименование_документа" /> 
							<Column name="Обязательность_предоставления" />
						</TargetTable>
	        	</TableConsolidation> 
	        	<TableConsolidation>
						<SourceTable flow="Протоколы" tableName="|Document|Участники_комиссии">
							<Column name="Номер" />
							<Column name="ФИО_комиссии|Фамилия_комиссии" />
							<Column name="ФИО_комиссии|Имя_комиссии" />
							<Column name="ФИО_комиссии|Отчество_комиссии" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Выбор_комиссии">
							<Column name="Номер_комиссии"  findExisting="true"/>  
							<Column name="Фамилия" /> 
							<Column name="Имя" />
							<Column name="Отчество" />
						</TargetTable>
		</TableConsolidation> -->
		<TableConsolidation>
						<SourceTable flow="Протоколы" tableName="|Document|Критерии_оценки_заявки_участников">
							<Column name="Код_критерия" />
							<Column name="Критерий" />
							<Column name="Значимость_критерия" />
							<Column name="Дополнение_критерия" />
							<Column name="Лимит_критерия" />
							<Column name="Порядок_оценки_критерия" />
							<Column name="Порядок_оценки_критерия_код" />
							<Column name="Наличие_показателя" />
							<Column name="Код_показателя" />
							<Column name="Наименование_показателя" />
							<Column name="Порядок_оценки_по_показателю" />
							<Column name="доп_информация_по_показателю" />
							<Column name="Код_порядка" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Критерии_оценки_заявки_участников">
							<Column name="Код_критерия"  findExisting="true"/>  
							<Column name="Критерий" />
							<Column name="Значимость_критерия" />
							<Column name="Дополнение_критерия" />
							<Column name="Лимит_критерия" />
							<Column name="Порядок_оценки_критерия" />
							<Column name="Порядок_оценки_критерия_код" />
							<Column name="Наличие_показателя" />
							<Column name="Код_показателя" />
							<Column name="Наименование_показателя" />
							<Column name="Порядок_оценки_по_показателю" />
							<Column name="Доп_информация_по_показателю" />
							<Column name="Код_порядка" />
						</TargetTable>
		</TableConsolidation>		
		</Actions>
		</ConditionalAction>
		<ConditionalAction>
				<Conditions>
					<And>
				    	<WhenFieldsEquals tag="{current}" path="|Document|Победитель" value="1"/>
					</And>
				</Conditions>
		<Actions>	
    <DocsCountCheck sourceTag="Заявки участников Победитель" operation="notEmpty" message="Победитель по закупке определен, внесите корректировки в заявку" /> 			
		</Actions>
		</ConditionalAction>
			</Actions>	
		  </ConditionalActions>				
		
		</OnRegcardEdited> 		
	</Flow>	
	
	<Flow name="Контракты">
		<FieldsModify>
			<CopyField src="|Document|Позиции_не_учитывать"	dst="|Document|Позиции_не_учитывать" />
			<CopyField src="|Document|Номер_закупки_в_ЕИС"  />
			<CopyField src="|Document|Дата_публикации"	dst="|Document|Фактическая_дата_размещения" />
			<CopyField src="%key%" dst="|Document|ИД_позиции_ПГ" />
			<CopyField src="|Document|ИКЗ" dst="|Document|ИКЗ" />
			<CopyField src="|Document|Наименование_объекта_закупки" dst="|Document|Предмет_контракта" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СПЗ"   />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СР"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_справочный_код"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Код_в_ЕИС"/>
			<CopyField src="|Document|Организация_заказчик|Полное_наименование"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКОПФ"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_адрес"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Дата_постановки_на_учет"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_телефон"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_эл_почта"  />
			<CopyField src="|Document|Организация_заказчик|ОКТМО"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СПЗ"   />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СР" />
			<CopyField src="|Document|Способ_определения_поставщика_код"   />
			<CopyField src="|Document|Способ_определения_поставщика"  />
			<CopyField src="|Document|Валюта"  />
			<CopyField src="|Document|Код_валюты"   />
			<CopyField src="|Document|Документы_основание_ед_поставщик_пункт" />
			<CopyField src="|Document|Документы_основание_ед_поставщик_наименование"   />
			<CopyField src="|Document|Документы_основание_ед_поставщик_код"   />
			<CopyField src="|Document|Роль_организатора_закупки"  />
			<CopyField src="|Document|Роль_организатора_закупки_код"  /> 
			<CopyField src="|Document|Размер_аванса"  /> 
			<CopyField src="|Document|Размер_аванса_процент"  /> 
			<CopyField src="|Document|Лекарственный_препарат" />
			<CopyField src="|Document|НМЦК" dst="|Document|НМЦК" />			
			<SumField src="|Document|НМЦК" dst="|Document|Цена_контракта" /> 
			<SumField src="|Document|Цена_победителя"  /> 
			<CopyField src="|Document|ГРБС|ГРБС_наименование"  />
			<CopyField src="|Document|ГРБС|ГРБС"  />	
			<CopyField src="|Document|Используется_КТРУ"   /> 
			<CopyField src="|Document|Номер_лота_в_извещении"   /> 
			<CopyField src="|Document|ИД_в_РК_РБГ"   /> 
			<CopyTable src="|Document|Поставщики" />
		</FieldsModify>


		<FieldsModify source="Контракты">

			<CopyField src="|Document|Номер_контракта" /> 
			<CopyField src="|Document|Цена_контракта" /> 
			<CopyField src="|Document|НМЦК" />	
			<CopyField src="|Document|Цена_победителя"  /> 
			<CopyField src="|Document|Роль_организации_разместившей_контракт"  /> 
			<CopyField src="|Document|Роль_организации_разместившей_контракт_код"  /> 
			<CopyField src="|Document|ИКЗ"  />
			<CopyField src="|Document|Номер_закупки_в_ЕИС"  />
			<CopyField src="|Document|Позиции_не_учитывать"/>
			<CopyField src="|Document|Номер_реестровой_записи"/>
			<CopyField src="|Document|Номер_по_гос.оборонному_заказу"/>
			<CopyField src="|Document|Дата_заключения"/>
			<CopyField src="|Document|Дата_протокола"/>
			<CopyField src="|Document|Дата_начала_исполнения_контракта"/>
			<CopyField src="|Document|Дата_окончания_исполнения_контракта"/>
			<CopyField src="|Document|Организация_опубликовавшая_контракт|Организатор_опубликовавшая_контракт_наименование"  />
			<CopyField src="|Document|Организация_опубликовавшая_контракт|Организатор_опубликовавшая_контракт"  />
			<CopyField src="|Document|Организация_опубликовавшая_контракт|Организатор_опубликовавшая_контракт_код_по_СПЗ"   />
			<CopyField src="|Document|Организация_опубликовавшая_контракт|Организация_опубликовавшая_код_СР"  />
			<CopyField src="|Document|Организация_опубликовавшая_контракт|Организация_опубликовавшая_Код_ЕИС"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СПЗ"   />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СР"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_справочный_код"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Код_в_ЕИС"/>
			<CopyField src="|Document|Организация_заказчик|Полное_наименование"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКОПФ"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_адрес"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Дата_постановки_на_учет"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_телефон"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_эл_почта"  />
			<CopyField src="|Document|Организация_заказчик|ОКТМО"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СПЗ"   />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СР" />
			<CopyField src="|Document|Документы_основание_ед_поставщик_пункт" />
			<CopyField src="|Document|Документы_основание_ед_поставщик_наименование"   />
			<CopyField src="|Document|Документы_основание_ед_поставщик_код"   />
			<CopyField src="|Document|Роль_организатора_закупки"  />
			<CopyField src="|Document|Роль_организатора_закупки_код"  /> 
			<CopyField src="|Document|Предмет_контракта" />
			<CopyField src="|Document|Документ_основания" />
			<CopyField src="|Document|Валюта"  />
			<CopyField src="|Document|Код_валюты"   />
			<CopyField src="|Document|НДС" />
			<CopyField src="|Document|Признак_сравнения_цен" />
			<CopyField src="|Document|Курс_валюты" />
			<CopyField src="|Document|Номинал_валюты" />
			<CopyField src="|Document|Цена_контракта_в_рублях" />
			<CopyField src="|Document|НДС_в_рублях" />
			<CopyField src="|Document|Способ_указания_цены_код" />
			<CopyField src="|Document|Способ_указания_цены" />
			<CopyField src="|Document|Формула_цены" />
			<CopyField src="|Document|Объем_привлечения_субподрядчика" />
			<CopyField src="|Document|Объем_в_рублевом_эквиваленте" />
			<CopyField src="|Document|Требование_об_обеспечении_исполнения_контракта" />
			<CopyField src="|Document|Банковская_гарантия_выданная_банком" />
			<CopyField src="|Document|Внесение_денежных_средств_на_счет" />
			<CopyField src="|Document|Банковская_гарантия|РН_банковской_гарантии" />
			<CopyField src="|Document|Банковская_гарантия|Сумма_банковской_гарантии" />
			<CopyField src="|Document|Банковская_гарантия|Валюта_банковской_гарантии_код" />
			<CopyField src="|Document|Банковская_гарантия|Валюта_банковской_гарантии" />
			<CopyField src="|Document|Банковская_гарантия|Номер_документа_реестровой_записи_БГ" />
			<CopyField src="|Document|Банковская_гарантия|Курс_валюты_гарантии" />
			<CopyField src="|Document|Банковская_гарантия|Сумма_банковской_гарантии_в_рублевом_эквиваленте" />
			<CopyField src="|Document|Внесение_денежных_средств|Размер_обеспечения_контракта" />
			<CopyField src="|Document|Внесение_денежных_средств|Валюта_обеспечения_исполнения_код" />
			<CopyField src="|Document|Внесение_денежных_средств|Валюта_обеспечения_исполнения" />
			<CopyField src="|Document|Внесение_денежных_средств|Курс_валюты_исполнения" />
			<CopyField src="|Document|Внесение_денежных_средств|Размер_обеспечения_в_рублевом_эквиваленте" />
			<CopyField src="|Document|Сведения_о_гарантии" />
			<CopyField src="|Document|Гарантия_качества|гарантия_с" />
			<CopyField src="|Document|Гарантия_качества|гарантия_по" />
			<CopyField src="|Document|Гарантия_качества|требования_гарантии" />
			<CopyField src="|Document|Гарантия_качества|гарантия_производителя" />
			<CopyField src="|Document|ГРБС|ГРБС_наименование"  />
			<CopyField src="|Document|ГРБС|ГРБС"  />	
			<CopyField src="|Document|Номер_закупки"  />
			<CopyField src="|Document|Фактическая_дата_размещения" />
			<CopyField src="|Document|Способ_определения_поставщика_код"   />
			<CopyField src="|Document|Способ_определения_поставщика"  />
			<CopyField src="|Document|Номер_лота_в_извещении"   /> 
			<CopyField src="|Document|ИД_в_РК_РБГ"   /> 
			<CopyField src="|Document|ИД_позиции_ПГ" />
			<CopyField src="|Document|Размер_аванса"  /> 
			<CopyField src="|Document|Размер_аванса_процент"  /> 
			<CopyField src="|Document|Лекарственный_препарат" />	
			<CopyField src="|Document|Бюджет_код" />	
			<CopyField src="|Document|Бюджет_наименование" />	
			<CopyField src="|Document|Уровень_бюджета_код" />	
			<CopyField src="|Document|Уровень_бюджета_наименование" />	
			<CopyField src="|Document|Уровень_бюджета_фонда_код" />	
			<CopyField src="|Document|Уровень_бюджета_фонда" />	
			<CopyField src="|Document|Сумма_финансирования_бюджетных_средств" />	
			<CopyField src="|Document|Вид_внебюджетных_средств_код" />	
			<CopyField src="|Document|Вид_внебюджетных_средств" />	
			<CopyField src="|Document|Сумма_финансирования_внебюджетных_средств" />	
			<CopyField src="|Document|Фактическая_сумма_оплаты" />	
			<CopyField src="|Document|Остаток_по_контракту" />	
			<CopyTable src="|Document|Этапы_исполнения_бюджетные_средства" />
			<CopyTable src="|Document|Поставщики" />
			<CopyTable src="|Document|Этапы_исполнения_контракта" />
			<CopyTable src="|Document|Банковская_гарантия" />
			<CopyTable src="|Document|Внесение_денежных_средств" />
			<CopyTable src="|Document|Этапы_исполнения_внебюджетные_средства" />
			<CopyTable src="|Document|Возмещение_фактически_понесенного_ущерба" />
			<CopyTable src="|Document|Субподрядчики" />
			<CopyTable src="|Document|Источники_финансирования" />
				
			
		
		
		</FieldsModify>

		<FieldsModify source="Позиции">
			<CopyField src="%key%" dst="|Document|ИД_позиции_ПГ" />	
			<CopyField src="|Document|ИД_контракта" />			
		</FieldsModify>

		<LinksModify>
			<LinkCurrentDoc />
			<LinkAllLinksWhereFlow name="Позиции" />
			<LinkAllLinksWhereFlow name="Позиции плана-графика" />
		</LinksModify>
		
		<OnDocumentCreated transaction="split" >
		
					
			<NamedConstants>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Номер_редакции_порядковый"/>
				<Setting key="CounterNameFormat" value="({|Document|Год}/{|Document|Организация_заказчик|Организация_заказчик}/{|Document|ИКЗ})"/>
				</Constant>
			</NamedConstants>
			<ConditionalActions>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Контракты" />
				</Select>
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldsEquals tag="Контракты" path="|Document|Номер_редакции_порядковый" />
							</And>
						</Conditions>
						<Actions>
							<SetField targetFlow="Контракты" targetField="|Document|Номер_редакции" value="{{|Document|Номер_редакции_порядковый}-1}" />	
						</Actions>
					</ConditionalAction>
				</Actions>
			</ConditionalActions>
			
			
			</OnDocumentCreated>
		<OnDocumentCreated transaction="single" >
		
								  
			
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана-графика1" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана-графика1}/doc_Id]]" tag="Позиции" />
					<SelectLink source="{current}" flow="Позиции" tag="Позиции"/>
					<SelectLink source="{current}" flow="Позиции плана-графика" tag="Позиции плана-графика"/> 
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' and xn-in(doc_Id, {currentDocLinkList})]" tag="Контракты" />					
				</Select>		
				<Actions>  
					<CreateFromLink flow="Позиции" />  
					<CreateFromLink flow="Контракты" />  
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана-графика1" sourceField="%key%" targetField="|Document|ИД_позиции_ПГ" />  
					<SetFieldGuid targetFlow="{current}" targetField="|Document|ИД_в_ЕИС" />
					<SetField targetFlow="Позиции плана-графика1" targetField="|Document|Статус" value="Заключение контракта" /> 
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана-графика1" sourceField ="%key%" targetField="|Document|ИД_контракта"/>
					<CopyField sourceFlow="Позиции плана-графика1" targetFlow="{current}" sourceField="|Document|Регистрационный_номер" targetField="|Document|Номер_закупки" /> 	
					<CopyField sourceFlow="{current}" targetFlow="Позиции" sourceField ="%key%" targetField="|Document|ИД_контракта"/>
					<SetField targetFlow="Позиции" targetField="|Document|Статус" value="Позиция контракта" /> 
					<CopyField sourceFlow="Контракты" targetFlow="{current}"  sourceField ="%key%" targetField="|Document|ParentRK" />
					 
					<!-- <SetField targetFlow="Контракты" targetField="|Document|Статус" value="Неактуальный" />  -->
					
					
				<!--	<VerifyExpression>
						<Variables>
							<Variable name="Ценаконтракта" source="{current}" path="|Document|Цена_контракта" />
							<Variable name="Ценапобедителя" source="{current}" path="|Document|Цена_победителя" />
						</Variables>
						<Expression value="$NullToZero({Ценаконтракта}) == $NullToZero({Ценапобедителя})"/>
						<FailtureText value="Цена контракта не соответствует цене победителя"/>
					</VerifyExpression>
					
					<VerifyExpression>
						<Variables>
							<Variable name="Ценаконтракта" source="{current}" path="|Document|Цена_контракта" />
							<Variable name="НМЦК" source="{current}" path="|Document|НМЦК" />
						</Variables>
						<Expression value="$NullToZero({Ценаконтракта}) &lt; $NullToZero({НМЦК})"/>
						<FailtureText value="Цена контракта не должна превышать НМЦК"/>
					</VerifyExpression>-->
					
					
						<TableConsolidation>
						<SourceTable flow="Позиции плана-графика1" tableName="|Document|Источники_финансирования">
							<Column name="Источник_финансирования_по_статье_расхода" />
							<Column name="КБК_по_статье_расхода" />
							<Column name="Корректируемая_сумма" />
							<Column name="Год_финансирования_бюджета" />
							<Column name="КВР_бюджета" />
							<Column name="КВР_бюджета_код" />
						
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Источники_финансирования">
							<Column name="Источник_финансирования_по_статье_расхода" />
							<Column name="КБК_по_статье_расхода"   findExisting="true"/>
							<Column name="Финансирование" />
							<Column name="Год_финансирования_бюджета" />
							<Column name="КВР_бюджета" />
							<Column name="КВР_бюджета_код" />
						
						</TargetTable>
					</TableConsolidation>
					
										
						<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_платежа_бюджетные_средства} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_бюджетные_средства}"  checkFormula="{sourceTableColumn=Финансирование}&lt;{Сумма_по_контракту}" checkMessage="Сумма по контракту не может быть больше суммы финансирования по данному виду КБК" >
						<SourceTable tableName="|Document|Этапы_исполнения_бюджетные_средства|*|Платежи_этапа_бюджетные_средства">
							<Column name="Финансирование"  />
							<Column name="КБК_бюджетные_средства"  />
							<Column name="Год_платежа_бюджетные_средства"  />
							<Column name="Сумма_платежа_бюджетные_средства"  aggregate="Sum" />
						</SourceTable>
						<Action column="Сумма_по_контракту" formula="$NullToZero({Сумма_по_контракту})+$NullToZero({sourceTableColumn=Сумма_платежа_бюджетные_средства})"/>
						</TableFieldOperations>
						
						<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_платежа_внебюджетные_средства} And {КВР_бюджета_код}={sourceTableColumn=КВР_внебюджетные_средства}" >
						<SourceTable tableName="|Document|Этапы_исполнения_внебюджетные_средства|*|Платежи_этапа_внебюджетные_средства">
							<Column name="КВР_внебюджетные_средства"  />
							<Column name="Год_платежа_внебюджетные_средства"  />
							<Column name="Сумма_платежа_внебюджетные_средства"  aggregate="Sum" />
						</SourceTable>
						<Action column="Сумма_по_контракту" formula="$NullToZero({Сумма_по_контракту})+$NullToZero({sourceTableColumn=Сумма_платежа_внебюджетные_средства})"/>
						</TableFieldOperations>
					
					<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Источники_финансирования"  checkFormula="{Финансирование}&lt;{Сумма_по_контракту}" checkMessage="Сумма по контракту не может быть больше суммы финансирования по данному виду КБК">
					</TableFieldOperations>
					
					<TableConsolidation>
						<SourceTable flow="{current}" tableName="|Document|Этапы_исполнения_бюджетные_средства">
							<Column name="Дата_окончания_этапа_бюджетные_средства" />
							<Column name="Сумма_платежей_этапа_БС" />
						</SourceTable>
						<SourceTable flow="{current}" tableName="|Document|Этапы_исполнения_внебюджетные_средства">
							<Column name="Дата_окончания_этапа_внебюджетные_средства" />
							<Column name="Сумма_платежей_этапа_ВС" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Этапы_исполнения_контракта">
							<Column name="Дата_окончания_этапа_контракта" findExisting="true" />
							<Column name="Сумма_платежей_этапа_контракта" aggregate="sum" />
						</TargetTable>
					</TableConsolidation> 
					
					<TableFieldOperations sourceTag="{current}" targetTag="Позиции плана-графика1" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
-						<SourceTable tableName="|Document|Источники_финансирования">
-							<Column name="Сумма_по_контракту"  />
-							<Column name="КБК_по_статье_расхода"  />
-							<Column name="Год_финансирования_бюджета"  />
					</SourceTable>
-						<Action column="Сумма_контрактов" formula="$NullToZero({sourceTableColumn=Сумма_по_контракту})"/>
-						<Action column="Экономия" formula="$NullToZero({Корректируемая_сумма})- $NullToZero({Сумма_контрактов})"/> 
-					</TableFieldOperations>


					<TableConsolidation>
						<SourceTable flow="Позиции плана-графика1" tableName="|Document|Поставщики">
							<Column name="Поставщики" />
							<Column name="Поставщики_наименование" />
							<Column name="Поставщики_тип" />
							<Column name="Поставщики_тип_наименование" />
							<Column name="Поставщики_ИНН" />
							<Column name="Поставщики_КПП" />
							<Column name="Поставщики_ОКПО" />
							<Column name="Дата_постановки_на_учет" />
							<Column name="Поставщики_ОКОПФ" />
							<Column name="Поставщики_ОКТМО" />
							<Column name="Поставщики_адрес" />
							<Column name="Поставщики_код_нерезидента" />
							<Column name="Цифровой_код_страны" />
							<Column name="Поставщики_страна" />
							<Column name="Статус_поставщика" />
							<Column name="Поставщики_контактное_лицо_фамилия" />
							<Column name="Поставщики_контактное_лицо_имя" />
							<Column name="Поставщики_контактное_лицо_отчество" />
							<Column name="Поставщики_контактное_лицо_email" />
							<Column name="Поставщики_контактное_лицо_телефон" />
							<Column name="Поставщики_ИП" />
							<Column name="Поставщики_тип_код" />
							<Column name="Поставщики_телефон" />
							<Column name="Поставщики_октмо_код" />
							<Column name="Электронная_почта" />
							<Column name="Поставщики_ОКОПФ_наименование" />
							<Column name="Поставщик_культурных_ценностей" />
							<Column name="Поставщики_дата_постановки_на_учет" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Поставщики">
							<Column name="Поставщики" findExisting="true" />
							<Column name="Поставщики_наименование"  />
							<Column name="Поставщики_тип" />
							<Column name="Поставщики_тип_наименование" />
							<Column name="Поставщики_ИНН" />
							<Column name="Поставщики_КПП" />
							<Column name="Поставщики_ОКПО" />
							<Column name="Дата_постановки_на_учет" />
							<Column name="Поставщики_ОКОПФ" />
							<Column name="Поставщики_ОКТМО" />
							<Column name="Поставщики_адрес" />
							<Column name="Поставщики_код_нерезидента" />
							<Column name="Цифровой_код_страны" />
							<Column name="Поставщики_страна" />
							<Column name="Статус_поставщика" />
							<Column name="Поставщики_контактное_лицо_фамилия" />
							<Column name="Поставщики_контактное_лицо_имя" />
							<Column name="Поставщики_контактное_лицо_отчество" />
							<Column name="Поставщики_контактное_лицо_email" />
							<Column name="Поставщики_контактное_лицо_телефон" />
							<Column name="Поставщики_ИП" />
							<Column name="Поставщики_тип_код" />
							<Column name="Поставщики_телефон" />
							<Column name="Поставщики_октмо_код" />
							<Column name="Электронная_почта" />
							<Column name="Поставщики_ОКОПФ_наименование" />
							<Column name="Поставщик_культурных_ценностей" />
							<Column name="Поставщики_дата_постановки_на_учет" />
						</TargetTable>
					</TableConsolidation> 


				</Actions>
			</Aggregation>
		</OnDocumentCreated>  
		<OnRegcardEdited transaction="single"> 
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана-графика1" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции' and doc_Id = document[doc_Links/doc_Link/link_Document={Позиции плана-графика1}/doc_Id]]" tag="Позиции" />
					<SelectLink source="{current}" flow="Позиции" tag="Позиции"/>
					<SelectLink source="{current}" flow="Позиции плана-графика" tag="Позиции плана-графика"/>
					<Select tag="Все позиции" joinTags="Позиции,{current}" />

				</Select>
				<Actions>
					<Sum sourceFlow="Позиции" targetFlow="{current}" sourceField="|Document|Дата_публикации" targetField="|Document|Фактическая_дата_размещения" />
					
										
					<TableConsolidation>
						<SourceTable flow="Позиции плана-графика1" tableName="|Document|Источники_финансирования">
							<Column name="Источник_финансирования_по_статье_расхода" />
							<Column name="КБК_по_статье_расхода" />
							<Column name="Корректируемая_сумма" />
							<Column name="Год_финансирования_бюджета" />
							<Column name="КВР_бюджета" />
							<Column name="КВР_бюджета_код" />
						
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Источники_финансирования">
							<Column name="Источник_финансирования_по_статье_расхода" />
							<Column name="КБК_по_статье_расхода"   findExisting="true"/>
							<Column name="Финансирование" />
							<Column name="Год_финансирования_бюджета" />
							<Column name="КВР_бюджета" />
							<Column name="КВР_бюджета_код" />
						
						</TargetTable>
					</TableConsolidation>
					
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="{current}" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_платежа_бюджетные_средства} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_бюджетные_средства}"  >
						<SourceTable tableName="|Document|Этапы_исполнения_бюджетные_средства|*|Платежи_этапа_бюджетные_средства">
							<Column name="Финансирование"  />
							<Column name="КБК_бюджетные_средства"  />
							<Column name="Год_платежа_бюджетные_средства"  />
							<Column name="Сумма_платежа_бюджетные_средства"  aggregate="Sum" />
						</SourceTable>
						<Action column="Сумма_по_контракту" formula="$NullToZero({Сумма_по_контракту})-$NullToZero({sourceTableColumn=Сумма_платежа_бюджетные_средства})"/>
					</TableFieldOperations>
					
					<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_платежа_бюджетные_средства} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_бюджетные_средства}" >
						<SourceTable tableName="|Document|Этапы_исполнения_бюджетные_средства|*|Платежи_этапа_бюджетные_средства">
							<Column name="Финансирование"  />
							<Column name="КБК_бюджетные_средства"  />
							<Column name="Год_платежа_бюджетные_средства"  />
							<Column name="Сумма_платежа_бюджетные_средства"  aggregate="Sum" />
						</SourceTable>
						<Action column="Сумма_по_контракту" formula="$NullToZero({Сумма_по_контракту})+$NullToZero({sourceTableColumn=Сумма_платежа_бюджетные_средства})"/>
					</TableFieldOperations>
							
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="{current}" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_платежа_внебюджетные_средства} And {КВР_бюджета_код}={sourceTableColumn=КВР_внебюджетные_средства}" >
						<SourceTable tableName="|Document|Этапы_исполнения_внебюджетные_средства|*|Платежи_этапа_внебюджетные_средства">
							<Column name="КВР_внебюджетные_средства"  />
							<Column name="Год_платежа_внебюджетные_средства"  />
							<Column name="Сумма_платежа_внебюджетные_средства"  aggregate="Sum" />
						</SourceTable>
						<Action column="Сумма_по_контракту" formula="$NullToZero({Сумма_по_контракту})-$NullToZero({sourceTableColumn=Сумма_платежа_внебюджетные_средства})"/>
					</TableFieldOperations>
						
						<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_платежа_внебюджетные_средства} And {КВР_бюджета_код}={sourceTableColumn=КВР_внебюджетные_средства}" >
						<SourceTable tableName="|Document|Этапы_исполнения_внебюджетные_средства|*|Платежи_этапа_внебюджетные_средства">
							<Column name="КВР_внебюджетные_средства"  />
							<Column name="Год_платежа_внебюджетные_средства"  />
							<Column name="Сумма_платежа_внебюджетные_средства"  aggregate="Sum" />
						</SourceTable>
						<Action column="Сумма_по_контракту" formula="$NullToZero({Сумма_по_контракту})+$NullToZero({sourceTableColumn=Сумма_платежа_внебюджетные_средства})"/>
						</TableFieldOperations>
						
					<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Источники_финансирования"  checkFormula="{Финансирование}&lt;{Сумма_по_контракту}" checkMessage="Сумма по контракту не может быть больше суммы финансирования по данному виду КБК">
					</TableFieldOperations>
						
						<!--{Финансирование}&lt;{Сумма_по_контракту}-->
					
						<TableFieldOperations sourceTag="{oldCurrent}" targetTag="Позиции плана-графика1" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}">

						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Сумма_по_контракту"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_контрактов" formula="$NullToZero({Сумма_контрактов})-$NullToZero({sourceTableColumn=Сумма_по_контракту})"/>
						<Action column="Экономия" formula="$NullToZero({Корректируемая_сумма})-$NullToZero({Сумма_контрактов})"/>  
					</TableFieldOperations>
					
					
					
							<TableFieldOperations sourceTag="{current}" targetTag="Позиции плана-графика1" targetTable="|Document|Источники_финансирования" targetRowFilter="{Год_финансирования_бюджета}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Сумма_по_контракту"  />
							<Column name="КБК_по_статье_расхода"  />
							<Column name="Год_финансирования_бюджета"  />
						</SourceTable>
						<Action column="Сумма_контрактов" formula="$NullToZero({sourceTableColumn=Сумма_по_контракту})"/>
						<Action column="Экономия" formula="$NullToZero({Корректируемая_сумма})- $NullToZero({Сумма_контрактов})"/> 
					</TableFieldOperations>
					
					
					
					
					<TableConsolidation>
						<SourceTable flow="{current}" tableName="|Document|Этапы_исполнения_бюджетные_средства">
							<Column name="Дата_окончания_этапа_бюджетные_средства" />
							<Column name="Сумма_платежей_этапа_БС" />
						</SourceTable>
						<SourceTable flow="{current}" tableName="|Document|Этапы_исполнения_внебюджетные_средства">
							<Column name="Дата_окончания_этапа_внебюджетные_средства" />
							<Column name="Сумма_платежей_этапа_ВС" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Этапы_исполнения_контракта">
							<Column name="Дата_окончания_этапа_контракта" findExisting="true" />
							<Column name="Сумма_платежей_этапа_контракта" aggregate="sum" />
						</TargetTable>
					</TableConsolidation>

					<TableConsolidation>
						<SourceTable flow="Позиции плана-графика" tableName="|Document|Поставщики">
							<Column name="Поставщики" />
							<Column name="Поставщики_наименование" />
							<Column name="Поставщики_тип" />
							<Column name="Поставщики_тип_наименование" />
							<Column name="Поставщики_ИНН" />
							<Column name="Поставщики_КПП" />
							<Column name="Поставщики_ОКПО" />
							<Column name="Дата_постановки_на_учет" />
							<Column name="Поставщики_ОКОПФ" />
							<Column name="Поставщики_ОКТМО" />
							<Column name="Поставщики_адрес" />
							<Column name="Поставщики_код_нерезидента" />
							<Column name="Цифровой_код_страны" />
							<Column name="Поставщики_страна" />
							<Column name="Статус_поставщика" />
							<Column name="Поставщики_контактное_лицо_фамилия" />
							<Column name="Поставщики_контактное_лицо_имя" />
							<Column name="Поставщики_контактное_лицо_отчество" />
							<Column name="Поставщики_контактное_лицо_email" />
							<Column name="Поставщики_контактное_лицо_телефон" />
							<Column name="Поставщики_ИП" />
							<Column name="Поставщики_тип_код" />
							<Column name="Поставщики_телефон" />
							<Column name="Поставщики_октмо_код" />
							<Column name="Электронная_почта" />
							<Column name="Поставщики_ОКОПФ_наименование" />
							<Column name="Поставщик_культурных_ценностей" />
							<Column name="Поставщики_дата_постановки_на_учет" />
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Поставщики">
							<Column name="Поставщики" findExisting="true" />
							<Column name="Поставщики_наименование"  />
							<Column name="Поставщики_тип" />
							<Column name="Поставщики_тип_наименование" />
							<Column name="Поставщики_ИНН" />
							<Column name="Поставщики_КПП" />
							<Column name="Поставщики_ОКПО" />
							<Column name="Дата_постановки_на_учет" />
							<Column name="Поставщики_ОКОПФ" />
							<Column name="Поставщики_ОКТМО" />
							<Column name="Поставщики_адрес" />
							<Column name="Поставщики_код_нерезидента" />
							<Column name="Цифровой_код_страны" />
							<Column name="Поставщики_страна" />
							<Column name="Статус_поставщика" />
							<Column name="Поставщики_контактное_лицо_фамилия" />
							<Column name="Поставщики_контактное_лицо_имя" />
							<Column name="Поставщики_контактное_лицо_отчество" />
							<Column name="Поставщики_контактное_лицо_email" />
							<Column name="Поставщики_контактное_лицо_телефон" />
							<Column name="Поставщики_ИП" />
							<Column name="Поставщики_тип_код" />
							<Column name="Поставщики_телефон" />
							<Column name="Поставщики_октмо_код" />
							<Column name="Электронная_почта" />
							<Column name="Поставщики_ОКОПФ_наименование" />
							<Column name="Поставщик_культурных_ценностей" />
							<Column name="Поставщики_дата_постановки_на_учет" />
						</TargetTable>
					</TableConsolidation> 
					<!--	<TableFieldOperations sourceTag="Исполнения контрактов" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" rowFilter="{Дата_окончания_этапа_контракта}={field=Исполнения контрактов:|Document|Этап_контракта}">
						<SourceTable tableName="|Document|Исполнение_контракта">
							<Column name="Фактически_оплачено" aggregate="Sum" />
						</SourceTable>
						<Action column="Фактическая_оплата_по_этапу" formula="{Фактическая_оплата_по_этапу}+{sourceTableColumn=Фактически_оплачено}" />
					</TableFieldOperations>
					<TableFieldOperations sourceTag="Исполнения контрактов" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" rowFilter="{Дата_окончания_этапа_контракта}={field=Исполнения контрактов:|Document|Этап_контракта} And {Сумма_платежей_этапа_контракта}={Фактическая_оплата_по_этапу}">
						<Action column="Этап_закрыт_контракта" formula="1" />
					</TableFieldOperations>-->

					<VerifyExpression>
						<Variables>
							<Variable name="Ценаконтракта" source="{current}" path="|Document|Цена_контракта" />
							<Variable name="НМЦК" source="{current}" path="|Document|НМЦК" />
						</Variables>
						<Expression value="$NullToZero({Ценаконтракта}) &lt; $NullToZero({НМЦК})*1.1"/>
						<FailtureText value="Измененная цена контракта не должна превышать 10% от суммы НМЦК"/>
					</VerifyExpression>
					
				</Actions>
			</Aggregation>
		</OnRegcardEdited>
		<!-- <OnLinkAdded>
			<Aggregation>
				<Select>
						<Select searchString="document[(doc_RegCard/rc_FlowName = 'Позиции') and doc_Id = document[doc_Links/doc_Link/link_Document={Контракты}/doc_Id]]" tag="Позиции" /> 
				</Select>
				<Actions>
					<Sum sourceFlow="Позиции" targetFlow="{current}" sourceField="|Document|Сумма_выплат_всего" targetField="|Document|Цена_контракта" />
					<SetField targetFlow="Позиции" targetField="|Document|Статус" value="Позиция контракта" />
				</Actions>
			</Aggregation>
		</OnLinkAdded> -->

	</Flow>

	<Flow name="Дополнительные соглашения">
		<FieldsModify>
			<CopyField src="|Document|Предмет_договора" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_наименование" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_ИНН" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_КПП" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_СМП" />
			<CopyField src="|Document|Способ_закупки" />
			<CopyField src="|Document|Способ_закупки_код" />
			<CopyField src="|Document|Валюта" />
			<CopyField src="|Document|Цифровой_код_валюты" />
			<CopyField src="|Document|Код_валюты" />
			<CopyField src="|Document|Закупка_в_электронной_форме" />
			<CopyField src="|Document|Номер_извещения" />
			<CopyField src="|Document|Название_закупки" />
			<CopyField src="|Document|ИД_извещения" />
			<CopyField src="|Document|ИД_лота" />
			<CopyField src="|Document|Номер_лота" />
			<CopyField src="%key%" dst="|Document|ИД_договора" />
			<CopyField src="|Document|Номер_договора" dst="|Document|Номер_основного_договора" />
			<CopyField src="|Document|Дата_заключения_договора" dst="|Document|Дата_основного_договора" />
		</FieldsModify>
		<LinksModify>
			<LinkCurrentDoc />
			</LinksModify>
		<OnDocumentCreated>
			<Aggregation>
				<Select>
					<CurrentDoc />
					<Link flow="Контракты" />
				</Select>
				<Actions>
					<SetField targetFlow="Контракты" targetField="|Document|Статус" value="Заключение договора" />
					<SetFieldGuid targetFlow="current" targetField="|Document|ИД_в_ЕИС" />
					<CopyField sourceFlow="Контракты" targetFlow="current" sourceField="%key%" targetField="|Document|ИД_договора" />
				</Actions>
			</Aggregation>
		</OnDocumentCreated>
	</Flow>
	<Flow name="Планы закупок">
		<FieldsModify>
			<PurchasePlanFieldsModify>
				<ThrowIfExist statuses="Отправлено в ЕИС;Опубликован;Размещен;Загружен;Неактуальный" message="Формирование нового плана не доступно при не размещенной версии плана закупок в базе"/>
			</PurchasePlanFieldsModify>
		</FieldsModify>
		<OnDocumentCreated  transaction="split">
			<NamedConstants>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Номер_редакции_порядковый"/>
					<Setting key="CounterNameFormat" value="({|Document|Текущий_финансовый_год}/{|Document|Второй_плановый_год}/{|Document|Организация_заказчик|Организация_заказчик})"/>
				</Constant>
			</NamedConstants>
			<ConditionalActions>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Планы закупок" />
				</Select>
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldsEquals tag="Планы закупок" path="|Document|Номер_редакции_порядковый" />
							</And>
						</Conditions>
						<Actions>
							<SetField targetFlow="Планы закупок" targetField="|Document|Номер_редакции" value="{{|Document|Номер_редакции_порядковый}-1}" />	
						</Actions>
					</ConditionalAction>
				</Actions>
			</ConditionalActions>
		</OnDocumentCreated>
		<OnDocumentCreated  transaction="single">
			<Aggregation>
				<Select>
					<!-- <CurrentDoc /> -->
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Планы закупок" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and xn-in(doc_Id, {currentDocLinkList})]" tag="ППЗ"/>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Бюджеты' and doc_RegCard/rc_Index/text_Организация_заказчик_наименование='{currentDocField=|Document|Организация_заказчик|Организация_заказчик_наименование}']" tag="Бюджеты" />
				</Select>
				<Actions>
					<SetFieldGuid targetFlow="Планы закупок" targetField="|Document|ИД_в_ЕИС" />
					<TableConsolidation>
						<SourceTable flow="ППЗ" tableName="|Document|Источники_финансирования">
							<Column name="КБК_по_статье_расхода" />
                        </SourceTable>
                        <TargetTable flow="{current}" tableName="|Document|Детализация_КБК">
							<Column name="КБК_по_статье_расхода" findExisting="true" />
                        </TargetTable>
                    </TableConsolidation>
					 <TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Текущий_финансовый_год}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_текущий_год" formula="$NullToZero({Сумма_текущий_год})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations> 
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Первый_плановый_год}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_первого_года" formula="$NullToZero({Сумма_первого_года})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Второй_плановый_год}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_второго_года" formula="$NullToZero({Сумма_второго_года})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Второй_плановый_год}&lt;{sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_последующих_годов" formula="$NullToZero({Сумма_последующих_годов})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_всего" formula="$NullToZero({Сумма_всего})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Текущий_финансовый_год}&lt;{sourceTableColumn=Год_финансирования_бюджета} Or {fieldTarget=|Document|Текущий_финансовый_год}=={sourceTableColumn=Год_финансирования_бюджета}) And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Нераспределенный_остаток_ППЗ"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Нераспределенный_остаток" formula="$NullToZero({Нераспределенный_остаток})+$NullToZero({sourceTableColumn=Нераспределенный_остаток_ППЗ})"/>
					</TableFieldOperations>
				</Actions>
			</Aggregation>
		</OnDocumentCreated>
		<OnLinkAdded transaction="single">
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Планы закупок" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and doc_RegCard/rc_Index/text_Статус = 'Согласована' and doc_Id = document[doc_Links/doc_Link/link_Document={Планы закупок}/doc_Id]]" tag="Позиции плана закупок" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and doc_RegCard/rc_Index/text_Статус = 'Согласована' and xn-in(doc_Id, {currentDocLinkList})]" tag="ППЗ"/>
				</Select>
				<Actions>
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Текущий_финансовый_год}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_текущий_год" formula="$NullToZero({Сумма_текущий_год})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations> 
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Первый_плановый_год}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_первого_года" formula="$NullToZero({Сумма_первого_года})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Второй_плановый_год}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_второго_года" formula="$NullToZero({Сумма_второго_года})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Второй_плановый_год}&lt;{sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_последующих_годов" formula="$NullToZero({Сумма_последующих_годов})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_всего" formula="$NullToZero({Сумма_всего})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Текущий_финансовый_год}&lt;{sourceTableColumn=Год_финансирования_бюджета} Or {fieldTarget=|Document|Текущий_финансовый_год}=={sourceTableColumn=Год_финансирования_бюджета}) And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Нераспределенный_остаток_ППЗ"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Нераспределенный_остаток" formula="$NullToZero({Нераспределенный_остаток})+$NullToZero({sourceTableColumn=Нераспределенный_остаток_ППЗ})"/>
					</TableFieldOperations>
					<SetField targetFlow="ППЗ" targetField="|Document|Статус" value="Включена в проект плана закупок" />	
				</Actions>
			</Aggregation>
		</OnLinkAdded>
		<OnLinkDeleted transaction="split">
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Планы закупок" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and doc_Id = document[doc_Links/doc_Link/link_Document={Планы закупок}/doc_Id]]" tag="Позиции плана закупок" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок' and xn-in(doc_Id, {currentDocLinkList})]" tag="ППЗ"/>
				</Select>
				<Actions>
					<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Детализация_КБК" >
						<Action column="Сумма_текущий_год" formula="0"/>
						<Action column="Сумма_первого_года" formula="0"/>
						<Action column="Сумма_второго_года" formula="0"/>
						<Action column="Сумма_последующих_годов" formula="0"/>
						<Action column="Сумма_всего" formula="0"/>
						<Action column="Нераспределенный_остаток" formula="0"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Текущий_финансовый_год}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_текущий_год" formula="$NullToZero({Сумма_текущий_год})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations> 
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Первый_плановый_год}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_первого_года" formula="$NullToZero({Сумма_первого_года})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Второй_плановый_год}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_второго_года" formula="$NullToZero({Сумма_второго_года})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Второй_плановый_год}&lt;{sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_последующих_годов" formula="$NullToZero({Сумма_последующих_годов})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Финансирование"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_всего" formula="$NullToZero({Сумма_всего})+$NullToZero({sourceTableColumn=Финансирование})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="ППЗ" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Текущий_финансовый_год}&lt;{sourceTableColumn=Год_финансирования_бюджета} Or {fieldTarget=|Document|Текущий_финансовый_год}=={sourceTableColumn=Год_финансирования_бюджета}) And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Нераспределенный_остаток_ППЗ"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Нераспределенный_остаток" formula="$NullToZero({Нераспределенный_остаток})+$NullToZero({sourceTableColumn=Нераспределенный_остаток_ППЗ})"/>
					</TableFieldOperations>
					<SetField targetFlow="ППЗ" targetField="|Document|Статус" value="Включена в проект плана закупок" />	

				</Actions>
			</Aggregation>
		</OnLinkDeleted> 
	</Flow>
	<Flow name="Планы-графики">
		<FieldsModify>
			<TenderPlanFieldsModify>
				<ThrowIfExist statuses="Отправлено в ЕИС;Размещен;Загружен;Опубликован;Неактуальный" message="Формирование нового плана не доступно при не размещенной версии плана-графика в базе"/>
				<CalcField target="|Document|Совокупный_годовой_объем_закупок"
                   query="document[doc_RegCard/rc_Index/text_Статус in list ('Исполнение','Завершен', 'Отправлен в ЕИС') and doc_RegCard/rc_FlowName='Контракты' ]"
                   function="SUM(source[|Document|Этапы_исполнения_бюджетные_средства|Платежи_этапа_бюджетные_средства], source[Сумма_платежа_бюджетные_средства], source[Год_платежа_бюджетные_средства] = target[|Document|Год]) + SUM(source[|Document|Этапы_исполнения_внебюджетные_средства|Платежи_этапа_внебюджетные_средства], source[Сумма_платежа_внебюджетные_средства],source[Год_платежа_внебюджетные_средства] = target[|Document|Год])"/>
			</TenderPlanFieldsModify>
		</FieldsModify>
		<OnDocumentCreated  transaction="split">
			<NamedConstants>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Номер_редакции_порядковый"/>
					<Setting key="CounterNameFormat" value="({|Document|Год}/{|Document|Организация_заказчик|Организация_заказчик})"/>
				</Constant>
			</NamedConstants>
     <ConditionalActions>
    <Select>
     <Select searchString="document[doc_Id = '{current_Id}']" tag="Планы-графики" />
    </Select>
    <Actions>
     <ConditionalAction>
      <Conditions>
       <And>
        <WhenFieldsEquals tag="Планы-графики" path="|Document|Номер_редакции_порядковый" />
       </And>
      </Conditions>
      <Actions>
       <SetField targetFlow="Планы-графики" targetField="|Document|Номер_редакции" value="{{|Document|Номер_редакции_порядковый}-1}" /> 
      </Actions>
     </ConditionalAction>
    </Actions>
   </ConditionalActions>
  </OnDocumentCreated>
		<OnDocumentCreated  transaction="single">
			
					
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_RegCard/rc_Index/boolean_СМП = '1' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции план-графика СМП" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_RegCard/rc_Index/text_Способ_определения_поставщика_код = 'ZK44' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции план-графика котировки" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции план-графика" />
					
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Черновик', 'На согласовании', 'На доработке', 'Включена в проект плана-графика', 'Отказ от размещения', 'Отправлено в ЕИС')) and doc_RegCard/rc_Index/integer_Планируемый_год_размещения = '{currentDocField=|Document|Год}' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции план-графика СГОЗ" />	

					<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Черновик', 'На согласовании', 'На доработке', 'Неактуальный', 'Отправлено в ЕИС', 'Согласован')) and (doc_RegCard/rc_Index/date_Дата_заключения &lt;= '{currentDocField=|Document|Год}-01-01T00:00:00Z')  and doc_RegCard/rc_Index/integer_Год_финансирования_бюджета = '{currentDocField=|Document|Год}' ]" tag="Контракты СГОЗ" />
					
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Планы закупок' and xn-in(doc_RegCard/rc_Index/text_Статус, 'Размещен', 'Опубликован') and (doc_RegCard/rc_Index/integer_Текущий_финансовый_год= '{currentDocField=|Document|Год}')  and (doc_RegCard/rc_Index/integer_Организация_заказчик = '{currentDocField=|Document|Организация_заказчик|Организация_заказчик}')]" tag="Планы_закупок" />
				</Select>

				<Actions>
					<CopyField sourceFlow="Планы_закупок" targetFlow="{current}" sourceField="|Document|Реестровый_номер_в_ЕИС" targetField="|Document|Реестровый_номер_ПЗ" />
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_текущий_год" targetField="|Document|Сумма_СМП_текущий_год" />
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_первый_плановый_год" targetField="|Document|Сумма_СМП_первый_плановый_год" />
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_второй_плановый_год" targetField="|Document|Сумма_СМП_второй_плановый_год" />
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_последующие_годы" targetField="|Document|Сумма_СМП_последующие_годы" />
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_всего" targetField="|Document|Сумма_СМП" />

					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_текущий_год" targetField="|Document|Сумма_запросы_котировок_текущий_год" />
					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_первый_плановый_год" targetField="|Document|Сумма_запросы_котировок_первый_плановый_год" />
					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_второй_плановый_год" targetField="|Document|Сумма_запросы_котировок_второй_плановый_год" />
					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_последующие_годы" targetField="|Document|Сумма_запросы_котировок_последующие_годы" />
					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_всего" targetField="|Document|Сумма_запросы_котировок" />

					<Sum sourceFlow="Позиции план-графика" targetFlow="{current}" sourceField="|Document|Сумма_текущий_год" targetField="|Document|Сумма_финансирования_ПГ_текущий_год" />
					<Sum sourceFlow="Позиции план-графика" targetFlow="{current}" sourceField="|Document|Сумма_первый_плановый_год" targetField="|Document|Сумма_финансирования_ПГ_первый_плановый_год" />
					<Sum sourceFlow="Позиции план-графика" targetFlow="{current}" sourceField="|Document|Сумма_второй_плановый_год" targetField="|Document|Сумма_финансирования_ПГ_второй_плановый_год" />
					<Sum sourceFlow="Позиции план-графика" targetFlow="{current}" sourceField="|Document|Сумма_последующие_годы" targetField="|Document|Сумма_финансирования_ПГ_последующие_годы" />
					<Sum sourceFlow="Позиции план-графика" targetFlow="{current}" sourceField="|Document|Сумма_всего" targetField="|Document|Общая_сумма_финансирования_ПГ" />
					<!-- <SetFieldGuid targetFlow="Планы-графики" targetField="|Document|ИД_в_ЕИС" /> -->
					
					<TableConsolidation>
						<SourceTable flow="Позиции план-графика" tableName="|Document|Источники_финансирования">
							<Column name="КБК_по_статье_расхода" />
                        </SourceTable>
                        <TargetTable flow="{current}" tableName="|Document|Детализация_КБК">
							<Column name="КБК_по_статье_расхода" findExisting="true" />
                        </TargetTable>
                    </TableConsolidation>
					 <TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Год}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_текущий_год" formula="$NullToZero({Сумма_текущий_год})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations> 
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Год}+1)={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_первого_года" formula="$NullToZero({Сумма_первого_года})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Год}+2)={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_второго_года" formula="$NullToZero({Сумма_второго_года})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Год}+2)&lt;{sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_последующих_годов" formula="$NullToZero({Сумма_последующих_годов})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_всего" formula="$NullToZero({Сумма_всего})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Год}&lt;{sourceTableColumn=Год_финансирования_бюджета} Or ({fieldTarget=|Document|Год})=={sourceTableColumn=Год_финансирования_бюджета}) And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Нераспределенный_остаток_для_карточки"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Нераспределенный_остаток" formula="$NullToZero({Нераспределенный_остаток})+$NullToZero({sourceTableColumn=Нераспределенный_остаток_для_карточки})"/>
					</TableFieldOperations>
					
					<!--СГОЗ-->
					<CalculateExpression targetFlow="{current}" targetField="|Document|Сумма_по_ППГ"> 
						<Variables>
							<Variable name="СуммаизППГ" source="Позиции план-графика СГОЗ" path="|Document|Сумма_текущий_год" aggregation="sum" />
							<Variable name="СуммаизКонтрактыСГОЗ" source="Контракты СГОЗ" path="|Document|Источники_финансирования" isTable="true" tableColumn="Сумма_по_контракту" rowFilter="{fieldTarget=|Document|Год}=={Год_финансирования_бюджета}" aggregation="sum"/>							
					</Variables>
						<Expression value="$NullToZero({СуммаизППГ})+ $NullToZero({СуммаизКонтрактыСГОЗ}) "/>
					</CalculateExpression>
					
				</Actions>
			</Aggregation>
		</OnDocumentCreated>
		<OnLinkAdded transaction="single">
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Планы-графики" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_RegCard/rc_Index/text_Статус = 'Согласована' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции план-графика" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and xn-in(doc_Id, {currentDocLinkList})]" tag="ППГ" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_RegCard/rc_Index/boolean_СМП = '1' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции план-графика СМП" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_RegCard/rc_Index/text_Способ_определения_поставщика_код = 'ZK44' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции план-графика котировки" />
				</Select>
				<Actions>
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_текущий_год" targetField="|Document|Сумма_СМП_текущий_год" />
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_первый_плановый_год" targetField="|Document|Сумма_СМП_первый_плановый_год" />
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_второй_плановый_год" targetField="|Document|Сумма_СМП_второй_плановый_год" />
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_последующие_годы" targetField="|Document|Сумма_СМП_последующие_годы" />
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_всего" targetField="|Document|Сумма_СМП" />

					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_текущий_год" targetField="|Document|Сумма_запросы_котировок_текущий_год" />
					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_первый_плановый_год" targetField="|Document|Сумма_запросы_котировок_первый_плановый_год" />
					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_второй_плановый_год" targetField="|Document|Сумма_запросы_котировок_второй_плановый_год" />
					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_последующие_годы" targetField="|Document|Сумма_запросы_котировок_последующие_годы" />
					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_всего" targetField="|Document|Сумма_запросы_котировок" />

					<Sum sourceFlow="ППГ" targetFlow="{current}" sourceField="|Document|Сумма_текущий_год" targetField="|Document|Сумма_финансирования_ПГ_текущий_год" />
					<Sum sourceFlow="ППГ" targetFlow="{current}" sourceField="|Document|Сумма_первый_плановый_год" targetField="|Document|Сумма_финансирования_ПГ_первый_плановый_год" />
					<Sum sourceFlow="ППГ" targetFlow="{current}" sourceField="|Document|Сумма_второй_плановый_год" targetField="|Document|Сумма_финансирования_ПГ_второй_плановый_год" />
					<Sum sourceFlow="ППГ" targetFlow="{current}" sourceField="|Document|Сумма_последующие_годы" targetField="|Document|Сумма_финансирования_ПГ_последующие_годы" />
					<Sum sourceFlow="ППГ" targetFlow="{current}" sourceField="|Document|Сумма_всего" targetField="|Document|Общая_сумма_финансирования_ПГ" />
					<TableConsolidation>
						<SourceTable flow="Позиции план-графика" tableName="|Document|Источники_финансирования">
							<Column name="КБК_по_статье_расхода" />
                        </SourceTable>
                        <TargetTable flow="{current}" tableName="|Document|Детализация_КБК">
							<Column name="КБК_по_статье_расхода" findExisting="true" />
                        </TargetTable>
                    </TableConsolidation>
					 <TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Год}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_текущий_год" formula="$NullToZero({Сумма_текущий_год})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations> 
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Год}+1)={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_первого_года" formula="$NullToZero({Сумма_первого_года})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Год}+2)={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_второго_года" formula="$NullToZero({Сумма_второго_года})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Год}+2)&lt;{sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_последующих_годов" formula="$NullToZero({Сумма_последующих_годов})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_всего" formula="$NullToZero({Сумма_всего})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Год}&lt;{sourceTableColumn=Год_финансирования_бюджета} Or ({fieldTarget=|Document|Год})=={sourceTableColumn=Год_финансирования_бюджета}) And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Нераспределенный_остаток_для_карточки"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Нераспределенный_остаток" formula="$NullToZero({Нераспределенный_остаток})+$NullToZero({sourceTableColumn=Нераспределенный_остаток_для_карточки})"/>
					</TableFieldOperations>
					 <SetField targetFlow="Позиции план-графика" targetField="|Document|Статус" value="Включена в проект плана-графика" />	 				
				</Actions>
			</Aggregation>
		</OnLinkAdded>
		<OnLinkDeleted transaction="split">
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="Планы-графики" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_Id = document[doc_Links/doc_Link/link_Document={Планы-графики}/doc_Id]]" tag="Позиции план-графика" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_RegCard/rc_Index/boolean_СМП = '1' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции план-графика СМП" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' and doc_RegCard/rc_Index/text_Способ_определения_поставщика_код = 'ZK44' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции план-графика котировки" />
				</Select>
				<Actions>
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_текущий_год" targetField="|Document|Сумма_СМП_текущий_год" />
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_первый_плановый_год" targetField="|Document|Сумма_СМП_первый_плановый_год" />
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_второй_плановый_год" targetField="|Document|Сумма_СМП_второй_плановый_год" />
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_последующие_годы" targetField="|Document|Сумма_СМП_последующие_годы" />
					<Sum sourceFlow="Позиции план-графика СМП" targetFlow="{current}" sourceField="|Document|Сумма_всего" targetField="|Document|Сумма_СМП" />

					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_текущий_год" targetField="|Document|Сумма_запросы_котировок_текущий_год" />
					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_первый_плановый_год" targetField="|Document|Сумма_запросы_котировок_первый_плановый_год" />
					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_второй_плановый_год" targetField="|Document|Сумма_запросы_котировок_второй_плановый_год" />
					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_последующие_годы" targetField="|Document|Сумма_запросы_котировок_последующие_годы" />
					<Sum sourceFlow="Позиции план-графика котировки" targetFlow="{current}" sourceField="|Document|Сумма_всего" targetField="|Document|Сумма_запросы_котировок" />

					<Sum sourceFlow="Позиции план-графика" targetFlow="{current}" sourceField="|Document|Сумма_текущий_год" targetField="|Document|Сумма_финансирования_ПГ_текущий_год" />
					<Sum sourceFlow="Позиции план-графика" targetFlow="{current}" sourceField="|Document|Сумма_первый_плановый_год" targetField="|Document|Сумма_финансирования_ПГ_первый_плановый_год" />
					<Sum sourceFlow="Позиции план-графика" targetFlow="{current}" sourceField="|Document|Сумма_второй_плановый_год" targetField="|Document|Сумма_финансирования_ПГ_второй_плановый_год" />
					<Sum sourceFlow="Позиции план-графика" targetFlow="{current}" sourceField="|Document|Сумма_последующие_годы" targetField="|Document|Сумма_финансирования_ПГ_последующие_годы" />
					<Sum sourceFlow="Позиции план-графика" targetFlow="{current}" sourceField="|Document|Сумма_всего" targetField="|Document|Общая_сумма_финансирования_ПГ" />
					
					<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Детализация_КБК" >
						<Action column="Сумма_текущий_год" formula="0"/>
						<Action column="Сумма_первого_года" formula="0"/>
						<Action column="Сумма_второго_года" formula="0"/>
						<Action column="Сумма_последующих_годов" formula="0"/>
						<Action column="Сумма_всего" formula="0"/>
						<Action column="Нераспределенный_остаток" formula="0"/>
					</TableFieldOperations>
					<TableConsolidation>
						<SourceTable flow="Позиции план-графика" tableName="|Document|Источники_финансирования">
							<Column name="КБК_по_статье_расхода" />
                        </SourceTable>
                        <TargetTable flow="{current}" tableName="|Document|Детализация_КБК">
							<Column name="КБК_по_статье_расхода" findExisting="true" />
                        </TargetTable>
                    </TableConsolidation>
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{fieldTarget=|Document|Год}={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма" />
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_текущий_год" formula="$NullToZero({Сумма_текущий_год})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations> 
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Год}+1)={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_первого_года" formula="$NullToZero({Сумма_первого_года})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Год}+2)={sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_второго_года" formula="$NullToZero({Сумма_второго_года})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Год}+2)&lt;{sourceTableColumn=Год_финансирования_бюджета} And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_последующих_годов" formula="$NullToZero({Сумма_последующих_годов})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="{КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Корректируемая_сумма"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Сумма_всего" formula="$NullToZero({Сумма_всего})+$NullToZero({sourceTableColumn=Корректируемая_сумма})"/>
					</TableFieldOperations>
					<TableFieldOperations sourceTag="Позиции план-графика" targetTag="{current}" targetTable="|Document|Детализация_КБК" targetRowFilter="({fieldTarget=|Document|Год}&lt;{sourceTableColumn=Год_финансирования_бюджета} Or ({fieldTarget=|Document|Год})=={sourceTableColumn=Год_финансирования_бюджета}) And {КБК_по_статье_расхода}={sourceTableColumn=КБК_по_статье_расхода}" >
						<SourceTable tableName="|Document|Источники_финансирования">
							<Column name="Нераспределенный_остаток_для_карточки"/>
							<Column name="Год_финансирования_бюджета" />
							<Column name="КБК_по_статье_расхода" />
						</SourceTable>
						<Action column="Нераспределенный_остаток" formula="$NullToZero({Нераспределенный_остаток})+$NullToZero({sourceTableColumn=Нераспределенный_остаток_для_карточки})"/>
					</TableFieldOperations>

				</Actions>
			</Aggregation>
		</OnLinkDeleted> 
	</Flow> 
	<Flow name="Исполнения контрактов">
		<FieldsModify>
		
			<CopyField src="%key%" dst="|Document|ИД_контракта" />
			<CopyField src="|Document|Номер_контракта" />
			<CopyField src="|Document|Номер_закупки_в_ЕИС" />
			<CopyField src="|Document|Номер_по_гос.оборонному_заказу" />
			<CopyField src="|Document|Цена_контракта" />
			<CopyField src="|Document|Дата_заключения" />
			<CopyField src="|Document|Валюта" />
			<CopyField src="|Document|Код_валюты" />
			<CopyField src="|Document|Номер_реестровой_записи" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СПЗ" /> 
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СР" /> 
			<CopyField src="|Document|Лекарственный_препарат" />
			<CopyField src="|Document|Роль_организатора_закупки" dst="|Document|Роль_организатора_закупки_протокол" />
			<CopyField src="|Document|Роль_организатора_закупки_код"  dst="|Document|Роль_организатора_закупки_протокол_код" />
			<CopyField src="|Document|Банковская_гарантия|РН_банковской_гарантии" dst="|Document|Банковская_гарантия|Реестровый_номер_БГ" />
			<CopyField src="|Document|Банковская_гарантия|Валюта_банковской_гарантии" dst="|Document|Банковская_гарантия|Валюта_требований" />
			<CopyField src="|Document|Банковская_гарантия|Валюта_банковской_гарантии_код" dst="|Document|Банковская_гарантия|Код_валюты_требований" />
			<CopyField src="|Document|Банковская_гарантия|Сумма_банковской_гарантии" dst="|Document|Банковская_гарантия|Сумма_требований" />
			<CopyField src="|Document|Банковская_гарантия|Сумма_банковской_гарантии_в_рублевом_эквиваленте" dst="|Document|Банковская_гарантия|Сумма_требований_руб" />
			<CopyField src="|Document|Банковская_гарантия|Номер_документа_реестровой_записи_БГ" dst="|Document|Банковская_гарантия|Номер_документа_требований" />
			<CopyField src="|Document|Организация_опубликовавшая_контракт|Организатор_опубликовавшая_контракт_наименование"  />
			<CopyField src="|Document|Организация_опубликовавшая_контракт|Организатор_опубликовавшая_контракт"  />
			<CopyField src="|Document|Организация_опубликовавшая_контракт|Организатор_опубликовавшая_контракт_код_по_СПЗ"   />
			<CopyField src="|Document|Организация_опубликовавшая_контракт|Организация_опубликовавшая_код_СР"  />
			<CopyField src="|Document|Организация_опубликовавшая_контракт|Организация_опубликовавшая_Код_ЕИС"  />
			<CopyField src="|Document|Требование_об_обеспечении_исполнения_контракта"  />
			<CopyField src="|Document|Банковская_гарантия_выданная_банком"  />
		</FieldsModify>
		<LinksModify>
			<LinkCurrentDoc />
		</LinksModify> 

		<OnDocumentCreated transaction="single">
			<Aggregation>
				<Select>
				<!-- 	<Select searchString="document[doc_Id = '{current_Id}']" tag="Исполнения контрактов" /> -->
							
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' and xn-in(doc_Id, {currentDocLinkList})]" tag="Контракты" />
					<SelectLink source="{current}" flow="Контракты" tag="Контракты"/> 

				</Select>
				<Actions>

					<TableFieldOperations sourceTag="{current}" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" targetRowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}">
						<SourceTable tableName="|Document|Исполнение_контракта">
							<Column name="Фактически_оплачено" aggregate="Sum" />
						</SourceTable>
						<Action column="Фактическая_оплата_по_этапу" formula="iif({Фактическая_оплата_по_этапу}=null,Decimal?(0),{Фактическая_оплата_по_этапу})+{sourceTableColumn=Фактически_оплачено}" />
					</TableFieldOperations>
					
					<TableFieldOperations sourceTag="{current}" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" targetRowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта} And {Сумма_платежей_этапа_контракта}={Фактическая_оплата_по_этапу}">
						<Action column="Этап_закрыт_контракта" formula="1" />
					</TableFieldOperations>
					
					<TableFieldOperations sourceTag="{current}" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" targetRowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}">
						<SourceTable tableName="|Document|Исполнение_контракта">
							<Column name="Фактически_оплачено" aggregate="Sum" />
						</SourceTable>
						<Action column="Остаток_платежей_по_этапу" formula="iif({Сумма_платежей_этапа_контракта}=null,Decimal?(0),{Сумма_платежей_этапа_контракта})-{sourceTableColumn=Фактически_оплачено}" />
					</TableFieldOperations>
					
					<TableFieldOperations sourceTag="{current}" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" targetRowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}">
						<SourceTable tableName="|Document|Исполнение_контракта|*|Объем_товаров">
							<Column name="Единица_измерения_поставки" />
							<Column name="Код_ОКЕИ_поставки" />
							<Column name="Количество_поставки" aggregate="Sum" />
						</SourceTable>
						<Action column="ОКЕИ_этап_код" formula="{sourceTableColumn=Код_ОКЕИ_поставки}" />
						<Action column="ОКЕИ_этап" formula="{sourceTableColumn=Единица_измерения_поставки}" />
						<Action column="Колво_поставки_по_этапу" formula="iif({Колво_поставки_по_этапу}=null,Decimal?(0),{Колво_поставки_по_этапу})+{sourceTableColumn=Количество_поставки}" />
					</TableFieldOperations>
		
					<TableFieldOperations sourceTag="{current}" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" targetRowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}">
						<SourceTable tableName="|Document|Исполнение_контракта|*|ЛП_объем">
							<Column name="ОКЕИ_поставки_ЛП" />
							<Column name="Код_ОКЕИ_поставки_ЛП" />
							<Column name="Количество_поставленных_ЛП" aggregate="Sum" />
						</SourceTable>
						<Action column="ОКЕИ_этап_код" formula="{sourceTableColumn=ОКЕИ_поставки_ЛП}" />
						<Action column="ОКЕИ_этап" formula="{sourceTableColumn=Единица_измерения_поставки}" />
						<Action column="Колво_поставки_по_этапу" formula="iif({Колво_поставки_по_этапу}=null,Decimal?(0),{Колво_поставки_по_этапу})+{sourceTableColumn=Количество_поставленных_ЛП}" />
					</TableFieldOperations>
					
					
					<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Исполнение_контракта|*|Объем_товаров" checkFormula="{Количество_по_контракту}&lt;={Количество_поставки}" checkMessage="Количество поставки не должно быть больше количества по контракту" >
					</TableFieldOperations>
					
					<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Исполнение_контракта|*|ЛП_объем" checkFormula="{Количество_по_контракту_ЛП}&lt;={Количество_поставленных_ЛП}" checkMessage="Количество поставки не должно быть больше количества по контракту" >
					</TableFieldOperations>
						
					
						
					
				</Actions>
			</Aggregation>
		</OnDocumentCreated>
		<OnRegcardEdited transaction="single"> 
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' and doc_Id = document[doc_Links/doc_Link/link_Document={current_Id}]]" tag="Контракты" />
				</Select>
				<Actions>
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" targetRowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}">
						<!-- rowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}"   {Фактическая_оплата_по_этапу}-->
						<SourceTable tableName="|Document|Исполнение_контракта">
							<Column name="Фактически_оплачено" aggregate="Sum" />
						</SourceTable>
						<Action column="Фактическая_оплата_по_этапу" formula="iif({Фактическая_оплата_по_этапу}=null,Decimal?(0),{Фактическая_оплата_по_этапу})-{sourceTableColumn=Фактически_оплачено}" />
					</TableFieldOperations>

					<TableFieldOperations sourceTag="{current}" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" targetRowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}">
						<!-- rowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}"   {Фактическая_оплата_по_этапу}-->
						<SourceTable tableName="|Document|Исполнение_контракта">
							<Column name="Фактически_оплачено" aggregate="Sum" />
						</SourceTable>
						<Action column="Фактическая_оплата_по_этапу" formula="iif({Фактическая_оплата_по_этапу}=null,Decimal?(0),{Фактическая_оплата_по_этапу})+{sourceTableColumn=Фактически_оплачено}" />
					</TableFieldOperations>
					<TableFieldOperations sourceTag="{current}" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" targetRowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта} And {Сумма_платежей_этапа_контракта}={Фактическая_оплата_по_этапу}">
						<Action column="Этап_закрыт_контракта" formula="1" />
					</TableFieldOperations>
					
					<TableFieldOperations sourceTag="{oldCurrent}" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" targetRowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}">
						<!-- rowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}"   {Фактическая_оплата_по_этапу}-->
						<SourceTable tableName="|Document|Исполнение_контракта">
							<Column name="Фактически_оплачено" aggregate="Sum" />
						</SourceTable>
						<Action column="Остаток_платежей_по_этапу" formula="iif({Сумма_платежей_этапа_контракта}=null,Decimal?(0),{Сумма_платежей_этапа_контракта})+{sourceTableColumn=Фактически_оплачено}" />
					</TableFieldOperations>
					
					<TableFieldOperations sourceTag="{current}" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" targetRowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}">
						<!-- rowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}"   {Фактическая_оплата_по_этапу}-->
						<SourceTable tableName="|Document|Исполнение_контракта">
							<Column name="Фактически_оплачено" aggregate="Sum" />
						</SourceTable>
						<Action column="Остаток_платежей_по_этапу" formula="iif({Сумма_платежей_этапа_контракта}=null,Decimal?(0),{Сумма_платежей_этапа_контракта})-{sourceTableColumn=Фактически_оплачено}" />
					</TableFieldOperations>
		
					<TableFieldOperations sourceTag="{current}" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" targetRowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}">
						<SourceTable tableName="|Document|Исполнение_контракта|*|Объем_товаров">
								<Column name="Количество_поставки" aggregate="Sum" />
						</SourceTable>
						<Action column="Колво_поставки_по_этапу" formula="iif({Колво_поставки_по_этапу}=null,Decimal?(0),{Колво_поставки_по_этапу})-{sourceTableColumn=Количество_поставки}" />
					</TableFieldOperations>
					
								
					<TableFieldOperations sourceTag="{current}" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" targetRowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}">
						<SourceTable tableName="|Document|Исполнение_контракта|*|Объем_товаров">
							<Column name="Единица_измерения_поставки" />
							<Column name="Код_ОКЕИ_поставки" />
							<Column name="Количество_поставки" aggregate="Sum" />
						</SourceTable>
						<Action column="ОКЕИ_этап_код" formula="{sourceTableColumn=Код_ОКЕИ_поставки}" />
						<Action column="ОКЕИ_этап" formula="{sourceTableColumn=Единица_измерения_поставки}" />
						<Action column="Колво_поставки_по_этапу" formula="iif({Колво_поставки_по_этапу}=null,Decimal?(0),{Колво_поставки_по_этапу})+{sourceTableColumn=Количество_поставки}" />
					</TableFieldOperations>
					
						<TableFieldOperations sourceTag="{current}" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" targetRowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}">
						<SourceTable tableName="|Document|Исполнение_контракта|*|ЛП_объем">
								<Column name="Количество_поставленных_ЛП" aggregate="Sum" />
						</SourceTable>
						<Action column="Колво_поставки_по_этапу" formula="iif({Колво_поставки_по_этапу}=null,Decimal?(0),{Колво_поставки_по_этапу})-{sourceTableColumn=Количество_поставленных_ЛП}" />
					</TableFieldOperations>
					
								
					<TableFieldOperations sourceTag="{current}" targetTag="Контракты" targetTable="|Document|Этапы_исполнения_контракта" targetRowFilter="{Дата_окончания_этапа_контракта}={field=|Document|Этап_контракта}">
						<SourceTable tableName="|Document|Исполнение_контракта|*|ЛП_объем">
							<Column name="ОКЕИ_поставки_ЛП" />
							<Column name="Код_ОКЕИ_поставки_ЛП" />
							<Column name="Количество_поставленных_ЛП" aggregate="Sum" />
						</SourceTable>
						<Action column="ОКЕИ_этап_код" formula="{sourceTableColumn=ОКЕИ_поставки_ЛП}" />
						<Action column="ОКЕИ_этап" formula="{sourceTableColumn=Единица_измерения_поставки}" />
						<Action column="Колво_поставки_по_этапу" formula="iif({Колво_поставки_по_этапу}=null,Decimal?(0),{Колво_поставки_по_этапу})+{sourceTableColumn=Количество_поставленных_ЛП}" />
					</TableFieldOperations>
					
					<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Исполнение_контракта|*|Объем_товаров" checkFormula="{Количество_по_контракту}&lt;={Количество_поставки}" checkMessage="Количество поставки не должно быть больше количества по контракту" >
					</TableFieldOperations>
					
					<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Исполнение_контракта|*|ЛП_объем" checkFormula="{Количество_по_контракту_ЛП}&lt;={Количество_поставленных_ЛП}" checkMessage="Количество поставки не должно быть больше количества по контракту" >
					</TableFieldOperations>
					

				</Actions>
			</Aggregation>
		</OnRegcardEdited>
	</Flow>	

	<Flow name="Федеральные отчеты">
		<LinksModify>
			<LinkCurrentDoc />
		</LinksModify>	
		<FieldsModify  source="Контракты">
			<CopyField src="%key%" dst="|Document|ИД_контракта" />
			<CopyField src="|Document|Номер_закупки_в_ЕИС" />
			<CopyField src="|Document|Номер_лота_в_извещении" />   
			<CopyField src="|Document|Предмет_контракта" /> 
			<CopyField src="|Document|Номер_реестровой_записи" dst="|Document|Реестровый_номер_контракта" />
			<CopyField src="|Document|Документы_основание_ед_поставщик_код" />    
			<CopyField src="|Document|Документы_основание_ед_поставщик_пункт" />       
			<CopyField src="|Document|Документы_основание_ед_поставщик_наименование" />  
			<SetField dst="|Document|Номер_редакции" value="" /> 
			<SetField dst="|Document|Тип_отчета" value="Отчет с обоснованием закупки у единственного поставщика (подрядчика, исполнителя)" />    
            <SetField dst="|Document|Отчетный_год" value="1999" /> 
			<CopyTable src="|Document|Поставщики" />
			<CopyTable src="|Document|Этапы_исполнения_контракта" />
			<CopyField src="|Document|Цена_контракта" />  
			<CopyField src="|Document|Дата_начала_исполнения_контракта" />  
			<CopyField src="|Document|Дата_окончания_исполнения_контракта" />  
			<CopyField src="|Document|Дата_заключения" />  
		</FieldsModify>
		<FieldsModify  source="Планы закупок">
			<CopyField src="%key%" dst="|Document|ИД_ПЗ" />
			<CopyField src="|Document|Реестровый_номер_в_ЕИС" />
			<CopyField src="|Document|Дата_утверждения" />   
			<CopyField src="|Document|Текущий_финансовый_год" /> 
			<CopyField src="|Document|Первый_плановый_год" />
			<CopyField src="|Document|Второй_плановый_год" />    
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование" />     
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ИНН" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_КПП"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Адрес"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Телефон"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Электронная_почта"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Код_в_ЕИС"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СПЗ"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_код_по_СР"   />
			<CopyField src="|Document|Организация_заказчик|ОКТМО"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКОПФ"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКТМОППО"   />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_Дата_постановки_на_учет"  />			
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОКОПФ_наименование"  />			
			<CopyField src="|Document|Нормативная_база" />  
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СПЗ"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_код_по_СР"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_ОКТМО"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_ОКП"  />
			<CopyField src="|Document|Роль_организатора_закупки" />  
			<CopyField src="|Document|Ответственный|Ответственный_ФИО" />  
			<CopyField src="|Document|Ответственный|Ответственный_должность" />  
			<CopyField src="|Document|Утвердивший|Утвердивший_ФИО" />  
			<CopyField src="|Document|Утвердивший|Утвердивший_должност" />  
			<CopyField src="|Document|Согласующий|Согласующий_ФИО" />  			
			<SetField dst="|Document|Номер_редакции" value="" /> 
			<SetField dst="|Document|Тип_отчета" value="Исполнение плана закупок" /> 
            <SetField dst="|Document|Отчетный_год" value="1999" />             
		</FieldsModify>		
		<OnDocumentCreated transaction="single" >
			<NamedConstants>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Номер_редакции"/>
					<Setting key="CounterNameFormat" value="({|Document|Отчетный_год}/{|Document|Организация_заказчик|Организация_заказчик}/{|Document|Тип_отчета}/{|Document|ИД_контракта})"/>
				</Constant>
			</NamedConstants>
             <ConditionalActions>
      <Select>
		<!-- НМЦК_СМП_несостоявшиеся -->
        <Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки на размещение закупки' 
							  and doc_RegCard/rc_Index/text_Код_ограничения='MB44330']"
				tag="Заявки на размещение закупки" />
        <Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика'
							and doc_RegCard/rc_Index/integer_Планируемый_год_размещения='{currentDocField=|Document|Отчетный_год}'
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}'
							and xn-in(doc_RegCard/rc_Index/text_Способ_определения_поставщика_код, 'OK44', 'EA44', 'OKD44', 'OKU44', 'PO44', 'ZK44', 'ZP44') 
							and ((xn-in(doc_RegCard/rc_Index/text_Статус,'Закупка не состоялась (одна заявка)', 'Закупка не состоялась (отказ комиссии)', 'Отказ от заключения контракта')) 
							or (xn-in(doc_RegCard/rc_Index/text_Статус,'Заключение контракта','Согласование контракта','Контракт согласован','Исполнение', 'Исполнение завершено') 
							and (doc_RegCard/rc_Index/longtext_Документы_основание_ед_поставщик_пункт='Часть 1 пункт 25 статьи 93')) )
							and doc_Id = document[doc_Links/doc_Link/link_Document={Заявки на размещение закупки}/doc_Id]]" 
				tag="Позиции плана-графика" />
	    <!--СГОЗ-->  
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' 
							and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Черновик', 'На согласовании', 'На доработке', 'Включена в проект плана-графика', 'Отказ от размещения', 'Отправлено в ЕИС')) 
							and doc_RegCard/rc_Index/integer_Планируемый_год_размещения = '{currentDocField=|Document|Отчетный_год}' 
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}']" 
				tag="Сумма_по_ППГ" />	

		<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' 
							and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Черновик', 'На согласовании', 'На доработке', 'Неактуальный', 'Отправлено в ЕИС', 'Согласован')) 
							and (doc_RegCard/rc_Index/date_Дата_заключения &lt;= '{currentDocField=|Document|Отчетный_год}-01-01T00:00:00Z') 
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}' 
							and doc_RegCard/rc_Index/integer_Год_финансирования_бюджета = '{currentDocField=|Document|Отчетный_год}']" 
				tag="Сумма_по_Контрактам" />
		<!-- Объем_СМП_обеспечения_контрактов_ст93_ч1 -->		
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика'   
							and xn-in(doc_RegCard/rc_Index/text_Способ_определения_поставщика_код, 'OK44', 'EA44', 'OKD44', 'OKU44', 'PO44', 'ZK44', 'ZP44', 'EP44')  
							and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Черновик','Проект', 'На согласовании', 'На доработке','Согласована', 'Включена в проект плана-графика', 'Неактуальная','Отказ от размещения')) 
							and doc_RegCard/rc_Index/integer_Планируемый_год_размещения = '{currentDocField=|Document|Отчетный_год}' 
							and doc_RegCard/rc_Index/longtext_Документы_основание_ед_поставщик_пункт != '' 
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}']" 
				tag="Сумма_по_ППГ_2.4" />	
		
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' 
							and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Черновик', 'На согласовании', 'На доработке', 'Неактуальный', 'Отправлено в ЕИС', 'Согласован')) 
							and (doc_RegCard/rc_Index/date_Дата_заключения &lt;= '{currentDocField=|Document|Отчетный_год}-01-01T00:00:00Z')  
							and doc_RegCard/rc_Index/longtext_Документы_основание_ед_поставщик_пункт != '' 
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}' 
							and xn-in(doc_RegCard/rc_Index/text_Способ_определения_поставщика_код, 'OK44', 'EA44', 'OKD44', 'OKU44', 'PO44', 'ZK44', 'ZP44', 'EP44')  
							and doc_RegCard/rc_Index/integer_Год_финансирования_бюджета = '{currentDocField=|Document|Отчетный_год}']" 
				tag="Сумма_по_Контрактам_2.4" />	
		
		<!-- Объем_СМП_обеспечения_контрактов_закрытых_способов -->	
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика'   
							and not(xn-in(doc_RegCard/rc_Index/text_Способ_определения_поставщика_код, 'OK44', 'EA44', 'OKD44', 'OKU44', 'PO44', 'ZK44', 'ZP44', 'EP44'))  
							and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Черновик','Проект', 'На согласовании', 'На доработке','Согласована', 'Включена в проект плана-графика', 'Неактуальная','Отказ от размещения'))
							and doc_RegCard/rc_Index/integer_Планируемый_год_размещения = '{currentDocField=|Document|Отчетный_год}'
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}']" 
				tag="Сумма_по_ППГ_2.6" />		
				
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' 
							and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Черновик', 'На согласовании', 'На доработке', 'Неактуальный', 'Отправлено в ЕИС', 'Согласован')) 
							and (doc_RegCard/rc_Index/date_Дата_заключения &lt;= '{currentDocField=|Document|Отчетный_год}-01-01T00:00:00Z')  
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}' 
							and not(xn-in(doc_RegCard/rc_Index/text_Способ_определения_поставщика_код, 'OK44', 'EA44', 'OKD44', 'OKU44', 'PO44', 'ZK44', 'ZP44', 'EP44'))  
							and doc_RegCard/rc_Index/integer_Год_финансирования_бюджета = '{currentDocField=|Document|Отчетный_год}']" 
				tag="Сумма_по_Контрактам_2.6" />	
		<!-- Объем_СМП_состоявшиеся -->	
		
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика'
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}'
							and doc_Id = document[doc_Links/doc_Link/link_Document={Заявки на размещение закупки}/doc_Id]]" 
				tag="ППГ_связанные_с_заявками" />
		
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' 
							and xn-in(doc_RegCard/rc_Index/text_Статус, 'Исполнение', 'Исполнение завершено') 
							and (doc_RegCard/rc_Index/date_Дата_заключения &gt;= '{currentDocField=|Document|Отчетный_год}-01-01T00:00:00Z') 
							and (doc_RegCard/rc_Index/date_Дата_заключения &lt;= '{currentDocField=|Document|Отчетный_год}-12-31T23:59:59Z')
							and doc_Id = document[doc_Links/doc_Link/link_Document={ППГ_связанные_с_заявками}/doc_Id] ]" 
				tag="Объем_СМП_состоявшиеся" />
		<!-- Объем_СМП_субподрядчики -->			
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки на размещение закупки' 
							  and doc_RegCard/rc_Index/text_Код_требования='TS44530']"
				tag="Заявки на размещение закупки TS44530" />
				
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика'
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}'
							and doc_Id = document[doc_Links/doc_Link/link_Document={Заявки на размещение закупки TS44530}/doc_Id]]" 
				tag="ППГ_связанные_с_заявками_TS44530" />
		
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' 
							and xn-in(doc_RegCard/rc_Index/text_Статус, 'Исполнение', 'Исполнение завершено') 
							and (doc_RegCard/rc_Index/date_Дата_заключения &gt;= '{currentDocField=|Document|Отчетный_год}-01-01T00:00:00Z') 
							and (doc_RegCard/rc_Index/date_Дата_заключения &lt;= '{currentDocField=|Document|Отчетный_год}-12-31T23:59:59Z')
							and doc_RegCard/rc_Index/money_Объем_в_рублевом_эквиваленте &gt; 0
							and doc_Id = document[doc_Links/doc_Link/link_Document={ППГ_связанные_с_заявками_TS44530}/doc_Id] ]" 
				tag="Объем_СМП_субподрядчики" />

      </Select>
      <!--<Actions>
        <Sum sourceFlow="Позиции плана-графика" targetFlow="{current}" sourceField="|Document|НМЦК" targetField="|Document|НМЦК_СМП_несостоявшиеся" />
      </Actions>-->
      <Actions>
	   <ConditionalAction>
        <Conditions>
          <And>
             <WhenFieldsEquals tag="{current}" path="|Document|Тип_отчета" value="Отчет об объеме закупок у субъектов малого предпринимательства, социально ориентированных некоммерческих организаций"/>
          </And>
        </Conditions>
        <Actions>
		 <!-- НМЦК_СМП_несостоявшиеся -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|НМЦК_СМП_несостоявшиеся"> 
				<Variables>
					<Variable name="ПозицииПланаГрафика" source="Позиции плана-графика" path="|Document|НМЦК" aggregation="sum" />
			</Variables>
				<Expression value="($NullToZero({ПозицииПланаГрафика}))/1000 "/>
			</CalculateExpression>
		
	
        </Actions>
      </ConditionalAction>
 
	  
	<!--   1) Для полей вкладки Информация о заключенных контракта, если Рассчитать_объемы_автоматически=1, то автоматически рассчитать пункты: 1, 2.4, 2.6, 5, 6, 9. -->
      <ConditionalAction>
        <Conditions>
          <And>
             <WhenFieldsEquals tag="{current}" path="|Document|Тип_отчета" value="Отчет об объеме закупок у субъектов малого предпринимательства, социально ориентированных некоммерческих организаций"/>
			 <WhenFieldsEquals tag="{current}" path="|Document|Заполнить_автоматически" value="1"/>
          </And>
        </Conditions>
        <Actions>
	  
		<!--СГОЗ-->
			<CalculateExpression targetFlow="{current}" targetField="|Document|СГОЗ"> 
				<Variables>
					<Variable name="СуммапоППГ" source="Сумма_по_ППГ" path="|Document|Сумма_текущий_год" aggregation="sum" />
					<Variable name="СуммапоКонтрактам" source="Сумма_по_Контрактам" path="|Document|Источники_финансирования" isTable="true" tableColumn="Сумма_по_контракту" rowFilter="{fieldTarget=|Document|Отчетный_год}=={Год_финансирования_бюджета}" aggregation="sum"/>							
			</Variables>
				<Expression value="($NullToZero({СуммапоППГ})+ $NullToZero({СуммапоКонтрактам}))/1000 "/>
			</CalculateExpression>
			
		<!-- Объем_СМП_обеспечения_контрактов_ст93_ч1 -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|Объем_СМП_обеспечения_контрактов_ст93_ч1"> 
				<Variables>
					<Variable name="СуммапоППГ" source="Сумма_по_ППГ_2.4" path="|Document|НМЦК" aggregation="sum" />
					<Variable name="СуммапоКонтрактам" source="Сумма_по_Контрактам_2.4" path="|Document|Источники_финансирования" isTable="true" tableColumn="Сумма_по_контракту" rowFilter="{fieldTarget=|Document|Отчетный_год}=={Год_финансирования_бюджета}" aggregation="sum"/>							
			</Variables>
				<Expression value="($NullToZero({СуммапоППГ})+ $NullToZero({СуммапоКонтрактам}))/1000 "/>
			</CalculateExpression>
		<!-- Объем_СМП_обеспечения_контрактов_закрытых_способов -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|Объем_СМП_обеспечения_контрактов_закрытых_способов"> 
				<Variables>
					<Variable name="СуммапоППГ" source="Сумма_по_ППГ_2.6" path="|Document|НМЦК" aggregation="sum" />
					<Variable name="СуммапоКонтрактам" source="Сумма_по_Контрактам_2.6" path="|Document|Источники_финансирования" isTable="true" tableColumn="Сумма_по_контракту" rowFilter="{fieldTarget=|Document|Отчетный_год}=={Год_финансирования_бюджета}" aggregation="sum"/>							
			</Variables>
				<Expression value="($NullToZero({СуммапоППГ})+ $NullToZero({СуммапоКонтрактам}))/1000 "/>
			</CalculateExpression>	

		<!-- Объем_СМП_состоявшиеся -->	
			<CalculateExpression targetFlow="{current}" targetField="|Document|Объем_СМП_состоявшиеся"> 
				<Variables>
					<Variable name="ОбъемСМПсостоявшиеся" source="Объем_СМП_состоявшиеся" path="|Document|Цена_контракта" aggregation="sum" />
			</Variables>
				<Expression value="($NullToZero({ОбъемСМПсостоявшиеся}))/1000 "/>
			</CalculateExpression>	
		
		<!-- Объем_СМП_субподрядчики -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|Объем_СМП_субподрядчики"> 
				<Variables>
					<Variable name="ОбъемСМПсубподрядчики" source="Объем_СМП_субподрядчики" path="|Document|Цена_контракта" aggregation="sum" />
			</Variables>
				<Expression value="($NullToZero({ОбъемСМПсубподрядчики}))/1000 "/>
			</CalculateExpression>	

		<!-- Объем_СМП_обеспечения_контрактов_ст30_ч1 -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|Объем_СМП_обеспечения_контрактов_ст30_ч1"> 
				<Variables>
						<Variable name="Обороны" source="{current}" path="|Document|Объем_СМП_обеспечения_контрактов_обороны"  />
						<Variable name="Кредитов" source="{current}" path="|Document|Объем_СМП_обеспечения_контрактов_кредитов"  />
						<Variable name="Ст93Ч1" source="{current}" path="|Document|Объем_СМП_обеспечения_контрактов_ст93_ч1"  />
						<Variable name="Энергии" source="{current}" path="|Document|Объем_СМП_обеспечения_контрактов_энергии"  />
						<Variable name="ЗакрытыхСпособов" source="{current}" path="|Document|Объем_СМП_обеспечения_контрактов_закрытых_способов"  />										
				</Variables>
				<Expression value="($NullToZero({Обороны}))+ ($NullToZero({Кредитов}))+ ($NullToZero({Ст93Ч1}))+ ($NullToZero({Энергии}))+ ($NullToZero({ЗакрытыхСпособов})) "/>
			</CalculateExpression>				

		<!-- СГОЗ_СМП -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|СГОЗ_СМП"> 
				<Variables>
						<Variable name="СГОЗ" source="{current}" path="|Document|СГОЗ"  />
						<Variable name="Объем_СМП_обеспечения_контрактов_ст30_ч1" source="{current}" path="|Document|Объем_СМП_обеспечения_контрактов_ст30_ч1"  />
				</Variables>
				<Expression value="($NullToZero({СГОЗ})) - ($NullToZero({Объем_СМП_обеспечения_контрактов_ст30_ч1}))"/>
			</CalculateExpression>	

		<!-- СГОЗ_СМП_обяз -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|СГОЗ_СМП_обяз"> 
				<Variables>
						<Variable name="СГОЗ_СМП" source="{current}" path="|Document|СГОЗ_СМП"  />
				</Variables>
				<Expression value="($NullToZero({СГОЗ_СМП})) * 0.15"/>
			</CalculateExpression>	
			
		<!-- Объем_СМП -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|Объем_СМП"> 
				<Variables>
						<Variable name="Объем_СМП_состоявшиеся" source="{current}" path="|Document|Объем_СМП_состоявшиеся"  />
						<Variable name="Объем_СМП_субподрядчики" source="{current}" path="|Document|Объем_СМП_субподрядчики"  />						
				</Variables>
				<Expression value="($NullToZero({Объем_СМП_состоявшиеся})) + ($NullToZero({Объем_СМП_субподрядчики}))"/>
			</CalculateExpression>		
			
		<!-- Объем_СМП_процент -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|Объем_СМП_процент"> 
				<Variables>
						<Variable name="Объем_СМП" source="{current}" path="|Document|Объем_СМП"  />
						<Variable name="СГОЗ_СМП" source="{current}" path="|Document|СГОЗ_СМП"  />						
				</Variables>
				<Expression value="($NullToZero({Объем_СМП})) / ($NullToZero({СГОЗ_СМП})) * 100"/>
			</CalculateExpression>	
			
        </Actions>
      </ConditionalAction>
      </Actions>
    </ConditionalActions>
		</OnDocumentCreated>
		
				<OnRegcardEdited transaction="single" >
             <ConditionalActions>
      <Select>
		<!-- НМЦК_СМП_несостоявшиеся -->
        <Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки на размещение закупки' 
							  and doc_RegCard/rc_Index/text_Код_ограничения='MB44330']"
				tag="Заявки на размещение закупки" />
        <Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика'
							and doc_RegCard/rc_Index/integer_Планируемый_год_размещения='{currentDocField=|Document|Отчетный_год}'
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}'
							and xn-in(doc_RegCard/rc_Index/text_Способ_определения_поставщика_код, 'OK44', 'EA44', 'OKD44', 'OKU44', 'PO44', 'ZK44', 'ZP44') 
							and ((xn-in(doc_RegCard/rc_Index/text_Статус,'Закупка не состоялась (одна заявка)', 'Закупка не состоялась (отказ комиссии)', 'Отказ от заключения контракта')) 
							or (xn-in(doc_RegCard/rc_Index/text_Статус,'Заключение контракта','Согласование контракта','Контракт согласован','Исполнение контракта', 'Контракт исполнен') 
							and (doc_RegCard/rc_Index/longtext_Документы_основание_ед_поставщик_пункт='Часть 1 пункт 25 статьи 93')) )
							and doc_Id = document[doc_Links/doc_Link/link_Document={Заявки на размещение закупки}/doc_Id]]" 
				tag="Позиции плана-графика" />
	    <!--СГОЗ-->  
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика' 
							and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Черновик', 'На согласовании', 'На доработке', 'Включена в проект плана-графика', 'Отказ от размещения', 'Отправлено в ЕИС')) 
							and doc_RegCard/rc_Index/integer_Планируемый_год_размещения = '{currentDocField=|Document|Отчетный_год}' 
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}']" 
				tag="Сумма_по_ППГ" />	

		<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' 
							and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Черновик', 'На согласовании', 'На доработке', 'Неактуальный', 'Отправлено в ЕИС', 'Согласован')) 
							and (doc_RegCard/rc_Index/date_Дата_заключения &lt;= '{currentDocField=|Document|Отчетный_год}-01-01T00:00:00Z') 
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}' 
							and doc_RegCard/rc_Index/integer_Год_финансирования_бюджета = '{currentDocField=|Document|Отчетный_год}']" 
				tag="Сумма_по_Контрактам" />
		<!-- Объем_СМП_обеспечения_контрактов_ст93_ч1 -->		
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика'   
							and xn-in(doc_RegCard/rc_Index/text_Способ_определения_поставщика_код, 'OK44', 'EA44', 'OKD44', 'OKU44', 'PO44', 'ZK44', 'ZP44', 'EP44')  
							and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Черновик','Проект', 'На согласовании', 'На доработке','Согласована', 'Включена в проект плана-графика', 'Неактуальная','Отказ от размещения')) 
							and doc_RegCard/rc_Index/integer_Планируемый_год_размещения = '{currentDocField=|Document|Отчетный_год}' 
							and doc_RegCard/rc_Index/longtext_Документы_основание_ед_поставщик_пункт != '' 
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}']" 
				tag="Сумма_по_ППГ_2.4" />	
		
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' 
							and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Черновик', 'На согласовании', 'На доработке', 'Неактуальный', 'Отправлено в ЕИС', 'Согласован')) 
							and (doc_RegCard/rc_Index/date_Дата_заключения &lt;= '{currentDocField=|Document|Отчетный_год}-01-01T00:00:00Z')  
							and doc_RegCard/rc_Index/longtext_Документы_основание_ед_поставщик_пункт != '' 
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}' 
							and xn-in(doc_RegCard/rc_Index/text_Способ_определения_поставщика_код, 'OK44', 'EA44', 'OKD44', 'OKU44', 'PO44', 'ZK44', 'ZP44', 'EP44')  
							and doc_RegCard/rc_Index/integer_Год_финансирования_бюджета = '{currentDocField=|Document|Отчетный_год}']" 
				tag="Сумма_по_Контрактам_2.4" />	
		
		<!-- Объем_СМП_обеспечения_контрактов_закрытых_способов -->	
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика'   
							and not(xn-in(doc_RegCard/rc_Index/text_Способ_определения_поставщика_код, 'OK44', 'EA44', 'OKD44', 'OKU44', 'PO44', 'ZK44', 'ZP44', 'EP44'))  
							and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Черновик','Проект', 'На согласовании', 'На доработке','Согласована', 'Включена в проект плана-графика', 'Неактуальная','Отказ от размещения'))
							and doc_RegCard/rc_Index/integer_Планируемый_год_размещения = '{currentDocField=|Document|Отчетный_год}'
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}']" 
				tag="Сумма_по_ППГ_2.6" />		
				
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' 
							and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Черновик', 'На согласовании', 'На доработке', 'Неактуальный', 'Отправлено в ЕИС', 'Согласован')) 
							and (doc_RegCard/rc_Index/date_Дата_заключения &lt;= '{currentDocField=|Document|Отчетный_год}-01-01T00:00:00Z')  
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}' 
							and not(xn-in(doc_RegCard/rc_Index/text_Способ_определения_поставщика_код, 'OK44', 'EA44', 'OKD44', 'OKU44', 'PO44', 'ZK44', 'ZP44', 'EP44'))  
							and doc_RegCard/rc_Index/integer_Год_финансирования_бюджета = '{currentDocField=|Document|Отчетный_год}']" 
				tag="Сумма_по_Контрактам_2.6" />	
		<!-- Объем_СМП_состоявшиеся -->	
		
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика'
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}'
							and doc_Id = document[doc_Links/doc_Link/link_Document={Заявки на размещение закупки}/doc_Id]]" 
				tag="ППГ_связанные_с_заявками" />
		
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' 
							and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Исполнение контракта', 'Контракт исполнен')) 
							and (doc_RegCard/rc_Index/date_Дата_заключения &gt;= '{currentDocField=|Document|Отчетный_год}-01-01T00:00:00Z') 
							and (doc_RegCard/rc_Index/date_Дата_заключения &lt;= '{currentDocField=|Document|Отчетный_год}-12-31T23:59:59Z')
							and doc_Id = document[doc_Links/doc_Link/link_Document={ППГ_связанные_с_заявками}/doc_Id] ]" 
				tag="Объем_СМП_состоявшиеся" />
		<!-- Объем_СМП_субподрядчики -->			
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявки на размещение закупки' 
							  and doc_RegCard/rc_Index/text_Код_ограничения='TS44530']"
				tag="Заявки на размещение закупки TS44530" />
				
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана-графика'
							and doc_RegCard/rc_Index/integer_Организация_заказчик='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}'
							and doc_Id = document[doc_Links/doc_Link/link_Document={Заявки на размещение закупки TS44530}/doc_Id]]" 
				tag="ППГ_связанные_с_заявками_TS44530" />
		
		<Select searchString="document[doc_RegCard/rc_FlowName = 'Контракты' 
							and not(xn-in(doc_RegCard/rc_Index/text_Статус, 'Исполнение контракта', 'Контракт исполнен')) 
							and (doc_RegCard/rc_Index/date_Дата_заключения &gt;= '{currentDocField=|Document|Отчетный_год}-01-01T00:00:00Z') 
							and (doc_RegCard/rc_Index/date_Дата_заключения &lt;= '{currentDocField=|Document|Отчетный_год}-12-31T23:59:59Z')
							and doc_RegCard/rc_Index/money_Объем_в_рублевом_эквиваленте &gt; 0
							and doc_Id = document[doc_Links/doc_Link/link_Document={ППГ_связанные_с_заявками_TS44530}/doc_Id] ]" 
				tag="Объем_СМП_субподрядчики" />

      </Select>
      <!--<Actions>
        <Sum sourceFlow="Позиции плана-графика" targetFlow="{current}" sourceField="|Document|НМЦК" targetField="|Document|НМЦК_СМП_несостоявшиеся" />
      </Actions>-->
      <Actions>
	  
	<!--   1) Для полей вкладки Информация о заключенных контракта, если Рассчитать_объемы_автоматически=1, то автоматически рассчитать пункты: 1, 2.4, 2.6, 5, 6, 9. -->
      <ConditionalAction>
        <Conditions>
          <And>
             <WhenFieldsEquals tag="{current}" path="|Document|Тип_отчета" value="Отчет об объеме закупок у субъектов малого предпринимательства, социально ориентированных некоммерческих организаций"/>
			 <WhenFieldsEquals tag="{current}" path="|Document|Заполнить_автоматически" value="1"/>
          </And>
        </Conditions>
        <Actions>
	  
		<!--СГОЗ-->
			<CalculateExpression targetFlow="{current}" targetField="|Document|СГОЗ"> 
				<Variables>
					<Variable name="СуммапоППГ" source="Сумма_по_ППГ" path="|Document|Сумма_текущий_год" aggregation="sum" />
					<Variable name="СуммапоКонтрактам" source="Сумма_по_Контрактам" path="|Document|Источники_финансирования" isTable="true" tableColumn="Сумма_по_контракту" rowFilter="{fieldTarget=|Document|Отчетный_год}=={Год_финансирования_бюджета}" aggregation="sum"/>							
			</Variables>
				<Expression value="($NullToZero({СуммапоППГ})+ $NullToZero({СуммапоКонтрактам}))/1000 "/>
			</CalculateExpression>
			
		<!-- Объем_СМП_обеспечения_контрактов_ст93_ч1 -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|Объем_СМП_обеспечения_контрактов_ст93_ч1"> 
				<Variables>
					<Variable name="СуммапоППГ" source="Сумма_по_ППГ_2.4" path="|Document|НМЦК" aggregation="sum" />
					<Variable name="СуммапоКонтрактам" source="Сумма_по_Контрактам_2.4" path="|Document|Источники_финансирования" isTable="true" tableColumn="Сумма_по_контракту" rowFilter="{fieldTarget=|Document|Отчетный_год}=={Год_финансирования_бюджета}" aggregation="sum"/>							
			</Variables>
				<Expression value="($NullToZero({СуммапоППГ})+ $NullToZero({СуммапоКонтрактам}))/1000 "/>
			</CalculateExpression>
		<!-- Объем_СМП_обеспечения_контрактов_закрытых_способов -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|Объем_СМП_обеспечения_контрактов_закрытых_способов"> 
				<Variables>
					<Variable name="СуммапоППГ" source="Сумма_по_ППГ_2.6" path="|Document|НМЦК" aggregation="sum" />
					<Variable name="СуммапоКонтрактам" source="Сумма_по_Контрактам_2.6" path="|Document|Источники_финансирования" isTable="true" tableColumn="Сумма_по_контракту" rowFilter="{fieldTarget=|Document|Отчетный_год}=={Год_финансирования_бюджета}" aggregation="sum"/>							
			</Variables>
				<Expression value="($NullToZero({СуммапоППГ})+ $NullToZero({СуммапоКонтрактам}))/1000 "/>
			</CalculateExpression>	

		<!-- Объем_СМП_состоявшиеся -->	
			<CalculateExpression targetFlow="{current}" targetField="|Document|Объем_СМП_состоявшиеся"> 
				<Variables>
					<Variable name="ОбъемСМПсостоявшиеся" source="Объем_СМП_состоявшиеся" path="|Document|Цена_контракта" aggregation="sum" />
			</Variables>
				<Expression value="($NullToZero({ОбъемСМПсостоявшиеся}))/1000 "/>
			</CalculateExpression>	
		
		<!-- Объем_СМП_субподрядчики -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|Объем_СМП_субподрядчики"> 
				<Variables>
					<Variable name="ОбъемСМПсубподрядчики" source="Объем_СМП_субподрядчики" path="|Document|Цена_контракта" aggregation="sum" />
			</Variables>
				<Expression value="($NullToZero({ОбъемСМПсубподрядчики}))/1000 "/>
			</CalculateExpression>	

		<!-- Объем_СМП_обеспечения_контрактов_ст30_ч1 -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|Объем_СМП_обеспечения_контрактов_ст30_ч1"> 
				<Variables>
						<Variable name="Обороны" source="{current}" path="|Document|Объем_СМП_обеспечения_контрактов_обороны"  />
						<Variable name="Кредитов" source="{current}" path="|Document|Объем_СМП_обеспечения_контрактов_кредитов"  />
						<Variable name="Ст93Ч1" source="{current}" path="|Document|Объем_СМП_обеспечения_контрактов_ст93_ч1"  />
						<Variable name="Энергии" source="{current}" path="|Document|Объем_СМП_обеспечения_контрактов_энергии"  />
						<Variable name="ЗакрытыхСпособов" source="{current}" path="|Document|Объем_СМП_обеспечения_контрактов_закрытых_способов"  />										
				</Variables>
				<Expression value="($NullToZero({Обороны}))+ ($NullToZero({Кредитов}))+ ($NullToZero({Ст93Ч1}))+ ($NullToZero({Энергии}))+ ($NullToZero({ЗакрытыхСпособов})) "/>
			</CalculateExpression>				

		<!-- СГОЗ_СМП -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|СГОЗ_СМП"> 
				<Variables>
						<Variable name="СГОЗ" source="{current}" path="|Document|СГОЗ"  />
						<Variable name="Объем_СМП_обеспечения_контрактов_ст30_ч1" source="{current}" path="|Document|Объем_СМП_обеспечения_контрактов_ст30_ч1"  />
				</Variables>
				<Expression value="($NullToZero({СГОЗ})) - ($NullToZero({Объем_СМП_обеспечения_контрактов_ст30_ч1}))"/>
			</CalculateExpression>	

		<!-- СГОЗ_СМП_обяз -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|СГОЗ_СМП_обяз"> 
				<Variables>
						<Variable name="СГОЗ_СМП" source="{current}" path="|Document|СГОЗ_СМП"  />
				</Variables>
				<Expression value="($NullToZero({СГОЗ_СМП})) * 0.15"/>
			</CalculateExpression>	
			
		<!-- Объем_СМП -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|Объем_СМП"> 
				<Variables>
						<Variable name="Объем_СМП_состоявшиеся" source="{current}" path="|Document|Объем_СМП_состоявшиеся"  />
						<Variable name="Объем_СМП_субподрядчики" source="{current}" path="|Document|Объем_СМП_субподрядчики"  />						
				</Variables>
				<Expression value="($NullToZero({Объем_СМП_состоявшиеся})) + ($NullToZero({Объем_СМП_субподрядчики}))"/>
			</CalculateExpression>		
			
		<!-- Объем_СМП_процент -->
			<CalculateExpression targetFlow="{current}" targetField="|Document|Объем_СМП_процент"> 
				<Variables>
						<Variable name="Объем_СМП" source="{current}" path="|Document|Объем_СМП"  />
						<Variable name="СГОЗ_СМП" source="{current}" path="|Document|СГОЗ_СМП"  />						
				</Variables>
				<Expression value="($NullToZero({Объем_СМП})) / ($NullToZero({СГОЗ_СМП})) * 100"/>
			</CalculateExpression>	
			
	
        </Actions>
      </ConditionalAction>
      </Actions>
    </ConditionalActions>
		</OnRegcardEdited>
	
	
	</Flow>
	
	<Flow name="Позиции КТРУ">
		<LinksModify>
			<LinkCurrentDoc />
		</LinksModify>	
		<FieldsModify  source="КТРУ">
			<CopyField src="%key%" dst="|Document|ИД_КТРУ" />
			<CopyField src="|Document|КТРУ" />
			<CopyField src="|Document|Наименование_позиции_КТРУ" />   
			<CopyField src="|Document|ОКПД2" /> 
			<CopyField src="|Document|ОКПД2_наименование" />
			<CopyField src="|Document|Описание_позиции" />      			
		</FieldsModify>
		<OnDocumentCreated transaction="single" >
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = {currentDocField=|Document|ИД_КТРУ}]" tag="КТРУ" />
				</Select>
				<Actions>		
					<TableConsolidation>
						<SourceTable flow="КТРУ" tableName="|Document|Характеристики_ПКТРУ">
							<Column name="Код_характеристики_ПКТРУ"/>
							<Column name="Наименование_характеристики_ПКТРУ" />
							<Column name="Тип_характеристики_ПКТРУ" />
							<Column name="Тип_характеристики_ПКТРУ_код" />
							<Column name="Вид_характеристики_ПКТРУ" />
							<Column name="Вид_характеристики_ПКТРУ_код" />
							<SubSourceTable name="Допустимые_значения_характеристики">
								<Column name="Единица_характеристики_количественной_КТРУ"/>
								<Column name="Тип_набора_значений"/>
								<Column name="Конкретное_значение"/>
								<Column name="Минимальное_значение_диапазона"/>
								<Column name="Обозначение_отношения_минимума"/>
								<Column name="Максимальное_значение_диапазона"/>
								<Column name="Обозначение_отношения_максимума"/>
								<Column name="Описание_качественной_характеристики_КТРУ"/>
							</SubSourceTable>
						</SourceTable>
						<TargetTable flow="{current}" tableName="|Document|Характеристики_ПКТРУ">
							<Column name="Код_характеристики_ПКТРУ" findExisting="true"/>
							<Column name="Наименование_характеристики_ПКТРУ" />
							<Column name="Тип_характеристики_ПКТРУ" />
							<Column name="Тип_характеристики_ПКТРУ_код" />
							<Column name="Вид_характеристики_ПКТРУ" />
							<Column name="Вид_характеристики_ПКТРУ_код" />
							<SubTargetTable name="Допустимые_значения_характеристики">
								<Column name="Единица_характеристики_количественной_КТРУ"/>
								<Column name="Тип_набора_значений"/>
								<Column name="Конкретное_значение"/>
								<Column name="Минимальное_значение_диапазона"/>
								<Column name="Обозначение_отношения_минимума"/>
								<Column name="Максимальное_значение_диапазона"/>
								<Column name="Обозначение_отношения_максимума"/>
								<Column name="Описание_качественной_характеристики_КТРУ"/>
							</SubTargetTable>
						</TargetTable>
					</TableConsolidation> 
				</Actions>
			</Aggregation>		
		</OnDocumentCreated>
	</Flow>
	<Flow name="Нормирование цен">
		<OnDocumentCreated transaction="single" >
			<Aggregation>
				<Select>					
					<Select searchString="document[doc_Id != {current_Id} and doc_RegCard/rc_FlowName = 'Нормирование цен' and doc_RegCard/rc_Index/text_КТРУ = '{currentDocField=|Document|КТРУ}' and doc_RegCard/rc_Index/text_Организация_заказчик_наименование='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}']" tag="НСИ" />
					<Select searchString="document[doc_Id != {current_Id} and doc_RegCard/rc_FlowName = 'Нормирование цен' and doc_RegCard/rc_Index/text_КТРУ = '{currentDocField=|Document|КТРУ}' and doc_RegCard/rc_Index/text_Организация_заказчик_Код_в_ЕИС='22901186555290101001']" tag="КОНТРАКТНОЕ_АГЕНТСТВО" />					
				</Select>
				<Actions>  
				<DocsCountCheck sourceTag="НСИ" operation="notEmpty" message="Для КТРУ {|Document|КТРУ} по организации: {|Document|Организация_заказчик|Организация_заказчик_наименование} цена нормирования уже определена." /> 
				<TableFieldOperations sourceTag="КОНТРАКТНОЕ_АГЕНТСТВО" targetTag="{current}" targetTable="|Document|Нормирование_для_подведомственных" checkFormula="$NullToZero({Средняя_цена_нормирования}) &gt; $NullToZero({field=|Document|Средняя_цена_за_единицу})" 
					checkMessage="Цена за единицу не должна превышать цену КОНТРАКТНОГО АГЕНТСТВА АРХАНГЕЛЬСКОЙ ОБЛАСТИ">
				</TableFieldOperations>					
				</Actions>			
			</Aggregation>
		</OnDocumentCreated>
		<OnRegcardEdited transaction="single">
			<Aggregation>
				<Select>					
					<Select searchString="document[doc_Id != {current_Id} and doc_RegCard/rc_FlowName = 'Нормирование цен' and doc_RegCard/rc_Index/text_КТРУ = '{currentDocField=|Document|КТРУ}' and doc_RegCard/rc_Index/text_Организация_заказчик_наименование='{currentDocField=|Document|Организация_заказчик|Организация_заказчик}']" tag="НСИ" />
					<Select searchString="document[doc_Id != {current_Id} and doc_RegCard/rc_FlowName = 'Нормирование цен' and doc_RegCard/rc_Index/text_КТРУ = '{currentDocField=|Document|КТРУ}' and doc_RegCard/rc_Index/text_Организация_заказчик_Код_в_ЕИС='22901186555290101001']" tag="КОНТРАКТНОЕ_АГЕНТСТВО" />					
				</Select>
				<Actions>  
				<DocsCountCheck sourceTag="НСИ" operation="notEmpty" message="Для КТРУ {|Document|КТРУ} по организации: {|Document|Организация_заказчик|Организация_заказчик_наименование} цена нормирования уже определена." /> 
				<TableFieldOperations sourceTag="КОНТРАКТНОЕ_АГЕНТСТВО" targetTag="{current}" targetTable="|Document|Нормирование_для_подведомственных" checkFormula="$NullToZero({Средняя_цена_нормирования}) &gt; $NullToZero({field=|Document|Средняя_цена_за_единицу})" 
					checkMessage="Цена за единицу не должна превышать цену КОНТРАКТНОГО АГЕНТСТВА АРХАНГЕЛЬСКОЙ ОБЛАСТИ">
				</TableFieldOperations>						
				</Actions>			
			</Aggregation>
		</OnRegcardEdited>
	</Flow>	
	<!--223ФЗ-->
	
<Flow name="Позиции плана закупок 223ФЗ">
	<LinksModify>
			<LinkCurrentDoc />
		</LinksModify>
		<FieldsModify>
			<SetField dst="|Document|Имя_потока" value="Позиции плана закупок 223ФЗ" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик" />
		</FieldsModify>
		<OnDocumentCreated transaction="single">
			<ConditionalActions>
				<Select />
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldEquals path="|Document|ИД_в_ЕИС" value="" />
							</And>
						</Conditions>
						<Actions>
							<SetFieldGuid targetFlow="{current}" targetField="|Document|ИД_в_ЕИС" />
						</Actions>
					</ConditionalAction>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldEquals path="|Document|ИД_позиции_плана" value="" />
							</And>
						</Conditions>
						<Actions>
							<SetFieldGuid targetFlow="{current}" targetField="|Document|ИД_позиции_плана" />
						</Actions>
					</ConditionalAction>				
				</Actions>
			</ConditionalActions>
			<Aggregation>
				<Select>
																																																																	
				</Select>
				<Actions>
																												
																																				
					<TableFieldOperations sourceTag="{current}" targetTag="{current}" targetTable="|Document|Позиции" targetRowFilter="{ИД_позиции_лота}=null" >
						<Action column="ИД_позиции_лота" formula="Guid.NewGuid()"/>
					</TableFieldOperations> 
				</Actions>
			</Aggregation>
			<NamedConstants>
				<CommonConditions>
				  <Condition path="|Document|Число_регномера" operation="neq" value="" />
				</CommonConditions>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Регистрационный_номер"/>
					<Setting key="CounterNameFormat" value="({|Document|Имя_потока}/{|Document|Организация_заказчик|Организация_заказчик})"/>
				</Constant>
			</NamedConstants>
		</OnDocumentCreated>
		
	</Flow>
	

	<Flow name="Заявка на размещение закупки 223ФЗ">
		<FieldsModify>
			<SetField dst="|Document|Имя_потока" value="Заявка на размещение закупки 223ФЗ" />
			<SumField src="|Document|НМЦ_с_НДС" />
			<CopyField src="|Document|Валюта" />
			<CopyField src="|Document|Цифровой_код_валюты" />
			<CopyField src="|Document|Код_валюты" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование" dst= "|Document|Контактное_лицо|Контактное_лицо_организация_наименование"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик" dst="|Document|Контактное_лицо|Контактное_лицо_организация" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ИНН" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_КПП" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОГРН" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_ИНН" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_КПП" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_ОГРН" />
			<CopyField src="|Document|Способ_закупки" />
			<CopyField src="|Document|Способ_закупки_код" />
			<CopyField src="|Document|Закупка_в_электронной_форме" />
			<CopyField src="|Document|Год_закупки" />
			<CopyField src="|Document|Номер_плана_в_ЕИС" />
			<CopyField src="|Document|Номер_позиции_плана" />
			<CopyField src="|Document|Номер_закупки" />
			<CopyField src="|Document|Участник_закупки_СМП" />
			<CopyField src="|Document|Закупка_не_учитывается" />
			<CopyField src="|Document|Субподрядчики_из_СМП" />
			<CopyField src="|Document|Категория_закупки" />
			<CopyField src="|Document|Категория_закупки_код" />
			<CopyField src="|Document|Фактическая_дата_размещения" />
			<CopyField src="|Document|Предмет_договора" />
			<CopyField src="|Document|Порядок_формирования_цены_договора" />
			<CopyField src="|Document|Место_поставки" />
			<CopyField src="|Document|ОКАТО" />
			<CopyField src="|Document|Регион" />
			<CopyField src="|Document|Сведения_о_НМЦ" />
		</FieldsModify> 
	
		<LinksModify>
			<LinkCurrentDoc />
		</LinksModify>
		
			<OnDocumentCreated transaction="single">			
				<Aggregation>
				<Select>			
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок 223ФЗ" />				
				</Select>
				<Actions>  
					<SetField targetFlow="Позиции плана закупок 223ФЗ" targetField="|Document|Статус" value="Включена в заявку на размещение на закупку" />
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана закупок 223ФЗ" sourceField="|Document|Обеспечение_заявки" targetField="|Document|Обеспечение_заявки" />     
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана закупок 223ФЗ" sourceField="|Document|Обеспечение_исполнения_договора" targetField="|Document|Обеспечение_исполнения_договора" />
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана закупок 223ФЗ" sourceField="|Document|Обеспечение_возврата_аванса" targetField="|Document|Обеспечение_возврата_аванса" />
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана закупок 223ФЗ" sourceField="|Document|Предоставление_банковской_гарантии" targetField="|Document|Предоставление_банковской_гарантии" />
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана закупок 223ФЗ" sourceField="|Document|Размер_обеспечения_возврата_аванса" targetField="|Document|Размер_обеспечения_возврата_аванса" />
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана закупок 223ФЗ" sourceField="|Document|Предоставление_обеспечения_возврата_аванса" targetField="|Document|Предоставление_обеспечения_возврата_аванса" />
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана закупок 223ФЗ" sourceField="|Document|Критерии_оценки" targetField="|Document|Критерии_оценки" />
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана закупок 223ФЗ" sourceField="|Document|Преференции" targetField="|Document|Преференции" />
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана закупок 223ФЗ" sourceField="|Document|Дополнительные_сведения" targetField="|Document|Дополнительные_сведения" />
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана закупок 223ФЗ" sourceField="|Document|Размер_обеспечения_заявки" targetField="|Document|Размер_обеспечения_заявки" />
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана закупок 223ФЗ" sourceField="|Document|Размер_обеспечения_договора" targetField="|Document|Размер_обеспечения_договора" />
				</Actions>
			</Aggregation>
          <ConditionalActions>
				<Select />
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldEquals path="|Document|ИД_в_ЕИС" value="" />
							</And>
						</Conditions>
						<Actions>
							<SetFieldGuid targetFlow="{current}" targetField="|Document|ИД_в_ЕИС" />
						</Actions>
					</ConditionalAction>				
				</Actions>
			</ConditionalActions>			
			<NamedConstants>
				<CommonConditions>
				  <Condition path="|Document|Число_регномера" operation="neq" value="" />
				</CommonConditions>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Регистрационный_номер"/>
					<Setting key="CounterNameFormat" value="({|Document|Имя_потока}/{|Document|Организация_заказчик|Организация_заказчик})"/>
				</Constant>
			</NamedConstants>
		</OnDocumentCreated>
		<OnRegcardEdited>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Извещения о закупочной процедуре 223ФЗ' and doc_Links/doc_Link/link_Document='{current_Id}']" tag="Извещения о закупочной процедуре 223ФЗ">
						<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявка на размещение закупки 223ФЗ' and doc_Id = document[doc_Links/doc_Link/link_Document={Извещения о закупочной процедуре 223ФЗ}/doc_Id]]" tag="Заявка на размещение закупки 223ФЗ" />
					</Select>
				</Select>
				<Actions>
					<Sum sourceFlow="Заявка на размещение закупки 223ФЗ" targetFlow="Извещения о закупочной процедуре 223ФЗ" sourceField="|Document|НМЦ_с_НДС" targetField="|Document|НМЦ_с_НДС" />
					<Min sourceFlow="Заявка на размещение закупки 223ФЗ" targetFlow="Извещения о закупочной процедуре 223ФЗ" sourceField="|Document|Плановая_дата_размещения" targetField="|Document|Порядок_проведения_процедуры|Плановая_дата_размещения" />
			
					
				</Actions>
			</Aggregation>
		</OnRegcardEdited>
		<OnLinkAdded transaction="split">
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок 223ФЗ" />
				</Select>
				<Actions>
					<SetField targetFlow="Позиции плана закупок 223ФЗ" targetField="|Document|Статус" value="Включена в заявку на размещение на закупку" />	
					<Sum sourceFlow="Позиции плана закупок 223ФЗ" targetFlow="{current}" sourceField="|Document|НМЦ_с_НДС" targetField="|Document|НМЦ_с_НДС" />
				</Actions>
			</Aggregation>
		</OnLinkAdded>
		<OnLinkDeleted transaction="split">
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок 223ФЗ" />
				</Select>
				<Actions>
					<Sum sourceFlow="Позиции плана закупок 223ФЗ" targetFlow="{current}" sourceField="|Document|НМЦ_с_НДС" targetField="|Document|НМЦ_с_НДС" />
				</Actions>
			</Aggregation>
		</OnLinkDeleted>
		<OnDocumentDeleted>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Извещения о закупочной процедуре 223ФЗ' and doc_Links/doc_Link/link_Document='{current_Id}']" tag="Извещения о закупочной процедуре 223ФЗ">
						<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявка на размещение закупки 223ФЗ' and doc_Id = document[doc_Links/doc_Link/link_Document={Извещения о закупочной процедуре 223ФЗ}/doc_Id]]" tag="Заявка на размещение закупки 223ФЗ" />
					</Select>
				</Select>
				<Actions>
					<Sum sourceFlow="Заявка на размещение закупки 223ФЗ" targetFlow="Извещения о закупочной процедуре 223ФЗ" sourceField="|Document|НМЦ_с_НДС" targetField="|Document|НМЦ_с_НДС" />
					<Min sourceFlow="Заявка на размещение закупки 223ФЗ" targetFlow="Извещения о закупочной процедуре 223ФЗ" sourceField="|Document|Плановая_дата_размещения" targetField="|Document|Порядок_проведения_процедуры|Плановая_дата_размещения" />
					
				</Actions>
			</Aggregation>
		</OnDocumentDeleted>
		<OnRouteStarted>
			<ConditionalActions>
				<ConditionalAction>
					<Conditions>
						<Condition name="RouteKey" value="15" />
					</Conditions>				
				</ConditionalAction>
			</ConditionalActions>
		</OnRouteStarted>		
	</Flow> 
	
	
	<Flow name="Извещения о закупочной процедуре 223ФЗ">
		<FieldsModify>
			<SetField dst="|Document|Имя_потока" value="Извещения о закупочной процедуре 223ФЗ" />
			<SumField src="|Document|НМЦ_с_НДС" />
			<SumField src="|Document|НМЦ_без_НДС" />
			<MinField src="|Document|Плановая_дата_размещения" dst="|Document|Порядок_проведения_процедуры|Плановая_дата_размещения" />
			<CopyField src="|Document|Валюта" />
			<CopyField src="|Document|Цифровой_код_валюты" />
			<CopyField src="|Document|Код_валюты" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование" dst= "|Document|Контактное_лицо|Контактное_лицо_организация_наименование"/>
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик" dst="|Document|Контактное_лицо|Контактное_лицо_организация" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки" dst="|Document|Организатор_закупки|Организатор_закупки" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование" dst= "|Document|Организатор_закупки|Организатор_закупки_наименование"/>
			<CopyField src="|Document|Способ_закупки" />
			<CopyField src="|Document|Способ_закупки_код" />
			<CopyField src="|Document|Способ_закупки_положение" />
			<CopyField src="|Document|Вид_закупки" />
			<CopyField src="|Document|Предмет_договора" dst="|Document|Название_закупки" />
			<CopyField src="|Document|Закупка_в_электронной_форме" />
			<CopyField src="|Document|Количество_этапов" />
			<CopyField src="|Document|Квалификационный_отбор" />
			<CopyField src="|Document|Год_закупки" dst="|Document|Год_закупки"/>
			<CopyField src="|Document|Наименование_ЭТП" />
			<CopyField src="|Document|Адрес_ЭТП" />
			<CopyField src="|Document|ИД_ЭТП" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ИНН"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_КПП"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОГРН"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_ИНН"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_КПП"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_ОРГН"  />
			<CopyField src="|Document|Требуется_согласование_юриста"  />
			<CopyField src="|Document|Централизованная_закупка"  />
		</FieldsModify>
		<LinksModify>
			<LinkCurrentDoc />
			<LinkAllLinksWhereFlow name="Заявка на размещение закупки 223ФЗ" />
			<LinkAllLinksWhereFlow name="Позиции плана закупок 223ФЗ" />
		</LinksModify>
		<OnDocumentCreated transaction="split">
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="current" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявка на размещение закупки 223ФЗ' and doc_Links/doc_Link/link_Document='{current_Id}']" tag="Заявка на размещение закупки 223ФЗ">
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Извещения о закупочной процедуре' and doc_Id = document[doc_Links/doc_Link/link_Document={Заявка на размещение закупки 223ФЗ}/doc_Id]]" tag="Извещения о закупочной процедуре 223ФЗ" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and doc_Id = document[doc_Links/doc_Link/link_Document={Заявка на размещение закупки 223ФЗ}/doc_Id]]" tag="Позиции плана закупок 223ФЗ" />			  
					</Select>
				</Select>
				<Actions>
					<Number targetFlow="Заявка на размещение закупки 223ФЗ" targetField="|Document|Номер_лота_в_извещении" />
					<SetField targetFlow="Заявка на размещение закупки 223ФЗ" targetField="|Document|Статус" value="Подготовка извещения" />
					<SetFieldGuid targetFlow="current" targetField="|Document|ИД_в_ЕИС" />
					<CopyField sourceFlow="current" targetFlow="Заявка на размещение закупки 223ФЗ" sourceField="%key%" targetField="|Document|ИД_извещения" />
					<CopyField sourceFlow="current" targetFlow="Позиции плана закупок 223ФЗ" sourceField="%key%" targetField="|Document|ИД_извещения" />
					<CopyField sourceFlow="current" targetFlow="Заявка на размещение закупки 223ФЗ" sourceField="|Document|Валюта" targetField="|Document|Валюта" />
					<CopyField sourceFlow="current" targetFlow="Заявка на размещение закупки 223ФЗ" sourceField="|Document|Регистрационный_номер" targetField="|Document|Номер_извещения" />
					<CopyField sourceFlow="current" targetFlow="Позиции плана закупок 223ФЗ" sourceField="|Document|Порядок_проведения_процедуры|Дата_подведения_итогов" targetField="|Document|Дата_подведения_итогов" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организация_заказчик|Организация_заказчик_ИНН" targetField="|Document|Организация_заказчик|Организация_заказчик_ИНН" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организация_заказчик|Организация_заказчик_КПП" targetField="|Document|Организация_заказчик|Организация_заказчик_КПП" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организация_заказчик|Организация_заказчик_ОГРН" targetField="|Document|Организация_заказчик|Организация_заказчик_ОГРН" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организатор_закупки|Организатор_закупки_ИНН" targetField="|Document|Организатор_закупки|Организатор_закупки_ИНН" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организатор_закупки|Организатор_закупки_КПП" targetField="|Document|Организатор_закупки|Организатор_закупки_КПП" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организатор_закупки|Организатор_закупки_ОРГН" targetField="|Document|Организатор_закупки|Организатор_закупки_ОРГН" />
				</Actions>
			</Aggregation>
			<ConditionalActions>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявка на размещение закупки 223ФЗ' and doc_Links/doc_Link/link_Document='{current_Id}']" tag="Заявка на размещение закупки 223ФЗ"/>	  
				</Select>
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldEquals path="|Document|Централизованная_закупка" value="1" />
							</And>
						</Conditions>
						<Actions>
							<CopyField sourceFlow="Заявка на размещение закупки 223ФЗ" targetFlow="current" sourceField="|Document|Ответственный_руководитель|Ответственный_руководитель_ФИО" targetField="|Document|Согласующий|Согласующий_ФИО" />
						</Actions>
					</ConditionalAction>				
				</Actions>
			</ConditionalActions>
			<NamedConstants>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Регистрационный_номер"/>
					<Setting key="CounterNameFormat" value="({|Document|Имя_потока}/{|Document|Организация_заказчик|Организация_заказчик})"/>
				</Constant>	
			</NamedConstants>
		</OnDocumentCreated>
		<OnRegcardEdited transaction="single"> 
			<Aggregation>
			<Select>			
				<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок 223ФЗ" />	
				</Select>
				<Actions>
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организация_заказчик|Организация_заказчик_ИНН" targetField="|Document|Организация_заказчик|Организация_заказчик_ИНН" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организация_заказчик|Организация_заказчик_КПП" targetField="|Document|Организация_заказчик|Организация_заказчик_КПП" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организация_заказчик|Организация_заказчик_ОГРН" targetField="|Document|Организация_заказчик|Организация_заказчик_ОГРН" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организатор_закупки|Организатор_закупки_ИНН" targetField="|Document|Организатор_закупки|Организатор_закупки_ИНН" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организатор_закупки|Организатор_закупки_КПП" targetField="|Document|Организатор_закупки|Организатор_закупки_КПП" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организатор_закупки|Организатор_закупки_ОРГН" targetField="|Document|Организатор_закупки|Организатор_закупки_ОРГН" />
	</Actions>
			</Aggregation>
		</OnRegcardEdited>
		<OnLinkAdded>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="current" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявка на размещение закупки 223ФЗ' and doc_Links/doc_Link/link_Document='{current_Id}']" tag="Заявка на размещение закупки 223ФЗ" />
					<Select searchString="document[doc_Id = {Заявка на размещение закупки 223ФЗ}/doc_Id and not(doc_RegCard/rc_Index/integer_ИД_извещения)]" tag="Добавление_Связки_С_Лотом" />
				</Select>
				<Actions>
					<Sum sourceFlow="Заявка на размещение закупки 223ФЗ" targetFlow="current" sourceField="|Document|НМЦ_без_НДС" targetField="|Document|НМЦ_без_НДС" />
					<Sum sourceFlow="Заявка на размещение закупки 223ФЗ" targetFlow="current" sourceField="|Document|НМЦ_с_НДС" targetField="|Document|НМЦ_с_НДС" />
					<Min sourceFlow="Заявка на размещение закупки 223ФЗ" targetFlow="current" sourceField="|Document|Плановая_дата_размещения" targetField="|Document|Порядок_проведения_процедуры|Плановая_дата_размещения" />
					<CopyField sourceFlow="current" targetFlow="Добавление_Связки_С_Лотом" sourceField="%key%" targetField="|Document|ИД_извещения" />
					<CopyField sourceFlow="current" targetFlow="Добавление_Связки_С_Лотом" sourceField="|Document|Число_регномера" targetField="|Document|Номер_извещения" />
					<CopyField sourceFlow="current" targetFlow="Добавление_Связки_С_Лотом" sourceField="|Document|Статус" targetField="|Document|Статус" />
					<Count sourceFlow="Заявка на размещение закупки 223ФЗ" targetFlow="Добавление_Связки_С_Лотом" targetField="|Document|Номер_лота_в_извещении" />
				</Actions>
			</Aggregation>
		</OnLinkAdded>
		<OnLinkDeleted>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="current" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявка на размещение закупки 223ФЗ' and doc_Links/doc_Link/link_Document='{current_Id}']" tag="Заявка на размещение закупки 223ФЗ" />
				</Select>
				<Actions>
					<Sum sourceFlow="Заявка на размещение закупки 223ФЗ" targetFlow="current" sourceField="|Document|НМЦ_без_НДС" targetField="|Document|НМЦ_без_НДС" />
					<Sum sourceFlow="Заявка на размещение закупки 223ФЗ" targetFlow="current" sourceField="|Document|НМЦ_с_НДС" targetField="|Document|НМЦ_с_НДС" />
					<Min sourceFlow="Заявка на размещение закупки 223ФЗ" targetFlow="current" sourceField="|Document|Плановая_дата_размещения" targetField="|Document|Порядок_проведения_процедуры|Плановая_дата_размещения" />
					<Number targetFlow="Заявка на размещение закупки 223ФЗ" targetField="|Document|Номер_лота_в_извещении" />
				</Actions>
			</Aggregation>
		</OnLinkDeleted>
	</Flow>
	
	
	<Flow name="Заявки участников 223ФЗ">
	
		<FieldsModify>
			<SetField dst="|Document|Имя_потока" value="Заявки участников 223ФЗ" />
			<CopyField src="%key%" dst="|Document|ИД_лота" />
			<CopyField src="|Document|Регистрационный_номер" dst="|Document|Номер_лота" />
			<CopyField src="|Document|Валюта" />
			<CopyField src="|Document|Цифровой_код_валюты" />
			<CopyField src="|Document|Код_валюты" />
			<CopyField src="|Document|Наименование_лота" />
			<CopyField src="|Document|Номер_извещения_в_ЕИС" />
			<CopyField src="|Document|Номер_лота_в_извещении" />
			<CopyField src="|Document|Фактическая_дата_размещения" />
			<CopyField src="|Document|Способ_закупки" />
			<CopyField src="|Document|Способ_закупки_код" />
			<CopyField src="|Document|Способ_закупки_положение" />
			<CopyField src="|Document|Год_закупки" />
		</FieldsModify>
		<OnDocumentCreated>
			<NamedConstants>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Регистрационный_номер"/>
					<Setting key="CounterNameFormat" value="({|Document|Имя_потока}/{|Document|Организация_заказчик|Организация_заказчик})"/>
				</Constant>	
			</NamedConstants>
			<ConditionalActions>
				<Select>					
				    <Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and xn-in(doc_Id, {currentDocLinkList})]" tag="ППЗ_победитель" />					
				</Select>
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldEquals path="|Document|Результат_код" value="F"/>
							</And>
						</Conditions>
							<Actions>
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки" targetField="|Document|Победитель|Победитель" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_наименование" targetField="|Document|Победитель|Победитель_наименование" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_ИНН" targetField="|Document|Победитель|Победитель_ИНН"  />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_КПП" targetField="|Document|Победитель|Победитель_КПП"  />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_тип_код" targetField="|Document|Победитель|Победитель_тип_код"  />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_тип" targetField="|Document|Победитель|Победитель_тип" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_СМП" targetField="|Document|Победитель|Победитель_СМП"  />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_закупки_ОГРН" targetField="|Document|Победитель|Победитель_ОГРН"  />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_ОКОПФ" targetField="|Document|Победитель|Победитель_ОКОПФ"/>
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_ОКПО" targetField="|Document|Победитель|Победитель_ОКПО"  />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_страна_код" targetField="|Document|Победитель|Победитель_страна_код" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_страна" targetField="|Document|Победитель|Победитель_страна" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_индекс" targetField="|Document|Победитель|Победитель_индекс"/>
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_регион_код" targetField="|Document|Победитель|Победитель_регион_код" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_регион" targetField="|Document|Победитель|Победитель_регион" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_состоит_на_учете" targetField="|Document|Победитель|Победитель_состоит_на_учете" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_дата_постановки" targetField="|Document|Победитель|Победитель_дата_постановки" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_район" targetField="|Document|Победитель|Победитель_район" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_город" targetField="|Document|Победитель|Победитель_город" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_населенный_пункт" targetField="|Document|Победитель|Победитель_населенный_пункт" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_улица" targetField="|Document|Победитель|Победитель_улица" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_дом" targetField="|Document|Победитель|Победитель_дом" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_корпус" targetField="|Document|Победитель|Победитель_корпус" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_офис" targetField="|Document|Победитель|Победитель_офис"/>
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_email" targetField="|Document|Победитель|Победитель_email" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_телефон" targetField="|Document|Победитель|Победитель_телефон" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_идентификационный_номер" targetField="|Document|Победитель|Победитель_идентификационный_номер" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_доп_идентификационный_номер" targetField="|Document|Победитель|Победитель_доп_идентификационный_номер" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_нерезидент" targetField="|Document|Победитель|Победитель_нерезидент" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_отсутствует_в_РНП" targetField="|Document|Победитель|Победитель_отсутствует_в_РНП" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Окончательная_цена_без_НДС" targetField="|Document|Победитель|Фактическая_цена_закупки_без_НДС" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Окончательная_цена_с_НДС" targetField="|Document|Победитель|Фактическая_цена_закупки_с_НДС" />
							</Actions>
					</ConditionalAction>
				</Actions>
			</ConditionalActions>
		</OnDocumentCreated>
		<OnRegcardEdited>
				<ConditionalActions>
				<Select>					
				    <Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and xn-in(doc_Id, {currentDocLinkList})]" tag="ППЗ_победитель" />					
				</Select>
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldEquals path="|Document|Результат_код" value="F"/>
							</And>
						</Conditions>
							<Actions>
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки" targetField="|Document|Победитель|Победитель" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_наименование" targetField="|Document|Победитель|Победитель_наименование" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_ИНН" targetField="|Document|Победитель|Победитель_ИНН"  />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_КПП" targetField="|Document|Победитель|Победитель_КПП"  />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_тип_код" targetField="|Document|Победитель|Победитель_тип_код"  />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_тип" targetField="|Document|Победитель|Победитель_тип" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_СМП" targetField="|Document|Победитель|Победитель_СМП"  />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_закупки_ОГРН" targetField="|Document|Победитель|Победитель_ОГРН"  />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_ОКОПФ" targetField="|Document|Победитель|Победитель_ОКОПФ"/>
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_ОКПО" targetField="|Document|Победитель|Победитель_ОКПО"  />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_страна_код" targetField="|Document|Победитель|Победитель_страна_код" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_страна" targetField="|Document|Победитель|Победитель_страна" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_индекс" targetField="|Document|Победитель|Победитель_индекс"/>
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_регион_код" targetField="|Document|Победитель|Победитель_регион_код" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_регион" targetField="|Document|Победитель|Победитель_регион" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_состоит_на_учете" targetField="|Document|Победитель|Победитель_состоит_на_учете" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_дата_постановки" targetField="|Document|Победитель|Победитель_дата_постановки" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_район" targetField="|Document|Победитель|Победитель_район" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_город" targetField="|Document|Победитель|Победитель_город" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_населенный_пункт" targetField="|Document|Победитель|Победитель_населенный_пункт" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_улица" targetField="|Document|Победитель|Победитель_улица" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_дом" targetField="|Document|Победитель|Победитель_дом" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_корпус" targetField="|Document|Победитель|Победитель_корпус" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_офис" targetField="|Document|Победитель|Победитель_офис"/>
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_email" targetField="|Document|Победитель|Победитель_email" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_телефон" targetField="|Document|Победитель|Победитель_телефон" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_идентификационный_номер" targetField="|Document|Победитель|Победитель_идентификационный_номер" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_доп_идентификационный_номер" targetField="|Document|Победитель|Победитель_доп_идентификационный_номер" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_нерезидент" targetField="|Document|Победитель|Победитель_нерезидент" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Участник_заявки_отсутствует_в_РНП" targetField="|Document|Победитель|Победитель_отсутствует_в_РНП" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Окончательная_цена_без_НДС" targetField="|Document|Победитель|Фактическая_цена_закупки_без_НДС" />
								<CopyField sourceFlow="{current}" targetFlow="ППЗ_победитель" sourceField="|Document|Окончательная_цена_с_НДС" targetField="|Document|Победитель|Фактическая_цена_закупки_с_НДС" />
							</Actions>
					</ConditionalAction>
				</Actions>
			</ConditionalActions>
		</OnRegcardEdited>
		<LinksModify>
			<LinkCurrentDoc />
		</LinksModify>
	</Flow>
	
<Flow name="Договоры 223ФЗ">
		<FieldsModify>
			<SetField dst="|Document|Имя_потока" value="Договоры 223ФЗ" />
			<!-- <CopyField src="%key%" dst="|Document|ИД_лота" /> -->
			<CopyField src="|Document|НМЦ_с_НДС"  />
			<CopyField src="|Document|Победитель|Фактическая_цена_закупки_с_НДС" dst="|Document|Цена_с_НДС"  />
			<CopyField src="|Document|Победитель|Фактическая_цена_закупки_без_НДС" dst="|Document|Цена_без_НДС" />	
			<CopyField src="|Document|Предмет_договора"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ИНН"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_КПП"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОГРН"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_ИНН"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_КПП"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_ОРГН"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик" dst="|Document|Организатор_закупки|Организатор_закупки" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование" dst="|Document|Организатор_закупки|Организатор_закупки_наименование" />
			<CopyField src="|Document|Победитель|Победитель" dst="|Document|Организация_поставщик|Организация_поставщик" />
			<CopyField src="|Document|Победитель|Победитель_наименование" dst="|Document|Организация_поставщик|Организация_поставщик_наименование" />
			<CopyField src="|Document|Победитель|Победитель_ИНН" dst="|Document|Организация_поставщик|Организация_поставщик_ИНН" />
			<CopyField src="|Document|Победитель|Победитель_КПП" dst="|Document|Организация_поставщик|Организация_поставщик_КПП" />
			<CopyField src="|Document|Победитель|Победитель_СМП" dst="|Document|Организация_поставщик|Организация_поставщик_СМП" />
			<CopyField src="|Document|Победитель|Победитель_тип_код" dst="|Document|Организация_поставщик|Тип_юридического_лица_код" />
			<CopyField src="|Document|Победитель|Победитель_тип" dst="|Document|Организация_поставщик|Тип_юридического_лица" />
			<CopyField src="|Document|Победитель|Победитель_ОГРН" dst="|Document|Организация_поставщик|Организация_поставщик_ОГРН" />
			<CopyField src="|Document|Победитель|Победитель_нерезидент" dst="|Document|Организация_поставщик|Организация_поставщик_нерезидент" />
			<CopyField src="|Document|Победитель|Победитель_идентификационный_номер" dst="|Document|Организация_поставщик|Организация_поставщик_идентификационный_номер" />
			<CopyField src="|Document|Победитель|Победитель_доп_идентификационный_номер" dst="|Document|Организация_поставщик|Организация_поставщик_доп_идентификационный_номер" />
			<CopyField src="|Document|Победитель|Победитель_страна" dst="|Document|Организация_поставщик|Организация_поставщик_страна" />
			<CopyField src="|Document|Победитель|Победитель_страна_код" dst="|Document|Организация_поставщик|Организация_поставщик_страна_код" />
			<CopyField src="|Document|Победитель|Победитель_индекс" dst="|Document|Организация_поставщик|Организация_поставщик_индекс" />
			<CopyField src="|Document|Победитель|Победитель_регион" dst="|Document|Организация_поставщик|Организация_поставщик_регион" />
			<CopyField src="|Document|Победитель|Победитель_регион_код" dst="|Document|Организация_поставщик|Организация_поставщик_регион_код" />
			<CopyField src="|Document|Победитель|Победитель_состоит_на_учете" dst="|Document|Организация_поставщик|Организация_поставщик_состоит_на_учете" />
			<CopyField src="|Document|Победитель|Победитель_район" dst="|Document|Организация_поставщик|Организация_поставщик_район" />
			<CopyField src="|Document|Победитель|Победитель_населенный_пункт" dst="|Document|Организация_поставщик|Организация_поставщик_населенный_пункт" />
			<CopyField src="|Document|Победитель|Победитель_улица" dst="|Document|Организация_поставщик|Организация_поставщик_улица" />
			<CopyField src="|Document|Победитель|Победитель_дом" dst="|Document|Организация_поставщик|Организация_поставщик_дом" />
			<CopyField src="|Document|Победитель|Победитель_город" dst="|Document|Организация_поставщик|Организация_поставщик_город" />
			<CopyField src="|Document|Победитель|Победитель_корпус" dst="|Document|Организация_поставщик|Организация_поставщик_корпус" />
			<CopyField src="|Document|Победитель|Победитель_офис" dst="|Document|Организация_поставщик|Организация_поставщик_офис" />
			<CopyField src="|Document|Победитель|Победитель_email" dst="|Document|Организация_поставщик|Организация_поставщик_email" />
			<CopyField src="|Document|Победитель|Победитель_дата_постановки" dst="|Document|Организация_поставщик|Организация_поставщик_дата_постановки" />
			<CopyField src="|Document|Победитель|Победитель_телефон" dst="|Document|Организация_поставщик|Организация_поставщик_телефон" />
			<CopyField src="|Document|Победитель|Победитель_ОКОПФ" dst="|Document|Организация_поставщик|Организация_поставщик_ОКОПФ" />
			<CopyField src="|Document|Победитель|Победитель_ОКПО" dst="|Document|Организация_поставщик|Организация_поставщик_ОКПО" />				
			<CopyField src="|Document|Способ_закупки" />
			<CopyField src="|Document|Способ_закупки_код" />
			<CopyField src="|Document|Способ_закупки_положение"  />
			<CopyField src="|Document|Валюта" />
			<CopyField src="|Document|Цифровой_код_валюты" />
			<CopyField src="|Document|Код_валюты" />
			<CopyField src="|Document|Закупка_в_электронной_форме" />
			<CopyField src="|Document|Номер_извещения" />
			<CopyField src="|Document|Номер_лота_в_извещении" />
			<CopyField src="|Document|Название_закупки" />
			<CopyField src="|Document|ИД_извещения" />
			<CopyField src="|Document|Регистрационный_номер" dst="|Document|Номер_лота" />
			<CopyField src="|Document|Рамочный_договор" />
			<CopyField src="|Document|Инновационная_продукция" />
			<CopyField src="|Document|Номер_закупки" />
			<CopyField src="|Document|Наименование_ЭТП" />
			<CopyField src="|Document|ИД_ЭТП" />
			<CopyField src="|Document|Адрес_ЭТП" />			
			<CopyField src="|Document|ИД_на_ЭТП" />			
			<CopyField src="|Document|Год_закупки" />
			<CopyField src="|Document|Дата_подведения_итогов" />
			
		</FieldsModify>
		<LinksModify>
			<LinkCurrentDoc />
		</LinksModify>
		<OnDocumentCreated transaction="split">
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="current" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and doc_Links/doc_Link/link_Document='{current_Id}']" tag="Позиции плана закупок 223ФЗ" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявка на размещение закупки 223ФЗ' and xn-in(doc_Links/doc_Link/link_Document, {currentDocLinkList})]" tag="Заявка на размещение закупки 223ФЗ" />
					<!-- <Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок 223ФЗ" /> -->
				</Select>
				<Actions>
					<SetField targetFlow="Позиции плана закупок 223ФЗ" targetField="|Document|Статус" value="Заключение договора" />
					<SetFieldGuid targetFlow="current" targetField="|Document|ИД_в_ЕИС" />
					<CopyField sourceFlow="{current}" targetFlow="Позиции плана закупок 223ФЗ" sourceField="%key%" targetField="|Document|ИД_договора" /> 
					<CopyField sourceFlow="Заявка на размещение закупки 223ФЗ" targetFlow="{current}" sourceField="%key%" targetField="|Document|ИД_лота" /> 
					<!-- <CopyField sourceFlow="Позиции плана закупок 223ФЗ" targetFlow="current" sourceField="%key%" targetField="|Document|ИД_договора" /> --> 
					<CopyField sourceFlow="Позиции плана закупок 223ФЗ" targetFlow="current" sourceField="|Document|Регистрационный_номер" targetField="|Document|Номер_лота" />
					<!-- <CopyField sourceFlow="Позиции плана закупок 223ФЗ" targetFlow="current" sourceField="|Document|НМЦ_без_НДС" targetField="|Document|Цена_без_НДС" />
					<CopyField sourceFlow="Позиции плана закупок 223ФЗ" targetFlow="current" sourceField="|Document|НМЦ_с_НДС" targetField="|Document|Цена_с_НДС" />--> 
					<CopyField sourceFlow="current" targetFlow="Позиции плана закупок 223ФЗ" sourceField="|Document|Номер_договора" targetField="|Document|Номер_договора" />
		<!-- 			<VerifyExpression>
						<Variables>
							<Variable name="Ценаконтракта" source="{current}" path="|Document|Цена_с_НДС" />
							<Variable name="НМЦ" source="{current}" path="|Document|НМЦ_с_НДС" />
						</Variables>
						<Expression value="$NullToZero({Ценаконтракта}) &lt;= $NullToZero({НМЦ})"/>
						<FailtureText value="Цена договора не должна превышать НМЦ"/>
			</VerifyExpression> -->
				</Actions>
			</Aggregation>
			<NamedConstants>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Регистрационный_номер"/>					
					<Setting key="CounterNameFormat" value="({|Document|Имя_потока}/{|Document|Организация_заказчик|Организация_заказчик})"/>
				</Constant>	
			</NamedConstants>		
		</OnDocumentCreated>
		<!-- <OnRegcardEdited>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Заявка на размещение закупки 223ФЗ' and xn-in(doc_Links/doc_Link/link_Document, {currentDocLinkList})]" tag="Заявка на размещение закупки 223ФЗ" />
					</Select>
				<Actions>
					<CopyField sourceFlow="Заявка на размещение закупки 223ФЗ" targetFlow="{current}" sourceField="%key%" targetField="|Document|ИД_лота" /> 				
				</Actions>
			</Aggregation>
		</OnRegcardEdited> -->
	</Flow>
	
	<Flow name="Дополнительные соглашения 223ФЗ">
		<FieldsModify>
			<SetField dst="|Document|Имя_потока" value="Дополнительные соглашения 223ФЗ" />
			<CopyField src="|Document|Предмет_договора" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_наименование" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_ИНН" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_КПП" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_СМП" />
			<CopyField src="|Document|Организация_поставщик|Тип_юридического_лица" />
			<CopyField src="|Document|Организация_поставщик|Тип_юридического_лица_код" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_ОГРН" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_нерезидент" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_идентификационный_номер" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_доп_идентификационный_номер" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_страна" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_страна_код" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_индекс" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_регион" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_регион_код" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_состоит_на_учете" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_район" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_населенный_пункт" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_улица" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_дом" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_город" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_корпус" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_офис" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_email" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_дата_постановки" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_телефон" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_ОКОПФ" />
			<CopyField src="|Document|Организация_поставщик|Организация_поставщик_ОКПО" />
			<CopyField src="|Document|Способ_закупки" />
			<CopyField src="|Document|Способ_закупки_код" />
			<CopyField src="|Document|Способ_закупки_положение"  />
			<CopyField src="|Document|Валюта" />
			<CopyField src="|Document|Цифровой_код_валюты" />
			<CopyField src="|Document|Код_валюты" />
			<CopyField src="|Document|Закупка_в_электронной_форме" />
			<CopyField src="|Document|Номер_извещения" />
			<CopyField src="|Document|Название_закупки" />
			<CopyField src="|Document|ИД_извещения" />
			<CopyField src="|Document|ИД_лота" />
			<CopyField src="|Document|Номер_лота" />
			<CopyField src="%key%" dst="|Document|ИД_договора" />
			<CopyField src="|Document|Номер_договора" dst="|Document|Номер_основного_договора" />
			<CopyField src="|Document|Дата_заключения" dst="|Document|Дата_основного_договора" />
			<CopyField src="|Document|Инновационная_продукция" />
			<CopyField src="|Document|Номер_закупки" />
			<CopyField src="|Document|Наименование_ЭТП" />
			<CopyField src="|Document|ИД_ЭТП" />
			<CopyField src="|Document|Адрес_ЭТП" />			
			<CopyField src="|Document|ИД_на_ЭТП" />
			<CopyField src="|Document|Год_закупки" />	
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ИНН"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_КПП"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОГРН"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_ИНН"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_КПП"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_ОРГН"  />
		</FieldsModify>
		<LinksModify>
			<LinkCurrentDoc />
		</LinksModify>
		<OnDocumentCreated>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="current" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Договоры' and doc_Links/doc_Link/link_Document='{current_Id}']" tag="Договоры 223ФЗ" />
				</Select>
				<Actions>
					<SetField targetFlow="Договоры 223ФЗ" targetField="|Document|Статус" value="Заключение договора" />
					<SetFieldGuid targetFlow="current" targetField="|Document|ИД_в_ЕИС" />
					<CopyField sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="%key%" targetField="|Document|ИД_договора" />
					<CopyField sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Номер_договора" targetField="|Document|Номер_основного_договора" />
					<CopyField sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Дата_заключения" targetField="|Document|Дата_основного_договора" />
					<CopyField sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Номер_лота" targetField="|Document|Номер_лота" />
					<CopyField sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|ИД_лота" targetField="|Document|ИД_лота" />
					<CopyField sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|ИД_извещения" targetField="|Document|ИД_извещения" />
					<CopyField sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Название_закупки" targetField="|Document|Название_закупки" />
					<CopyField sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Номер_извещения" targetField="|Document|Номер_извещения" />
					<CopyField sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Валюта" targetField="|Document|Валюта" />
					<CopyField sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Код_валюты" targetField="|Document|Код_валюты" />
					<CopyField sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Цифровой_код_валюты" targetField="|Document|Цифровой_код_валюты" />

				</Actions>
			</Aggregation>
			<NamedConstants>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Регистрационный_номер"/>
					<Setting key="CounterNameFormat" value="({|Document|Имя_потока}/{|Document|Организация_заказчик|Организация_заказчик})"/>
				</Constant>	
			</NamedConstants>
		</OnDocumentCreated>
	</Flow>
	
	<Flow name="Планы закупок 223ФЗ">
		<FieldsModify>
			<SetField dst="|Document|Имя_потока" value="Планы закупок 223ФЗ" />
			<Plan223FieldsModify flowNameForSearch="Позиции плана закупок 223ФЗ"  flowNamePlan="Планы закупок 223ФЗ" />
			<ThrowIfExist statuses="Опубликовано в ЕИС;Неактуальный" message="Формирование нового плана не доступно при неразмещенной версии плана закупок в базе"/>			
		</FieldsModify>  
 
	
		<OnDocumentCreated transaction="single">
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Планы закупок 223ФЗ' and doc_RegCard/rc_Index/boolean_Инновационная_продукция = '{currentDocField=|Document|Инновационная_продукция}' and doc_RegCard/rc_Index/integer_Организация_заказчик = '{currentDocField=|Document|Организация_заказчик|Организация_заказчик}' and doc_RegCard/rc_Index/integer_Год = '{currentDocField=|Document|Год}' and doc_RegCard/rc_Index/integer_Номер_редакции = '1']" tag="Первая_Версия_Плана" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and doc_RegCard/rc_Index/integer_Организация_заказчик = '{currentDocField=|Document|Организация_заказчик|Организация_заказчик}' and doc_RegCard/rc_Index/integer_Год_закупки = '{currentDocField=|Document|Год}' and not(xn-in(doc_RegCard/rc_Index/text_Статус,'Подготовка ППЗ','Доработка ППЗ','Подготовка лота','Согласование','Согласовано руководителем инициатора','Согласовано для вынесения на ЦЗК','Согласовано','Отклонено','Согласование лота')) and doc_RegCard/rc_Index/boolean_Инновационная_продукция = '{currentDocField=|Document|Инновационная_продукция}']" tag="ППЗ_связь" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and doc_RegCard/rc_Index/integer_Организация_заказчик = '{currentDocField=|Document|Организация_заказчик|Организация_заказчик}' and doc_RegCard/rc_Index/integer_Год_закупки = '{currentDocField=|Document|Год}' and not(xn-in(doc_RegCard/rc_Index/text_Статус,'Подготовка ППЗ','Доработка ППЗ','Подготовка лота','Согласование','Согласовано руководителем инициатора','Согласовано для вынесения на ЦЗК','Согласовано','Отклонено','Согласование лота')) and doc_RegCard/rc_Index/boolean_Инновационная_продукция = '{currentDocField=|Document|Инновационная_продукция}' and doc_RegCard/rc_Index/boolean_Участник_закупки_СМП = '1']" tag="ППЗ_связь_СМП" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and doc_RegCard/rc_Index/integer_Организация_заказчик = '{currentDocField=|Document|Организация_заказчик|Организация_заказчик}' and doc_RegCard/rc_Index/integer_Год_закупки = '{currentDocField=|Document|Год}' and not(xn-in(doc_RegCard/rc_Index/text_Статус,'Подготовка ППЗ','Доработка ППЗ','Подготовка лота','Согласование','Согласовано руководителем инициатора','Согласовано для вынесения на ЦЗК','Согласовано','Отклонено','Согласование лота')) and doc_RegCard/rc_Index/boolean_Инновационная_продукция = '{currentDocField=|Document|Инновационная_продукция}' and doc_RegCard/rc_Index/boolean_Закупка_не_учитывается = '1']" tag="ППЗ_связь_исключение" />
																																								
				</Select>
				<Actions>
                    <AddLink target="{current}" link="ППЗ_связь"/>								
				
					<CopyField sourceFlow="Первая_Версия_Плана" targetFlow="{current}" sourceField="|Document|Объем_закупок" targetField="|Document|Объем_закупок_первой_версии" />
					<Count sourceFlow="ППЗ_связь" targetFlow="{current}" targetField="|Document|Количество_лотов" />
					<Sum sourceFlow="ППЗ_связь" targetFlow="{current}" targetField="|Document|Объем_закупок" sourceField="|Document|НМЦ_с_НДС" useSqlAggregate="yes"/>
					<Sum sourceFlow="ППЗ_связь_СМП" targetFlow="{current}" targetField="|Document|Объем_закупок_СМП" sourceField="|Document|НМЦ_с_НДС" useSqlAggregate="yes"/>
					<Sum sourceFlow="ППЗ_связь_исключение" targetFlow="{current}" targetField="|Document|Объем_закупок_исключенные" sourceField="|Document|НМЦ_с_НДС" useSqlAggregate="yes"/>
						<SetLotSequentialNumbers  planInnoFlagPropertyName="doc_RegCard/rc_Index/boolean_Инновационная_продукция"
                                              planYearPropertyName="doc_RegCard/rc_Index/integer_Год"
                                              planOrgZakPropertyName="doc_RegCard/rc_Index/integer_Организация_заказчик">
                     <MaxLotNumQuery>
                            (doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ') and (doc_RegCard/rc_Index/integer_Год_закупки = '{0}') and (doc_RegCard/rc_Index/boolean_Инновационная_продукция = '{1}') and (doc_RegCard/rc_Index/integer_Организация_заказчик = '{2}')
                     </MaxLotNumQuery>
                     <FirstTimeInPlanQuery>  (doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ') and (doc_RegCard/rc_Index/integer_Год_закупки = '{0}') and (doc_RegCard/rc_Index/boolean_Инновационная_продукция = '{1}') and (doc_RegCard/rc_Index/integer_Организация_заказчик = '{2}')
                      and not (xn-in(doc_RegCard/rc_Index/text_Статус,'Подготовка ППЗ','Доработка ППЗ','Подготовка лота','Согласование','Согласовано руководителем инициатора','Согласовано для вынесения на ЦЗК','Согласовано','Отклонено','Согласование лота')) and (not((doc_RegCard/rc_Index/integer_Номер_позиции_плана)))
                       </FirstTimeInPlanQuery>
                  </SetLotSequentialNumbers>
				</Actions>
			</Aggregation>
			<NamedConstants>
				<!-- <CommonConditions>
					<Condition path="|Document|Число_регномера" operation="neq" value="" />
				</CommonConditions> -->
				<Constant>
<!-- 					<Conditions>
						<Condition path="|Document|Номер_редакции" operation="eq" value="" />
					</Conditions> -->
					<Setting key="IncrementedElementPath" value="|Document|Номер_редакции"/>
					<Setting key="CounterNameFormat" value="({|Document|Имя_потока}/{|Document|Год}/{|Document|Организация_заказчик|Организация_заказчик}/{|Document|Инновационная_продукция})"/>
				</Constant>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Регистрационный_номер"/>
					<Setting key="CounterNameFormat" value="({|Document|Имя_потока}/{|Document|Организация_заказчик|Организация_заказчик})"/>
				</Constant>
			</NamedConstants>
					<ConditionalActions>
				<Select/>	
	
				
				<Actions>
					<ConditionalAction>
						<Conditions>
							<And>
								<WhenFieldsEquals  tag="{current}" path="|Document|ИД_в_ЕИС" value="" />

							</And>
						</Conditions>
						<Actions>
					
							<SetFieldGuid targetFlow="{current}" targetField="|Document|ИД_в_ЕИС" />
						</Actions>
					</ConditionalAction>
				</Actions>
			</ConditionalActions> 
		</OnDocumentCreated>
		<OnLinkAdded transaction="single">
			<Aggregation>
				<Select>
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and doc_RegCard/rc_Index/text_Статус = 'ППЗ согласована' and xn-in(doc_Id, {currentDocLinkList})]" tag="ППЗ"/>
				</Select>
				<Actions>
					<SetField targetFlow="ППЗ" targetField="|Document|Статус" value="Включена в проект плана закупок" />	
				</Actions>
			</Aggregation>
		</OnLinkAdded>

	</Flow>
	

<Flow name="Протоколы 223ФЗ">
		<LinksModify>
			<LinkCurrentDoc />
			<LinkAllLinksWhereFlow name="Заявки участников  223ФЗ" />
			<LinkAllLinksWhereFlow name="Заявка на размещение закупки 223ФЗ" />
			<LinkAllLinksWhereFlow name="Извещения о закупочной процедуре 223ФЗ" />
			<LinkAllLinksWhereFlow name="Позиции плана закупок 223ФЗ" />							  
		</LinksModify>
		<OnDocumentCreated transaction="split">
			<Aggregation>
				<Select>
				<Select searchString="document[doc_RegCard/rc_FlowName = 'Извещения о закупочной процедуре 223ФЗ' and xn-in(doc_Id, {currentDocLinkList})]" tag="Извещения о закупочной процедуре 223ФЗ" />					
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Извещения о закупочной процедуре 223ФЗ' and xn-in(doc_Id, {currentDocLinkList}) and doc_RegCard/rc_Index/boolean_Наличие_процедуры_в_ЕИС = '1']" tag="Лоты_ЕИС" />			
				<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок 223ФЗ" />	
				</Select>
					<Actions>
					<CopyField  sourceFlow='Извещения о закупочной процедуре 223ФЗ' targetFlow="{current}" sourceField="%key%" targetField="|Document|ИД_извещения" />
					<!-- <CopyField  sourceFlow='Извещения о закупочной процедуре 223ФЗ' targetFlow="{current}" sourceField="|Document|ИД_извещения" targetField="|Document|ИД_извещения" /> -->
					<CopyField  sourceFlow='Извещения о закупочной процедуре 223ФЗ' targetFlow="{current}" sourceField="|Document|Номер_извещения_в_ЕИС" targetField="|Document|Номер_извещения_в_ЕИС" />
					<CopyField  sourceFlow='Извещения о закупочной процедуре 223ФЗ' targetFlow="{current}" sourceField="|Document|ИД_извещения_на_ЭТП" targetField="|Document|ИД_извещения_на_ЭТП" />
					<CopyField  sourceFlow='Извещения о закупочной процедуре 223ФЗ' targetFlow="{current}" sourceField="|Document|ИД_ЭТП" targetField="|Document|ИД_ЭТП" />					
					<CopyField  sourceFlow='Извещения о закупочной процедуре 223ФЗ' targetFlow="{current}" sourceField="|Document|Организация_заказчик|Организация_заказчик" targetField="|Document|Организация_заказчик|Организация_заказчик" />
					<CopyField  sourceFlow='Извещения о закупочной процедуре 223ФЗ' targetFlow="{current}" sourceField="|Document|Организация_заказчик|Организация_заказчик_наименование" targetField="|Document|Организация_заказчик|Организация_заказчик_наименование" />
					<CopyField  sourceFlow='Извещения о закупочной процедуре 223ФЗ' targetFlow="{current}" sourceField="|Document|Организатор_закупки|Организатор_закупки" targetField="|Document|Организатор_закупки|Организатор_закупки" />
					<CopyField  sourceFlow='Извещения о закупочной процедуре 223ФЗ' targetFlow="{current}" sourceField="|Document|Организатор_закупки|Организатор_закупки_наименование" targetField="|Document|Организатор_закупки|Организатор_закупки_наименование" />
					<CopyField  sourceFlow='Извещения о закупочной процедуре 223ФЗ' targetFlow="{current}" sourceField="|Document|Способ_закупки" targetField="|Document|Способ_закупки" />
					<CopyField  sourceFlow='Извещения о закупочной процедуре 223ФЗ' targetFlow="{current}" sourceField="|Document|Способ_закупки_код" targetField="|Document|Способ_закупки_код" />
					<CopyField  sourceFlow='Извещения о закупочной процедуре 223ФЗ' targetFlow="{current}" sourceField="|Document|Способ_закупки_положение" targetField="|Document|Способ_закупки_положение" />
					<CopyField  sourceFlow='Извещения о закупочной процедуре 223ФЗ' targetFlow="{current}" sourceField="|Document|Номер_итогового_протокола" targetField="|Document|Номер_протокола_в_ЕИС" />
					<CopyField sourceFlow="Лоты_ЕИС" targetFlow="{current}" sourceField="|Document|Заказчик_подразделение|Заказчик_подразделение" targetField="|Document|Заказчик_подразделение|Заказчик_подразделение" />	
                    <CopyField sourceFlow="Лоты_ЕИС" targetFlow="{current}" sourceField="|Document|Заказчик_подразделение|Заказчик_подразделение_наименование" targetField="|Document|Заказчик_подразделение|Заказчик_подразделение_наименование" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организация_заказчик|Организация_заказчик_ИНН" targetField="|Document|Организация_заказчик|Организация_заказчик_ИНН" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организация_заказчик|Организация_заказчик_КПП" targetField="|Document|Организация_заказчик|Организация_заказчик_КПП" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организация_заказчик|Организация_заказчик_ОГРН" targetField="|Document|Организация_заказчик|Организация_заказчик_ОГРН" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организатор_закупки|Организатор_закупки_ИНН" targetField="|Document|Организатор_закупки|Организатор_закупки_ИНН" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организатор_закупки|Организатор_закупки_КПП" targetField="|Document|Организатор_закупки|Организатор_закупки_КПП" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организатор_закупки|Организатор_закупки_ОРГН" targetField="|Document|Организатор_закупки|Организатор_закупки_ОРГН" />
	</Actions>
			</Aggregation>
			<NamedConstants>		
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Номер_редакции"/>
					<Setting key="CounterNameFormat" value="({|Document|Имя_потока}/{|Document|ИД_извещения}/{|Document|Код_протокола})"/>
				</Constant>			
			</NamedConstants>
			<ConditionalActions>
				<Select/>
				<Actions>
					<ConditionalAction>			
						<Conditions>
							<And>
								<WhenFieldEquals path="|Document|ИД_в_ЕИС" value="" />
							</And>
						</Conditions>
						<Actions>
							<SetFieldGuid targetFlow="{current}" targetField="|Document|ИД_в_ЕИС" />
						</Actions>
					</ConditionalAction>
				</Actions>
			</ConditionalActions>
		</OnDocumentCreated>
		
		<OnRegcardEdited transaction="single"> 
			<Aggregation>
			<Select>			
				<Select searchString="document[doc_RegCard/rc_FlowName = 'Позиции плана закупок 223ФЗ' and xn-in(doc_Id, {currentDocLinkList})]" tag="Позиции плана закупок 223ФЗ" />	
				</Select>
				<Actions>
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организация_заказчик|Организация_заказчик_ИНН" targetField="|Document|Организация_заказчик|Организация_заказчик_ИНН" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организация_заказчик|Организация_заказчик_КПП" targetField="|Document|Организация_заказчик|Организация_заказчик_КПП" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организация_заказчик|Организация_заказчик_ОГРН" targetField="|Document|Организация_заказчик|Организация_заказчик_ОГРН" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организатор_закупки|Организатор_закупки_ИНН" targetField="|Document|Организатор_закупки|Организатор_закупки_ИНН" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организатор_закупки|Организатор_закупки_КПП" targetField="|Document|Организатор_закупки|Организатор_закупки_КПП" />
					<CopyField  sourceFlow='Позиции плана закупок 223ФЗ' targetFlow="{current}" sourceField="|Document|Организатор_закупки|Организатор_закупки_ОРГН" targetField="|Document|Организатор_закупки|Организатор_закупки_ОРГН" />
	</Actions>
			</Aggregation>
		</OnRegcardEdited>
		
		<FieldsModify>		
			<SetField dst="|Document|Имя_потока" value="Протоколы 223ФЗ" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование" />
			<CopyField src="|Document|Способ_закупки" />
			<CopyField src="|Document|Способ_закупки_код"  />
			<CopyField src="|Document|Способ_закупки_положение"  />
			<CopyField src="|Document|ИД_лота" />
			<CopyField src="|Document|ИД_извещения" />
			<CopyField src="|Document|Номер_извещения" />
			<CopyField src="|Document|ИД_ЭТП" />
			<CopyField src="|Document|Год_закупки" />
		</FieldsModify>
		</Flow>
		
	<Flow name="Исполнение договора 223ФЗ">
		<LinksModify>
			<LinkCurrentDoc />
		</LinksModify>
		<OnDocumentCreated>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="current" />
					<Select searchString="document[doc_RegCard/rc_FlowName = 'Договоры' and doc_Links/doc_Link/link_Document='{current_Id}']" tag="Договоры 223ФЗ"/>
				</Select>
				<Actions>
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="%key%" targetField="|Document|ИД_договора" />
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|ИД_лота" targetField="|Document|ИД_лота" />
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Номер_договора" targetField="|Document|Номер_договора" />
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Дата_заключения" targetField="|Document|Дата_заключения_договора" />
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Номер_договора_в_ЕИС" targetField="|Document|Номер_договора_в_ЕИС" />
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Предмет_договора" targetField="|Document|Предмет_договора" />
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Валюта" targetField="|Document|Валюта" />
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Код_валюты" targetField="|Document|Код_валюты" />
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Цифровой_код_валюты" targetField="|Document|Цифровой_код_валюты" />
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Организация_заказчик|Организация_заказчик" targetField="|Document|Организация_заказчик|Организация_заказчик" />
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Организация_заказчик|Организация_заказчик_наименование" targetField="|Document|Организация_заказчик|Организация_заказчик_наименование" />
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Организатор_закупки|Организатор_закупки" targetField="|Document|Организатор_закупки|Организатор_закупки" />
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Организатор_закупки|Организатор_закупки_наименование" targetField="|Document|Организатор_закупки|Организатор_закупки_наименование" />
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Организация_поставщик" targetField="|Document|Организация_поставщик" />
					<CopyField  sourceFlow="Договоры 223ФЗ" targetFlow="current" sourceField="|Document|Организация_поставщик|Организация_поставщик_наименование" targetField="|Document|Организация_поставщик|Организация_поставщик_наименование" />
				</Actions>
			</Aggregation>
			<NamedConstants>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Номер_редакции"/>
					<Setting key="CounterNameFormat" value="({|Document|Имя_потока}/{|Document|Имя_потока}/{|Document|ИД_договора}/{|Document|Номер_этапа})"/>
				</Constant>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Регистрационный_номер"/>
					<Setting key="CounterNameFormat" value="({|Document|Имя_потока}/{|Document|Организация_заказчик|Организация_заказчик})"/>
				</Constant>	
			</NamedConstants>
		</OnDocumentCreated>
		<FieldsModify>
			<SetField dst="|Document|Имя_потока" value="Исполнение договора 223ФЗ" />		
			<CopyField src="|Document|ИД_лота"  />
			<CopyField src="|Document|ИД_договора"  />
			<CopyField src="|Document|Номер_договора"  />
			<CopyField src="|Document|Год_закупки" />

			<CopyField src="|Document|Дата_заключения" dst="|Document|Дата_заключения_договора" />
			<CopyField src="|Document|Предмет_договора" />
			<CopyField src="|Document|Номер_договора_в_ЕИС"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик" />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_наименование" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ИНН"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_КПП"  />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_ОГРН"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_ИНН"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_КПП"  />
			<CopyField src="|Document|Организатор_закупки|Организатор_закупки_ОРГН"  />
		</FieldsModify>
	</Flow>
	<Flow name="Отчетность о договорах 223ФЗ">
		<FieldsModify>
			<SetField dst="|Document|Имя_потока" value="Отчетность о договорах 223ФЗ" />	
	
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик_наименование" />
			<CopyField src="|Document|Организация_заказчик|Организация_заказчик" />
		</FieldsModify>			
		<OnDocumentCreated>
			<Aggregation>
				<Select>
					<Select searchString="document[doc_Id = '{current_Id}']" tag="current" />
				</Select>
				<Actions>
					<SetFieldGuid targetFlow="current" targetField="|Document|ИД_в_ЕИС" />					
				</Actions>
			</Aggregation>	
			<NamedConstants>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Номер_редакции"/>
					<Setting key="CounterNameFormat" value="({|Document|Имя_потока}/{|Document|Организация_заказчик|Организация_заказчик}/{|Document|Тип_отчетности_код}/{|Document|Период_сведений_с}/{|Document|Период_сведений_по})"/>
				</Constant>
				<Constant>
					<Setting key="IncrementedElementPath" value="|Document|Регистрационный_номер"/>
					<Setting key="CounterNameFormat" value="({|Document|Имя_потока}/{|Document|Организация_заказчик|Организация_заказчик})"/>
				</Constant>	
			</NamedConstants>
		</OnDocumentCreated>
	</Flow>
	
	<Flow name="Положение о закупках 223ФЗ">
		<FieldsModify>
		</FieldsModify>

		<OnDocumentCreated transaction="single">
			<Aggregation>
				<Select>
					<Select searchString="document[
                doc_RegCard/rc_FlowName = 'Положение о закупках 223ФЗ' and
                doc_RegCard/rc_Index/text_Организация_заказчик_наименование = '{currentDocField=|Document|Организация_заказчик|Организация_заказчик_наименование}'
                ]" tag="Положение о закупках 223ФЗ" />
				</Select>
				<Actions>
					<DocsCountCheck sourceTag="Положение о закупках 223ФЗ" operation="notEmpty" message="Для данной организации положение о закупках уже зарегистрировано" />
				</Actions>
			</Aggregation>
		</OnDocumentCreated>

	</Flow>
	<!--223ФЗEND-->
</Hooks>